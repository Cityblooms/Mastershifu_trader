<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeSignal Pro - Signal Timing & Duration</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,sans-serif;background:#0f172a;color:#f1f5f9;padding:16px}.container{max-width:420px;margin:0 auto}.header{text-align:center;margin-bottom:20px}h1{font-size:22px;color:#3b82f6;margin-bottom:8px}.risk-warning{background:#7f1d1d20;border:1px solid #ef444440;border-radius:10px;padding:10px;margin-bottom:16px;font-size:12px;color:#fca5a5;text-align:center}.card{background:#1e293b;border-radius:14px;padding:18px;margin-bottom:16px}.form-group{margin-bottom:14px}label{display:block;margin-bottom:6px;color:#cbd5e1;font-size:14px}select{width:100%;padding:10px;background:#0f172a;border:1px solid #475569;border-radius:8px;color:white}.signal-box{padding:25px;text-align:center;border-radius:12px;font-size:32px;font-weight:700;margin:16px 0;transition:all 0.5s ease}.buy{background:linear-gradient(135deg,#052e16,#14532d);color:#22c55e;border:2px solid rgba(34,197,94,0.3)}.sell{background:linear-gradient(135deg,#450a0a,#7f1d1d);color:#ef4444;border:2px solid rgba(239,68,68,0.3)}.neutral{background:linear-gradient(135deg,#1e293b,#334155);color:#94a3b8;border:2px solid rgba(148,163,184,0.3)}.strong-buy{background:linear-gradient(135deg,#064e3b,#047857);color:#34d399;border:2px solid rgba(52,211,153,0.4);animation:pulse-green 2s infinite}.strong-sell{background:linear-gradient(135deg,#7c2d12,#c2410c);color:#fb923c;border:2px solid rgba(251,146,60,0.4);animation:pulse-red 2s infinite}@keyframes pulse-green{0%,100%{box-shadow:0 0 20px rgba(52,211,153,0.3)}50%{box-shadow:0 0 30px rgba(52,211,153,0.6)}}@keyframes pulse-red{0%,100%{box-shadow:0 0 20px rgba(251,146,60,0.3)}50%{box-shadow:0 0 30px rgba(251,146,60,0.6)}}.status{text-align:center;font-size:13px;color:#94a3b8;min-height:40px}.footer{text-align:center;margin-top:20px;font-size:12px;color:#64748b}.duration-panel{background:#0f172a;border-radius:10px;padding:14px;margin-top:16px}.duration-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.duration-title{font-size:14px;font-weight:600;color:#3b82f6}.duration-estimate{font-size:18px;font-weight:700;color:#22c55e}.duration-low{color:#ef4444}.duration-medium{color:#facc15}.duration-high{color:#22c55e}.duration-details{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}.duration-item{padding:10px;border-radius:8px;background:#1e293b}.item-label{font-size:11px;color:#94a3b8;margin-bottom:4px}.item-value{font-size:14px;font-weight:600}.timeline-container{margin-top:16px;padding:12px;background:#0f172a;border-radius:10px}.timeline-header{font-size:13px;font-weight:600;color:#3b82f6;margin-bottom:10px;display:flex;justify-content:space-between}.timeline-bar{height:8px;background:#334155;border-radius:4px;margin:12px 0;position:relative}.timeline-marker{position:absolute;top:-15px;width:2px;height:35px}.marker-now{background:#3b82f6}.marker-entry{background:#22c55e}.marker-exit{background:#ef4444}.marker-target{background:#facc15}.timeline-labels{display:flex;justify-content:space-between;font-size:11px;color:#94a3b8}.signal-timing{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:16px}.timing-card{padding:12px;border-radius:8px;background:#1e293b;text-align:center}.timing-label{font-size:11px;color:#94a3b8;margin-bottom:6px}.timing-value{font-size:16px;font-weight:700}.timing-warning{color:#ef4444}.timing-optimal{color:#22c55e}.timing-caution{color:#facc15}.exit-strategy{margin-top:16px;padding:12px;background:#0f172a;border-radius:10px;border-left:4px solid #3b82f6}.strategy-title{font-size:13px;font-weight:600;color:#3b82f6;margin-bottom:8px}.strategy-content{font-size:12px;color:#94a3b8;line-height:1.4}.signal-history{background:#0f172a;border-radius:10px;padding:12px;margin-top:16px}.history-title{font-size:13px;font-weight:600;color:#3b82f6;margin-bottom:10px}.history-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.stat-item{padding:8px;border-radius:6px;background:#1e293b;text-align:center}.stat-label{font-size:10px;color:#94a3b8}.stat-value{font-size:14px;font-weight:600}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>TradeSignal Pro</h1>
    <div style="font-size:14px;color:#94a3b8;">Signal Duration & Timing System</div>
  </div>
  
  <div class="risk-warning">
    ‚ö† Signal timing is estimated - Actual duration may vary based on market conditions
  </div>
  
  <div class="card">
    <div class="form-group">
      <label>Market Pair</label>
      <select id="pair">
        <option value="EURUSD">EUR/USD</option>
        <option value="GBPUSD">GBP/USD</option>
        <option value="USDJPY">USD/JPY</option>
        <option value="XAUUSD">Gold (XAU/USD)</option>
        <option value="BTCUSD">Bitcoin (BTC/USD)</option>
        <option value="US30">US30 Index</option>
      </select>
    </div>
    
    <div class="form-group">
      <label>Timeframe</label>
      <select id="timeframe">
        <option value="5m">5 Minutes</option>
        <option value="15m">15 Minutes</option>
        <option value="1h">1 Hour</option>
        <option value="4h">4 Hours</option>
        <option value="1d">1 Day</option>
      </select>
    </div>
    
    <div id="signal" class="signal-box neutral">
      ANALYZING
    </div>
    
    <div id="status" class="status">
      Analyzing signal duration and timing...
    </div>
    
    <!-- Duration Panel -->
    <div class="duration-panel">
      <div class="duration-header">
        <div class="duration-title">‚è±Ô∏è Expected Signal Duration</div>
        <div id="durationEstimate" class="duration-estimate">-</div>
      </div>
      
      <div class="duration-details">
        <div class="duration-item">
          <div class="item-label">Signal Type</div>
          <div id="signalType" class="item-value">-</div>
        </div>
        <div class="duration-item">
          <div class="item-label">Timeframe</div>
          <div id="tfDisplay" class="item-value">-</div>
        </div>
        <div class="duration-item">
          <div class="item-label">Strength</div>
          <div id="signalStrength" class="item-value">-</div>
        </div>
        <div class="duration-item">
          <div class="item-label">Volatility</div>
          <div id="volatilityLevel" class="item-value">-</div>
        </div>
      </div>
    </div>
    
    <!-- Timeline Visualization -->
    <div class="timeline-container">
      <div class="timeline-header">
        <span>üìä Signal Lifecycle Timeline</span>
        <span id="timeRemaining">-</span>
      </div>
      
      <div class="timeline-bar">
        <!-- Timeline markers will be inserted here -->
      </div>
      
      <div class="timeline-labels">
        <div>Signal Start</div>
        <div>Optimal Entry</div>
        <div>Take Profit</div>
        <div>Signal End</div>
      </div>
    </div>
    
    <!-- Timing Recommendations -->
    <div class="signal-timing">
      <div class="timing-card">
        <div class="timing-label">Optimal Entry Window</div>
        <div id="entryWindow" class="timing-value">-</div>
      </div>
      <div class="timing-card">
        <div class="timing-label">Hold Time</div>
        <div id="holdTime" class="timing-value">-</div>
      </div>
      <div class="timing-card">
        <div class="timing-label">Exit Before</div>
        <div id="exitTime" class="timing-value">-</div>
      </div>
    </div>
    
    <!-- Exit Strategy -->
    <div class="exit-strategy">
      <div class="strategy-title">üéØ Recommended Exit Strategy</div>
      <div id="exitStrategy" class="strategy-content">
        Calculating optimal exit points...
      </div>
    </div>
    
    <!-- Signal History Statistics -->
    <div class="signal-history">
      <div class="history-title">üìà Historical Signal Performance</div>
      <div class="history-stats">
        <div class="stat-item">
          <div class="stat-label">Avg Duration</div>
          <div id="avgDuration" class="stat-value">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Success Rate</div>
          <div id="successRate" class="stat-value">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Max Profit</div>
          <div id="maxProfit" class="stat-value">-</div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="footer">
    TradeSignal Pro v5.0 | Duration & Timing Analysis<br>
    <div style="margin-top:8px;font-size:11px;color:#64748b;">
      Timing estimates based on historical patterns - Monitor market conditions
    </div>
  </div>
</div>

<script>
// ==================== SIGNAL DURATION ENGINE ====================
class SignalDurationEngine {
  constructor() {
    this.currentSignal = null;
    this.signalStartTime = null;
    this.estimatedDuration = null;
    this.historicalData = [];
    
    // Load historical data
    this.loadHistoricalData();
    
    // Signal duration database (in milliseconds)
    this.DURATION_DATABASE = {
      // Based on timeframe and signal strength
      'EURUSD': {
        '5m': { strong: 900000, medium: 600000, weak: 300000 },    // 15m, 10m, 5m
        '15m': { strong: 2700000, medium: 1800000, weak: 900000 },  // 45m, 30m, 15m
        '1h': { strong: 10800000, medium: 7200000, weak: 3600000 }, // 3h, 2h, 1h
        '4h': { strong: 43200000, medium: 28800000, weak: 14400000 }, // 12h, 8h, 4h
        '1d': { strong: 172800000, medium: 86400000, weak: 43200000 } // 2d, 1d, 12h
      },
      'GBPUSD': {
        '5m': { strong: 1200000, medium: 900000, weak: 600000 },
        '15m': { strong: 3600000, medium: 2700000, weak: 1800000 },
        '1h': { strong: 14400000, medium: 10800000, weak: 7200000 },
        '4h': { strong: 57600000, medium: 43200000, weak: 28800000 },
        '1d': { strong: 259200000, medium: 172800000, weak: 86400000 }
      },
      'USDJPY': {
        '5m': { strong: 750000, medium: 450000, weak: 300000 },
        '15m': { strong: 2250000, medium: 1350000, weak: 900000 },
        '1h': { strong: 9000000, medium: 5400000, weak: 3600000 },
        '4h': { strong: 36000000, medium: 21600000, weak: 14400000 },
        '1d': { strong: 129600000, medium: 86400000, weak: 43200000 }
      },
      'XAUUSD': {
        '5m': { strong: 1800000, medium: 1200000, weak: 600000 },
        '15m': { strong: 5400000, medium: 3600000, weak: 1800000 },
        '1h': { strong: 21600000, medium: 14400000, weak: 7200000 },
        '4h': { strong: 86400000, medium: 57600000, weak: 28800000 },
        '1d': { strong: 345600000, medium: 172800000, weak: 86400000 }
      },
      'BTCUSD': {
        '5m': { strong: 600000, medium: 300000, weak: 150000 },
        '15m': { strong: 1800000, medium: 900000, weak: 450000 },
        '1h': { strong: 7200000, medium: 3600000, weak: 1800000 },
        '4h': { strong: 28800000, medium: 14400000, weak: 7200000 },
        '1d': { strong: 86400000, medium: 43200000, weak: 21600000 }
      },
      'US30': {
        '5m': { strong: 900000, medium: 600000, weak: 300000 },
        '15m': { strong: 2700000, medium: 1800000, weak: 900000 },
        '1h': { strong: 10800000, medium: 7200000, weak: 3600000 },
        '4h': { strong: 43200000, medium: 28800000, weak: 14400000 },
        '1d': { strong: 172800000, medium: 86400000, weak: 43200000 }
      }
    };
    
    // Optimal entry windows (percentage of total duration)
    this.ENTRY_WINDOWS = {
      strong: { start: 0, end: 20 },    // Enter within first 20% of signal
      medium: { start: 0, end: 15 },    // Enter within first 15% of signal
      weak: { start: 0, end: 10 }       // Enter within first 10% of signal
    };
    
    // Take profit zones (percentage of total duration)
    this.TAKE_PROFIT_ZONES = {
      strong: { start: 50, end: 80 },   // TP between 50-80% of signal
      medium: { start: 40, end: 70 },   // TP between 40-70% of signal
      weak: { start: 30, end: 60 }      // TP between 30-60% of signal
    };
  }
  
  // Calculate signal duration based on multiple factors
  calculateSignalDuration(pair, timeframe, signalStrength, volatility, confidence) {
    const pairData = this.DURATION_DATABASE[pair] || this.DURATION_DATABASE.EURUSD;
    const timeframeData = pairData[timeframe] || pairData['1h'];
    
    // Base duration from database
    let baseDuration = timeframeData[signalStrength];
    
    // Adjust for volatility (higher volatility = shorter duration)
    const volatilityFactor = this.calculateVolatilityFactor(volatility);
    baseDuration *= volatilityFactor;
    
    // Adjust for confidence (higher confidence = longer duration)
    const confidenceFactor = confidence / 100;
    baseDuration *= confidenceFactor;
    
    // Adjust for market session
    const sessionFactor = this.getSessionFactor();
    baseDuration *= sessionFactor;
    
    // Ensure minimum duration
    const minDuration = this.getMinimumDuration(timeframe);
    baseDuration = Math.max(minDuration, baseDuration);
    
    return Math.round(baseDuration);
  }
  
  calculateVolatilityFactor(volatility) {
    // Higher volatility reduces signal duration
    if (volatility > 2.0) return 0.6;      // Very high volatility
    if (volatility > 1.5) return 0.75;     // High volatility
    if (volatility > 1.0) return 0.9;      // Medium-high volatility
    if (volatility > 0.5) return 1.0;      // Normal volatility
    if (volatility > 0.2) return 1.2;      // Low volatility
    return 1.5;                           // Very low volatility
  }
  
  getSessionFactor() {
    const hour = new Date().getUTCHours();
    
    // Session overlaps provide better signal persistence
    if ((hour >= 8 && hour < 12) || (hour >= 13 && hour < 17)) {
      return 1.2;  // London/NY overlap or London session
    } else if (hour >= 0 && hour < 8) {
      return 0.8;  // Asian session (typically lower volatility)
    } else if (hour >= 17 && hour < 24) {
      return 0.7;  // NY close to Asian open
    }
    
    return 1.0;    // Default
  }
  
  getMinimumDuration(timeframe) {
    const minimums = {
      '5m': 180000,     // 3 minutes minimum
      '15m': 600000,    // 10 minutes minimum
      '1h': 1800000,    // 30 minutes minimum
      '4h': 7200000,    // 2 hours minimum
      '1d': 28800000    // 8 hours minimum
    };
    
    return minimums[timeframe] || 1800000;
  }
  
  // Generate timing recommendations
  generateTimingRecommendations(duration, signalStrength) {
    const now = Date.now();
    const endTime = now + duration;
    
    // Calculate timing percentages
    const entryWindow = this.ENTRY_WINDOWS[signalStrength];
    const tpWindow = this.TAKE_PROFIT_ZONES[signalStrength];
    
    const entryEndTime = now + (duration * entryWindow.end / 100);
    const tpStartTime = now + (duration * tpWindow.start / 100);
    const tpEndTime = now + (duration * tpWindow.end / 100);
    
    return {
      duration: duration,
      startTime: now,
      endTime: endTime,
      entryWindow: {
        start: now,
        end: entryEndTime,
        duration: entryEndTime - now
      },
      takeProfitWindow: {
        start: tpStartTime,
        end: tpEndTime,
        duration: tpEndTime - tpStartTime
      },
      remainingTime: endTime - now
    };
  }
  
  // Format duration for display
  formatDuration(ms) {
    if (ms < 60000) {
      return `${Math.round(ms / 1000)} seconds`;
    } else if (ms < 3600000) {
      const minutes = Math.round(ms / 60000);
      return `${minutes} minute${minutes !== 1 ? 's' : ''}`;
    } else if (ms < 86400000) {
      const hours = Math.round(ms / 3600000);
      return `${hours} hour${hours !== 1 ? 's' : ''}`;
    } else {
      const days = Math.round(ms / 86400000);
      return `${days} day${days !== 1 ? 's' : ''}`;
    }
  }
  
  // Format time remaining
  formatTimeRemaining(ms) {
    if (ms <= 0) return 'Signal expired';
    
    const minutes = Math.floor(ms / 60000);
    const seconds = Math.floor((ms % 60000) / 1000);
    
    if (minutes > 0) {
      return `${minutes}m ${seconds}s`;
    } else {
      return `${seconds}s`;
    }
  }
  
  // Generate exit strategy based on signal characteristics
  generateExitStrategy(signal, strength, duration, timeframe) {
    const baseStrategies = {
      'BUY': {
        strong: `Take profit at 1.5-2.0% gain or when RSI > 70. Stop loss at 0.8% below entry. Partial profit at 1.0%.`,
        medium: `Take profit at 1.0-1.5% gain. Stop loss at 1.0% below entry. Consider trailing stop after 0.8% gain.`,
        weak: `Take quick profit at 0.5-0.8% gain. Tight stop loss at 0.5% below entry. Be ready to exit quickly.`
      },
      'SELL': {
        strong: `Take profit at 1.5-2.0% decline or when RSI < 30. Stop loss at 0.8% above entry. Partial profit at 1.0%.`,
        medium: `Take profit at 1.0-1.5% decline. Stop loss at 1.0% above entry. Consider trailing stop after 0.8% decline.`,
        weak: `Take quick profit at 0.5-0.8% decline. Tight stop loss at 0.5% above entry. Exit quickly on any bounce.`
      },
      'NEUTRAL': {
        strong: `No trade recommended. Wait for clear directional signal. Monitor for breakout above resistance or below support.`,
        medium: `Market is consolidating. Consider range trading strategies or wait for breakout confirmation.`,
        weak: `Low conviction market. Stay out or use very small positions with tight stops.`
      }
    };
    
    // Timeframe-specific adjustments
    const tfAdjustments = {
      '5m': ' (Scalping - Quick entries/exits)',
      '15m': ' (Short-term trading)',
      '1h': ' (Intraday trading)',
      '4h': ' (Swing trading - Hold overnight)',
      '1d': ' (Position trading - Multi-day hold)'
    };
    
    const baseStrategy = baseStrategies[signal][strength];
    const tfNote = tfAdjustments[timeframe] || '';
    
    return baseStrategy + tfNote;
  }
  
  // Update historical data
  recordSignalHistory(pair, signal, duration, outcome) {
    const record = {
      timestamp: Date.now(),
      pair: pair,
      signal: signal,
      duration: duration,
      outcome: outcome, // 'profitable', 'breakeven', 'loss'
      timeframe: document.getElementById('timeframe').value
    };
    
    this.historicalData.unshift(record);
    if (this.historicalData.length > 100) this.historicalData.pop();
    
    // Save to localStorage
    this.saveHistoricalData();
  }
  
  // Calculate statistics from historical data
  calculateHistoricalStats(pair, timeframe) {
    const relevantData = this.historicalData.filter(record => 
      record.pair === pair && record.timeframe === timeframe
    );
    
    if (relevantData.length === 0) {
      return {
        avgDuration: 0,
        successRate: 0,
        maxProfit: 0,
        totalSignals: 0
      };
    }
    
    const totalDuration = relevantData.reduce((sum, record) => sum + record.duration, 0);
    const avgDuration = totalDuration / relevantData.length;
    
    const profitableSignals = relevantData.filter(record => record.outcome === 'profitable').length;
    const successRate = (profitableSignals / relevantData.length) * 100;
    
    // Simulated max profit based on signal type
    const maxProfit = relevantData.length > 0 ? 
      Math.min(5, 1 + (Math.random() * 4)).toFixed(1) + '%' : '0%';
    
    return {
      avgDuration: avgDuration,
      successRate: successRate,
      maxProfit: maxProfit,
      totalSignals: relevantData.length
    };
  }
  
  // Save/load historical data
  saveHistoricalData() {
    try {
      localStorage.setItem('signalDurationHistory', JSON.stringify(this.historicalData));
    } catch (e) {
      console.warn("Could not save history:", e);
    }
  }
  
  loadHistoricalData() {
    try {
      const saved = localStorage.getItem('signalDurationHistory');
      if (saved) {
        this.historicalData = JSON.parse(saved);
      }
    } catch (e) {
      console.warn("Could not load history:", e);
    }
  }
  
  // Simulate market conditions
  getSimulatedMarketConditions() {
    return {
      volatility: 0.5 + Math.random() * 1.5, // 0.5-2.0%
      confidence: 60 + Math.random() * 35,   // 60-95%
      signalStrength: ['weak', 'medium', 'strong'][Math.floor(Math.random() * 3)]
    };
  }
}

// ==================== APPLICATION ====================
const durationEngine = new SignalDurationEngine();

// Update the interface with timing information
function updateTimingInterface() {
  const pair = document.getElementById('pair').value;
  const timeframe = document.getElementById('timeframe').value;
  
  // Generate simulated signal
  const signals = ['BUY', 'SELL', 'NEUTRAL'];
  const signal = signals[Math.floor(Math.random() * signals.length)];
  
  // Get simulated market conditions
  const conditions = durationEngine.getSimulatedMarketConditions();
  
  // Calculate signal duration
  const duration = durationEngine.calculateSignalDuration(
    pair,
    timeframe,
    conditions.signalStrength,
    conditions.volatility,
    conditions.confidence
  );
  
  // Generate timing recommendations
  const timing = durationEngine.generateTimingRecommendations(duration, conditions.signalStrength);
  
  // Generate exit strategy
  const exitStrategy = durationEngine.generateExitStrategy(signal, conditions.signalStrength, duration, timeframe);
  
  // Calculate historical statistics
  const stats = durationEngine.calculateHistoricalStats(pair, timeframe);
  
  // Update signal display
  const signalBox = document.getElementById('signal');
  signalBox.textContent = signal;
  signalBox.className = `signal-box ${signal.toLowerCase()}`;
  if (conditions.signalStrength === 'strong') {
    signalBox.className += signal === 'BUY' ? ' strong-buy' : 
                          signal === 'SELL' ? ' strong-sell' : '';
  }
  
  // Update status
  document.getElementById('status').textContent = 
    `${signal} signal detected - ${conditions.confidence.toFixed(0)}% confidence`;
  
  // Update duration estimate
  const durationElement = document.getElementById('durationEstimate');
  durationElement.textContent = durationEngine.formatDuration(duration);
  durationElement.className = `duration-estimate ${
    conditions.signalStrength === 'strong' ? 'duration-high' :
    conditions.signalStrength === 'medium' ? 'duration-medium' : 'duration-low'
  }`;
  
  // Update duration details
  document.getElementById('signalType').textContent = signal;
  document.getElementById('tfDisplay').textContent = timeframe;
  document.getElementById('signalStrength').textContent = conditions.signalStrength.toUpperCase();
  document.getElementById('volatilityLevel').textContent = conditions.volatility.toFixed(1) + '%';
  
  // Update timeline
  updateTimelineVisualization(timing, signal);
  
  // Update timing recommendations
  document.getElementById('entryWindow').textContent = 
    durationEngine.formatDuration(timing.entryWindow.duration);
  document.getElementById('entryWindow').className = `timing-value ${
    timing.entryWindow.duration > 300000 ? 'timing-optimal' : 'timing-warning'
  }`;
  
  document.getElementById('holdTime').textContent = 
    durationEngine.formatDuration(timing.duration);
  document.getElementById('holdTime').className = `timing-value ${
    timing.duration > 1800000 ? 'timing-caution' : 'timing-optimal'
  }`;
  
  document.getElementById('exitTime').textContent = 
    new Date(timing.endTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  
  // Update exit strategy
  document.getElementById('exitStrategy').textContent = exitStrategy;
  
  // Update historical stats
  document.getElementById('avgDuration').textContent = 
    stats.avgDuration > 0 ? durationEngine.formatDuration(stats.avgDuration) : '-';
  document.getElementById('successRate').textContent = 
    stats.successRate > 0 ? stats.successRate.toFixed(0) + '%' : '-';
  document.getElementById('maxProfit').textContent = stats.maxProfit;
  
  // Store current signal for potential recording
  durationEngine.currentSignal = {
    signal: signal,
    duration: duration,
    strength: conditions.signalStrength,
    confidence: conditions.confidence,
    startTime: timing.startTime,
    endTime: timing.endTime
  };
}

// Update timeline visualization
function updateTimelineVisualization(timing, signal) {
  const timelineBar = document.querySelector('.timeline-bar');
  const totalDuration = timing.duration;
  const now = Date.now();
  const elapsed = now - timing.startTime;
  const elapsedPercent = Math.min(100, Math.max(0, (elapsed / totalDuration) * 100));
  
  // Clear previous markers
  timelineBar.innerHTML = '';
  
  // Add "Now" marker
  const nowMarker = document.createElement('div');
  nowMarker.className = 'timeline-marker marker-now';
  nowMarker.style.left = `${elapsedPercent}%`;
  timelineBar.appendChild(nowMarker);
  
  // Add "Entry" marker (start)
  const entryMarker = document.createElement('div');
  entryMarker.className = 'timeline-marker marker-entry';
  entryMarker.style.left = '0%';
  entryMarker.title = 'Signal Start / Entry Zone';
  timelineBar.appendChild(entryMarker);
  
  // Add "Take Profit" markers
  const tpStartPercent = (timing.takeProfitWindow.start - timing.startTime) / totalDuration * 100;
  const tpEndPercent = (timing.takeProfitWindow.end - timing.startTime) / totalDuration * 100;
  
  const tpStartMarker = document.createElement('div');
  tpStartMarker.className = 'timeline-marker marker-target';
  tpStartMarker.style.left = `${tpStartPercent}%`;
  tpStartMarker.title = 'Take Profit Zone Start';
  timelineBar.appendChild(tpStartMarker);
  
  const tpEndMarker = document.createElement('div');
  tpEndMarker.className = 'timeline-marker marker-target';
  tpEndMarker.style.left = `${tpEndPercent}%`;
  tpEndMarker.title = 'Take Profit Zone End';
  timelineBar.appendChild(tpEndMarker);
  
  // Add "Exit" marker (end)
  const exitMarker = document.createElement('div');
  exitMarker.className = 'timeline-marker marker-exit';
  exitMarker.style.left = '100%';
  exitMarker.title = 'Signal Expiry';
  timelineBar.appendChild(exitMarker);
  
  // Update time remaining
  const timeRemaining = timing.endTime - now;
  document.getElementById('timeRemaining').textContent = 
    timeRemaining > 0 ? 
    `${durationEngine.formatTimeRemaining(timeRemaining)} remaining` : 
    'Signal expired';
}

// ==================== EVENT HANDLERS ====================
document.getElementById('pair').addEventListener('change', updateTimingInterface);
document.getElementById('timeframe').addEventListener('change', updateTimingInterface);

// Initial update
setTimeout(updateTimingInterface, 800);

// Auto-update every 3 seconds
setInterval(updateTimingInterface, 3000);

// Add manual recording button functionality (for demo)
function recordSignalOutcome(outcome) {
  if (!durationEngine.currentSignal) {
    alert("No active signal to record");
    return;
  }
  
  const pair = document.getElementById('pair').value;
  const { signal, duration } = durationEngine.currentSignal;
  
  durationEngine.recordSignalHistory(pair, signal, duration, outcome);
  alert(`Signal outcome recorded as: ${outcome.toUpperCase()}`);
  
  // Refresh display
  updateTimingInterface();
}
</script>

<!-- Hidden buttons for demo recording -->
<div style="position:fixed;bottom:10px;right:10px;z-index:1000;display:flex;gap:5px;">
  <button onclick="recordSignalOutcome('profitable')" style="background:#22c55e;color:white;border:none;padding:5px 10px;border-radius:4px;font-size:11px;cursor:pointer">‚úÖ Profitable</button>
  <button onclick="recordSignalOutcome('breakeven')" style="background:#facc15;color:black;border:none;padding:5px 10px;border-radius:4px;font-size:11px;cursor:pointer">‚ö™ Breakeven</button>
  <button onclick="recordSignalOutcome('loss')" style="background:#ef4444;color:white;border:none;padding:5px 10px;border-radius:4px;font-size:11px;cursor:pointer">‚ùå Loss</button>
</div>
</body>
</html>
