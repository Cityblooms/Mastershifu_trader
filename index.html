<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KILLER ZONE - Professional RSI Trading System</title>
    <style>
        :root {
            --bg-dark: #0a0e23;
            --panel-bg: #151a35;
            --accent-gold: #FFD700;
            --buy-green: #00C853;
            --sell-red: #FF3D00;
            --strong-buy: #00E676;
            --strong-sell: #FF5252;
            --pending: #2196F3;
            --text-white: #FFFFFF;
            --text-gray: #B0B0B0;
            --border-radius: 12px;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-white);
            line-height: 1.4;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #1a1f3d 0%, #0a0e23 100%);
            padding: 15px 20px;
            text-align: center;
            border-bottom: 2px solid var(--accent-gold);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            color: var(--accent-gold);
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .header p {
            color: var(--text-gray);
            font-size: 0.85rem;
        }
        
        /* Sync Status */
        .sync-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 0.8rem;
        }
        
        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .sync-dot.synced {
            background: var(--buy-green);
            animation: pulse 2s infinite;
        }
        
        .sync-dot.syncing {
            background: #FF9800;
            animation: pulse 1s infinite;
        }
        
        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 15px;
        }
        
        /* Assets Grid */
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .assets-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Asset Card */
        .asset-card {
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .asset-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }
        
        .asset-card.active {
            border-color: var(--accent-gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), transparent);
        }
        
        /* Signal States */
        .asset-card.buy-signal {
            border-color: var(--buy-green);
            background: linear-gradient(135deg, rgba(0, 200, 83, 0.1), transparent);
        }
        
        .asset-card.sell-signal {
            border-color: var(--sell-red);
            background: linear-gradient(135deg, rgba(255, 61, 0, 0.1), transparent);
        }
        
        .asset-card.strong-buy-signal {
            border-color: var(--strong-buy);
            background: linear-gradient(135deg, rgba(0, 230, 118, 0.15), transparent);
            animation: strongPulse 3s infinite;
        }
        
        .asset-card.strong-sell-signal {
            border-color: var(--strong-sell);
            background: linear-gradient(135deg, rgba(255, 82, 82, 0.15), transparent);
            animation: strongPulse 3s infinite;
        }
        
        /* Asset Header */
        .asset-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .asset-name-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .asset-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .asset-details {
            flex: 1;
        }
        
        .asset-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .asset-symbol {
            color: var(--text-gray);
            font-size: 0.85rem;
        }
        
        /* Signal Badge */
        .signal-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .buy-badge {
            background: var(--buy-green);
            color: #000;
        }
        
        .sell-badge {
            background: var(--sell-red);
            color: #fff;
        }
        
        .strong-buy-badge {
            background: var(--strong-buy);
            color: #000;
            animation: textGlow 2s infinite;
        }
        
        .strong-sell-badge {
            background: var(--strong-sell);
            color: #000;
            animation: textGlow 2s infinite;
        }
        
        .pending-badge {
            background: var(--pending);
            color: #fff;
        }
        
        /* RSI Display */
        .rsi-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .rsi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .rsi-label {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        .rsi-value {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .rsi-oversold {
            color: var(--strong-buy);
        }
        
        .rsi-overbought {
            color: var(--strong-sell);
        }
        
        .rsi-neutral {
            color: var(--text-gray);
        }
        
        /* RSI Progress Bar */
        .rsi-progress {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .rsi-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .progress-buy {
            background: linear-gradient(90deg, var(--strong-buy), var(--buy-green));
        }
        
        .progress-sell {
            background: linear-gradient(90deg, var(--sell-red), var(--strong-sell));
        }
        
        .progress-neutral {
            background: linear-gradient(90deg, var(--buy-green), var(--text-gray), var(--sell-red));
        }
        
        /* Signal Strength */
        .signal-strength {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
        }
        
        .strength-dots {
            display: flex;
            gap: 3px;
        }
        
        .strength-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .strength-dot.active {
            background: var(--buy-green);
        }
        
        .strength-dot.active.sell {
            background: var(--sell-red);
        }
        
        /* Signal Age */
        .signal-freshness {
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .freshness-indicator {
            height: 100%;
            border-radius: 2px;
            transition: width 1s linear;
        }
        
        .freshness-new {
            background: var(--buy-green);
        }
        
        .freshness-old {
            background: var(--text-gray);
        }
        
        /* Multi-Timeframe Agreement */
        .timeframe-agreement {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.75rem;
            color: var(--text-gray);
            margin-top: 5px;
        }
        
        .agreement-count {
            background: rgba(255, 215, 0, 0.2);
            color: var(--accent-gold);
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        /* Timeframe Signals */
        .timeframe-signals {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        .tf-signal {
            text-align: center;
            padding: 6px;
            border-radius: 6px;
            font-size: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .tf-buy {
            background: rgba(0, 200, 83, 0.2);
            color: var(--buy-green);
        }
        
        .tf-sell {
            background: rgba(255, 61, 0, 0.2);
            color: var(--sell-red);
        }
        
        .tf-strong-buy {
            background: rgba(0, 230, 118, 0.3);
            color: var(--strong-buy);
            font-weight: 600;
        }
        
        .tf-strong-sell {
            background: rgba(255, 82, 82, 0.3);
            color: var(--strong-sell);
            font-weight: 600;
        }
        
        /* Signal Info */
        .signal-info {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .signal-type {
            color: var(--text-gray);
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .signal-confidence {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }
        
        .confidence-bar {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s ease;
        }
        
        .confidence-high {
            background: var(--buy-green);
        }
        
        .confidence-medium {
            background: #FF9800;
        }
        
        .confidence-low {
            background: var(--text-gray);
        }
        
        /* Chart Section */
        .chart-section {
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }
        
        .chart-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .chart-title {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .chart-controls {
            display: flex;
            gap: 10px;
        }
        
        .timeframe-selector {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 4px;
        }
        
        .tf-btn {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: var(--text-gray);
            font-size: 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            min-width: 40px;
            transition: all 0.3s;
        }
        
        .tf-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tf-btn.active {
            background: var(--accent-gold);
            color: #000;
            font-weight: 600;
        }
        
        .chart-display {
            height: 400px;
            position: relative;
        }
        
        #tradingview_chart {
            width: 100%;
            height: 100%;
        }
        
        /* RSI Zones */
        .rsi-zones {
            background: var(--panel-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }
        
        .zones-title {
            text-align: center;
            color: var(--accent-gold);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .zones-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        @media (min-width: 576px) {
            .zones-container {
                flex-direction: row;
            }
        }
        
        .zone {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .zone-extreme-buy {
            background: linear-gradient(135deg, #00E67620, transparent);
            border: 2px solid var(--strong-buy);
            color: var(--strong-buy);
        }
        
        .zone-buy {
            background: linear-gradient(135deg, #00C85320, transparent);
            border: 2px solid var(--buy-green);
            color: var(--buy-green);
        }
        
        .zone-neutral {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
        }
        
        .zone-sell {
            background: linear-gradient(135deg, #FF3D0020, transparent);
            border: 2px solid var(--sell-red);
            color: var(--sell-red);
        }
        
        .zone-extreme-sell {
            background: linear-gradient(135deg, #FF525220, transparent);
            border: 2px solid var(--strong-sell);
            color: var(--strong-sell);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-gray);
            font-size: 0.8rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Animations */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        @keyframes strongPulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 230, 118, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 230, 118, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 230, 118, 0); }
        }
        
        @keyframes textGlow {
            0% { text-shadow: 0 0 5px currentColor; }
            50% { text-shadow: 0 0 15px currentColor; }
            100% { text-shadow: 0 0 5px currentColor; }
        }
        
        /* Mobile Optimizations */
        @media (max-width: 576px) {
            .container {
                padding: 15px 10px;
            }
            
            .chart-display {
                height: 300px;
            }
            
            .timeframe-selector {
                overflow-x: auto;
                padding-bottom: 5px;
            }
            
            .asset-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .signal-badge {
                align-self: flex-start;
            }
        }
    </style>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1><i class="fas fa-bolt"></i> KILLER ZONE PROFESSIONAL RSI</h1>
        <p>Multi-Timeframe Confirmation â€¢ Clear BUY/SELL Signals â€¢ Real-time Analysis</p>
        <div class="sync-status">
            <div class="sync-dot syncing" id="sync-status"></div>
            <span id="sync-text">SYNCING ALL ASSETS...</span>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Assets Grid -->
        <div class="assets-grid" id="assets-grid">
            <!-- Assets will be dynamically loaded here -->
        </div>
        
        <!-- Chart Section -->
        <div class="chart-section">
            <div class="chart-header">
                <div class="chart-title" id="chart-title">BITCOIN (BTC/USD) - 15M Chart</div>
                <div class="chart-controls">
                    <div class="timeframe-selector">
                        <button class="tf-btn" data-tf="1">1M</button>
                        <button class="tf-btn" data-tf="5">5M</button>
                        <button class="tf-btn active" data-tf="15">15M</button>
                        <button class="tf-btn" data-tf="60">1H</button>
                        <button class="tf-btn" data-tf="240">4H</button>
                        <button class="tf-btn" data-tf="D">D</button>
                    </div>
                </div>
            </div>
            <div class="chart-display">
                <div id="tradingview_chart"></div>
            </div>
        </div>
        
        <!-- RSI Zones -->
        <div class="rsi-zones">
            <div class="zones-title">KILLER ZONE SIGNAL THRESHOLDS</div>
            <div class="zones-container">
                <div class="zone zone-extreme-buy">EXTREME BUY<br>RSI â‰¤ 25</div>
                <div class="zone zone-buy">BUY ZONE<br>RSI 26-35</div>
                <div class="zone zone-neutral">NEUTRAL<br>RSI 36-64</div>
                <div class="zone zone-sell">SELL ZONE<br>RSI 65-74</div>
                <div class="zone zone-extreme-sell">EXTREME SELL<br>RSI â‰¥ 75</div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        Â© 2024 KILLER ZONE Professional Trading System â€¢ All recommendations implemented
    </div>

    <script>
        // ============================================
        // SIGNAL MEMORY CLASS (Recommendation 4)
        // ============================================
        class SignalMemory {
            constructor() {
                this.lastSignals = {};
                this.signalStartTime = {};
                this.minimumHoldTime = 30; // seconds - prevents signal flipping
                this.signalHistory = {};
            }
            
            shouldChangeSignal(assetSymbol, newSignal) {
                const now = Date.now();
                const lastSignal = this.lastSignals[assetSymbol];
                
                // No previous signal - always accept new one
                if (!lastSignal) {
                    this.lastSignals[assetSymbol] = newSignal;
                    this.signalStartTime[assetSymbol] = now;
                    this.recordSignal(assetSymbol, newSignal);
                    return true;
                }
                
                // Same signal type - keep it and update time
                if (lastSignal.type === newSignal?.type) {
                    this.signalStartTime[assetSymbol] = now;
                    return true;
                }
                
                // Different signal - check if enough time has passed
                const timeSinceChange = (now - (this.signalStartTime[assetSymbol] || now)) / 1000;
                
                if (timeSinceChange >= this.minimumHoldTime && newSignal) {
                    // Enough time passed, allow signal change
                    this.lastSignals[assetSymbol] = newSignal;
                    this.signalStartTime[assetSymbol] = now;
                    this.recordSignal(assetSymbol, newSignal);
                    return true;
                }
                
                // Not enough time - keep old signal
                return false;
            }
            
            getCurrentSignal(assetSymbol) {
                return this.lastSignals[assetSymbol];
            }
            
            recordSignal(assetSymbol, signal) {
                if (!this.signalHistory[assetSymbol]) {
                    this.signalHistory[assetSymbol] = [];
                }
                
                this.signalHistory[assetSymbol].push({
                    timestamp: new Date(),
                    signal: signal
                });
                
                // Keep only last 10 signals
                if (this.signalHistory[assetSymbol].length > 10) {
                    this.signalHistory[assetSymbol].shift();
                }
            }
            
            getSignalAge(assetSymbol) {
                const startTime = this.signalStartTime[assetSymbol];
                if (!startTime) return 0;
                
                return (Date.now() - startTime) / 1000; // Age in seconds
            }
        }

        // ============================================
        // KILLER ZONE PROFESSIONAL SYSTEM
        // ============================================
        const KillerZoneSystem = {
            // Current state
            currentAsset: 'BTCUSD',
            currentTimeframe: '15',
            tvWidget: null,
            isChartLoaded: false,
            signalMemory: new SignalMemory(), // Initialize signal memory
            
            // RSI Thresholds (Recommendation 3)
            rsiThresholds: {
                extremeBuy: 25,
                buyZone: 35,
                neutralUpper: 64,
                neutralLower: 36,
                sellZone: 65,
                extremeSell: 75
            },
            
            // All assets with multi-timeframe data
            assets: [
                {
                    id: 1,
                    symbol: 'BTCUSD',
                    name: 'BITCOIN',
                    tvSymbol: 'BITSTAMP:BTCUSD',
                    icon: 'fab fa-bitcoin',
                    type: 'crypto',
                    basePrice: 45000,
                    rsiData: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    signals: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    price: null,
                    lastUpdate: null,
                    previousRSI: {}
                },
                {
                    id: 2,
                    symbol: 'ETHUSD',
                    name: 'ETHEREUM',
                    tvSymbol: 'BITSTAMP:ETHUSD',
                    icon: 'fab fa-ethereum',
                    type: 'crypto',
                    basePrice: 2400,
                    rsiData: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    signals: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    price: null,
                    lastUpdate: null,
                    previousRSI: {}
                },
                {
                    id: 3,
                    symbol: 'XAUUSD',
                    name: 'GOLD',
                    tvSymbol: 'FX_IDC:XAUUSD',
                    icon: 'fas fa-gem',
                    type: 'commodity',
                    basePrice: 1950,
                    rsiData: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    signals: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    price: null,
                    lastUpdate: null,
                    previousRSI: {}
                },
                {
                    id: 4,
                    symbol: 'EURUSD',
                    name: 'EUR/USD',
                    tvSymbol: 'FX:EURUSD',
                    icon: 'fas fa-euro-sign',
                    type: 'forex',
                    basePrice: 1.08,
                    rsiData: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    signals: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    price: null,
                    lastUpdate: null,
                    previousRSI: {}
                },
                {
                    id: 5,
                    symbol: 'NAS100',
                    name: 'NASDAQ 100',
                    tvSymbol: 'NASDAQ:NDX',
                    icon: 'fas fa-chart-line',
                    type: 'index',
                    basePrice: 16000,
                    rsiData: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    signals: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    price: null,
                    lastUpdate: null,
                    previousRSI: {}
                },
                {
                    id: 6,
                    symbol: 'US30',
                    name: 'DOW JONES',
                    tvSymbol: 'DOWI:DJI',
                    icon: 'fas fa-industry',
                    type: 'index',
                    basePrice: 34000,
                    rsiData: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    signals: {
                        '1': null, '5': null, '15': null, '60': null, '240': null, 'D': null
                    },
                    price: null,
                    lastUpdate: null,
                    previousRSI: {}
                }
            ],
            
            // ============================================
            // INITIALIZATION
            // ============================================
            async init() {
                console.log('ðŸš€ KILLER ZONE Professional System Initializing...');
                
                // Initialize all assets
                this.initializeAssets();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Load assets display
                this.loadAssetsDisplay();
                
                // Load TradingView chart
                await this.loadTradingViewChart();
                
                // Start monitoring all assets
                this.startAssetMonitoring();
                
                // Update sync status
                this.updateSyncStatus('synced');
                
                console.log('âœ… KILLER ZONE Professional System Ready');
                console.log('ðŸ“Š Monitoring 6 assets across 6 timeframes');
            },
            
            // Initialize assets with starting values
            initializeAssets() {
                this.assets.forEach(asset => {
                    // Initialize price
                    asset.price = asset.basePrice;
                    
                    // Initialize RSI for all timeframes with realistic starting values
                    Object.keys(asset.rsiData).forEach(tf => {
                        // Start each asset at different RSI levels for variety
                        const baseRSI = 40 + (Math.random() * 20); // Between 40-60
                        asset.rsiData[tf] = parseFloat(baseRSI.toFixed(2));
                        asset.previousRSI[tf] = asset.rsiData[tf];
                        asset.signals[tf] = null;
                    });
                    
                    asset.lastUpdate = new Date();
                });
            },
            
            // Setup event listeners
            setupEventListeners() {
                // Timeframe buttons
                document.querySelectorAll('.tf-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const timeframe = btn.dataset.tf;
                        this.changeTimeframe(timeframe, btn);
                    });
                });
                
                // Asset card clicks
                document.addEventListener('click', (e) => {
                    const assetCard = e.target.closest('.asset-card');
                    if (assetCard) {
                        const symbol = assetCard.dataset.symbol;
                        this.selectAsset(symbol);
                    }
                });
            },
            
            // Update sync status
            updateSyncStatus(status) {
                const syncDot = document.getElementById('sync-status');
                const syncText = document.getElementById('sync-text');
                
                syncDot.className = `sync-dot ${status}`;
                
                if (status === 'synced') {
                    syncText.textContent = 'ALL ASSETS SYNCED';
                } else {
                    syncText.textContent = 'SYNCING ALL ASSETS...';
                }
            },
            
            // ============================================
            // ASSET DISPLAY (Recommendation 6)
            // ============================================
            loadAssetsDisplay() {
                const assetsGrid = document.getElementById('assets-grid');
                assetsGrid.innerHTML = this.assets.map(asset => this.createAssetCard(asset)).join('');
            },
            
            // Create asset card HTML
            createAssetCard(asset) {
                // Get display signal (with memory and validation)
                const displaySignal = this.getDisplaySignal(asset);
                const cardClass = this.getCardClass(displaySignal);
                const badge = this.getSignalBadge(displaySignal);
                
                // Get RSI for current timeframe
                const currentRSI = asset.rsiData[this.currentTimeframe] || 50;
                const rsiColor = this.getRSIColor(currentRSI);
                const progressWidth = currentRSI;
                const progressClass = this.getProgressClass(currentRSI);
                
                // Format price
                const priceFormatted = asset.type === 'forex' 
                    ? asset.price.toFixed(4) 
                    : asset.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                
                // Calculate signal age for freshness indicator
                const signalAge = this.signalMemory.getSignalAge(asset.symbol);
                const freshnessPercent = Math.max(0, 100 - (signalAge * 2)); // Fades over 50 seconds
                
                return `
                    <div class="asset-card ${cardClass}" data-symbol="${asset.symbol}">
                        <div class="asset-header">
                            <div class="asset-name-section">
                                <div class="asset-icon">
                                    <i class="${asset.icon}"></i>
                                </div>
                                <div class="asset-details">
                                    <div class="asset-name">${asset.name}</div>
                                    <div class="asset-symbol">${asset.symbol} â€¢ $${priceFormatted}</div>
                                </div>
                            </div>
                            <div class="signal-badge ${badge.class}">
                                ${badge.text}
                            </div>
                        </div>
                        
                        <div class="rsi-section">
                            <div class="rsi-header">
                                <div class="rsi-label">RSI (${this.currentTimeframe}M)</div>
                                <div class="rsi-value ${rsiColor}">${currentRSI}</div>
                            </div>
                            <div class="rsi-progress">
                                <div class="rsi-progress-fill ${progressClass}" style="width: ${progressWidth}%"></div>
                            </div>
                        </div>
                        
                        <!-- Signal Strength Dots (Recommendation 5) -->
                        <div class="signal-strength">
                            <span style="font-size: 0.75rem; color: var(--text-gray);">Strength:</span>
                            <div class="strength-dots">
                                ${this.getStrengthDots(displaySignal)}
                            </div>
                        </div>
                        
                        <!-- Signal Freshness (Recommendation 5) -->
                        <div class="signal-freshness">
                            <div class="freshness-indicator ${freshnessPercent > 50 ? 'freshness-new' : 'freshness-old'}" 
                                 style="width: ${freshnessPercent}%"></div>
                        </div>
                        
                        <!-- Multi-Timeframe Agreement (Recommendation 2) -->
                        ${this.getTimeframeAgreementHTML(asset)}
                        
                        <div class="timeframe-signals">
                            ${this.createTimeframeSignals(asset)}
                        </div>
                        
                        <div class="signal-info">
                            <div class="signal-type">${displaySignal.reason || 'Analyzing market conditions...'}</div>
                            <div class="signal-confidence">
                                <span>Confidence:</span>
                                <div class="confidence-bar">
                                    <div class="confidence-fill ${this.getConfidenceClass(displaySignal)}" 
                                         style="width: ${displaySignal.confidence || 30}%"></div>
                                </div>
                                <span>${displaySignal.confidence || 30}%</span>
                            </div>
                        </div>
                    </div>
                `;
            },
            
            // Get strength dots HTML
            getStrengthDots(signal) {
                if (!signal || signal.type === 'ANALYZING') {
                    return '<div class="strength-dot"></div><div class="strength-dot"></div><div class="strength-dot"></div>';
                }
                
                const dotCount = signal.type.includes('STRONG') ? 3 : 2;
                const isSell = signal.type.includes('SELL');
                
                let dots = '';
                for (let i = 0; i < 3; i++) {
                    const activeClass = i < dotCount ? 'active' : '';
                    const sellClass = isSell ? 'sell' : '';
                    dots += `<div class="strength-dot ${activeClass} ${sellClass}"></div>`;
                }
                
                return dots;
            },
            
            // Get timeframe agreement HTML
            getTimeframeAgreementHTML(asset) {
                const validatedSignal = this.validateMultiTimeframeSignals(asset);
                
                if (!validatedSignal || validatedSignal.timeframeCount < 2) {
                    return '';
                }
                
                return `
                    <div class="timeframe-agreement">
                        <span>${validatedSignal.timeframeCount}/${validatedSignal.totalTimeframes} timeframes agree</span>
                        <div class="agreement-count">${validatedSignal.timeframeCount}</div>
                    </div>
                `;
            },
            
            // Create timeframe signals display
            createTimeframeSignals(asset) {
                const timeframes = ['15', '60', '240', 'D'];
                return timeframes.map(tf => {
                    const signal = asset.signals[tf];
                    const rsi = asset.rsiData[tf];
                    
                    let tfClass = '';
                    let tfText = `${tf}${tf === 'D' ? '' : 'M'}`;
                    
                    if (signal) {
                        if (signal.type === 'STRONG_BUY') tfClass = 'tf-strong-buy';
                        else if (signal.type === 'STRONG_SELL') tfClass = 'tf-strong-sell';
                        else if (signal.type === 'BUY') tfClass = 'tf-buy';
                        else if (signal.type === 'SELL') tfClass = 'tf-sell';
                        tfText += `: ${rsi}`;
                    } else {
                        tfText += `: ${rsi || '--'}`;
                    }
                    
                    return `<div class="tf-signal ${tfClass}">${tfText}</div>`;
                }).join('');
            },
            
            // ============================================
            // SIGNAL GENERATION LOGIC (Recommendation 1)
            // ============================================
            generateTimeframeSignal(currentRSI, previousRSI, timeframe) {
                if (!previousRSI) return null;
                
                const rsiChange = currentRSI - previousRSI;
                const signals = [];
                
                // 1. Extreme Zone Signals (Highest Priority)
                if (currentRSI <= this.rsiThresholds.extremeBuy && previousRSI > this.rsiThresholds.extremeBuy) {
                    signals.push({
                        type: 'STRONG_BUY',
                        strength: 95,
                        reason: 'RSI entered extreme oversold zone',
                        timeframe: timeframe,
                        rsiChange: rsiChange
                    });
                }
                
                if (currentRSI >= this.rsiThresholds.extremeSell && previousRSI < this.rsiThresholds.extremeSell) {
                    signals.push({
                        type: 'STRONG_SELL',
                        strength: 95,
                        reason: 'RSI entered extreme overbought zone',
                        timeframe: timeframe,
                        rsiChange: rsiChange
                    });
                }
                
                // 2. Zone Boundary Crossovers (Medium Priority)
                if (currentRSI <= this.rsiThresholds.buyZone && previousRSI > this.rsiThresholds.buyZone && currentRSI > this.rsiThresholds.extremeBuy) {
                    signals.push({
                        type: 'BUY',
                        strength: 80,
                        reason: 'RSI entered buy zone',
                        timeframe: timeframe,
                        rsiChange: rsiChange
                    });
                }
                
                if (currentRSI >= this.rsiThresholds.sellZone && previousRSI < this.rsiThresholds.sellZone && currentRSI < this.rsiThresholds.extremeSell) {
                    signals.push({
                        type: 'SELL',
                        strength: 80,
                        reason: 'RSI entered sell zone',
                        timeframe: timeframe,
                        rsiChange: rsiChange
                    });
                }
                
                // 3. Trend Reversal at 50 (Lower Priority)
                if (currentRSI > 50 && previousRSI <= 50 && Math.abs(rsiChange) > 2) {
                    signals.push({
                        type: 'BUY',
                        strength: 70,
                        reason: 'Bullish trend beginning',
                        timeframe: timeframe,
                        rsiChange: rsiChange
                    });
                }
                
                if (currentRSI < 50 && previousRSI >= 50 && Math.abs(rsiChange) > 2) {
                    signals.push({
                        type: 'SELL',
                        strength: 70,
                        reason: 'Bearish trend beginning',
                        timeframe: timeframe,
                        rsiChange: rsiChange
                    });
                }
                
                // Return strongest signal if any
                return signals.length > 0 ? signals[0] : null;
            },
            
            // ============================================
            // MULTI-TIMEFRAME VALIDATION (Recommendation 2)
            // ============================================
            validateMultiTimeframeSignals(asset) {
                const timeframeSignals = {};
                const timeframes = ['15', '60', '240', 'D'];
                
                timeframes.forEach(tf => {
                    const signal = asset.signals[tf];
                    if (signal) {
                        timeframeSignals[tf] = signal;
                    }
                });
                
                // Count signal types
                const signalCounts = {
                    'STRONG_BUY': 0,
                    'BUY': 0,
                    'SELL': 0,
                    'STRONG_SELL': 0
                };
                
                Object.values(timeframeSignals).forEach(signal => {
                    signalCounts[signal.type]++;
                });
                
                // Determine final signal based on consensus
                const totalSignals = Object.values(signalCounts).reduce((a, b) => a + b, 0);
                
                if (totalSignals === 0) return null;
                
                // Strong signals take precedence
                if (signalCounts.STRONG_BUY >= 2) {
                    return {
                        type: 'STRONG_BUY',
                        confidence: Math.min(95, 70 + (signalCounts.STRONG_BUY * 10)),
                        timeframeCount: signalCounts.STRONG_BUY,
                        totalTimeframes: totalSignals,
                        reason: 'Multiple timeframes show extreme oversold conditions'
                    };
                }
                
                if (signalCounts.STRONG_SELL >= 2) {
                    return {
                        type: 'STRONG_SELL',
                        confidence: Math.min(95, 70 + (signalCounts.STRONG_SELL * 10)),
                        timeframeCount: signalCounts.STRONG_SELL,
                        totalTimeframes: totalSignals,
                        reason: 'Multiple timeframes show extreme overbought conditions'
                    };
                }
                
                // Regular signals with majority
                if (signalCounts.BUY > signalCounts.SELL && signalCounts.BUY >= 2) {
                    return {
                        type: 'BUY',
                        confidence: Math.min(85, 60 + (signalCounts.BUY * 10)),
                        timeframeCount: signalCounts.BUY,
                        totalTimeframes: totalSignals,
                        reason: 'Multiple timeframes show oversold conditions'
                    };
                }
                
                if (signalCounts.SELL > signalCounts.BUY && signalCounts.SELL >= 2) {
                    return {
                        type: 'SELL',
                        confidence: Math.min(85, 60 + (signalCounts.SELL * 10)),
                        timeframeCount: signalCounts.SELL,
                        totalTimeframes: totalSignals,
                        reason: 'Multiple timeframes show overbought conditions'
                    };
                }
                
                // Single timeframe signal (weaker)
                if (signalCounts.BUY === 1 && signalCounts.SELL === 0) {
                    return {
                        type: 'BUY',
                        confidence: 60,
                        timeframeCount: 1,
                        totalTimeframes: totalSignals,
                        reason: 'Single timeframe shows oversold condition'
                    };
                }
                
                if (signalCounts.SELL === 1 && signalCounts.BUY === 0) {
                    return {
                        type: 'SELL',
                        confidence: 60,
                        timeframeCount: 1,
                        totalTimeframes: totalSignals,
                        reason: 'Single timeframe shows overbought condition'
                    };
                }
                
                return null;
            },
            
            // ============================================
            // GET DISPLAY SIGNAL (Recommendation 6)
            // ============================================
            getDisplaySignal(asset) {
                // Get multi-timeframe validated signal
                const validatedSignal = this.validateMultiTimeframeSignals(asset);
                
                // Check signal memory
                const shouldDisplay = this.signalMemory.shouldChangeSignal(asset.symbol, validatedSignal);
                
                if (!shouldDisplay || !validatedSignal) {
                    // Return memory signal or analyzing state
                    const memorySignal = this.signalMemory.getCurrentSignal(asset.symbol);
                    if (memorySignal) {
                        return memorySignal;
                    }
                    
                    return {
                        type: 'ANALYZING',
                        confidence: 30,
                        reason: 'Analyzing market conditions...'
                    };
                }
                
                // Add RSI context to signal
                const currentRSI = asset.rsiData[this.currentTimeframe] || 50;
                validatedSignal.rsi = currentRSI;
                validatedSignal.timestamp = new Date();
                
                return validatedSignal;
            },
            
            // ============================================
            // REALISTIC RSI SIMULATION (Recommendation 3)
            // ============================================
            simulateRealisticRSI(asset, timeframe) {
                let currentRSI = asset.rsiData[timeframe] || 50;
                const previousRSI = asset.previousRSI[timeframe] || currentRSI;
                
                // Market session impact
                const hour = new Date().getUTCHours();
                let sessionMultiplier = 1.0;
                
                // Asian session (22:00-06:00 UTC): Lower volatility
                if (hour >= 22 || hour < 6) {
                    sessionMultiplier = 0.7;
                }
                // London session (08:00-16:00 UTC): Medium volatility
                else if (hour >= 8 && hour < 16) {
                    sessionMultiplier = 1.2;
                }
                // NY session overlap (13:00-16:00 UTC): Highest volatility
                else if (hour >= 13 && hour < 16) {
                    sessionMultiplier = 1.5;
                }
                // NY session (16:00-21:00 UTC): High volatility
                else if (hour >= 16 && hour < 21) {
                    sessionMultiplier = 1.3;
                }
                
                // Timeframe volatility
                const tfMultiplier = {
                    '1': 3.0, '5': 2.0, '15': 1.5, '60': 1.0, '240': 0.7, 'D': 0.3
                }[timeframe] || 1.0;
                
                // Asset type volatility
                const assetMultiplier = {
                    'crypto': 1.8, 'forex': 1.2, 'commodity': 1.0, 'index': 1.5
                }[asset.type] || 1.0;
                
                // Market trend influence - creates realistic cycles
                const timeFactor = Date.now() / 10000000;
                const marketTrend = Math.sin(timeFactor) * 0.5;
                
                // Calculate movement
                const baseMovement = (Math.random() - 0.5) * 1.5;
                const trendMovement = marketTrend * 0.3;
                const totalMovement = (baseMovement + trendMovement) * 
                                     sessionMultiplier * tfMultiplier * assetMultiplier;
                
                currentRSI += totalMovement;
                
                // Strong mean reversion at extremes (real RSI behavior)
                if (currentRSI > 70) {
                    currentRSI -= Math.random() * 3; // Strong reversion from overbought
                } else if (currentRSI < 30) {
                    currentRSI += Math.random() * 3; // Strong reversion from oversold
                }
                
                // Moderate mean reversion
                if (currentRSI > 60) {
                    currentRSI -= Math.random() * 1.5;
                } else if (currentRSI < 40) {
                    currentRSI += Math.random() * 1.5;
                }
                
                // Keep in bounds but allow occasional extremes
                currentRSI = Math.max(10, Math.min(90, currentRSI));
                
                return parseFloat(currentRSI.toFixed(2));
            },
            
            // ============================================
            // HELPER METHODS
            // ============================================
            getCardClass(signal) {
                if (!signal) return '';
                
                switch(signal.type) {
                    case 'STRONG_BUY': return 'strong-buy-signal';
                    case 'STRONG_SELL': return 'strong-sell-signal';
                    case 'BUY': return 'buy-signal';
                    case 'SELL': return 'sell-signal';
                    default: return '';
                }
            },
            
            getSignalBadge(signal) {
                if (!signal || signal.type === 'ANALYZING') {
                    return { class: 'pending-badge', text: 'ANALYZING' };
                }
                
                switch(signal.type) {
                    case 'STRONG_BUY': return { class: 'strong-buy-badge', text: 'STRONG BUY' };
                    case 'STRONG_SELL': return { class: 'strong-sell-badge', text: 'STRONG SELL' };
                    case 'BUY': return { class: 'buy-badge', text: 'BUY' };
                    case 'SELL': return { class: 'sell-badge', text: 'SELL' };
                    default: return { class: 'pending-badge', text: 'ANALYZING' };
                }
            },
            
            getRSIColor(rsi) {
                if (rsi <= this.rsiThresholds.extremeBuy) return 'rsi-oversold';
                if (rsi <= this.rsiThresholds.buyZone) return 'rsi-oversold';
                if (rsi >= this.rsiThresholds.extremeSell) return 'rsi-overbought';
                if (rsi >= this.rsiThresholds.sellZone) return 'rsi-overbought';
                return 'rsi-neutral';
            },
            
            getProgressClass(rsi) {
                if (rsi <= this.rsiThresholds.buyZone) return 'progress-buy';
                if (rsi >= this.rsiThresholds.sellZone) return 'progress-sell';
                return 'progress-neutral';
            },
            
            getConfidenceClass(signal) {
                if (!signal || signal.type === 'ANALYZING') return 'confidence-low';
                
                const confidence = signal.confidence || 50;
                if (confidence >= 80) return 'confidence-high';
                if (confidence >= 60) return 'confidence-medium';
                return 'confidence-low';
            },
            
            // ============================================
            // CHART AND ASSET MANAGEMENT
            // ============================================
            async loadTradingViewChart() {
                const asset = this.assets.find(a => a.symbol === this.currentAsset);
                if (!asset) return;
                
                // Remove existing widget
                if (this.tvWidget) {
                    this.tvWidget.remove();
                }
                
                // Update chart title
                document.getElementById('chart-title').textContent = 
                    `${asset.name} (${asset.symbol}) - ${this.currentTimeframe}${this.currentTimeframe === 'D' ? '' : 'M'} Chart`;
                
                // Create new widget
                this.tvWidget = new TradingView.widget({
                    container_id: "tradingview_chart",
                    width: "100%",
                    height: "100%",
                    symbol: asset.tvSymbol,
                    interval: this.currentTimeframe,
                    timezone: "Etc/UTC",
                    theme: "dark",
                    style: "1",
                    locale: "en",
                    toolbar_bg: "#151a35",
                    enable_publishing: false,
                    hide_legend: false,
                    hide_volume: false,
                    save_image: false,
                    studies: [
                        "RSI@tv-basicstudies"
                    ],
                    overrides: {
                        "mainSeriesProperties.style": 1,
                        "paneProperties.background": "#151a35",
                        "paneProperties.vertGridProperties.color": "rgba(255,255,255,0.05)",
                        "paneProperties.horzGridProperties.color": "rgba(255,255,255,0.05)"
                    },
                    studies_overrides: {
                        "RSI.rsi.linewidth": 2,
                        "RSI.levels.0.value": this.rsiThresholds.extremeBuy,
                        "RSI.levels.1.value": this.rsiThresholds.buyZone,
                        "RSI.levels.2.value": this.rsiThresholds.sellZone,
                        "RSI.levels.3.value": this.rsiThresholds.extremeSell
                    }
                });
                
                // Set chart ready callback
                this.tvWidget.onChartReady(() => {
                    this.isChartLoaded = true;
                    console.log(`âœ… Chart loaded for ${asset.name}`);
                });
            },
            
            selectAsset(symbol) {
                this.currentAsset = symbol;
                
                // Update active card
                document.querySelectorAll('.asset-card').forEach(card => {
                    card.classList.remove('active');
                    if (card.dataset.symbol === symbol) {
                        card.classList.add('active');
                    }
                });
                
                // Reload chart
                this.loadTradingViewChart();
                
                console.log(`ðŸ“Š Now viewing ${symbol} chart`);
            },
            
            changeTimeframe(timeframe, button) {
                // Update active button
                document.querySelectorAll('.tf-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');
                
                this.currentTimeframe = timeframe;
                
                // Update chart
                if (this.tvWidget && this.isChartLoaded) {
                    try {
                        this.tvWidget.chart().setResolution(timeframe);
                    } catch (error) {
                        console.error('Error changing timeframe:', error);
                        this.loadTradingViewChart();
                    }
                }
                
                // Update assets display with new timeframe
                this.loadAssetsDisplay();
                
                console.log(`ðŸ•’ Switched to ${timeframe}${timeframe === 'D' ? ' Daily' : 'M'} timeframe`);
            },
            
            // ============================================
            // ASSET MONITORING
            // ============================================
            startAssetMonitoring() {
                // Initial update
                this.updateAllAssets();
                
                // Update all assets every 3 seconds
                setInterval(() => {
                    this.updateAllAssets();
                }, 3000);
            },
            
            updateAllAssets() {
                this.assets.forEach(asset => {
                    // Update RSI for all timeframes
                    Object.keys(asset.rsiData).forEach(tf => {
                        this.updateAssetRSI(asset, tf);
                    });
                    
                    // Update price
                    this.updateAssetPrice(asset);
                    
                    // Update last update time
                    asset.lastUpdate = new Date();
                });
                
                // Update display
                this.loadAssetsDisplay();
            },
            
            updateAssetRSI(asset, timeframe) {
                // Get new RSI value
                const newRSI = this.simulateRealisticRSI(asset, timeframe);
                const previousRSI = asset.rsiData[timeframe] || newRSI;
                
                // Update RSI data
                asset.rsiData[timeframe] = newRSI;
                asset.previousRSI[timeframe] = previousRSI;
                
                // Generate signal for this timeframe
                asset.signals[timeframe] = this.generateTimeframeSignal(newRSI, previousRSI, timeframe);
                
                // Debug logging for signal generation
                if (asset.signals[timeframe]) {
                    console.log(`Signal: ${asset.symbol} ${timeframe}M - ${asset.signals[timeframe].type} (RSI: ${newRSI})`);
                }
            },
            
            updateAssetPrice(asset) {
                // Generate realistic price movement
                const volatility = asset.type === 'crypto' ? 0.02 : 0.01;
                const priceChange = (Math.random() - 0.5) * volatility;
                
                asset.price *= (1 + priceChange);
                
                // Format based on asset type
                if (asset.type === 'forex') {
                    asset.price = parseFloat(asset.price.toFixed(4));
                } else {
                    asset.price = parseFloat(asset.price.toFixed(2));
                }
            }
        };
        
        // Initialize system when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸš€ KILLER ZONE Professional System Starting...');
            console.log('============================================');
            console.log('âœ… All Recommendations Implemented:');
            console.log('1. Fixed Signal Generation Logic âœ“');
            console.log('2. Multi-Timeframe Validation âœ“');
            console.log('3. Realistic RSI Simulation âœ“');
            console.log('4. Signal Memory & Persistence âœ“');
            console.log('5. Visual Signal Indicators âœ“');
            console.log('6. Smart Display Logic âœ“');
            console.log('============================================');
            
            KillerZoneSystem.init();
            
            // Auto-select first asset
            setTimeout(() => {
                const firstAsset = document.querySelector('.asset-card');
                if (firstAsset) {
                    firstAsset.classList.add('active');
                }
            }, 100);
        });
    </script>
</body>
</html>
