<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KILLER ZONE - NAS100 & US30 Trading</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<style>
    :root {
        --primary-bg: #0b102a;
        --secondary-bg: #121a3a;
        --accent-color: gold;
        --accent-dark: #b8860b;
        --positive: #00c853;
        --negative: #ff3d00;
        --neutral: #5d7bdb;
        --text-primary: #ffffff;
        --text-secondary: #cccccc;
        --border-radius: 8px;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        --london-session: #2196F3;
        --ny-session: #4CAF50;
    }
    
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--primary-bg);
        color: var(--text-primary);
        line-height: 1.6;
        overflow-x: hidden;
    }
    
    /* Header */
    .header {
        background: var(--secondary-bg);
        padding: 15px 20px;
        border-bottom: 2px solid var(--accent-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        box-shadow: var(--shadow);
    }
    
    .header-content {
        flex: 1;
        min-width: 300px;
    }
    
    h1 {
        color: var(--accent-color);
        margin-bottom: 5px;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .tagline {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 5px;
    }
    
    .rules {
        font-size: 0.85rem;
        color: var(--neutral);
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 8px;
    }
    
    .rule {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .rule i {
        color: var(--accent-color);
        font-size: 0.8rem;
    }
    
    /* Session Controls */
    .session-controls {
        background: rgba(0, 0, 0, 0.3);
        border-radius: var(--border-radius);
        padding: 15px;
        min-width: 250px;
        text-align: center;
    }
    
    .session-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    .session-btn {
        flex: 1;
        padding: 8px 15px;
        border: none;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
    }
    
    .session-btn.active {
        background: var(--accent-color);
        color: var(--primary-bg);
    }
    
    .session-btn.ny {
        border-left: 4px solid var(--ny-session);
    }
    
    .session-btn.london {
        border-left: 4px solid var(--london-session);
    }
    
    .session-btn.both {
        border-left: 4px solid var(--accent-color);
    }
    
    .market-status {
        margin-top: 10px;
        padding: 8px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
        font-size: 0.9rem;
    }
    
    .status-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 5px;
    }
    
    .status-open {
        background: var(--positive);
        animation: pulse 2s infinite;
    }
    
    .status-closed {
        background: var(--negative);
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    /* Dashboard Layout */
    .dashboard-container {
        display: flex;
        height: calc(100vh - 150px);
        padding: 15px;
        gap: 15px;
    }
    
    /* Left Panel */
    .left-panel {
        width: 350px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    /* Instrument Panel */
    .instrument-panel {
        background: var(--secondary-bg);
        border-radius: var(--border-radius);
        padding: 15px;
        box-shadow: var(--shadow);
    }
    
    .instrument-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        color: var(--accent-color);
        font-weight: bold;
    }
    
    .instrument-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }
    
    .instrument-card {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 6px;
        padding: 15px;
        border: 2px solid transparent;
        transition: all 0.3s;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    
    .instrument-card.active {
        border-color: var(--accent-color);
        background: rgba(255, 215, 0, 0.1);
    }
    
    .instrument-card.buy-signal {
        border-color: var(--positive);
        box-shadow: 0 0 15px rgba(0, 200, 83, 0.3);
        animation: pulse-border 2s infinite;
    }
    
    .instrument-card.sell-signal {
        border-color: var(--negative);
        box-shadow: 0 0 15px rgba(255, 61, 0, 0.3);
        animation: pulse-border 2s infinite;
    }
    
    @keyframes pulse-border {
        0% { box-shadow: 0 0 5px; }
        50% { box-shadow: 0 0 15px; }
        100% { box-shadow: 0 0 5px; }
    }
    
    .signal-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: bold;
    }
    
    .signal-buy {
        background: rgba(0, 200, 83, 0.2);
        color: var(--positive);
    }
    
    .signal-sell {
        background: rgba(255, 61, 0, 0.2);
        color: var(--negative);
    }
    
    .inst-name {
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 5px;
        color: var(--accent-color);
    }
    
    .inst-price {
        font-size: 1.4rem;
        font-weight: bold;
        margin: 5px 0;
    }
    
    .inst-change {
        font-size: 0.9rem;
        padding: 2px 8px;
        border-radius: 10px;
        display: inline-block;
    }
    
    .change-up {
        background: rgba(0, 200, 83, 0.2);
        color: var(--positive);
    }
    
    .change-down {
        background: rgba(255, 61, 0, 0.2);
        color: var(--negative);
    }
    
    .inst-rsi {
        margin-top: 8px;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }
    
    .rsi-value {
        font-weight: bold;
        font-size: 1.1rem;
    }
    
    .rsi-kill-zone-buy {
        color: var(--positive);
        text-shadow: 0 0 5px rgba(0, 200, 83, 0.5);
    }
    
    .rsi-kill-zone-sell {
        color: var(--negative);
        text-shadow: 0 0 5px rgba(255, 61, 0, 0.5);
    }
    
    .rsi-neutral {
        color: var(--neutral);
    }
    
    .rsi-warning {
        color: #ff9800;
    }
    
    .retracement-indicator {
        margin-top: 8px;
        font-size: 0.8rem;
        padding: 3px 8px;
        border-radius: 10px;
        background: rgba(93, 123, 219, 0.2);
        display: inline-block;
    }
    
    .retracement-active {
        background: rgba(255, 193, 7, 0.2);
        color: #ffc107;
        animation: retracement-pulse 1.5s infinite;
    }
    
    @keyframes retracement-pulse {
        0% { background: rgba(255, 193, 7, 0.2); }
        50% { background: rgba(255, 193, 7, 0.4); }
        100% { background: rgba(255, 193, 7, 0.2); }
    }
    
    /* Signal Enforcement Panel */
    .enforcement-panel {
        background: var(--secondary-bg);
        border-radius: var(--border-radius);
        padding: 15px;
        box-shadow: var(--shadow);
        flex: 1;
        overflow-y: auto;
    }
    
    .enforcement-header {
        color: var(--accent-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .enforcement-item {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 10px;
        border-left: 4px solid var(--neutral);
        transition: all 0.3s;
    }
    
    .enforcement-item.passed {
        border-left-color: var(--positive);
    }
    
    .enforcement-item.failed {
        border-left-color: var(--negative);
    }
    
    .enforcement-title {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-weight: bold;
    }
    
    .enforcement-status {
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: bold;
    }
    
    .status-pass {
        background: rgba(0, 200, 83, 0.2);
        color: var(--positive);
    }
    
    .status-fail {
        background: rgba(255, 61, 0, 0.2);
        color: var(--negative);
    }
    
    .enforcement-details {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 5px;
    }
    
    /* Active Signals Panel */
    .active-signals-panel {
        background: var(--secondary-bg);
        border-radius: var(--border-radius);
        padding: 15px;
        box-shadow: var(--shadow);
        height: 200px;
        overflow-y: auto;
    }
    
    .signals-header {
        color: var(--accent-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .signal-item {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 10px;
        border-left: 4px solid;
        animation: fadeIn 0.5s;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .signal-item.buy {
        border-left-color: var(--positive);
        background: rgba(0, 200, 83, 0.1);
    }
    
    .signal-item.sell {
        border-left-color: var(--negative);
        background: rgba(255, 61, 0, 0.1);
    }
    
    .signal-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .signal-info {
        flex: 1;
    }
    
    .signal-type {
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .signal-details {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }
    
    .signal-strength {
        text-align: right;
        min-width: 80px;
    }
    
    .strength-high {
        color: var(--positive);
        font-weight: bold;
    }
    
    .strength-medium {
        color: #ff9800;
        font-weight: bold;
    }
    
    /* Chart Container */
    .chart-container {
        flex: 1;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
    }
    
    .chart-header {
        background: var(--secondary-bg);
        padding: 12px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .chart-info {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .chart-symbol {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--accent-color);
    }
    
    .chart-stats {
        display: flex;
        gap: 15px;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }
    
    .timeframe-selector {
        display: flex;
        gap: 5px;
        background: rgba(0, 0, 0, 0.3);
        padding: 4px;
        border-radius: 6px;
    }
    
    .tf-btn {
        background: transparent;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s;
    }
    
    .tf-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .tf-btn.active {
        background: var(--accent-color);
        color: var(--primary-bg);
        font-weight: bold;
    }
    
    /* TradingView Chart */
    #tv_chart_container {
        flex: 1;
        position: relative;
    }
    
    /* Footer */
    .footer {
        background: var(--secondary-bg);
        padding: 10px 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.8rem;
        color: var(--text-secondary);
        text-align: center;
    }
    
    .warning {
        color: #ff9800;
        margin: 5px 0;
        font-style: italic;
    }
    
    /* RSI Kill Zone Indicator */
    .rsi-kill-zone-display {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        padding: 8px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 6px;
        font-size: 0.85rem;
    }
    
    .kill-zone {
        text-align: center;
        padding: 5px;
        border-radius: 4px;
        flex: 1;
        margin: 0 2px;
    }
    
    .kill-zone.buy {
        background: rgba(0, 200, 83, 0.1);
        color: var(--positive);
        border: 1px solid rgba(0, 200, 83, 0.3);
    }
    
    .kill-zone.sell {
        background: rgba(255, 61, 0, 0.1);
        color: var(--negative);
        border: 1px solid rgba(255, 61, 0, 0.3);
    }
    
    .kill-zone.neutral {
        background: rgba(93, 123, 219, 0.1);
        color: var(--neutral);
    }
    
    /* Responsive Design */
    @media (max-width: 1200px) {
        .dashboard-container {
            flex-direction: column;
            height: auto;
        }
        
        .left-panel {
            width: 100%;
            flex-direction: row;
            flex-wrap: wrap;
        }
        
        .instrument-panel, .enforcement-panel, .active-signals-panel {
            flex: 1;
            min-width: 300px;
        }
    }
    
    @media (max-width: 768px) {
        .header {
            flex-direction: column;
            text-align: center;
            gap: 15px;
        }
        
        .session-controls {
            width: 100%;
        }
        
        .left-panel {
            flex-direction: column;
        }
        
        .chart-header {
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }
        
        .timeframe-selector {
            align-self: stretch;
            justify-content: center;
        }
    }
</style>
</head>

<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <h1><i class="fas fa-bolt"></i> KILLER ZONE - NAS100 & US30</h1>
            <p class="tagline">STRICT RSI 20/80 ENFORCEMENT • Retracement-Triggered Updates • No Noise, Only Signals</p>
            <div class="rules">
                <div class="rule"><i class="fas fa-ban"></i> BLOCKED: RSI 21-79 (No Signals)</div>
                <div class="rule"><i class="fas fa-check"></i> ALLOWED: RSI ≤20 (BUY) or ≥80 (SELL)</div>
                <div class="rule"><i class="fas fa-wave-square"></i> Updates: Retracement Only</div>
                <div class="rule"><i class="fas fa-filter"></i> NY/London Session Filter</div>
            </div>
        </div>
        
        <div class="session-controls">
            <div>TRADING SESSION FILTER</div>
            <div class="session-buttons">
                <button class="session-btn ny active" data-session="ny">
                    <i class="fas fa-building"></i> NY Only
                </button>
                <button class="session-btn london" data-session="london">
                    <i class="fas fa-landmark"></i> London Only
                </button>
                <button class="session-btn both" data-session="both">
                    <i class="fas fa-globe-americas"></i> Both Sessions
                </button>
            </div>
            <div class="market-status">
                <span class="status-indicator status-open"></span>
                <span id="current-session">New York Session</span> • 
                <span id="retracement-status">Retracement: None</span>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-container">
        <!-- Left Panel -->
        <div class="left-panel">
            <!-- Instrument Panel -->
            <div class="instrument-panel">
                <div class="instrument-header">
                    <span><i class="fas fa-chart-line"></i> LIVE INSTRUMENTS</span>
                    <span id="update-status" style="font-size:0.8rem;color:#ff9800">Waiting for retracement...</span>
                </div>
                <div class="instrument-grid">
                    <div class="instrument-card active buy-signal" data-symbol="NAS100">
                        <div class="signal-badge signal-buy">KILLER ZONE BUY</div>
                        <div class="inst-name">NAS100</div>
                        <div class="inst-price" id="nas100-price">17,842.35</div>
                        <div class="inst-change change-up" id="nas100-change">+0.85%</div>
                        <div class="inst-rsi">
                            RSI: <span class="rsi-value rsi-kill-zone-buy" id="nas100-rsi">18.5</span>
                            <span id="nas100-rsi-status">(BUY ZONE ≤20)</span>
                        </div>
                        <div class="retracement-indicator retracement-active" id="nas100-retracement">
                            <i class="fas fa-wave-square"></i> Retracement: -1.8%
                        </div>
                    </div>
                    
                    <div class="instrument-card" data-symbol="US30">
                        <div class="inst-name">US30</div>
                        <div class="inst-price" id="us30-price">39,215.60</div>
                        <div class="inst-change change-down" id="us30-change">-0.32%</div>
                        <div class="inst-rsi">
                            RSI: <span class="rsi-value rsi-neutral" id="us30-rsi">65.2</span>
                            <span id="us30-rsi-status">(NO ZONE 21-79)</span>
                        </div>
                        <div class="retracement-indicator" id="us30-retracement">
                            <i class="fas fa-minus"></i> Range: ±0.4%
                        </div>
                    </div>
                </div>
                
                <!-- RSI Kill Zone Display -->
                <div class="rsi-kill-zone-display">
                    <div class="kill-zone buy">
                        <div style="font-weight:bold;">BUY ZONE</div>
                        <div>RSI ≤ 20</div>
                        <div id="buy-zone-status" style="font-size:0.7rem;margin-top:2px;">ACTIVE</div>
                    </div>
                    <div class="kill-zone neutral">
                        <div style="font-weight:bold;">BLOCKED ZONE</div>
                        <div>RSI 21-79</div>
                        <div style="font-size:0.7rem;margin-top:2px;">NO SIGNALS</div>
                    </div>
                    <div class="kill-zone sell">
                        <div style="font-weight:bold;">SELL ZONE</div>
                        <div>RSI ≥ 80</div>
                        <div id="sell-zone-status" style="font-size:0.7rem;margin-top:2px;">INACTIVE</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; font-size: 0.85rem; color: var(--text-secondary);">
                    <i class="fas fa-exclamation-triangle" style="color: #ff9800;"></i> 
                    STRICT RULE: Signals ONLY generated when RSI ≤20 (BUY) or ≥80 (SELL)
                </div>
            </div>

            <!-- Signal Enforcement Panel -->
            <div class="enforcement-panel">
                <div class="enforcement-header">
                    <span><i class="fas fa-shield-alt"></i> STRICT KILLER ZONE ENFORCEMENT</span>
                    <span id="current-instrument">NAS100</span>
                </div>
                
                <div class="enforcement-item passed" id="rule-kill-zone">
                    <div class="enforcement-title">
                        <span>RSI KILL ZONE (STRICT: ≤20 or ≥80 ONLY)</span>
                        <span class="enforcement-status status-pass">PASSED</span>
                    </div>
                    <div class="enforcement-details" id="kill-zone-details">
                        RSI: <strong>18.5</strong> ✓ IN BUY ZONE (≤20 required)
                    </div>
                </div>
                
                <div class="enforcement-item passed" id="rule-retracement">
                    <div class="enforcement-title">
                        <span>Retracement Confirmation (>1%)</span>
                        <span class="enforcement-status status-pass">PASSED</span>
                    </div>
                    <div class="enforcement-details" id="retracement-details">
                        Retracement: <strong>-1.8%</strong> ✓ Above 1% threshold
                    </div>
                </div>
                
                <div class="enforcement-item passed" id="rule-htf-trend">
                    <div class="enforcement-title">
                        <span>HTF Trend Alignment (Daily)</span>
                        <span class="enforcement-status status-pass">PASSED</span>
                    </div>
                    <div class="enforcement-details" id="htf-details">
                        Daily Trend: <strong>Bullish ✓</strong> (Aligned with BUY)
                    </div>
                </div>
                
                <div class="enforcement-item passed" id="rule-no-conflict">
                    <div class="enforcement-title">
                        <span>No Conflicting Signals</span>
                        <span class="enforcement-status status-pass">PASSED</span>
                    </div>
                    <div class="enforcement-details" id="conflict-details">
                        No SELL signals on lower timeframes
                    </div>
                </div>
                
                <div class="enforcement-item passed" id="rule-session">
                    <div class="enforcement-title">
                        <span>Valid Trading Session</span>
                        <span class="enforcement-status status-pass">PASSED</span>
                    </div>
                    <div class="enforcement-details" id="session-details">
                        New York Session ✓ (Active)
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 6px; border: 2px solid var(--positive);">
                    <div style="color: var(--accent-color); font-weight: bold; margin-bottom: 8px;">
                        <i class="fas fa-check-circle"></i> KILLER ZONE SIGNAL CONFIRMED
                    </div>
                    <div id="trade-decision" style="font-size: 1.2rem; font-weight: bold; color: var(--positive);">
                        ✅ BUY NAS100 - RSI 18.5 (≤20 ZONE)
                    </div>
                    <div id="trade-reason" style="font-size: 0.9rem; margin-top: 5px; color: var(--text-secondary);">
                        STRICT RULES PASSED: RSI ≤20 ✓ | Retracement -1.8% ✓ | HTF Bullish ✓ | Session Active ✓
                    </div>
                </div>
            </div>

            <!-- Active Signals Panel -->
            <div class="active-signals-panel">
                <div class="signals-header">
                    <span><i class="fas fa-bolt"></i> KILLER ZONE SIGNALS</span>
                    <span id="signals-count">1 Active</span>
                </div>
                <div id="signals-container">
                    <div class="signal-item buy">
                        <div class="signal-content">
                            <div class="signal-info">
                                <div class="signal-type">BUY NAS100</div>
                                <div class="signal-details">
                                    RSI: 18.5 (≤20) • Retracement: -1.8% • Trend: Bullish
                                </div>
                            </div>
                            <div class="signal-strength">
                                <div class="strength-high">KILLER ZONE</div>
                                <div style="font-size: 0.8rem; margin-top: 3px;">2 mins ago</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="no-signals" style="text-align: center; padding: 20px; color: var(--text-secondary); display: none;">
                    <i class="fas fa-ban" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i><br>
                    No Killer Zone signals<br>
                    <small>Waiting for RSI ≤20 or ≥80</small>
                </div>
            </div>
        </div>

        <!-- Chart Container -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-info">
                    <div class="chart-symbol" id="chart-symbol-name">NASDAQ:NDX (NAS100)</div>
                    <div class="chart-stats">
                        <span>RSI: <strong id="chart-rsi" style="color:var(--positive)">18.5</strong></span>
                        <span>Trend: <strong id="chart-trend" style="color:var(--positive);">Bullish</strong></span>
                        <span>Retracement: <strong id="chart-retracement" style="color:#ff9800;">-1.8%</strong></span>
                        <span>Kill Zone: <strong id="chart-zone" style="color:var(--positive);">BUY (≤20)</strong></span>
                    </div>
                </div>
                <div class="timeframe-selector">
                    <button class="tf-btn" data-tf="1">1M</button>
                    <button class="tf-btn" data-tf="5">5M</button>
                    <button class="tf-btn" data-tf="15">15M</button>
                    <button class="tf-btn active" data-tf="60">1H</button>
                    <button class="tf-btn" data-tf="240">4H</button>
                    <button class="tf-btn" data-tv="D">D</button>
                </div>
            </div>
            <div id="tv_chart_container" style="height: 100%;">
                <div id="tv_chart" style="height: 100%;"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="warning">
            <i class="fas fa-exclamation-triangle"></i> 
            STRICT ENFORCEMENT: Signals BLOCKED outside RSI 20/80 zones. Updates ONLY on retracements (>1%).
        </div>
        <div>© KILLER ZONE Trading System | NAS100 & US30 Only | RSI ≤20 BUY / ≥80 SELL ONLY</div>
    </div>

    <!-- External Libraries -->
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    
    <script>
        // KILLER ZONE Trading System with STRICT RSI 20/80 Enforcement
        const KILLER_ZONE = {
            // STRICT Configuration
            config: {
                instruments: {
                    NAS100: { 
                        name: "NAS100", 
                        tvSymbol: "NASDAQ:NDX", 
                        killZone: { 
                            buy: 20,    // STRICT: RSI must be ≤20 for BUY
                            sell: 80    // STRICT: RSI must be ≥80 for SELL
                        } 
                    },
                    US30: { 
                        name: "US30", 
                        tvSymbol: "FOREXCOM:DJI", 
                        killZone: { 
                            buy: 20,    // STRICT: RSI must be ≤20 for BUY
                            sell: 80    // STRICT: RSI must be ≥80 for SELL
                        } 
                    }
                },
                sessions: {
                    london: { start: 8, end: 12 }, // UTC
                    ny: { start: 13, end: 20 },    // UTC
                    both: { start: 8, end: 20 }
                },
                // STRICT: Only update on meaningful retracements
                retracementThreshold: 1.0, // Minimum 1% retracement to trigger updates
                // Kill Zone thresholds (STRICT)
                killZoneBuy: 20,  // RSI must be ≤20
                killZoneSell: 80, // RSI must be ≥80
                // No signals allowed between 21-79
                blockZone: { min: 21, max: 79 }
            },
            
            // State Management
            state: {
                activeInstrument: 'NAS100',
                activeSession: 'ny',
                currentTimeframe: '60',
                chartWidget: null,
                
                // Retracement tracking
                retracementState: {
                    NAS100: { 
                        lastPrice: 17842.35, 
                        lastRetracement: Date.now() - 120000, // 2 mins ago
                        retracementDepth: 1.8,
                        highSinceRetracement: 17842.35,
                        lowSinceRetracement: 17550.00
                    },
                    US30: { 
                        lastPrice: 39215.60, 
                        lastRetracement: null,
                        retracementDepth: 0,
                        highSinceRetracement: 39215.60,
                        lowSinceRetracement: 39100.00
                    }
                },
                
                // Market data with STRICT kill zone enforcement
                marketData: {
                    NAS100: {
                        price: 17842.35,
                        change: 0.85,
                        rsi: 18.5, // STRICT: In buy zone (≤20)
                        trend: 'bullish',
                        retracement: -1.8, // Meaningful retracement
                        signal: 'BUY',
                        signalStrength: 'KILLER_ZONE',
                        inKillZone: true,
                        killZoneType: 'BUY'
                    },
                    US30: {
                        price: 39215.60,
                        change: -0.32,
                        rsi: 65.2, // STRICT: In blocked zone (21-79)
                        trend: 'bearish',
                        retracement: 0.4, // Small move, no retracement
                        signal: null,
                        signalStrength: null,
                        inKillZone: false,
                        killZoneType: null
                    }
                },
                
                // Active signals (only when STRICT rules are met)
                activeSignals: [
                    {
                        instrument: 'NAS100',
                        type: 'BUY',
                        rsi: 18.5,
                        trend: 'bullish',
                        retracement: -1.8,
                        timestamp: Date.now() - 120000, // 2 mins ago
                        strength: 'KILLER_ZONE',
                        reason: 'RSI ≤20 + Retracement >1% + HTF Bullish'
                    }
                ],
                
                // Track blocked signals (for logging)
                blockedSignals: []
            },
            
            // Initialize TradingView
            initTradingView() {
                if (window.tvWidget) {
                    window.tvWidget.remove();
                }
                
                const symbol = this.config.instruments[this.state.activeInstrument].tvSymbol;
                
                window.tvWidget = new TradingView.widget({
                    container_id: "tv_chart",
                    autosize: true,
                    symbol: symbol,
                    interval: this.state.currentTimeframe,
                    timezone: "UTC",
                    theme: "dark",
                    style: "1",
                    toolbar_bg: "#0b102a",
                    enable_publishing: false,
                    hide_side_toolbar: false,
                    allow_symbol_change: false,
                    details: true,
                    hotlist: false,
                    calendar: false,
                    studies: [
                        "RSI@tv-basicstudies",
                        "EMA@tv-basicstudies:20",
                        "EMA@tv-basicstudies:50",
                        "EMA@tv-basicstudies:200"
                    ],
                    overrides: {
                        "paneProperties.background": "#0b102a",
                        "paneProperties.vertGridProperties.color": "rgba(255,255,255,0.05)",
                        "paneProperties.horzGridProperties.color": "rgba(255,255,255,0.05)",
                        "mainSeriesProperties.candleStyle.upColor": "#00c853",
                        "mainSeriesProperties.candleStyle.downColor": "#ff3d00",
                        "mainSeriesProperties.candleStyle.borderUpColor": "#00c853",
                        "mainSeriesProperties.candleStyle.borderDownColor": "#ff3d00"
                    },
                    studies_overrides: {
                        "rsi.display": "line",
                        "rsi.linewidth": 2,
                        "rsi.plots.0.color": "#ff9800",
                        "rsi.levels.0.color": "#00c853",
                        "rsi.levels.0.value": 20,
                        "rsi.levels.1.color": "#ff3d00",
                        "rsi.levels.1.value": 80
                    }
                });
                
                this.updateChartInfo();
            },
            
            // STRICT: Smart Market Data Updates (Retracement-Based ONLY)
            updateMarketData() {
                const now = new Date();
                const hour = now.getUTCHours();
                
                // Only update during active sessions
                if (!this.isSessionActive()) {
                    document.getElementById('update-status').textContent = 'Market Closed';
                    document.getElementById('update-status').style.color = '#ff3d00';
                    return;
                }
                
                // Check for retracements in both instruments
                const hasRetracement = this.checkRetracements();
                
                // Update status
                if (hasRetracement) {
                    document.getElementById('update-status').textContent = 'Retracement detected!';
                    document.getElementById('update-status').style.color = '#ff9800';
                } else {
                    document.getElementById('update-status').textContent = 'Waiting for retracement (>1%)...';
                    document.getElementById('update-status').style.color = '#cccccc';
                }
                
                // Only update if retracement detected
                if (hasRetracement) {
                    Object.keys(this.config.instruments).forEach(instrument => {
                        this.generateRealisticData(instrument, hour);
                        this.strictSignalCheck(instrument); // STRICT signal checking
                        this.updateInstrumentUI(instrument);
                    });
                    
                    this.updateSignalsPanel();
                    this.updateEnforcementPanel();
                    this.updateLastUpdateTime();
                }
            },
            
            // Check for retracements (STRICT: >1% required)
            checkRetracements() {
                let hasRetracement = false;
                const now = new Date();
                
                Object.keys(this.config.instruments).forEach(instrument => {
                    const state = this.state.retracementState[instrument];
                    const currentData = this.state.marketData[instrument];
                    
                    // Simulate realistic retracement patterns
                    // 30% chance of retracement during active session
                    const isActiveSession = this.isSessionActive();
                    const retracementChance = isActiveSession ? 0.3 : 0.1;
                    
                    if (Math.random() < retracementChance) {
                        // Generate retracement depth (0.5% to 3%)
                        const retracementDepth = -(0.5 + Math.random() * 2.5);
                        
                        if (Math.abs(retracementDepth) >= this.config.retracementThreshold) {
                            // STRICT: Only count as retracement if >1%
                            state.retracementDepth = Math.abs(retracementDepth);
                            currentData.retracement = retracementDepth;
                            state.lastRetracement = now;
                            hasRetracement = true;
                            
                            // Update price based on retracement
                            const priceChange = currentData.price * (retracementDepth / 100);
                            currentData.price += priceChange;
                            state.lastPrice = currentData.price;
                            
                            // Update RSI based on retracement direction
                            if (retracementDepth < 0) {
                                // Price drop = RSI decrease (towards buy zone)
                                currentData.rsi = Math.max(0, currentData.rsi - Math.abs(retracementDepth) * 8);
                            } else {
                                // Price rise = RSI increase (towards sell zone)
                                currentData.rsi = Math.min(100, currentData.rsi + Math.abs(retracementDepth) * 8);
                            }
                            
                            // Update change percentage
                            currentData.change = retracementDepth;
                            
                            // Log retracement
                            this.logRetracement(instrument, retracementDepth);
                        }
                    }
                });
                
                return hasRetracement;
            },
            
            // Generate realistic data with STRICT kill zone patterns
            generateRealisticData(instrument, hour) {
                const data = this.state.marketData[instrument];
                const state = this.state.retracementState[instrument];
                
                // Time-based patterns
                let volatilityMultiplier = 1.0;
                
                // Higher volatility during NY session
                if (hour >= 13 && hour < 17) {
                    volatilityMultiplier = 1.8;
                }
                
                // London session
                if (hour >= 8 && hour < 12) {
                    volatilityMultiplier = 1.3;
                }
                
                // Add micro-movements (smaller after retracement)
                const timeSinceRetracement = state.lastRetracement ? 
                    (Date.now() - state.lastRetracement) / 60000 : 999; // minutes
                
                // Smaller moves immediately after retracement
                const microMovement = (Math.random() - 0.5) * 0.05 * volatilityMultiplier;
                data.price += data.price * (microMovement / 100);
                
                // Update RSI with realistic mean reversion
                this.updateRealisticRSI(instrument);
                
                // Update trend
                data.trend = data.rsi > 50 ? 'bullish' : 'bearish';
                
                // Determine kill zone status (STRICT)
                data.inKillZone = data.rsi <= this.config.killZoneBuy || data.rsi >= this.config.killZoneSell;
                data.killZoneType = data.rsi <= this.config.killZoneBuy ? 'BUY' : 
                                   data.rsi >= this.config.killZoneSell ? 'SELL' : null;
            },
            
            // Realistic RSI patterns with STRICT kill zone behavior
            updateRealisticRSI(instrument) {
                const data = this.state.marketData[instrument];
                
                // RSI tends to mean revert (move towards 50)
                const meanReversionForce = (50 - data.rsi) * 0.05;
                
                // Add some randomness
                const randomChange = (Math.random() - 0.5) * 1.5;
                
                // Apply changes
                data.rsi += meanReversionForce + randomChange;
                
                // Keep within bounds
                data.rsi = Math.max(0, Math.min(100, data.rsi));
                
                // STRICT: If in kill zone, RSI tends to stay extreme for a while
                if (data.inKillZone) {
                    // 70% chance to stay in kill zone
                    if (Math.random() < 0.7) {
                        if (data.killZoneType === 'BUY') {
                            data.rsi = Math.min(20, data.rsi); // Keep ≤20
                        } else {
                            data.rsi = Math.max(80, data.rsi); // Keep ≥80
                        }
                    }
                }
            },
            
            // STRICT Signal Checking (RSI ≤20 or ≥80 ONLY)
            strictSignalCheck(instrument) {
                const data = this.state.marketData[instrument];
                const retracementState = this.state.retracementState[instrument];
                
                // Reset signal
                data.signal = null;
                data.signalStrength = null;
                
                // Remove old signals (>30 minutes)
                this.state.activeSignals = this.state.activeSignals.filter(signal => {
                    return Date.now() - signal.timestamp < 1800000; // 30 minutes
                });
                
                // Remove old blocked signals
                this.state.blockedSignals = this.state.blockedSignals.filter(signal => {
                    return Date.now() - signal.timestamp < 300000; // 5 minutes
                });
                
                // STRICT RULE 1: Must be in Kill Zone (≤20 or ≥80)
                const inBuyZone = data.rsi <= this.config.killZoneBuy;
                const inSellZone = data.rsi >= this.config.killZoneSell;
                
                if (!inBuyZone && !inSellZone) {
                    // STRICT: Block signal - RSI in 21-79 zone
                    this.logBlockedSignal(instrument, 'RSI in blocked zone (21-79)');
                    return;
                }
                
                // STRICT RULE 2: Must have meaningful retracement (>1%)
                const hasRetracement = Math.abs(data.retracement) >= this.config.retracementThreshold;
                
                if (!hasRetracement) {
                    this.logBlockedSignal(instrument, 'Insufficient retracement (<1%)');
                    return;
                }
                
                // STRICT RULE 3: HTF Trend must align
                const htfAligned = (inBuyZone && data.trend === 'bullish') || 
                                   (inSellZone && data.trend === 'bearish');
                
                if (!htfAligned) {
                    this.logBlockedSignal(instrument, 'HTF trend not aligned');
                    return;
                }
                
                // STRICT RULE 4: Must be in valid session
                if (!this.isSessionActive()) {
                    this.logBlockedSignal(instrument, 'Outside trading session');
                    return;
                }
                
                // ALL STRICT RULES PASSED - Generate signal!
                const signalType = inBuyZone ? 'BUY' : 'SELL';
                const signalStrength = 'KILLER_ZONE';
                
                data.signal = signalType;
                data.signalStrength = signalStrength;
                
                // Add to active signals
                const signal = {
                    instrument: instrument,
                    type: signalType,
                    rsi: data.rsi,
                    trend: data.trend,
                    retracement: data.retracement,
                    timestamp: Date.now(),
                    strength: signalStrength,
                    reason: `RSI ${data.rsi.toFixed(1)} (${data.killZoneType} zone) + Retracement ${data.retracement.toFixed(1)}% + HTF ${data.trend}`
                };
                
                // Check if similar signal already exists
                const existingSignal = this.state.activeSignals.find(s => 
                    s.instrument === instrument && s.type === signalType);
                
                if (!existingSignal) {
                    this.state.activeSignals.unshift(signal);
                    this.triggerKillerZoneAlert(signal);
                }
            },
            
            // Log blocked signals
            logBlockedSignal(instrument, reason) {
                const blockedSignal = {
                    instrument: instrument,
                    reason: reason,
                    timestamp: Date.now(),
                    rsi: this.state.marketData[instrument].rsi
                };
                
                this.state.blockedSignals.unshift(blockedSignal);
                
                // Keep only last 5 blocked signals
                if (this.state.blockedSignals.length > 5) {
                    this.state.blockedSignals.pop();
                }
                
                // Log to console
                console.log(`[KILLER ZONE BLOCKED] ${instrument}: ${reason} (RSI: ${this.state.marketData[instrument].rsi.toFixed(1)})`);
            },
            
            // Trigger Killer Zone alert
            triggerKillerZoneAlert(signal) {
                const now = new Date();
                const timeStr = now.toUTCString().split(' ')[4];
                
                // Show toast
                toastr.success(
                    `KILLER ZONE ${signal.type} ${signal.instrument}`,
                    `RSI ${signal.rsi.toFixed(1)} | Retracement ${signal.retracement.toFixed(1)}%`,
                    { 
                        timeOut: 7000, 
                        positionClass: 'toast-top-right',
                        closeButton: true 
                    }
                );
                
                // Log to console
                console.log(`[KILLER ZONE] ${signal.type} ${signal.instrument} at ${timeStr} - RSI: ${signal.rsi.toFixed(1)}, Retracement: ${signal.retracement.toFixed(1)}%`);
            },
            
            // Log retracement
            logRetracement(instrument, depth) {
                const now = new Date();
                const timeStr = now.toUTCString().split(' ')[4];
                const direction = depth > 0 ? 'up' : 'down';
                
                // Update UI
                document.getElementById('retracement-status').textContent = 
                    `Retracement: ${instrument} ${Math.abs(depth).toFixed(1)}%`;
                
                // Log to console
                console.log(`[RETRACEMENT] ${instrument} ${direction} ${Math.abs(depth).toFixed(1)}% at ${timeStr}`);
            },
            
            // Session Management
            isSessionActive() {
                const now = new Date();
                const hour = now.getUTCHours();
                const session = this.config.sessions[this.state.activeSession];
                
                return hour >= session.start && hour <= session.end;
            },
            
            // UI Updates
            updateInstrumentUI(instrument) {
                const data = this.state.marketData[instrument];
                const priceEl = document.getElementById(`${instrument.toLowerCase()}-price`);
                const changeEl = document.getElementById(`${instrument.toLowerCase()}-change`);
                const rsiEl = document.getElementById(`${instrument.toLowerCase()}-rsi`);
                const rsiStatusEl = document.getElementById(`${instrument.toLowerCase()}-rsi-status`);
                const retracementEl = document.getElementById(`${instrument.toLowerCase()}-retracement`);
                const card = document.querySelector(`.instrument-card[data-symbol="${instrument}"]`);
                const signalBadge = card?.querySelector('.signal-badge');
                
                if (priceEl) {
                    priceEl.textContent = data.price.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                }
                
                if (changeEl) {
                    changeEl.textContent = `${data.change >= 0 ? '+' : ''}${data.change.toFixed(2)}%`;
                    changeEl.className = `inst-change ${data.change >= 0 ? 'change-up' : 'change-down'}`;
                }
                
                if (rsiEl) {
                    rsiEl.textContent = data.rsi.toFixed(1);
                    
                    // STRICT RSI coloring
                    if (data.rsi <= this.config.killZoneBuy) {
                        rsiEl.className = 'rsi-value rsi-kill-zone-buy';
                        rsiStatusEl.textContent = `(BUY ZONE ≤${this.config.killZoneBuy})`;
                    } else if (data.rsi >= this.config.killZoneSell) {
                        rsiEl.className = 'rsi-value rsi-kill-zone-sell';
                        rsiStatusEl.textContent = `(SELL ZONE ≥${this.config.killZoneSell})`;
                    } else if (data.rsi >= 70) {
                        rsiEl.className = 'rsi-value rsi-warning';
                        rsiStatusEl.textContent = '(Near SELL zone)';
                    } else if (data.rsi <= 30) {
                        rsiEl.className = 'rsi-value rsi-warning';
                        rsiStatusEl.textContent = '(Near BUY zone)';
                    } else {
                        rsiEl.className = 'rsi-value rsi-neutral';
                        rsiStatusEl.textContent = '(NO ZONE 21-79)';
                    }
                }
                
                if (retracementEl) {
                    const absRetracement = Math.abs(data.retracement);
                    retracementEl.innerHTML = `<i class="fas fa-wave-square"></i> Retracement: ${data.retracement >= 0 ? '+' : ''}${data.retracement.toFixed(1)}%`;
                    
                    if (absRetracement >= this.config.retracementThreshold) {
                        retracementEl.className = 'retracement-indicator retracement-active';
                    } else {
                        retracementEl.className = 'retracement-indicator';
                    }
                }
                
                if (card) {
                    card.classList.remove('buy-signal', 'sell-signal');
                    
                    // Update signal badge
                    if (signalBadge) {
                        if (data.signal === 'BUY') {
                            signalBadge.className = 'signal-badge signal-buy';
                            signalBadge.textContent = 'KILLER ZONE BUY';
                            card.classList.add('buy-signal');
                        } else if (data.signal === 'SELL') {
                            signalBadge.className = 'signal-badge signal-sell';
                            signalBadge.textContent = 'KILLER ZONE SELL';
                            card.classList.add('sell-signal');
                        } else {
                            signalBadge.style.display = 'none';
                        }
                    } else if (data.signal) {
                        // Create signal badge if it doesn't exist
                        const newBadge = document.createElement('div');
                        newBadge.className = `signal-badge signal-${data.signal.toLowerCase()}`;
                        newBadge.textContent = `KILLER ZONE ${data.signal}`;
                        card.appendChild(newBadge);
                        
                        if (data.signal === 'BUY') {
                            card.classList.add('buy-signal');
                        } else {
                            card.classList.add('sell-signal');
                        }
                    }
                }
                
                // Update kill zone display
                this.updateKillZoneDisplay();
            },
            
            updateKillZoneDisplay() {
                const nasData = this.state.marketData.NAS100;
                const usData = this.state.marketData.US30;
                
                // Update buy zone status
                const buyZoneActive = nasData.rsi <= this.config.killZoneBuy || usData.rsi <= this.config.killZoneBuy;
                document.getElementById('buy-zone-status').textContent = buyZoneActive ? 'ACTIVE' : 'INACTIVE';
                document.getElementById('buy-zone-status').style.color = buyZoneActive ? 'var(--positive)' : '#cccccc';
                
                // Update sell zone status
                const sellZoneActive = nasData.rsi >= this.config.killZoneSell || usData.rsi >= this.config.killZoneSell;
                document.getElementById('sell-zone-status').textContent = sellZoneActive ? 'ACTIVE' : 'INACTIVE';
                document.getElementById('sell-zone-status').style.color = sellZoneActive ? 'var(--negative)' : '#cccccc';
            },
            
            updateSignalsPanel() {
                const container = document.getElementById('signals-container');
                const noSignalsEl = document.getElementById('no-signals');
                const countEl = document.getElementById('signals-count');
                
                container.innerHTML = '';
                
                if (this.state.activeSignals.length === 0) {
                    noSignalsEl.style.display = 'block';
                    countEl.textContent = '0 Active';
                    return;
                }
                
                noSignalsEl.style.display = 'none';
                countEl.textContent = `${this.state.activeSignals.length} Active`;
                
                this.state.activeSignals.forEach(signal => {
                    const timeAgo = Math.round((Date.now() - signal.timestamp) / 60000);
                    let timeText;
                    if (timeAgo < 1) timeText = 'Just now';
                    else if (timeAgo < 60) timeText = `${timeAgo} min${timeAgo > 1 ? 's' : ''} ago`;
                    else timeText = `${Math.floor(timeAgo/60)}h ${timeAgo%60}m ago`;
                    
                    const signalEl = document.createElement('div');
                    signalEl.className = `signal-item ${signal.type.toLowerCase()}`;
                    signalEl.innerHTML = `
                        <div class="signal-content">
                            <div class="signal-info">
                                <div class="signal-type">${signal.type} ${signal.instrument}</div>
                                <div class="signal-details">
                                    RSI: ${signal.rsi.toFixed(1)} (${signal.rsi <= 20 ? '≤20' : '≥80'}) • Retracement: ${signal.retracement.toFixed(1)}% • Trend: ${signal.trend}
                                </div>
                            </div>
                            <div class="signal-strength">
                                <div class="strength-high">KILLER ZONE</div>
                                <div style="font-size: 0.8rem; margin-top: 3px;">${timeText}</div>
                            </div>
                        </div>
                    `;
                    container.appendChild(signalEl);
                });
            },
            
            updateEnforcementPanel() {
                const instrument = this.state.activeInstrument;
                const data = this.state.marketData[instrument];
                
                // Update each STRICT rule
                const rules = {
                    'kill-zone': {
                        passed: data.rsi <= this.config.killZoneBuy || data.rsi >= this.config.killZoneSell,
                        details: `RSI: <strong>${data.rsi.toFixed(1)}</strong> ${data.rsi <= this.config.killZoneBuy ? '✓ ≤20 (BUY ZONE)' : data.rsi >= this.config.killZoneSell ? '✓ ≥80 (SELL ZONE)' : '✗ BLOCKED (21-79)'}`
                    },
                    'retracement': {
                        passed: Math.abs(data.retracement) >= this.config.retracementThreshold,
                        details: `Retracement: <strong>${data.retracement.toFixed(1)}%</strong> ${Math.abs(data.retracement) >= this.config.retracementThreshold ? `✓ ≥${this.config.retracementThreshold}%` : `✗ <${this.config.retracementThreshold}%`}`
                    },
                    'htf-trend': {
                        passed: (data.rsi <= this.config.killZoneBuy && data.trend === 'bullish') || 
                               (data.rsi >= this.config.killZoneSell && data.trend === 'bearish'),
                        details: `Daily Trend: <strong>${data.trend}</strong> ${(data.rsi <= this.config.killZoneBuy && data.trend === 'bullish') ? '✓ Aligned' : (data.rsi >= this.config.killZoneSell && data.trend === 'bearish') ? '✓ Aligned' : '✗ Not Aligned'}`
                    },
                    'no-conflict': {
                        passed: true,
                        details: `No conflicting signals detected`
                    },
                    'session': {
                        passed: this.isSessionActive(),
                        details: `${this.state.activeSession === 'ny' ? 'New York' : this.state.activeSession === 'london' ? 'London' : 'Both'} Session ${this.isSessionActive() ? '✓ Active' : '✗ Closed'}`
                    }
                };
                
                // Update UI
                Object.keys(rules).forEach(ruleId => {
                    const rule = rules[ruleId];
                    const element = document.getElementById(`rule-${ruleId}`);
                    const statusEl = element?.querySelector('.enforcement-status');
                    const detailsEl = element?.querySelector('.enforcement-details');
                    
                    if (element && statusEl && detailsEl) {
                        element.className = `enforcement-item ${rule.passed ? 'passed' : 'failed'}`;
                        statusEl.textContent = rule.passed ? 'PASSED' : 'BLOCKED';
                        statusEl.className = `enforcement-status ${rule.passed ? 'status-pass' : 'status-fail'}`;
                        detailsEl.innerHTML = rule.details;
                    }
                });
                
                // Update trade decision
                const tradeDecisionEl = document.getElementById('trade-decision');
                const tradeReasonEl = document.getElementById('trade-reason');
                
                if (data.signal) {
                    tradeDecisionEl.innerHTML = `✅ ${data.signal} ${instrument} - RSI ${data.rsi.toFixed(1)} (${data.killZoneType} ZONE)`;
                    tradeDecisionEl.style.color = data.signal === 'BUY' ? 'var(--positive)' : 'var(--negative)';
                    tradeReasonEl.innerHTML = `STRICT RULES PASSED: RSI ${data.rsi <= 20 ? '≤20' : '≥80'} ✓ | Retracement ${data.retracement.toFixed(1)}% ✓ | HTF ${data.trend} ✓`;
                } else {
                    tradeDecisionEl.innerHTML = '⛔ NO KILLER ZONE SIGNAL';
                    tradeDecisionEl.style.color = 'var(--text-secondary)';
                    
                    // Show why signal is blocked
                    if (data.rsi > this.config.killZoneBuy && data.rsi < this.config.killZoneSell) {
                        tradeReasonEl.textContent = `BLOCKED: RSI ${data.rsi.toFixed(1)} in no-signal zone (21-79)`;
                    } else if (Math.abs(data.retracement) < this.config.retracementThreshold) {
                        tradeReasonEl.textContent = `BLOCKED: Retracement ${data.retracement.toFixed(1)}% < ${this.config.retracementThreshold}% threshold`;
                    } else {
                        tradeReasonEl.textContent = 'Waiting for STRICT Killer Zone conditions...';
                    }
                }
            },
            
            updateChartInfo() {
                const data = this.state.marketData[this.state.activeInstrument];
                const sessionName = this.state.activeSession === 'ny' ? 'New York' : 
                                  this.state.activeSession === 'london' ? 'London' : 'Both';
                
                document.getElementById('chart-symbol-name').textContent = 
                    `${this.config.instruments[this.state.activeInstrument].tvSymbol} (${this.state.activeInstrument})`;
                
                document.getElementById('chart-rsi').textContent = data.rsi.toFixed(1);
                document.getElementById('chart-trend').textContent = data.trend;
                document.getElementById('chart-retracement').textContent = `${data.retracement >= 0 ? '+' : ''}${data.retracement.toFixed(1)}%`;
                
                // Set colors based on kill zone
                if (data.rsi <= this.config.killZoneBuy) {
                    document.getElementById('chart-rsi').style.color = 'var(--positive)';
                    document.getElementById('chart-zone').textContent = 'BUY (≤20)';
                    document.getElementById('chart-zone').style.color = 'var(--positive)';
                } else if (data.rsi >= this.config.killZoneSell) {
                    document.getElementById('chart-rsi').style.color = 'var(--negative)';
                    document.getElementById('chart-zone').textContent = 'SELL (≥80)';
                    document.getElementById('chart-zone').style.color = 'var(--negative)';
                } else {
                    document.getElementById('chart-rsi').style.color = 'var(--neutral)';
                    document.getElementById('chart-zone').textContent = 'BLOCKED';
                    document.getElementById('chart-zone').style.color = '#cccccc';
                }
                
                document.getElementById('chart-trend').style.color = data.trend === 'bullish' ? 'var(--positive)' : 'var(--negative)';
                document.getElementById('chart-retracement').style.color = Math.abs(data.retracement) >= this.config.retracementThreshold ? '#ff9800' : 'var(--text-secondary)';
                
                document.getElementById('current-instrument').textContent = this.state.activeInstrument;
            },
            
            updateLastUpdateTime() {
                const now = new Date();
                const timeStr = now.toUTCString().split(' ')[4];
                
                // Update retracement status
                const nasRetracement = Math.abs(this.state.marketData.NAS100.retracement);
                const usRetracement = Math.abs(this.state.marketData.US30.retracement);
                const hasRetracement = nasRetracement >= this.config.retracementThreshold || 
                                      usRetracement >= this.config.retracementThreshold;
                
                if (hasRetracement) {
                    document.getElementById('retracement-status').innerHTML = 
                        `<i class="fas fa-wave-square" style="color:#ff9800;"></i> Retracement detected`;
                }
            },
            
            updateSessionDisplay() {
                const session = this.getCurrentSession();
                const now = new Date();
                const hour = now.getUTCHours();
                
                let sessionName = 'Market Closed';
                
                if (session === 'london') {
                    sessionName = 'London Session';
                } else if (session === 'ny') {
                    sessionName = 'New York Session';
                }
                
                document.getElementById('current-session').textContent = sessionName;
                
                // Update status indicator
                const statusEl = document.querySelector('.status-indicator');
                if (this.isSessionActive()) {
                    statusEl.className = 'status-indicator status-open';
                } else {
                    statusEl.className = 'status-indicator status-closed';
                }
            },
            
            getCurrentSession() {
                const now = new Date();
                const hour = now.getUTCHours();
                
                if (hour >= 8 && hour < 12) return 'london';
                if (hour >= 13 && hour < 20) return 'ny';
                return 'closed';
            },
            
            // Event Handlers
            setupEventListeners() {
                // Instrument selection
                document.querySelectorAll('.instrument-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const symbol = card.getAttribute('data-symbol');
                        
                        // Remove active class from all cards
                        document.querySelectorAll('.instrument-card').forEach(c => {
                            c.classList.remove('active');
                        });
                        
                        // Add active class to clicked card
                        card.classList.add('active');
                        
                        // Update state and chart
                        this.state.activeInstrument = symbol;
                        this.updateChartInfo();
                        this.updateEnforcementPanel();
                        this.initTradingView();
                    });
                });
                
                // Session buttons
                document.querySelectorAll('.session-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const session = btn.getAttribute('data-session');
                        
                        // Remove active class from all buttons
                        document.querySelectorAll('.session-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        
                        // Add active class to clicked button
                        btn.classList.add('active');
                        
                        // Update state
                        this.state.activeSession = session;
                        
                        // Update session display
                        this.updateSessionDisplay();
                        this.updateEnforcementPanel();
                    });
                });
                
                // Timeframe buttons
                document.querySelectorAll('.tf-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tf = btn.getAttribute('data-tf');
                        
                        // Remove active class from all buttons
                        document.querySelectorAll('.tf-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        
                        // Add active class to clicked button
                        btn.classList.add('active');
                        
                        // Update state and chart
                        this.state.currentTimeframe = tf;
                        
                        if (window.tvWidget) {
                            window.tvWidget.setChartType(tf);
                        }
                    });
                });
            },
            
            // Initialize everything
            init() {
                // Setup toastr
                toastr.options = {
                    positionClass: 'toast-top-right',
                    progressBar: true,
                    timeOut: 7000,
                    closeButton: true,
                    newestOnTop: true
                };
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Initial UI updates
                this.updateInstrumentUI('NAS100');
                this.updateInstrumentUI('US30');
                this.updateSessionDisplay();
                this.updateSignalsPanel();
                this.updateEnforcementPanel();
                this.updateKillZoneDisplay();
                
                // Initialize TradingView
                setTimeout(() => {
                    this.initTradingView();
                }, 1000);
                
                // Set up smart updates (check every 3 seconds for retracements)
                setInterval(() => {
                    this.updateMarketData();
                }, 3000);
                
                // Update session display every minute
                setInterval(() => {
                    this.updateSessionDisplay();
                }, 60000);
            }
        };
        
        // Start the STRICT KILLER ZONE system
        document.addEventListener('DOMContentLoaded', () => {
            KILLER_ZONE.init();
        });
    </script>
</body>
</html>
