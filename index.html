<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendIQ Indicator Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #334155;
        }
        
        h1 {
            color: #ebfc02;
            font-size: 28px;
        }
        
        .tagline {
            color: #94a3b8;
            font-size: 16px;
        }
        
        .main-content {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .chart-container {
            flex: 1;
            min-width: 300px;
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .controls-panel {
            width: 320px;
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .panel-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #ebfc02;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            font-size: 22px;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .control-value {
            color: #ebfc02;
            font-weight: 600;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #334155;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #ebfc02;
            cursor: pointer;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #334155;
            transition: .3s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #10b981;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .toggle-label {
            font-weight: 500;
        }
        
        .buttons-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background-color: #ebfc02;
            color: #0f172a;
        }
        
        .btn-primary:hover {
            background-color: #d4e502;
        }
        
        .btn-secondary {
            background-color: #334155;
            color: #e2e8f0;
        }
        
        .btn-secondary:hover {
            background-color: #475569;
        }
        
        .signals-container {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .signal-box {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .signal-buy {
            background-color: rgba(235, 252, 2, 0.15);
            border: 1px solid #ebfc02;
        }
        
        .signal-sell {
            background-color: rgba(247, 0, 0, 0.15);
            border: 1px solid #f70000;
        }
        
        .signal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .signal-buy .signal-title {
            color: #ebfc02;
        }
        
        .signal-sell .signal-title {
            color: #f70000;
        }
        
        .signal-value {
            font-size: 24px;
            font-weight: 700;
        }
        
        .status-container {
            margin-top: 25px;
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(30, 41, 59, 0.7);
            border-left: 4px solid #ebfc02;
        }
        
        .status-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #ebfc02;
        }
        
        .status-text {
            color: #94a3b8;
        }
        
        .trend-direction {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .trend-up {
            background-color: rgba(235, 252, 2, 0.2);
            color: #ebfc02;
        }
        
        .trend-down {
            background-color: rgba(247, 0, 0, 0.2);
            color: #f70000;
        }
        
        .trend-neutral {
            background-color: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .controls-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1><i class="fas fa-chart-line"></i> TrendIQ Indicator</h1>
                <p class="tagline">Advanced trend detection using Bollinger Bands and ATR filter</p>
            </div>
            <div class="status-container">
                <div class="status-title">Current Status <span id="trendDirection" class="trend-direction trend-neutral">NEUTRAL</span></div>
                <p class="status-text" id="statusText">Awaiting signal generation...</p>
            </div>
        </header>
        
        <div class="main-content">
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
            
            <div class="controls-panel">
                <div class="panel-title"><i class="fas fa-sliders-h"></i> Indicator Settings</div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>ATR Period</span>
                        <span class="control-value" id="atrValue">200</span>
                    </div>
                    <input type="range" id="atrSlider" min="1" max="500" value="200" step="1">
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Bollinger Bands Period</span>
                        <span class="control-value" id="bbPeriodValue">22</span>
                    </div>
                    <input type="range" id="bbPeriodSlider" min="1" max="100" value="22" step="1">
                </div>
                
                <div class="control-group">
                    <div class="control-label">
                        <span>Bollinger Bands Deviation</span>
                        <span class="control-value" id="bbDeviationValue">2.40</span>
                    </div>
                    <input type="range" id="bbDeviationSlider" min="0.1" max="5" value="2.4" step="0.1">
                </div>
                
                <div class="toggle-container">
                    <span class="toggle-label">ATR Filter</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="atrFilterToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div class="toggle-container">
                    <span class="toggle-label">Show Signals</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showSignalsToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div class="buttons-container">
                    <button class="btn-secondary" id="resetBtn">
                        <i class="fas fa-redo"></i> Reset Defaults
                    </button>
                    <button class="btn-primary" id="applyBtn">
                        <i class="fas fa-play"></i> Apply Settings
                    </button>
                </div>
                
                <div class="signals-container">
                    <div class="signal-box signal-buy">
                        <div class="signal-title">BUY SIGNALS</div>
                        <div class="signal-value" id="buyCount">0</div>
                    </div>
                    <div class="signal-box signal-sell">
                        <div class="signal-title">SELL SIGNALS</div>
                        <div class="signal-value" id="sellCount">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize variables
        let atrPeriod = 200;
        let bbPeriod = 22;
        let bbDeviation = 2.4;
        let useATRFilter = true;
        let showSignals = true;
        
        // Chart data
        let chart = null;
        let priceData = [];
        let bbUpperData = [];
        let bbLowerData = [];
        let eliteSignalData = [];
        let eliteSignalUpperData = [];
        let eliteSignalLowerData = [];
        let buySignals = [];
        let sellSignals = [];
        
        // DOM elements
        const atrSlider = document.getElementById('atrSlider');
        const atrValue = document.getElementById('atrValue');
        const bbPeriodSlider = document.getElementById('bbPeriodSlider');
        const bbPeriodValue = document.getElementById('bbPeriodValue');
        const bbDeviationSlider = document.getElementById('bbDeviationSlider');
        const bbDeviationValue = document.getElementById('bbDeviationValue');
        const atrFilterToggle = document.getElementById('atrFilterToggle');
        const showSignalsToggle = document.getElementById('showSignalsToggle');
        const resetBtn = document.getElementById('resetBtn');
        const applyBtn = document.getElementById('applyBtn');
        const buyCount = document.getElementById('buyCount');
        const sellCount = document.getElementById('sellCount');
        const trendDirection = document.getElementById('trendDirection');
        const statusText = document.getElementById('statusText');
        
        // Initialize with sample data
        function initializeData() {
            priceData = [];
            bbUpperData = [];
            bbLowerData = [];
            eliteSignalData = [];
            eliteSignalUpperData = [];
            eliteSignalLowerData = [];
            buySignals = [];
            sellSignals = [];
            
            // Generate sample price data
            let basePrice = 100;
            for (let i = 0; i < 100; i++) {
                // Random walk with slight upward bias
                basePrice += (Math.random() - 0.45) * 3;
                priceData.push(basePrice);
            }
            
            // Calculate indicator data
            calculateIndicators();
        }
        
        // Calculate all indicators based on current settings
        function calculateIndicators() {
            // Clear previous data
            bbUpperData = [];
            bbLowerData = [];
            eliteSignalData = [];
            eliteSignalUpperData = [];
            eliteSignalLowerData = [];
            buySignals = [];
            sellSignals = [];
            
            let buySignalCount = 0;
            let sellSignalCount = 0;
            let previousTrend = 0;
            let currentTrend = 0;
            
            // Calculate Bollinger Bands
            for (let i = bbPeriod - 1; i < priceData.length; i++) {
                // Get the slice for SMA calculation
                const slice = priceData.slice(i - bbPeriod + 1, i + 1);
                const sma = slice.reduce((sum, price) => sum + price, 0) / bbPeriod;
                
                // Calculate standard deviation
                const variance = slice.reduce((sum, price) => sum + Math.pow(price - sma, 2), 0) / bbPeriod;
                const stdev = Math.sqrt(variance);
                
                // Calculate BB upper and lower
                const bbUpper = sma + stdev * bbDeviation;
                const bbLower = sma - stdev * bbDeviation;
                
                bbUpperData.push({x: i, y: bbUpper});
                bbLowerData.push({x: i, y: bbLower});
                
                // Calculate ATR (simplified)
                let atrValue = 0;
                if (i >= atrPeriod) {
                    let sum = 0;
                    for (let j = i - atrPeriod + 1; j <= i; j++) {
                        sum += Math.abs(priceData[j] - priceData[j-1]);
                    }
                    atrValue = sum / atrPeriod;
                }
                
                // Determine BB signal
                let bbSignal = 0;
                if (priceData[i] > bbUpper) bbSignal = 1;
                else if (priceData[i] < bbLower) bbSignal = -1;
                
                // Calculate Elite Signal
                let eliteSignal = 0;
                if (bbSignal === 1) {
                    // Buy signal logic
                    eliteSignal = priceData[i] - (useATRFilter ? atrValue : 0);
                    if (i > 0 && eliteSignalData.length > 0 && eliteSignal < eliteSignalData[eliteSignalData.length-1].y) {
                        eliteSignal = eliteSignalData[eliteSignalData.length-1].y;
                    }
                } else if (bbSignal === -1) {
                    // Sell signal logic
                    eliteSignal = priceData[i] + (useATRFilter ? atrValue : 0);
                    if (i > 0 && eliteSignalData.length > 0 && eliteSignal > eliteSignalData[eliteSignalData.length-1].y) {
                        eliteSignal = eliteSignalData[eliteSignalData.length-1].y;
                    }
                } else {
                    // No signal, continue previous trend
                    eliteSignal = eliteSignalData.length > 0 ? eliteSignalData[eliteSignalData.length-1].y : priceData[i];
                }
                
                eliteSignalData.push({x: i, y: eliteSignal});
                
                // Calculate trend direction
                if (i > 0 && eliteSignalData.length > 1) {
                    const prevSignal = eliteSignalData[eliteSignalData.length-2].y;
                    if (eliteSignal > prevSignal) currentTrend = 1;
                    else if (eliteSignal < prevSignal) currentTrend = -1;
                    else currentTrend = previousTrend;
                }
                
                // Detect buy/sell signals
                if (i > 0) {
                    if (previousTrend === -1 && currentTrend === 1) {
                        buySignals.push({x: i, y: eliteSignal - atrValue});
                        buySignalCount++;
                    } else if (previousTrend === 1 && currentTrend === -1) {
                        sellSignals.push({x: i, y: eliteSignal + atrValue});
                        sellSignalCount++;
                    }
                }
                
                previousTrend = currentTrend;
                
                // Calculate upper and lower elite signals with gap
                const gapSize = atrValue * 0.5;
                eliteSignalUpperData.push({x: i, y: eliteSignal + gapSize});
                eliteSignalLowerData.push({x: i, y: eliteSignal - gapSize});
            }
            
            // Update signal counters
            buyCount.textContent = buySignalCount;
            sellCount.textContent = sellSignalCount;
            
            // Update trend direction display
            updateTrendDisplay(currentTrend);
        }
        
        // Update trend direction display
        function updateTrendDisplay(trend) {
            if (trend === 1) {
                trendDirection.textContent = "BULLISH";
                trendDirection.className = "trend-direction trend-up";
                statusText.textContent = "Uptrend detected. Consider BUY opportunities.";
            } else if (trend === -1) {
                trendDirection.textContent = "BEARISH";
                trendDirection.className = "trend-direction trend-down";
                statusText.textContent = "Downtrend detected. Consider SELL opportunities.";
            } else {
                trendDirection.textContent = "NEUTRAL";
                trendDirection.className = "trend-direction trend-neutral";
                statusText.textContent = "No strong trend detected. Awaiting clear signal.";
            }
        }
        
        // Initialize chart
        function initializeChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            // Prepare datasets
            const datasets = [
                {
                    label: 'Price',
                    data: priceData.map((price, index) => ({x: index, y: price})),
                    borderColor: '#e2e8f0',
                    backgroundColor: 'rgba(226, 232, 240, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0
                },
                {
                    label: 'Bollinger Upper',
                    data: bbUpperData,
                    borderColor: 'rgba(59, 130, 246, 0.7)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 1,
                    fill: false,
                    pointRadius: 0,
                    borderDash: [5, 5]
                },
                {
                    label: 'Bollinger Lower',
                    data: bbLowerData,
                    borderColor: 'rgba(59, 130, 246, 0.7)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 1,
                    fill: false,
                    pointRadius: 0,
                    borderDash: [5, 5]
                },
                {
                    label: 'TrendIQ Signal',
                    data: eliteSignalData,
                    borderColor: '#ebfc02',
                    backgroundColor: 'rgba(235, 252, 2, 0.1)',
                    borderWidth: 3,
                    fill: false,
                    pointRadius: 0
                }
            ];
            
            // Add upper and lower trend lines if showSignals is true
            if (showSignals) {
                datasets.push({
                    label: 'TrendIQ Upper',
                    data: eliteSignalUpperData,
                    borderColor: '#ebfc02',
                    backgroundColor: 'rgba(235, 252, 2, 0.05)',
                    borderWidth: 1,
                    fill: false,
                    pointRadius: 0
                });
                
                datasets.push({
                    label: 'TrendIQ Lower',
                    data: eliteSignalLowerData,
                    borderColor: '#ebfc02',
                    backgroundColor: 'rgba(235, 252, 2, 0.05)',
                    borderWidth: 1,
                    fill: false,
                    pointRadius: 0
                });
            }
            
            // Add buy signals if showSignals is true
            if (showSignals && buySignals.length > 0) {
                datasets.push({
                    label: 'BUY',
                    data: buySignals,
                    borderColor: '#ebfc02',
                    backgroundColor: '#ebfc02',
                    borderWidth: 0,
                    pointRadius: 6,
                    pointStyle: 'triangle',
                    showLine: false
                });
            }
            
            // Add sell signals if showSignals is true
            if (showSignals && sellSignals.length > 0) {
                datasets.push({
                    label: 'SELL',
                    data: sellSignals,
                    borderColor: '#f70000',
                    backgroundColor: '#f70000',
                    borderWidth: 0,
                    pointRadius: 6,
                    pointStyle: 'triangle',
                    pointRotation: 180,
                    showLine: false
                });
            }
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#ebfc02',
                            bodyColor: '#e2e8f0',
                            borderColor: '#334155',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    }
                }
            });
        }
        
        // Event listeners
        atrSlider.addEventListener('input', function() {
            atrValue.textContent = this.value;
        });
        
        bbPeriodSlider.addEventListener('input', function() {
            bbPeriodValue.textContent = this.value;
        });
        
        bbDeviationSlider.addEventListener('input', function() {
            bbDeviationValue.textContent = parseFloat(this.value).toFixed(2);
        });
        
        atrFilterToggle.addEventListener('change', function() {
            useATRFilter = this.checked;
        });
        
        showSignalsToggle.addEventListener('change', function() {
            showSignals = this.checked;
        });
        
        resetBtn.addEventListener('click', function() {
            // Reset sliders to default values
            atrSlider.value = 200;
            atrValue.textContent = '200';
            
            bbPeriodSlider.value = 22;
            bbPeriodValue.textContent = '22';
            
            bbDeviationSlider.value = 2.4;
            bbDeviationValue.textContent = '2.40';
            
            atrFilterToggle.checked = true;
            showSignalsToggle.checked = true;
            
            // Reset variables
            atrPeriod = 200;
            bbPeriod = 22;
            bbDeviation = 2.4;
            useATRFilter = true;
            showSignals = true;
            
            // Recalculate and update chart
            calculateIndicators();
            initializeChart();
            
            // Show confirmation
            statusText.textContent = "Settings reset to defaults. Chart updated.";
        });
        
        applyBtn.addEventListener('click', function() {
            // Update variables from slider values
            atrPeriod = parseInt(atrSlider.value);
            bbPeriod = parseInt(bbPeriodSlider.value);
            bbDeviation = parseFloat(bbDeviationSlider.value);
            useATRFilter = atrFilterToggle.checked;
            showSignals = showSignalsToggle.checked;
            
            // Recalculate and update chart
            calculateIndicators();
            initializeChart();
            
            // Show confirmation
            statusText.textContent = "Settings applied successfully. Chart updated with new parameters.";
        });
        
        // Initialize the dashboard
        function initializeDashboard() {
            initializeData();
            initializeChart();
            
            // Set initial values for display
            atrValue.textContent = atrSlider.value;
            bbPeriodValue.textContent = bbPeriodSlider.value;
            bbDeviationValue.textContent = parseFloat(bbDeviationSlider.value).toFixed(2);
        }
        
        // Start the dashboard
        initializeDashboard();
    </script>
</body>
</html>
