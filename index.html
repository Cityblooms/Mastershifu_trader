<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quantum Turbo Trader</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1; --primary-dark: #4338ca; --success: #10b981; --danger: #ef4444;
            --warning: #f59e0b; --info: #3b82f6; --purple: #8b5cf6; --pink: #ec4899;
            --bg-dark: #0f172a; --bg-card: #1e293b; --text-primary: #f1f5f9; --text-secondary: #94a3b8;
            --border: #334155;
        }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-dark); color: var(--text-primary); line-height:1.6; overflow-x:hidden; padding-bottom:80px; }
        .container { max-width:100%; padding:0 15px; }
        .header { background:var(--bg-card); padding:15px; position:sticky; top:0; z-index:100; border-bottom:1px solid var(--border); backdrop-filter: blur(10px); }
        .nav-tabs { display:flex; justify-content:space-around; margin-top:10px; flex-wrap:wrap; gap:5px; }
        .nav-tab { padding:8px 12px; border-radius:20px; font-size:12px; font-weight:500; transition:all .3s; white-space:nowrap; cursor:pointer; }
        .nav-tab.active { background:var(--primary); color:white; }
        .turbo-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(170px,1fr)); gap:12px; margin:15px 0; }
        .turbo-card { background:var(--bg-card); border-radius:12px; padding:15px; border:1px solid var(--border); transition:all .3s; position:relative; overflow:hidden; cursor:pointer; min-height:90px; }
        .turbo-card::before { content:''; position:absolute; top:0; left:0; right:0; height:3px; background:var(--primary); }
        .turbo-card.jump::before { background:var(--pink); } .turbo-card.boom::before { background:var(--warning); }
        .turbo-card.crash::before { background:var(--danger); } .turbo-card.volatility::before { background:var(--info); }
        .turbo-card.active { border-color:var(--primary); box-shadow: 0 0 0 2px rgba(99,102,241,.12); }
        .market-badge { position:absolute; top:8px; right:8px; padding:2px 8px; border-radius:10px; font-size:10px; font-weight:600; }
        .badge-jump { background:var(--pink); } .badge-boom { background:var(--warning); color:black; }
        .badge-crash { background:var(--danger); } .badge-volatility { background:var(--info); }
        .signal-card { background:var(--bg-card); border-radius:16px; padding:20px; margin:15px 0; border:1px solid var(--border); position:relative; overflow:hidden; }
        .signal-card.turbo { background:linear-gradient(135deg, rgba(139,92,246,0.12), transparent); border-color:var(--purple); }
        .signal-card.jump { background:linear-gradient(135deg, rgba(236,72,153,0.12), transparent); border-color:var(--pink); }
        .signal-card.boom { background:linear-gradient(135deg, rgba(245,158,11,0.12), transparent); border-color:var(--warning); }
        .signal-card.crash { background:linear-gradient(135deg, rgba(239,68,68,0.12), transparent); border-color:var(--danger); }
        .signal-card.volatility { background:linear-gradient(135deg, rgba(59,130,246,0.12), transparent); border-color:var(--info); }
        .countdown { display:inline-block; padding:4px 8px; background:var(--primary); border-radius:8px; font-family:monospace; font-weight:bold; margin-left:8px; }
        .countdown.warning { background:var(--warning); color:black; animation:blink 1s infinite; }
        .countdown.danger { background:var(--danger); animation:blink .5s infinite; }
        .btn { padding:12px 24px; border:none; border-radius:12px; font-weight:600; font-size:16px; cursor:pointer; transition:all .3s; display:flex; align-items:center; justify-content:center; gap:8px; }
        .btn-primary { background:var(--primary); color:white; } .btn-success { background:var(--success); color:white; }
        .btn-danger { background:var(--danger); color:white; } .btn-warning { background:var(--warning); color:black; }
        .btn-turbo { background:var(--purple); color:white; } .btn-outline { background:transparent; border:2px solid var(--border); color:var(--text-primary); }
        .btn.active-trade-up { background-color:var(--success) !important; color:white !important; }
        .btn.active-trade-down { background-color:var(--danger) !important; color:white !important; }
        .trade-panel { position:fixed; bottom:0; left:0; right:0; background:var(--bg-card); border-top:1px solid var(--border); padding:15px; z-index:1000; }
        .trade-buttons { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
        .expiry-options { display:flex; gap:8px; margin:10px 0; flex-wrap:wrap; }
        .expiry-option { padding:8px 12px; border:2px solid var(--border); border-radius:8px; cursor:pointer; transition:all .3s; font-size:14px; }
        .expiry-option.active { border-color:var(--primary); background:var(--primary); color:white; }
        .modal { display:none; position:fixed; z-index:1001; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.75); backdrop-filter: blur(5px); padding-top:50px; }
        .modal.active { display:block; }
        .modal-content { background-color:var(--bg-card); margin:5% auto; padding:20px; border:1px solid var(--border); width:90%; max-width:400px; border-radius:16px; box-shadow: 0 5px 15px rgba(0,0,0,.5); animation:slideIn .3s ease-out; }
        @keyframes slideIn { from { transform: translateY(-50px); opacity:0; } to { transform: translateY(0); opacity:1; } }
        .form-group { margin-bottom:15px; } .form-label { display:block; margin-bottom:5px; font-size:14px; color:var(--text-secondary); }
        .form-input { width:100%; padding:10px; background:var(--bg-dark); border:1px solid var(--border); border-radius:8px; color:var(--text-primary); font-size:16px; }
        @keyframes pulse { 0% { transform:scale(1); box-shadow:0 0 0 0 rgba(245,158,11,.7); } 50% { transform:scale(1.02); box-shadow:0 0 0 10px rgba(245,158,11,0); } 100% { transform:scale(1); box-shadow:0 0 0 0 rgba(245,158,11,0); } }
        @keyframes blink { 0%,100%{ opacity:1; } 50%{ opacity:0.5; } }
        @keyframes flash { 0%,100% { background: var(--bg-card); } 50% { background: var(--warning); } }
        .flash { animation: flash .5s; }
        .high-volatility { animation: pulse 2s infinite; border-color: var(--warning) !important; }
        .text-success { color:var(--success); } .text-danger { color:var(--danger); } .text-warning { color:var(--warning); }
        .text-info { color:var(--info); } .text-turbo { color:var(--purple); }
        .flex { display:flex; } .justify-between { justify-content:space-between; } .items-center { align-items:center; }
        .text-center { text-align:center; } .mb-1 { margin-bottom:8px; } .mb-2 { margin-bottom:16px; } .mt-2 { margin-top:16px; } .gap-2 { gap:16px; }
        .text-large { font-size:20px; font-weight:700; }
        .connection-status { font-size:12px; color:var(--text-secondary); margin-left:8px; }
        .signals-container { max-height: 400px; overflow-y: auto; margin-top: 15px; }
        .signals-container::-webkit-scrollbar { width: 6px; }
        .signals-container::-webkit-scrollbar-track { background: var(--bg-dark); border-radius: 3px; }
        .signals-container::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        @media (max-width:768px) { .turbo-grid { grid-template-columns:repeat(2,1fr); } .btn { padding:14px 20px; } .nav-tab { padding:6px 10px; font-size:11px; } }
    </style>
</head>
<body>
    <div class="header">
        <div class="flex justify-between items-center">
            <h1>Quantum Turbo Trader</h1>
            <div class="flex items-center gap-3">
                <div id="connStatus" class="connection-status">WS: <strong id="connState">disconnected</strong></div>
                <button id="settingsBtn" class="btn btn-outline" style="padding:8px;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="turbo">Turbo Markets</div>
            <div class="nav-tab" data-tab="jump">Jump Indices</div>
            <div class="nav-tab" data-tab="boom">Boom & Crash</div>
            <div class="nav-tab" data-tab="volatility">Volatility</div>
            <div class="nav-tab" data-tab="forex">Forex</div>
            <div class="nav-tab" data-tab="crypto">Crypto</div>
        </div>
    </div>

    <div class="container">
        <div id="turbo" class="tab-content active">
            <div class="signal-card turbo">
                <h3 class="mb-2">ðŸš€ Turbo Markets Live</h3>
                <p>Fast-expiry trading with 1-5 minute timeframes</p>
            </div>
            <div class="turbo-grid" id="turboMarkets"></div>
            
            <div class="signal-card turbo">
                <h3 class="mb-2">ðŸ”¥ Live Market Signals</h3>
                <div class="signals-container" id="turboSignals">
                    <div class="text-center text-secondary" style="padding: 20px;">
                        <i class="fas fa-wave-square" style="font-size: 24px; margin-bottom: 10px;"></i>
                        <p>Waiting for market signals...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="jump" class="tab-content" style="display:none;">
            <div class="signal-card jump">
                <h3 class="mb-2">ðŸ¦˜ Jump Indices</h3>
                <p>Predict sharp upward price movements</p>
            </div>
            <div class="turbo-grid" id="jumpMarkets"></div>
        </div>
        
        <div id="boom" class="tab-content" style="display:none;">
            <div class="signal-card boom">
                <h3 class="mb-2">ðŸ’¥ Boom & Crash</h3>
                <p>Trade explosive market movements in both directions</p>
            </div>
            <div class="turbo-grid" id="boomMarkets"></div>
        </div>
        
        <div id="volatility" class="tab-content" style="display:none;">
            <div class="signal-card volatility">
                <h3 class="mb-2">ðŸ“Š Volatility Markets</h3>
                <p>Trade market volatility without directional bias</p>
            </div>
            <div class="turbo-grid" id="volatilityMarkets"></div>
        </div>
        
        <div id="forex" class="tab-content" style="display:none;">
            <div class="signal-card turbo">
                <h3 class="mb-2">ðŸ“ˆ Forex Markets</h3>
                <p>Coming soon...</p>
            </div>
        </div>
        
        <div id="crypto" class="tab-content" style="display:none;">
            <div class="signal-card turbo">
                <h3 class="mb-2">â‚¿ Crypto Markets</h3>
                <p>Coming soon...</p>
            </div>
        </div>
    </div>

    <div class="trade-panel">
        <div class="expiry-options" id="expiryOptions">
            <div class="expiry-option active" data-minutes="1">1 Min</div>
            <div class="expiry-option" data-minutes="2">2 Min</div>
            <div class="expiry-option" data-minutes="5">5 Min</div>
            <div class="expiry-option" data-minutes="15">15 Min</div>
        </div>
        <div class="trade-buttons">
            <button id="turboUpBtn" class="btn btn-success"><i class="fas fa-arrow-up"></i> UP</button>
            <button id="turboDownBtn" class="btn btn-danger"><i class="fas fa-arrow-down"></i> DOWN</button>
        </div>
    </div>

    <div id="turboTradeModal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <h3 id="turboTradeTitle" class="mb-2">Turbo Trade</h3>
            <div class="form-group">
                <label class="form-label">Market</label>
                <input class="form-input" id="turboTradeSymbol" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Direction</label>
                <div class="flex gap-2">
                    <button id="confirmUp" class="btn btn-outline" style="flex:1;"><i class="fas fa-arrow-up"></i> UP</button>
                    <button id="confirmDown" class="btn btn-outline" style="flex:1;"><i class="fas fa-arrow-down"></i> DOWN</button>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Entry Price</label>
                <input class="form-input" id="turboTradeEntryPrice" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">Amount ($)</label>
                <input class="form-input" id="turboTradeAmount" type="number" value="50" min="5" max="1000">
            </div>
            <div class="form-group">
                <label class="form-label">Expires In</label>
                <div class="countdown" id="tradeCountdown">01:00</div>
            </div>
            <div class="flex gap-2">
                <button id="confirmTurboTrade" class="btn btn-turbo" style="flex:1;">Confirm Trade</button>
                <button id="cancelTurboTrade" class="btn btn-outline" style="flex:1;">Cancel</button>
            </div>
        </div>
    </div>

    <script>
    class QuantumTurboTrader {
        constructor() {
            this.derivAppId = '1089';
            this.derivApiToken = null;
            this.ws = null;
            this.reconnectAttempts = 0;
            this.maxSignalsShown = 10;
            this.signalCount = 0;
            
            // Enhanced market data with proper Deriv symbols
            this.turboMarkets = {
                jump: [
                    { symbol: '1HZ50V', name: 'Jump 50', price: 15432.50, volatility: 'high', type: 'jump', trend: 'neutral', nextJump: 45 },
                    { symbol: '1HZ75V', name: 'Jump 75', price: 23456.75, volatility: 'very-high', type: 'jump', trend: 'neutral', nextJump: 30 },
                    { symbol: '1HZ100V', name: 'Jump 100', price: 34567.25, volatility: 'extreme', type: 'jump', trend: 'neutral', nextJump: 60 }
                ],
                boom: [
                    { symbol: 'BOOM500', name: 'Boom 500', price: 51234.80, volatility: 'high', type: 'boom', trend: 'neutral' },
                    { symbol: 'BOOM1000', name: 'Boom 1000', price: 102345.60, volatility: 'very-high', type: 'boom', trend: 'neutral' },
                    { symbol: 'CRASH500', name: 'Crash 500', price: 48765.40, volatility: 'high', type: 'crash', trend: 'neutral' },
                    { symbol: 'CRASH1000', name: 'Crash 1000', price: 97654.20, volatility: 'very-high', type: 'crash', trend: 'neutral' }
                ],
                volatility: [
                    { symbol: 'R_75', name: 'Volatility 75', price: 75000.25, volatility: 'extreme', type: 'volatility', trend: 'neutral', spikeProbability: 0.3 },
                    { symbol: 'R_100', name: 'Volatility 100', price: 100000.50, volatility: 'extreme', type: 'volatility', trend: 'neutral', spikeProbability: 0.4 },
                    { symbol: 'RDBULL', name: 'Volatility 250', price: 250000.75, volatility: 'extreme', type: 'volatility', trend: 'neutral', spikeProbability: 0.5 }
                ]
            };
            
            this.activeTurboTrades = [];
            this.currentExpiry = 1;
            this.selectedMarket = null;
            this.countdownInterval = null;
            this.currentTradeDirection = null;
            this.pingInterval = null;
            this.demoMode = true;
            
            this.init();
        }

        init() {
            this.setupEventListeners();
            this.renderTurboMarkets();
            this.startDemoMode();
            
            // Auto-select first market
            const firstMarket = this.turboMarkets.jump[0];
            if (firstMarket) {
                this.selectTurboMarket(firstMarket.symbol);
            }
            
            console.log('Quantum Turbo Trader initialized in Demo Mode');
        }

        startDemoMode() {
            // Demo price updates
            setInterval(() => {
                this.updateDemoPrices();
            }, 2000);
            
            // Demo signal generation
            setInterval(() => {
                this.generateDemoSignals();
            }, 8000);
        }

        updateDemoPrices() {
            Object.values(this.turboMarkets).flat().forEach(market => {
                if (market.price > 0) {
                    const volatility = market.volatility === 'extreme' ? 0.3 : 
                                     market.volatility === 'very-high' ? 0.15 : 0.08;
                    
                    const change = (Math.random() - 0.5) * volatility;
                    const newPrice = market.price * (1 + change / 100);
                    
                    // Update trend
                    market.trend = newPrice > market.price ? 'bullish' : 'bearish';
                    market.price = newPrice;
                    
                    // Update jump countdown
                    if (market.nextJump !== undefined && market.nextJump > 0) {
                        market.nextJump--;
                        if (market.nextJump === 0) {
                            this.triggerDemoJump(market);
                        }
                    }
                }
            });
            this.renderTurboMarkets();
        }

        generateDemoSignals() {
            const markets = Object.values(this.turboMarkets).flat();
            const randomMarket = markets[Math.floor(Math.random() * markets.length)];
            const signalTypes = ['JUMP', 'BOOM', 'CRASH', 'VOLATILITY_SPIKE'];
            const randomType = signalTypes[Math.floor(Math.random() * signalTypes.length)];
            
            this.createSignal(randomMarket, randomType, (Math.random() * 5 + 1).toFixed(2));
        }

        triggerDemoJump(market) {
            // Simulate jump
            const jumpSize = 2 + Math.random() * 3;
            market.price *= (1 + jumpSize / 100);
            market.nextJump = Math.floor(Math.random() * 60) + 30;
            market.trend = 'bullish';
            
            this.createSignal(market, 'JUMP', jumpSize.toFixed(2));
        }

        createSignal(market, type, changePercent) {
            this.signalCount++;
            
            const signalCard = document.createElement('div');
            signalCard.className = `signal-card ${market.type} flash`;
            
            let typeIcon = 'âš¡';
            let typeColor = 'text-info';
            
            switch(type) {
                case 'JUMP':
                    typeIcon = 'ðŸ¦˜';
                    typeColor = 'text-turbo';
                    break;
                case 'BOOM':
                    typeIcon = 'ðŸ’¥';
                    typeColor = 'text-warning';
                    break;
                case 'CRASH':
                    typeIcon = 'ðŸ“‰';
                    typeColor = 'text-danger';
                    break;
                case 'VOLATILITY_SPIKE':
                    typeIcon = 'âš¡';
                    typeColor = 'text-info';
                    break;
            }
            
            const isPositive = !type.includes('CRASH') && parseFloat(changePercent) > 0;
            const changeText = isPositive ? `+${changePercent}%` : `${changePercent}%`;
            
            signalCard.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <h3>${typeIcon} ${type} DETECTED!</h3>
                    <span class="${isPositive ? 'text-success' : 'text-danger'}">
                        ${changeText}
                    </span>
                </div>
                <div class="flex justify-between mb-2">
                    <strong>${market.name}</strong>
                    <span class="text-large">$${market.price.toFixed(2)}</span>
                </div>
                <div class="flex justify-between text-secondary">
                    <span>Signal #${this.signalCount}</span>
                    <span>${new Date().toLocaleTimeString()}</span>
                </div>
            `;
            
            this.addSignalToDashboard(signalCard);
            
            // Show browser notification
            this.showNotification(`${type}!`, `${market.name} ${changeText}`);
        }

        setupEventListeners() {
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                    
                    e.target.classList.add('active');
                    const tabId = e.target.dataset.tab;
                    const tabElement = document.getElementById(tabId);
                    if (tabElement) {
                        tabElement.style.display = 'block';
                    }
                });
            });

            // Expiry options
            document.querySelectorAll('.expiry-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    document.querySelectorAll('.expiry-option').forEach(o => o.classList.remove('active'));
                    e.target.classList.add('active');
                    this.currentExpiry = parseInt(e.target.dataset.minutes);
                });
            });

            // Trade buttons
            document.getElementById('turboUpBtn').addEventListener('click', () => {
                this.showTurboTradeModal('UP');
            });

            document.getElementById('turboDownBtn').addEventListener('click', () => {
                this.showTurboTradeModal('DOWN');
            });

            // Modal buttons
            document.getElementById('cancelTurboTrade').addEventListener('click', () => {
                this.hideModal('turboTradeModal');
                this.stopCountdown();
            });

            document.getElementById('confirmTurboTrade').addEventListener('click', () => {
                this.placeTurboTrade();
            });

            // Direction selection in modal
            document.getElementById('confirmUp').addEventListener('click', () => {
                this.currentTradeDirection = 'UP';
                document.getElementById('confirmUp').classList.add('active-trade-up');
                document.getElementById('confirmDown').classList.remove('active-trade-down');
            });

            document.getElementById('confirmDown').addEventListener('click', () => {
                this.currentTradeDirection = 'DOWN';
                document.getElementById('confirmDown').classList.add('active-trade-down');
                document.getElementById('confirmUp').classList.remove('active-trade-up');
            });

            // Market selection
            document.addEventListener('click', (e) => {
                const card = e.target.closest('.turbo-card');
                if (card && card.dataset.symbol) {
                    this.selectTurboMarket(card.dataset.symbol);
                }
            });

            // Settings button
            document.getElementById('settingsBtn').addEventListener('click', () => {
                this.showNotification('Settings', 'Settings panel coming soon!');
            });
        }

        renderTurboMarkets() {
            this.renderMarketSection('turboMarkets', [...this.turboMarkets.jump, ...this.turboMarkets.boom, ...this.turboMarkets.volatility]);
            this.renderMarketSection('jumpMarkets', this.turboMarkets.jump);
            this.renderMarketSection('boomMarkets', this.turboMarkets.boom);
            this.renderMarketSection('volatilityMarkets', this.turboMarkets.volatility);
        }

        renderMarketSection(containerId, markets) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = markets.map(market => {
                const badgeClass = `badge-${market.type}`;
                const cardClass = `turbo-card ${market.type} ${market.volatility.includes('high') ? 'high-volatility' : ''}`;
                const isActive = this.selectedMarket && this.selectedMarket.symbol === market.symbol ? 'active' : '';
                const trendSymbol = market.trend === 'bullish' ? 'â†—' : market.trend === 'bearish' ? 'â†˜' : 'âž¡';
                const trendClass = market.trend === 'bullish' ? 'text-success' : market.trend === 'bearish' ? 'text-danger' : 'text-info';

                return `
                    <div class="${cardClass} ${isActive}" data-symbol="${market.symbol}">
                        <div class="market-badge ${badgeClass}">${market.type.toUpperCase()}</div>
                        <div class="flex justify-between items-center mb-1">
                            <strong>${market.name}</strong>
                            <span class="${trendClass}">${trendSymbol}</span>
                        </div>
                        <div class="text-large">$${market.price.toFixed(2)}</div>
                        <div class="flex justify-between text-secondary">
                            <small>Vol: ${market.volatility}</small>
                            ${market.nextJump ? `<small>Jump: <span class="text-warning">${market.nextJump}s</span></small>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        showTurboTradeModal(direction) {
            if (!this.selectedMarket) {
                this.showNotification('Select Market', 'Please select a market first');
                return;
            }

            this.currentTradeDirection = direction;
            
            // Update modal content
            document.getElementById('turboTradeTitle').textContent = `Turbo ${direction} Trade`;
            document.getElementById('turboTradeSymbol').value = this.selectedMarket.name;
            document.getElementById('turboTradeEntryPrice').value = this.selectedMarket.price.toFixed(2);
            
            // Set direction buttons
            document.getElementById('confirmUp').classList.toggle('active-trade-up', direction === 'UP');
            document.getElementById('confirmDown').classList.toggle('active-trade-down', direction === 'DOWN');
            
            this.startTradeCountdown();
            this.showModal('turboTradeModal');
        }

        startTradeCountdown() {
            let timeLeft = this.currentExpiry * 60;
            const countdownElement = document.getElementById('tradeCountdown');
            
            this.stopCountdown();
            
            this.countdownInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                if (countdownElement) {
                    countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Update styling based on time
                    if (timeLeft <= 10) {
                        countdownElement.className = 'countdown danger';
                    } else if (timeLeft <= 30) {
                        countdownElement.className = 'countdown warning';
                    } else {
                        countdownElement.className = 'countdown';
                    }
                }
                
                if (timeLeft <= 0) {
                    this.stopCountdown();
                    this.hideModal('turboTradeModal');
                }
                
                timeLeft--;
            }, 1000);
        }

        stopCountdown() {
            if (this.countdownInterval) {
                clearInterval(this.countdownInterval);
                this.countdownInterval = null;
            }
        }

        placeTurboTrade() {
            if (!this.currentTradeDirection) {
                this.showNotification('Error', 'Please select trade direction');
                return;
            }

            const amountInput = document.getElementById('turboTradeAmount');
            const amount = amountInput ? parseFloat(amountInput.value) : 0;
            
            if (isNaN(amount) || amount < 5 || amount > 1000) {
                this.showNotification('Invalid Amount', 'Amount must be between $5 and $1000');
                return;
            }

            const trade = {
                id: Date.now(),
                symbol: this.selectedMarket.symbol,
                name: this.selectedMarket.name,
                direction: this.currentTradeDirection,
                amount: amount,
                expiry: this.currentExpiry,
                entryPrice: this.selectedMarket.price,
                timestamp: new Date(),
                status: 'PENDING'
            };

            this.activeTurboTrades.push(trade);
            
            this.hideModal('turboTradeModal');
            this.stopCountdown();
            
            // Simulate trade resolution
            setTimeout(() => {
                this.resolveTurboTrade(trade);
            }, this.currentExpiry * 60 * 1000);

            this.showNotification('Trade Placed', 
                `${trade.direction} ${trade.name} - $${trade.amount} - ${trade.expiry}min`);
        }

        resolveTurboTrade(trade) {
            const market = this.findMarket(trade.symbol);
            if (!market) return;

            const currentPrice = market.price;
            const wasProfitable = (trade.direction === 'UP' && currentPrice > trade.entryPrice) ||
                                (trade.direction === 'DOWN' && currentPrice < trade.entryPrice);

            trade.status = wasProfitable ? 'WIN' : 'LOSS';
            trade.exitPrice = currentPrice;
            trade.profit = wasProfitable ? trade.amount * 0.85 : -trade.amount; // 85% payout

            this.showNotification(
                `Trade ${trade.status}`,
                `${trade.name} ${trade.direction}: $${Math.abs(trade.profit).toFixed(2)} ${wasProfitable ? 'Profit!' : 'Loss'}`
            );
        }

        selectTurboMarket(symbol) {
            document.querySelectorAll('.turbo-card').forEach(card => {
                card.classList.remove('active');
            });
            
            const selectedCard = document.querySelector(`[data-symbol="${symbol}"]`);
            if (selectedCard) {
                selectedCard.classList.add('active');
            }
            
            this.selectedMarket = this.findMarket(symbol);
        }

        findMarket(symbol) {
            return Object.values(this.turboMarkets).flat().find(m => m.symbol === symbol);
        }

        addSignalToDashboard(signalCard) {
            const dashboard = document.getElementById('turboSignals');
            if (!dashboard) return;

            // Remove "waiting" message if it exists
            const waitingMessage = dashboard.querySelector('.text-center');
            if (waitingMessage) {
                waitingMessage.remove();
            }

            // Add new signal at the top
            dashboard.insertBefore(signalCard, dashboard.firstChild);

            // Limit number of displayed signals
            const signals = dashboard.querySelectorAll('.signal-card');
            if (signals.length > this.maxSignalsShown) {
                signals[signals.length - 1].remove();
            }
        }

        showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                modal.setAttribute('aria-hidden', 'false');
            }
        }

        hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                modal.setAttribute('aria-hidden', 'true');
            }
        }

        showNotification(title, message) {
            // Browser notifications
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification(title, { body: message, icon: '/favicon.ico' });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification(title, { body: message, icon: '/favicon.ico' });
                    }
                });
            }

            // Vibration for mobile
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }

            console.log(`Notification: ${title} - ${message}`);
        }

        // Deriv WebSocket methods (commented out for demo)
        connectToDerivWSWithToken(token) {
            console.log('Real trading mode activated with token');
            this.derivApiToken = token;
            this.demoMode = false;
            // this.connectToDerivWS();
        }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
        window.quantumTrader = new QuantumTurboTrader();
        
        // Request notification permission on startup
        if ("Notification" in window && Notification.permission === "default") {
            Notification.requestPermission();
        }
        
        console.log('ðŸš€ Quantum Turbo Trader Ready!');
        console.log('ðŸ’¡ Running in DEMO MODE - Add real trading by calling:');
        console.log('   quantumTrader.connectToDerivWSWithToken("your-token-here")');
    });
    </script>
</body>
</html>
