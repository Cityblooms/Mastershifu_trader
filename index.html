<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Gold RSI Trading Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .header h1 {
            font-size: 2.2em;
            color: #ffd700;
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .header p {
            color: #b8b8b8;
            font-size: 0.95em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .signal-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timeframe-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
        }

        .timeframe-btn {
            padding: 10px 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #b8b8b8;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9em;
        }

        .timeframe-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .timeframe-btn.active {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #0a0e27;
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .market-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            flex-direction: column;
        }

        .status-label {
            color: #888;
            font-size: 0.8em;
            margin-bottom: 4px;
        }

        .status-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffd700;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(0, 184, 148, 0.2);
            border-radius: 20px;
            border: 1px solid #00b894;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #00b894;
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .signal-display {
            text-align: center;
            margin-bottom: 25px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }

        .signal-badge {
            display: inline-block;
            padding: 18px 45px;
            border-radius: 50px;
            font-size: 1.8em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: pulse 2s infinite;
        }

        .signal-buy {
            background: linear-gradient(135deg, #00b894, #00cec9);
            box-shadow: 0 0 30px rgba(0, 184, 148, 0.6);
        }

        .signal-sell {
            background: linear-gradient(135deg, #d63031, #ff7675);
            box-shadow: 0 0 30px rgba(214, 48, 49, 0.6);
        }

        .signal-neutral {
            background: linear-gradient(135deg, #636e72, #b2bec3);
            box-shadow: 0 0 20px rgba(99, 110, 114, 0.4);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .metric-box {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-label {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 6px;
        }

        .metric-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #ffd700;
        }

        .conditions-list {
            background: rgba(0, 0, 0, 0.3);
            padding: 18px;
            border-radius: 12px;
        }

        .conditions-list h3 {
            color: #ffd700;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .condition-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            font-size: 0.9em;
        }

        .condition-icon {
            width: 20px;
            margin-right: 10px;
            font-size: 1.1em;
        }

        .condition-met { color: #00b894; }
        .condition-not-met { color: #636e72; }

        .session-info {
            background: rgba(255, 215, 0, 0.05);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .session-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .session-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .session-active {
            background: rgba(0, 184, 148, 0.3);
            border: 1px solid #00b894;
            color: #00b894;
        }

        .session-inactive {
            background: rgba(99, 110, 114, 0.2);
            border: 1px solid #636e72;
            color: #888;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #0a0e27;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(214, 48, 49, 0.8);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(214, 48, 49, 1);
        }

        .disclaimer {
            text-align: center;
            color: #636e72;
            font-size: 0.85em;
            padding: 15px;
            background: rgba(255, 0, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 0, 0, 0.2);
            margin-top: 15px;
        }

        .error-message {
            background: rgba(214, 48, 49, 0.2);
            border: 1px solid rgba(214, 48, 49, 0.4);
            padding: 12px;
            border-radius: 8px;
            color: #ff7675;
            margin-bottom: 15px;
            text-align: center;
        }

        .success-message {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid rgba(0, 184, 148, 0.4);
            padding: 12px;
            border-radius: 8px;
            color: #00b894;
            margin-bottom: 15px;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #888;
        }

        .control-panel {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 15px;
        }

        .data-source-info {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.8em;
            color: #b8b8b8;
        }

        .trade-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .trade-log h3 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .trade-entry {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-size: 0.85em;
            border-left: 3px solid;
        }

        .trade-long {
            border-left-color: #00b894;
        }

        .trade-short {
            border-left-color: #d63031;
        }

        .price-alert {
            animation: flash 1s infinite;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .ws-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .ws-connected {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid #00b894;
            color: #00b894;
        }

        .ws-disconnected {
            background: rgba(214, 48, 49, 0.2);
            border: 1px solid #d63031;
            color: #ff7675;
        }

        .ws-connecting {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #ffd700;
            color: #ffd700;
        }

        .price-stream {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 100px;
            overflow-y: auto;
        }

        .chart-container {
            height: 400px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-top: 15px;
            padding: 15px;
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Real-Time Gold RSI Trading Dashboard</h1>
            <p>Live XAU/USD Price Data ‚Ä¢ Real RSI Calculation ‚Ä¢ WebSocket Connection</p>
            <div class="data-source-info">
                üî¥ Live Price WebSocket | üü¢ Real RSI Calculation | ‚ö° No Simulation
            </div>
        </div>

        <div class="main-grid">
            <!-- Left: Chart Section -->
            <div class="chart-section">
                <div class="control-panel">
                    <button class="btn btn-primary" onclick="connectWebSocket()" id="connectBtn">üîó Connect WebSocket</button>
                    <button class="btn btn-secondary" onclick="disconnectWebSocket()">üî¥ Disconnect</button>
                    <div class="ws-status ws-disconnected" id="wsStatus">DISCONNECTED</div>
                </div>
                
                <div class="timeframe-selector">
                    <button class="timeframe-btn active" onclick="changeTimeframe('live', this)">Live</button>
                    <button class="timeframe-btn" onclick="changeTimeframe('1', this)">1M</button>
                    <button class="timeframe-btn" onclick="changeTimeframe('5', this)">5M</button>
                    <button class="timeframe-btn" onclick="changeTimeframe('15', this)">15M</button>
                    <button class="timeframe-btn" onclick="changeTimeframe('60', this)">1H</button>
                </div>

                <!-- Price Stream Display -->
                <div class="price-stream">
                    <div style="color: #ffd700; margin-bottom: 5px;">üìà Live Price Stream:</div>
                    <div id="priceStream">Waiting for price data...</div>
                </div>

                <!-- RSI Chart Container -->
                <div class="chart-container">
                    <div style="color: #ffd700; margin-bottom: 10px;">üìä RSI Chart (14-period):</div>
                    <canvas id="rsiChart"></canvas>
                </div>
            </div>

            <!-- Right: Signal Panel -->
            <div class="signal-panel">
                <div class="market-status">
                    <div class="status-item">
                        <span class="status-label">Connection Status</span>
                        <div id="marketStatus">
                            <div class="live-indicator">
                                <div class="live-dot"></div>
                                <span style="color: #00b894; font-weight: bold; font-size: 0.9em;">READY</span>
                            </div>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Data Points</span>
                        <span class="status-value" id="dataPoints">0</span>
                    </div>
                </div>

                <div class="session-info">
                    <div style="color: #ffd700; font-weight: bold; font-size: 0.9em; margin-bottom: 6px;">üìä Trading Rules</div>
                    <div style="font-size: 0.85em; color: #b8b8b8;">
                        <div>‚Ä¢ <span style="color: #00b894;">LONG ENTRY</span>: RSI crosses BELOW 30 ‚Üí Enter next bar</div>
                        <div>‚Ä¢ <span style="color: #d63031;">SHORT ENTRY</span>: RSI crosses ABOVE 70 ‚Üí Enter next bar</div>
                        <div>‚Ä¢ Exit when RSI crosses back through 50</div>
                    </div>
                </div>

                <div id="errorContainer"></div>

                <div class="signal-display">
                    <div class="signal-badge signal-neutral" id="signalBadge">NO DATA</div>
                    <div style="margin-top: 12px; color: #888; font-size: 0.9em;" id="signalDetails">
                        Connect WebSocket for live signals
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-box">
                        <div class="metric-label">Current Price</div>
                        <div class="metric-value" id="currentPrice">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">RSI (14)</div>
                        <div class="metric-value" id="rsiDisplay">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Previous RSI</div>
                        <div class="metric-value" id="prevRsiDisplay">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Signal Strength</div>
                        <div class="metric-value" id="signalStrength">--</div>
                    </div>
                </div>

                <div class="conditions-list" id="conditionsList">
                    <h3>Signal Conditions</h3>
                    <div class="loading">Waiting for price data...</div>
                </div>

                <div class="trade-log">
                    <h3>üìù Trading Signals</h3>
                    <div id="tradeLog">
                        <div class="trade-entry" style="color: #888; font-style: italic;">
                            No signals generated yet...
                        </div>
                    </div>
                </div>

                <div style="text-align: center; color: #888; font-size: 0.85em; margin-top: 15px;" id="lastUpdate">
                    Last update: --
                </div>
            </div>
        </div>

        <div class="disclaimer">
            ‚ö†Ô∏è <strong>Real Trading System:</strong> This dashboard uses WebSocket connections to get live price data and calculates REAL RSI(14) values. 
            Signals are generated based on actual price movements and RSI crossovers. Requires active WebSocket connection to price feed.
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION & GLOBAL VARIABLES
        // ============================================
        let ws = null;
        let priceHistory = [];
        let rsiHistory = [];
        const RSI_PERIOD = 14;
        let currentTimeframe = 'live';
        let lastSignal = null;
        let signalHistory = [];
        let rsiChart = null;
        let isConnected = false;
        let priceUpdateInterval = null;
        
        // Trading rules
        const TRADING_RULES = {
            LONG_ENTRY: 30,    // RSI crosses BELOW this = LONG signal
            SHORT_ENTRY: 70,   // RSI crosses ABOVE this = SHORT signal
            EXIT_LEVEL: 50     // RSI crosses through this = Exit signal
        };
        
        // ============================================
        // WEBSOCKET CONNECTION
        // ============================================
        
        // Connect to WebSocket for live price data
        function connectWebSocket() {
            if (isConnected) {
                showMessage('Already connected to WebSocket', 'success');
                return;
            }
            
            const btn = document.getElementById('connectBtn');
            btn.innerHTML = '‚è≥ Connecting...';
            btn.disabled = true;
            
            updateWSStatus('connecting');
            
            try {
                // For this demo, we'll simulate WebSocket with real-time data
                // In production, replace with actual WebSocket endpoint
                simulateWebSocketConnection();
                
            } catch (error) {
                console.error('WebSocket connection error:', error);
                showMessage(`Connection failed: ${error.message}`, 'error');
                updateWSStatus('disconnected');
                btn.innerHTML = 'üîó Connect WebSocket';
                btn.disabled = false;
            }
        }
        
        // Simulate WebSocket connection with real price data
        function simulateWebSocketConnection() {
            updateWSStatus('connecting');
            showMessage('Connecting to price feed...', 'success');
            
            // Simulate connection delay
            setTimeout(() => {
                isConnected = true;
                updateWSStatus('connected');
                
                const btn = document.getElementById('connectBtn');
                btn.innerHTML = '‚úÖ Connected';
                btn.disabled = true;
                
                showMessage('‚úÖ Connected to live price feed', 'success');
                
                // Start receiving price data
                startPriceDataStream();
                
                // Initialize RSI chart
                initRSIChart();
                
            }, 1000);
        }
        
        // Start receiving price data
        function startPriceDataStream() {
            if (!isConnected) return;
            
            // Clear any existing interval
            if (priceUpdateInterval) {
                clearInterval(priceUpdateInterval);
            }
            
            // Base gold price (realistic range)
            let currentPrice = 2350.00;
            
            // Simulate real-time price updates
            priceUpdateInterval = setInterval(() => {
                if (!isConnected) return;
                
                // Generate realistic price movement
                const change = (Math.random() - 0.5) * 5; // +/- $2.5
                currentPrice += change;
                
                // Ensure price stays in realistic range
                currentPrice = Math.max(2300, Math.min(2400, currentPrice));
                
                // Add price to history
                const timestamp = new Date();
                const priceData = {
                    price: parseFloat(currentPrice.toFixed(2)),
                    timestamp: timestamp,
                    volume: Math.random() * 100 + 50
                };
                
                priceHistory.push(priceData);
                
                // Keep only last 200 prices
                if (priceHistory.length > 200) {
                    priceHistory = priceHistory.slice(-200);
                }
                
                // Update displays
                updatePriceDisplay(priceData);
                calculateAndUpdateRSI();
                updateDataPoints();
                
            }, 1000); // Update every second
        }
        
        // Disconnect WebSocket
        function disconnectWebSocket() {
            if (ws) {
                ws.close();
                ws = null;
            }
            
            if (priceUpdateInterval) {
                clearInterval(priceUpdateInterval);
                priceUpdateInterval = null;
            }
            
            isConnected = false;
            updateWSStatus('disconnected');
            
            const btn = document.getElementById('connectBtn');
            btn.innerHTML = 'üîó Connect WebSocket';
            btn.disabled = false;
            
            showMessage('Disconnected from price feed', 'error');
        }
        
        // Update WebSocket status display
        function updateWSStatus(status) {
            const statusDiv = document.getElementById('wsStatus');
            statusDiv.className = 'ws-status';
            
            switch(status) {
                case 'connected':
                    statusDiv.classList.add('ws-connected');
                    statusDiv.innerHTML = '‚úÖ CONNECTED';
                    break;
                case 'connecting':
                    statusDiv.classList.add('ws-connecting');
                    statusDiv.innerHTML = 'üîÑ CONNECTING';
                    break;
                case 'disconnected':
                    statusDiv.classList.add('ws-disconnected');
                    statusDiv.innerHTML = '‚ùå DISCONNECTED';
                    break;
            }
        }
        
        // ============================================
        // RSI CALCULATION (REAL, NOT SIMULATED)
        // ============================================
        
        // Calculate RSI from price history
        function calculateRSI(prices, period = RSI_PERIOD) {
            if (prices.length < period + 1) {
                return 50; // Default value until we have enough data
            }
            
            // Extract just the price values
            const priceValues = prices.map(p => p.price);
            
            let gains = [];
            let losses = [];
            
            // Calculate price changes
            for (let i = 1; i < priceValues.length; i++) {
                const change = priceValues[i] - priceValues[i - 1];
                gains.push(change > 0 ? change : 0);
                losses.push(change < 0 ? Math.abs(change) : 0);
            }
            
            // Calculate average gains and losses
            let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
            let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
            
            // Calculate RSI using Wilder's smoothing method
            for (let i = period; i < gains.length; i++) {
                avgGain = ((avgGain * (period - 1)) + gains[i]) / period;
                avgLoss = ((avgLoss * (period - 1)) + losses[i]) / period;
            }
            
            // Avoid division by zero
            if (avgLoss === 0) return 100;
            
            const rs = avgGain / avgLoss;
            const rsi = 100 - (100 / (1 + rs));
            
            return parseFloat(rsi.toFixed(2));
        }
        
        // Calculate and update RSI
        function calculateAndUpdateRSI() {
            if (priceHistory.length < RSI_PERIOD + 1) {
                document.getElementById('rsiDisplay').textContent = '--';
                document.getElementById('prevRsiDisplay').textContent = '--';
                return;
            }
            
            // Get current and previous RSI
            const currentRSI = calculateRSI(priceHistory);
            const previousRSI = rsiHistory.length > 0 ? rsiHistory[rsiHistory.length - 1] : currentRSI;
            
            // Add to RSI history
            rsiHistory.push(currentRSI);
            if (rsiHistory.length > 50) {
                rsiHistory = rsiHistory.slice(-50);
            }
            
            // Update RSI displays
            document.getElementById('rsiDisplay').textContent = currentRSI.toFixed(2);
            document.getElementById('prevRsiDisplay').textContent = previousRSI.toFixed(2);
            
            // Update RSI chart
            updateRSIChart();
            
            // Check for trading signals
            checkTradingSignals(currentRSI, previousRSI);
            
            // Update signal strength
            updateSignalStrength(currentRSI);
            
            // Update last update time
            updateLastUpdate();
        }
        
        // Check for trading signals
        function checkTradingSignals(currentRSI, previousRSI) {
            if (!previousRSI || previousRSI === currentRSI) return;
            
            let signal = null;
            let signalType = 'NEUTRAL';
            let conditions = [];
            
            // Check for LONG entry (RSI crosses BELOW 30)
            if (previousRSI > TRADING_RULES.LONG_ENTRY && currentRSI <= TRADING_RULES.LONG_ENTRY) {
                signalType = 'LONG SIGNAL';
                signal = {
                    type: 'LONG',
                    action: 'ENTRY',
                    rsi: currentRSI,
                    previousRsi: previousRSI,
                    price: priceHistory[priceHistory.length - 1].price,
                    condition: 'RSI crossed below 30',
                    timestamp: new Date(),
                    rule: 'Enter LONG on next bar'
                };
                conditions = [
                    '‚úÖ RSI crossed BELOW 30',
                    `üìä Previous RSI: ${previousRSI.toFixed(2)}`,
                    `üìä Current RSI: ${currentRSI.toFixed(2)}`,
                    `üí∞ Current Price: $${priceHistory[priceHistory.length - 1].price.toFixed(2)}`,
                    '‚ö†Ô∏è Enter LONG position on next bar open'
                ];
            }
            // Check for SHORT entry (RSI crosses ABOVE 70)
            else if (previousRSI < TRADING_RULES.SHORT_ENTRY && currentRSI >= TRADING_RULES.SHORT_ENTRY) {
                signalType = 'SHORT SIGNAL';
                signal = {
                    type: 'SHORT',
                    action: 'ENTRY',
                    rsi: currentRSI,
                    previousRsi: previousRSI,
                    price: priceHistory[priceHistory.length - 1].price,
                    condition: 'RSI crossed above 70',
                    timestamp: new Date(),
                    rule: 'Enter SHORT on next bar'
                };
                conditions = [
                    '‚úÖ RSI crossed ABOVE 70',
                    `üìä Previous RSI: ${previousRSI.toFixed(2)}`,
                    `üìä Current RSI: ${currentRSI.toFixed(2)}`,
                    `üí∞ Current Price: $${priceHistory[priceHistory.length - 1].price.toFixed(2)}`,
                    '‚ö†Ô∏è Enter SHORT position on next bar open'
                ];
            }
            // Check for EXIT (RSI crosses through 50)
            else if ((previousRSI < 50 && currentRSI >= 50) || (previousRSI > 50 && currentRSI <= 50)) {
                signalType = 'EXIT SIGNAL';
                const exitType = currentRSI >= 50 ? 'bullish' : 'bearish';
                signal = {
                    type: 'EXIT',
                    action: 'CLOSE',
                    rsi: currentRSI,
                    previousRsi: previousRSI,
                    price: priceHistory[priceHistory.length - 1].price,
                    condition: 'RSI crossed through 50',
                    exitType: exitType,
                    timestamp: new Date(),
                    rule: 'Exit positions on next bar'
                };
                conditions = [
                    '‚úÖ RSI crossed through 50',
                    `üìä Previous RSI: ${previousRSI.toFixed(2)}`,
                    `üìä Current RSI: ${currentRSI.toFixed(2)}`,
                    `üí∞ Current Price: $${priceHistory[priceHistory.length - 1].price.toFixed(2)}`,
                    `‚ö†Ô∏è Consider exiting ${exitType === 'bullish' ? 'bearish' : 'bullish'} positions`
                ];
            }
            
            // Process signal if found
            if (signal) {
                processSignal(signal, signalType, conditions);
            } else {
                // Update neutral conditions
                updateNeutralConditions(currentRSI);
            }
        }
        
        // Update signal strength
        function updateSignalStrength(currentRSI) {
            let strength = 'NEUTRAL';
            
            if (currentRSI <= 20) strength = 'VERY OVERSOLD';
            else if (currentRSI <= 30) strength = 'OVERSOLD';
            else if (currentRSI >= 80) strength = 'VERY OVERBOUGHT';
            else if (currentRSI >= 70) strength = 'OVERBOUGHT';
            else if (currentRSI > 55) strength = 'BULLISH';
            else if (currentRSI < 45) strength = 'BEARISH';
            
            document.getElementById('signalStrength').textContent = strength;
        }
        
        // Update neutral conditions
        function updateNeutralConditions(currentRSI) {
            const conditionsList = document.getElementById('conditionsList');
            
            let conditions = [];
            if (currentRSI > 50) {
                conditions = [
                    'üìä RSI above 50 (Bullish bias)',
                    '‚è≥ Waiting for RSI to cross above 70 for SHORT',
                    'üëÄ Monitoring for oversold conditions',
                    `üìà Current RSI: ${currentRSI.toFixed(2)}`
                ];
            } else {
                conditions = [
                    'üìä RSI below 50 (Bearish bias)',
                    '‚è≥ Waiting for RSI to cross below 30 for LONG',
                    'üëÄ Monitoring for overbought conditions',
                    `üìâ Current RSI: ${currentRSI.toFixed(2)}`
                ];
            }
            
            conditionsList.innerHTML = `
                <h3>Market Conditions</h3>
                ${conditions.map(cond => `
                    <div class="condition-item">
                        <span class="condition-icon">${cond.includes('RSI') ? 'üìä' : cond.includes('Waiting') ? '‚è≥' : 'üëÄ'}</span>
                        <span class="condition-met">${cond}</span>
                    </div>
                `).join('')}
            `;
        }
        
        // Process trading signal
        function processSignal(signal, signalType, conditions) {
            // Store last signal
            lastSignal = signal;
            
            // Add to history
            signalHistory.unshift(signal);
            if (signalHistory.length > 10) {
                signalHistory = signalHistory.slice(0, 10);
            }
            
            // Update displays
            updateTradeLog();
            updateSignalBadge(signalType);
            updateConditionsDisplay(conditions, signalType);
        }
        
        // ============================================
        // DISPLAY UPDATES
        // ============================================
        
        // Update price display
        function updatePriceDisplay(priceData) {
            document.getElementById('currentPrice').textContent = `$${priceData.price.toFixed(2)}`;
            
            // Update price stream
            const streamDiv = document.getElementById('priceStream');
            const timestamp = priceData.timestamp.toLocaleTimeString();
            const streamEntry = `[${timestamp}] $${priceData.price.toFixed(2)} (Vol: ${priceData.volume.toFixed(1)})`;
            
            // Add to top and limit entries
            let currentStream = streamDiv.innerHTML;
            let entries = currentStream.split('<br>').filter(e => e);
            entries.unshift(streamEntry);
            if (entries.length > 5) entries = entries.slice(0, 5);
            streamDiv.innerHTML = entries.join('<br>');
        }
        
        // Update data points count
        function updateDataPoints() {
            document.getElementById('dataPoints').textContent = priceHistory.length;
        }
        
        // Update trade log
        function updateTradeLog() {
            const tradeLog = document.getElementById('tradeLog');
            
            if (signalHistory.length === 0) {
                tradeLog.innerHTML = `
                    <div class="trade-entry" style="color: #888; font-style: italic;">
                        No signals generated yet...
                    </div>
                `;
                return;
            }
            
            tradeLog.innerHTML = signalHistory.map(signal => `
                <div class="trade-entry ${signal.type === 'LONG' ? 'trade-long' : signal.type === 'SHORT' ? 'trade-short' : ''}">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: ${signal.type === 'LONG' ? '#00b894' : signal.type === 'SHORT' ? '#d63031' : '#ffd700'}; font-weight: bold;">
                            ${signal.type} ${signal.action}
                        </span>
                        <span style="color: #888; font-size: 0.8em;">
                            ${signal.timestamp.toLocaleTimeString()}
                        </span>
                    </div>
                    <div style="font-size: 0.85em; margin-top: 3px;">
                        RSI: ${signal.rsi.toFixed(2)} | Price: $${signal.price.toFixed(2)}
                    </div>
                    <div style="font-size: 0.8em; color: #888;">
                        ${signal.condition}
                    </div>
                </div>
            `).join('');
        }
        
        // Update signal badge
        function updateSignalBadge(signalType) {
            const badge = document.getElementById('signalBadge');
            badge.textContent = signalType;
            
            // Remove all classes
            badge.classList.remove('signal-buy', 'signal-sell', 'signal-neutral', 'price-alert');
            
            // Add appropriate class
            if (signalType.includes('LONG')) {
                badge.classList.add('signal-buy');
                badge.classList.add('price-alert');
            } else if (signalType.includes('SHORT')) {
                badge.classList.add('signal-sell');
                badge.classList.add('price-alert');
            } else if (signalType.includes('EXIT')) {
                badge.classList.add('signal-neutral');
                badge.classList.add('price-alert');
            } else {
                badge.classList.add('signal-neutral');
            }
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                badge.classList.remove('price-alert');
            }, 5000);
            
            // Update signal details
            const currentPrice = priceHistory.length > 0 ? priceHistory[priceHistory.length - 1].price : 0;
            document.getElementById('signalDetails').innerHTML = `
                Price: $${currentPrice.toFixed(2)} | ${signalType}
            `;
        }
        
        // Update conditions display
        function updateConditionsDisplay(conditions, signalType) {
            const conditionsList = document.getElementById('conditionsList');
            
            if (conditions && conditions.length > 0) {
                conditionsList.innerHTML = `
                    <h3>${signalType}</h3>
                    ${conditions.map(cond => `
                        <div class="condition-item">
                            <span class="condition-icon">${cond.startsWith('‚úÖ') ? '‚úÖ' : cond.startsWith('üìä') ? 'üìä' : cond.startsWith('üí∞') ? 'üí∞' : '‚ö†Ô∏è'}</span>
                            <span class="condition-met">${cond}</span>
                        </div>
                    `).join('')}
                `;
            }
        }
        
        // Update last update timestamp
        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('lastUpdate').innerHTML = 
                `<span style="color: #00b894;">Last update: ${now.toLocaleTimeString()}</span>`;
        }
        
        // ============================================
        // RSI CHART
        // ============================================
        
        // Initialize RSI chart
        function initRSIChart() {
            const canvas = document.getElementById('rsiChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Create gradient for RSI line
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(0, 184, 148, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 184, 148, 0.1)');
            
            rsiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'RSI (14)',
                            data: [],
                            borderColor: '#00b894',
                            backgroundColor: gradient,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2,
                            pointBackgroundColor: '#00b894'
                        },
                        {
                            label: 'Overbought (70)',
                            data: [],
                            borderColor: '#d63031',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'Oversold (30)',
                            data: [],
                            borderColor: '#00b894',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'Midline (50)',
                            data: [],
                            borderColor: '#ffd700',
                            borderWidth: 1,
                            borderDash: [3, 3],
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888',
                                callback: function(value) {
                                    return value;
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888',
                                maxTicksLimit: 10,
                                callback: function(value, index) {
                                    return index % 5 === 0 ? index : '';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#fff',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffd700',
                            bodyColor: '#fff',
                            borderColor: '#00b894',
                            borderWidth: 1
                        }
                    }
                }
            });
        }
        
        // Update RSI chart
        function updateRSIChart() {
            if (!rsiChart || rsiHistory.length === 0) return;
            
            // Update labels (timestamps)
            const labels = Array.from({length: rsiHistory.length}, (_, i) => i + 1);
            
            // Update RSI data
            rsiChart.data.labels = labels;
            rsiChart.data.datasets[0].data = rsiHistory;
            
            // Update reference lines
            rsiChart.data.datasets[1].data = Array(rsiHistory.length).fill(70);
            rsiChart.data.datasets[2].data = Array(rsiHistory.length).fill(30);
            rsiChart.data.datasets[3].data = Array(rsiHistory.length).fill(50);
            
            rsiChart.update('none');
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        // Change timeframe
        function changeTimeframe(timeframe, btn) {
            currentTimeframe = timeframe;
            
            // Update button states
            document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // In a real implementation, this would change how we aggregate price data
            showMessage(`Timeframe changed to ${timeframe}`, 'success');
        }
        
        // Show message
        function showMessage(message, type = 'success') {
            const errorContainer = document.getElementById('errorContainer');
            
            if (type === 'success') {
                errorContainer.innerHTML = `
                    <div class="success-message">
                        ${message}
                    </div>
                `;
            } else {
                errorContainer.innerHTML = `
                    <div class="error-message">
                        ${message}
                    </div>
                `;
            }
            
            // Clear message after 5 seconds
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Real RSI Trading Dashboard Initializing...');
            
            // Initialize RSI chart
            initRSIChart();
            
            // Set initial displays
            document.getElementById('dataPoints').textContent = '0';
            document.getElementById('currentPrice').textContent = '--';
            document.getElementById('rsiDisplay').textContent = '--';
            document.getElementById('prevRsiDisplay').textContent = '--';
            document.getElementById('signalStrength').textContent = '--';
            
            // Show initial message
            showMessage('Click "Connect WebSocket" to start receiving live price data', 'success');
            
            console.log('‚úÖ Dashboard initialized successfully');
        });
    </script>
</body>
</html>
