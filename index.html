<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Somto trading ai dashboard</title>
<style>
  :root{
    --bg:#06070a; --card:#0f1720; --muted:#9aa4ad; --accent:#10b981; --danger:#ef4444;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:#e6eef6;}
  .wrap{max-width:1060px;margin:28px auto;padding:18px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
  h1{font-size:18px;margin:0;font-weight:600;color:#dff7ee}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:var(--card);border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;color:var(--muted);font-size:13px;cursor:pointer}
  .btn.primary{color:#fff;border-color:rgba(16,185,129,0.12)}
  .status{font-size:13px;color:var(--muted);margin-left:6px}

  #grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:14px}
  .card{background:var(--card);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 6px 18px rgba(2,6,23,0.6)}
  .row{display:flex;justify-content:space-between;align-items:center}
  .symbol{font-weight:700;font-size:15px}
  .badge{font-size:12px;padding:6px 8px;border-radius:8px;font-weight:700}
  .buy{background:linear-gradient(90deg,#062e24,#083926);color:var(--accent);border:1px solid rgba(16,185,129,0.06)}
  .sell{background:linear-gradient(90deg,#2b0610,#3b0713);color:#ffd6d6;border:1px solid rgba(239,68,68,0.06)}
  .meta{font-size:13px;color:var(--muted);margin-top:8px}
  .confidence{font-weight:700;color:#e6eef6;margin-top:8px}
  .small{font-size:12px;color:var(--muted);margin-top:8px}
  .reason{font-size:13px;color:var(--muted);margin-top:8px;display:none}
  .reason.open{display:block;color:#cfeee0}
  footer{margin-top:18px;font-size:12px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
  .chip{font-size:12px;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted)}
  .compact{font-size:12px;color:var(--muted)}
  
  /* Enhanced CSS - Signal Strength Bars */
  .strength-bar {
    height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin: 8px 0; overflow: hidden;
  }
  .strength-fill {
    height: 100%; border-radius: 2px; transition: width 0.3s ease;
  }
  .strength-high { background: linear-gradient(90deg, #10b981, #22c55e); }
  .strength-medium { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
  .strength-low { background: linear-gradient(90deg, #ef4444, #dc2626); }
  
  /* Loading animation */
  .loading-dots:after {
    content: '...';
    animation: dots 1.5s steps(4, end) infinite;
  }
  @keyframes dots {
    0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
    40% { color: var(--muted); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
    60% { text-shadow: .25em 0 0 var(--muted), .5em 0 0 rgba(0,0,0,0); }
    80%, 100% { text-shadow: .25em 0 0 var(--muted), .5em 0 0 var(--muted); }
  }
  
  /* Enhanced card layout */
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }
  .ai-badge {
    font-size: 10px;
    padding: 3px 6px;
    border-radius: 4px;
    background: rgba(16,185,129,0.1);
    color: var(--accent);
    border: 1px solid rgba(16,185,129,0.2);
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Somto trading ai dashboard</h1>
        <div class="status" id="statusLine">Ready</div>
      </div>

      <div class="controls">
        <button id="alertsToggle" class="btn primary">Alerts: On</button>
        <button id="refreshBtn" class="btn">Refresh</button>
        <div class="chip" id="lastUpdated">—</div>
      </div>
    </header>

    <main>
      <div id="grid" aria-live="polite" ></div>
    </main>

    <footer>
      <div class="compact">Auto-update every 20 s · Dual AI confirmation (simulated)</div>
      <div class="compact">© Somto</div>
    </footer>
  </div>

<script>
/* Somto trading ai dashboard — Enhanced version
   - Sophisticated AI validation with better scoring
   - Signal strength visual indicators
   - Enhanced loading states
   - Improved UI with AI badges
*/

// Config
const AUTO_INTERVAL = 20000;
const CACHE_KEY = 'somto_ai_signals_v2';
const MAX_CACHE = 12;
let alertsOn = true;
let shownKeys = new Set();

// DOM
const alertsToggle = document.getElementById('alertsToggle');
const refreshBtn = document.getElementById('refreshBtn');
const grid = document.getElementById('grid');
const statusLine = document.getElementById('statusLine');
const lastUpdatedEl = document.getElementById('lastUpdated');

// WebAudio beep (short strong beep) — no external files
let audioCtx = null;
function initAudio() {
  if (audioCtx) return;
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  } catch (e) {
    audioCtx = null;
    console.warn('AudioContext not available:', e);
  }
}
function playBeep(){
  if (!alertsOn) return;
  if (!audioCtx) initAudio();
  if (!audioCtx) return;
  // single short beep: 1kHz 160ms with quick envelope
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sine';
  o.frequency.value = 1000;
  g.gain.value = 0;
  o.connect(g);
  g.connect(audioCtx.destination);
  const now = audioCtx.currentTime;
  g.gain.cancelScheduledValues(now);
  g.gain.setValueAtTime(0, now);
  g.gain.linearRampToValueAtTime(0.9, now + 0.01);
  g.gain.linearRampToValueAtTime(0.0, now + 0.16);
  o.start(now);
  o.stop(now + 0.18);
}

// Controls
alertsToggle.addEventListener('click', () => {
  alertsOn = !alertsOn;
  alertsToggle.textContent = alertsOn ? 'Alerts: On' : 'Alerts: Off';
  // Try to resume audio context on user action (many browsers require user gesture)
  if (audioCtx && audioCtx.state === 'suspended') {
    audioCtx.resume().catch(()=>{});
  } else {
    initAudio();
  }
});
refreshBtn.addEventListener('click', () => {
  // resume audio context by user interaction if needed
  initAudio();
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
  cycleOnce();
});

// Enhanced engine with more realistic data
const engine = {
  symbols: ['EURUSD','GBPUSD','USDJPY','AUDUSD','BTCUSD','ETHUSD','XAUUSD'],
  async createSignal(sym){
    const direction = Math.random() > 0.5 ? 'BUY' : 'SELL';
    const now = new Date();
    
    // More realistic price ranges based on symbol type
    let price, entry, stopLoss, takeProfit;
    if (sym.includes('BTC') || sym.includes('ETH')) {
      // Crypto prices
      price = (30000 + Math.random() * 20000).toFixed(2);
      entry = (parseFloat(price) * (1 + (Math.random() * 0.02 - 0.01))).toFixed(2);
      stopLoss = (parseFloat(entry) * (1 - (0.02 + Math.random() * 0.03))).toFixed(2);
      takeProfit = (parseFloat(entry) * (1 + (0.03 + Math.random() * 0.04))).toFixed(2);
    } else if (sym.includes('XAU')) {
      // Gold prices
      price = (1800 + Math.random() * 200).toFixed(2);
      entry = (parseFloat(price) * (1 + (Math.random() * 0.008 - 0.004))).toFixed(2);
      stopLoss = (parseFloat(entry) * (1 - (0.008 + Math.random() * 0.006))).toFixed(2);
      takeProfit = (parseFloat(entry) * (1 + (0.012 + Math.random() * 0.008))).toFixed(2);
    } else {
      // Forex prices
      price = (0.9 + Math.random() * 0.3).toFixed(5);
      entry = (parseFloat(price) * (1 + (Math.random() * 0.004 - 0.002))).toFixed(5);
      stopLoss = (parseFloat(entry) * (1 - (0.004 + Math.random() * 0.003))).toFixed(5);
      takeProfit = (parseFloat(entry) * (1 + (0.006 + Math.random() * 0.004))).toFixed(5);
    }
    
    return {
      symbol: sym,
      direction,
      rsi: +(20 + Math.random()*60).toFixed(1),
      volume: +(100 + Math.random()*900).toFixed(0),
      signalStrength: +(70 + Math.random()*28).toFixed(1),
      indicatorAlignment: Math.floor(2 + Math.random()*3),
      marketStructure: Math.random()>0.5?'BULLISH':'BEARISH',
      rr: '1:' + (1.5 + Math.random()*2).toFixed(2),
      currentPrice: price,
      entry: entry,
      stopLoss: stopLoss,
      takeProfit: takeProfit,
      timestamp: now.toLocaleTimeString()
    };
  }
};

// Enhanced ChatGPT validator with sophisticated scoring
async function validateWithChatGPT(s){
  await new Promise(r => setTimeout(r, 260 + Math.random()*380));
  
  let score = 65; // base score
  
  // RSI scoring - more sophisticated
  if ((s.direction === 'BUY' && s.rsi < 30) || (s.direction === 'SELL' && s.rsi > 70)) {
    score += 18; // Strong RSI signal
  } else if ((s.direction === 'BUY' && s.rsi < 35) || (s.direction === 'SELL' && s.rsi > 65)) {
    score += 12; // Moderate RSI signal
  } else if ((s.direction === 'BUY' && s.rsi < 45) || (s.direction === 'SELL' && s.rsi > 55)) {
    score += 6; // Weak RSI signal
  }
  
  // Volume scoring - tiered approach
  if (s.volume > 800) score += 12;
  else if (s.volume > 600) score += 8;
  else if (s.volume > 400) score += 4;
  
  // Signal strength scoring
  score += (s.signalStrength - 70) * 0.25;
  
  // Alignment scoring - exponential
  score += Math.pow(s.indicatorAlignment - 2, 2) * 3;
  
  // Market structure bonus
  if ((s.direction === 'BUY' && s.marketStructure === 'BULLISH') || 
      (s.direction === 'SELL' && s.marketStructure === 'BEARISH')) {
    score += 8;
  }
  
  const valid = score >= 78; // Slightly higher threshold for better quality
  const reason = valid ? 
    `RSI ${s.rsi} with ${s.volume} volume and ${s.indicatorAlignment}/4 indicator alignment confirms ${s.direction.toLowerCase()} setup` :
    `Insufficient technical convergence (RSI: ${s.rsi}, Volume: ${s.volume}, Alignment: ${s.indicatorAlignment}/4)`;
    
  return { model: 'ChatGPT', valid, score: Math.min(97, Math.round(score)), reason };
}

// Enhanced DeepSeek validator with institutional focus
async function validateWithDeepSeek(s){
  await new Promise(r => setTimeout(r, 220 + Math.random()*360));
  
  let score = 60; // base score
  
  // Institutional flow analysis
  if (s.volume > 750) score += 15; // High volume = institutional interest
  else if (s.volume > 500) score += 10;
  else if (s.volume > 300) score += 5;
  
  // Signal quality assessment
  score += (s.signalStrength - 70) * 0.3;
  
  // Multi-timeframe alignment
  score += (s.indicatorAlignment - 2) * 7;
  
  // Risk-adjusted scoring
  const rrRatio = parseFloat(s.rr.split(':')[1]);
  if (rrRatio > 2.5) score += 8;
  else if (rrRatio > 2.0) score += 5;
  else if (rrRatio > 1.5) score += 2;
  
  // Market structure premium
  if ((s.direction === 'BUY' && s.marketStructure === 'BULLISH') || 
      (s.direction === 'SELL' && s.marketStructure === 'BEARISH')) {
    score += 10;
  }
  
  const valid = score >= 75;
  const reason = valid ? 
    `Institutional flow detected (${s.volume} volume) with ${rrRatio}:1 risk-reward and ${s.indicatorAlignment}/4 timeframe alignment` :
    `Weak institutional probability (Volume: ${s.volume}, RR: ${rrRatio}:1, Alignment: ${s.indicatorAlignment}/4)`;
  
  return { model: 'DeepSeek', valid, score: Math.min(96, Math.round(score)), reason };
}

// Dual validation
async function dualValidate(s){
  statusLine.textContent = `AI Analysis: Validating ${s.symbol} with dual AI systems`;
  const [g, d] = await Promise.all([validateWithChatGPT(s), validateWithDeepSeek(s)]);
  const approved = g.valid && d.valid;
  const avg = Math.round((g.score + d.score) / 2);
  return { approved, avgScore: avg, chatGPT: g, deepSeek: d };
}

// Enhanced Card creation with strength bars and AI badges
function makeCard(obj){
  const key = `${obj.symbol}_${obj.timestamp}`;
  const card = document.createElement('div');
  card.className = 'card';
  
  // Card header with AI badge
  const cardHeader = document.createElement('div');
  cardHeader.className = 'card-header';
  
  const left = document.createElement('div'); 
  left.className = 'symbol'; 
  left.textContent = obj.symbol;
  
  const right = document.createElement('div');
  right.innerHTML = `
    <span class="ai-badge">AI VERIFIED</span>
    <span class="badge ${obj.direction==='BUY'?'buy':'sell'}" style="margin-left: 6px;">${obj.direction}</span>
  `;
  
  cardHeader.appendChild(left);
  cardHeader.appendChild(right);
  
  // Signal strength bar
  const strengthBar = document.createElement('div');
  strengthBar.className = 'strength-bar';
  const strengthFill = document.createElement('div');
  strengthFill.className = 'strength-fill';
  
  // Determine strength class and width
  let strengthClass = 'strength-medium';
  let strengthWidth = obj.signalStrength;
  
  if (obj.signalStrength >= 85) {
    strengthClass = 'strength-high';
  } else if (obj.signalStrength < 75) {
    strengthClass = 'strength-low';
  }
  
  strengthFill.className = `strength-fill ${strengthClass}`;
  strengthFill.style.width = `${strengthWidth}%`;
  strengthBar.appendChild(strengthFill);
  
  // Body content
  const conf = document.createElement('div'); 
  conf.className = 'confidence'; 
  conf.textContent = `AI Confidence: ${obj.aiConfidence}%`;
  
  const meta = document.createElement('div'); 
  meta.className = 'meta'; 
  meta.textContent = `Price: ${obj.currentPrice} · Strength: ${Math.round(obj.signalStrength)}% · RSI: ${obj.rsi}`;
  
  // Trading levels
  const levels = document.createElement('div');
  levels.className = 'meta';
  levels.textContent = `Entry: ${obj.entry} | SL: ${obj.stopLoss} | TP: ${obj.takeProfit}`;
  
  // Reasoning toggle
  const toggle = document.createElement('button'); 
  toggle.className = 'btn'; 
  toggle.style.fontSize = '12px'; 
  toggle.style.marginTop = '8px';
  toggle.textContent = 'Show AI reasoning';
  
  const reason = document.createElement('div'); 
  reason.className = 'reason';
  reason.innerHTML = `
    <div style="margin-bottom: 6px;"><strong>ChatGPT:</strong> ${obj.aiValidation.chatGPT.reason}</div>
    <div><strong>DeepSeek:</strong> ${obj.aiValidation.deepSeek.reason}</div>
  `;
  
  toggle.addEventListener('click', () => {
    reason.classList.toggle('open');
    toggle.textContent = reason.classList.contains('open') ? 'Hide AI reasoning' : 'Show AI reasoning';
  });
  
  const stamp = document.createElement('div'); 
  stamp.className = 'small'; 
  stamp.textContent = obj.timestamp;
  
  // Assemble card
  card.appendChild(cardHeader);
  card.appendChild(strengthBar);
  card.appendChild(conf);
  card.appendChild(meta);
  card.appendChild(levels);
  card.appendChild(toggle);
  card.appendChild(reason);
  card.appendChild(stamp);
  
  return { el: card, key };
}

// Cache helpers
function loadCache(){
  try { return JSON.parse(localStorage.getItem(CACHE_KEY) || '[]'); } catch { return []; }
}
function saveCache(arr){
  try { localStorage.setItem(CACHE_KEY, JSON.stringify(arr.slice(0, MAX_CACHE))); } catch {}
}

// render combined cache & new
function renderSignals(newSignals){
  // merge new + existing, prefer newest first and unique by symbol+timestamp
  const existing = loadCache();
  const combined = [...newSignals, ...existing];
  const unique = [];
  const seen = new Set();
  for (const s of combined){
    const id = `${s.symbol}_${s.timestamp}`;
    if (seen.has(id)) continue;
    seen.add(id);
    unique.push(s);
    if (unique.length >= MAX_CACHE) break;
  }
  saveCache(unique);
  // render
  grid.innerHTML = '';
  unique.forEach(s => {
    const { el } = makeCard(s);
    grid.appendChild(el);
  });
  lastUpdatedEl.textContent = `Updated: ${new Date().toLocaleTimeString()}`;
}

// Enhanced main cycle with better loading states
async function cycleOnce(){
  statusLine.textContent = 'AI Analysis: ChatGPT & DeepSeek validating signals';
  statusLine.classList.add('loading-dots');
  
  const symbols = engine.symbols;
  const approved = [];
  
  for (const sym of symbols){
    statusLine.textContent = `Processing ${sym}`;
    statusLine.classList.add('loading-dots');
    
    const raw = await engine.createSignal(sym);
    const result = await dualValidate(raw);
    
    statusLine.textContent = `${sym}: ${result.approved ? '✅ APPROVED' : '❌ rejected'}`;
    statusLine.classList.remove('loading-dots');
    
    if (result.approved){
      const enriched = {
        ...raw,
        aiValidated: true,
        aiValidation: result,
        aiConfidence: result.avgScore,
        timestamp: raw.timestamp
      };
      const id = `${enriched.symbol}_${enriched.timestamp}`;
      if (!shownKeys.has(id)){
        approved.push(enriched);
        // play beep once per new approved
        try { playBeep(); } catch(e){ /* ignore */ }
        shownKeys.add(id);
      }
    }
    // tiny pause so UI remains responsive
    await new Promise(r => setTimeout(r, 80));
  }

  if (approved.length){
    statusLine.textContent = `✅ ${approved.length} new AI-verified signals found`;
    renderSignals(approved);
  } else {
    statusLine.textContent = 'No new AI-verified signals';
    // update last checked time
    lastUpdatedEl.textContent = `Checked: ${new Date().toLocaleTimeString()}`;
  }
  statusLine.classList.remove('loading-dots');
}

// initial load from cache
(function init(){
  // populate UI from cached signals
  const cached = loadCache();
  if (cached.length){
    grid.innerHTML = '';
    cached.forEach(s => {
      const { el } = makeCard(s);
      grid.appendChild(el);
      shownKeys.add(`${s.symbol}_${s.timestamp}`);
    });
    lastUpdatedEl.textContent = `Loaded cached (${cached.length})`;
    statusLine.textContent = `Loaded ${cached.length} cached AI signals`;
  } else {
    lastUpdatedEl.textContent = 'No cached signals';
    statusLine.textContent = 'Ready - Click Refresh to start';
  }

  // try init audio on first user gesture (if allowed later)
  alertsToggle.addEventListener('click', () => { 
    initAudio(); 
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{}); 
  });
  refreshBtn.addEventListener('click', () => { 
    initAudio(); 
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{}); 
  });

  // run initial cycle and auto loop
  setTimeout(() => {
    cycleOnce();
    setInterval(cycleOnce, AUTO_INTERVAL);
  }, 1000);
})();
</script>
</body>
</html>
