<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forex & Synthetic Trading Dashboard</title>
    <style>
        /* [Previous CSS remains the same] */
        :root {
            --bg: #0a0e17;
            --card: #131a2a;
            --accent: #3a86ff;
            --accent-hover: #2a76ef;
            --buy: #10b981;
            --sell: #ef4444;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #1e293b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo span {
            color: var(--accent);
        }
        
        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            border: none;
        }
        
        .btn:hover {
            background: var(--accent);
            color: white;
        }
        
        .btn-primary {
            background: var(--accent);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--accent-hover);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--sell);
        }
        
        .status-dot.connected {
            background: var(--buy);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .main-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .signals-container {
            background: var(--card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }
        
        .signals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .signals-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .signals-controls {
            display: flex;
            gap: 10px;
        }
        
        .signals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        
        .signal-card {
            background: var(--card);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            border: 1px solid var(--border);
        }
        
        .signal-card:hover {
            transform: translateY(-2px);
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .symbol {
            font-weight: 700;
            font-size: 16px;
        }
        
        .direction {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .direction.buy {
            background: rgba(16, 185, 129, 0.2);
            color: var(--buy);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .direction.sell {
            background: rgba(239, 68, 68, 0.2);
            color: var(--sell);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .signal-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .signal-strength {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .strength-bar {
            height: 4px;
            width: 60px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .strength-fill {
            height: 100%;
            border-radius: 2px;
        }
        
        .strength-fill.high {
            background: var(--buy);
            width: 80%;
        }
        
        .strength-fill.medium {
            background: #f59e0b;
            width: 60%;
        }
        
        .strength-fill.low {
            background: var(--sell);
            width: 40%;
        }
        
        .signal-details {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        
        .signal-footer {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background: var(--card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }
        
        .panel-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .symbols-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .symbol-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .symbol-item:last-child {
            border-bottom: none;
        }
        
        .symbol-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .price-change {
            font-size: 12px;
            font-weight: 600;
        }
        
        .price-change.positive {
            color: var(--buy);
        }
        
        .price-change.negative {
            color: var(--sell);
        }
        
        .performance-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-card {
            background: var(--bg);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin: 5px 0;
        }
        
        .stat-value.positive {
            color: var(--buy);
        }
        
        .stat-value.negative {
            color: var(--sell);
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .watchlist {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .watchlist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg);
            border-radius: 6px;
            transition: background 0.2s;
            border: 1px solid var(--border);
        }
        
        .watchlist-item:hover {
            background: rgba(58, 134, 255, 0.1);
        }
        
        .watchlist-symbol {
            font-weight: 600;
        }
        
        .watchlist-price {
            font-weight: 600;
        }
        
        .watchlist-change {
            font-size: 12px;
        }
        
        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .alert-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg);
            border-radius: 6px;
            font-size: 14px;
            border: 1px solid var(--border);
        }
        
        .alert-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
        }
        
        .alert-buy .alert-icon {
            background: var(--buy);
        }
        
        .alert-sell .alert-icon {
            background: var(--sell);
        }
        
        .no-data {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-style: italic;
            grid-column: 1 / -1;
        }
        
        .api-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--sell);
        }
        
        .api-status.connected {
            background: var(--buy);
        }
        
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .signal-reason {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            border-left: 3px solid var(--accent);
        }
        
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .signals-grid {
                grid-template-columns: 1fr;
            }
            
            .signals-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <h1>Forex & <span>Synthetic</span> Dashboard</h1>
                <div class="api-status" id="apiStatus">AI: Online</div>
            </div>
            <div class="controls">
                <div class="status-indicator">
                    <div class="status-dot connected"></div>
                    <span>Live Data Feed</span>
                </div>
                <button class="btn" id="refreshBtn">üîÑ Refresh</button>
                <button class="btn btn-primary" id="subscribeBtn">üìä Subscribe All</button>
                <select class="btn" id="timeframeSelect">
                    <option value="15m" selected>15 Minutes</option>
                    <option value="1h">1 Hour</option>
                    <option value="4h">4 Hours</option>
                </select>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="main-panel">
                <div class="signals-container">
                    <div class="signals-header">
                        <div class="signals-title">üéØ Trading Signals</div>
                        <div class="signals-controls">
                            <div class="btn" id="clearSignalsBtn">üóëÔ∏è Clear Signals</div>
                            <div class="btn" id="generateSignalsBtn">üé≤ Generate Signals</div>
                        </div>
                    </div>
                    <div class="signals-grid" id="signalsGrid">
                        <div class="no-data">Generating trading signals...</div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="panel">
                    <div class="panel-title">üìà Forex & Synthetic Symbols</div>
                    <div class="symbols-list" id="symbolsList">
                        <!-- Symbols populated by JavaScript -->
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">üìä Performance Metrics</div>
                    <div class="performance-stats">
                        <div class="stat-card">
                            <div class="stat-label">Win Rate</div>
                            <div class="stat-value positive">72%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Avg. Return</div>
                            <div class="stat-value positive">2.4%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Signals Today</div>
                            <div class="stat-value" id="signalsCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Active Trades</div>
                            <div class="stat-value">7</div>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">‚≠ê Watchlist</div>
                    <div class="watchlist" id="watchlist">
                        <!-- Watchlist populated by JavaScript -->
                    </div>
                </div>
                
                <div class="panel">
                    <div class="panel-title">üîî Recent Alerts</div>
                    <div class="alerts-list" id="alertsList">
                        <div class="no-data">No alerts yet</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            AUTO_UI_MS: 20000,
            PRICE_HISTORY_LEN: 100,
            EMA_SHORT: 5, 
            EMA_LONG: 20,
            RSI_PERIOD: 14,
            STABILITY: 2,
            CACHE_KEY: 'trading_dashboard_v5',
            MAX_SIGNALS: 15
        };

        // Enhanced Forex, Commodities, and Synthetic symbols
        const symbols = [
            // Forex Major Pairs
            { name: "EUR/USD", type: "Forex", price: 1.08542, change: 0.0012, changePercent: 0.11 },
            { name: "GBP/USD", type: "Forex", price: 1.26789, change: -0.0023, changePercent: -0.18 },
            { name: "USD/JPY", type: "Forex", price: 151.234, change: 0.456, changePercent: 0.30 },
            { name: "AUD/USD", type: "Forex", price: 0.65731, change: 0.0008, changePercent: 0.12 },
            { name: "USD/CAD", type: "Forex", price: 1.35467, change: -0.0011, changePercent: -0.08 },
            { name: "USD/CHF", type: "Forex", price: 0.89765, change: 0.0005, changePercent: 0.06 },
            { name: "NZD/USD", type: "Forex", price: 0.61234, change: -0.0015, changePercent: -0.24 },
            { name: "EUR/GBP", type: "Forex", price: 0.85678, change: 0.0009, changePercent: 0.11 },
            
            // Commodities
            { name: "GOLD", type: "Commodity", price: 1987.65, change: 12.34, changePercent: 0.62 },
            { name: "SILVER", type: "Commodity", price: 23.456, change: -0.123, changePercent: -0.52 },
            { name: "OIL", type: "Commodity", price: 78.901, change: 1.234, changePercent: 1.59 },
            { name: "COPPER", type: "Commodity", price: 3.8765, change: 0.0456, changePercent: 1.19 },
            
            // Indices
            { name: "US30", type: "Index", price: 34567.89, change: 123.45, changePercent: 0.36 },
            { name: "SPX500", type: "Index", price: 4567.89, change: -23.45, changePercent: -0.51 },
            { name: "NAS100", type: "Index", price: 15678.90, change: 67.89, changePercent: 0.43 },
            { name: "GER40", type: "Index", price: 16789.01, change: -45.67, changePercent: -0.27 },
            
            // Synthetic Indices
            { name: "BOOM 1000", type: "Synthetic", price: 543.21, change: 12.34, changePercent: 2.32 },
            { name: "CRASH 1000", type: "Synthetic", price: 456.78, change: -8.76, changePercent: -1.88 },
            { name: "R_100", type: "Synthetic", price: 123.45, change: 3.21, changePercent: 2.67 },
            { name: "STEP_INDEX", type: "Synthetic", price: 345.67, change: 7.89, changePercent: 2.34 }
        ];

        // Global variables
        let signals = [];
        let minuteCandles = {};
        let lastDirHistory = {};
        let shownKeys = new Set();

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Trading Dashboard...');
            initializePriceData();
            populateSymbolsList();
            populateWatchlist();
            setupEventListeners();
            loadCachedSignals();
            
            // Start signal generation
            startSignalGeneration();
            
            // Start price updates
            startPriceUpdates();
            
            console.log('‚úÖ Dashboard initialized successfully');
        });

        // Initialize price data for all symbols
        function initializePriceData() {
            symbols.forEach(symbol => {
                minuteCandles[symbol.name] = [];
                let basePrice = symbol.price;
                
                // Generate historical data with more balanced trends
                for (let i = 0; i < CONFIG.PRICE_HISTORY_LEN; i++) {
                    // Create more balanced trends (not always bearish)
                    const trend = Math.sin(i / 20 + Math.random() * 2) * 0.02;
                    const volatility = (Math.random() - 0.5) * 0.01;
                    basePrice = basePrice * (1 + trend + volatility);
                    const timestamp = Date.now() - (CONFIG.PRICE_HISTORY_LEN - i) * 60000;
                    
                    minuteCandles[symbol.name].push({
                        open: basePrice,
                        high: basePrice * (1 + Math.random() * 0.005),
                        low: basePrice * (1 - Math.random() * 0.005),
                        close: basePrice,
                        ts: timestamp
                    });
                }
            });
        }

        // Add minute tick for price updates
        function addMinuteTick(symbol, price, ts = Date.now()) {
            if (!minuteCandles[symbol]) minuteCandles[symbol] = [];
            const mins = minuteCandles[symbol];
            const minuteKey = Math.floor(ts / 60000) * 60000;
            const last = mins[mins.length - 1];
            
            if (!last || last.ts !== minuteKey) {
                mins.push({ 
                    open: price, 
                    high: price, 
                    low: price, 
                    close: price, 
                    ts: minuteKey 
                });
            } else {
                last.high = Math.max(last.high, price);
                last.low = Math.min(last.low, price);
                last.close = price;
            }
            
            if (mins.length > CONFIG.PRICE_HISTORY_LEN) mins.shift();
        }

        // Technical analysis functions
        function ema(values, period) {
            if (!values || values.length < period) return null;
            const k = 2 / (period + 1);
            let emaValue = values.slice(0, period).reduce((a, b) => a + b, 0) / period;
            for (let i = period; i < values.length; i++) {
                emaValue = values[i] * k + emaValue * (1 - k);
            }
            return emaValue;
        }

        function calcRSI(values, period = CONFIG.RSI_PERIOD) {
            if (!values || values.length < period + 1) return 50;
            
            let gains = 0;
            let losses = 0;
            
            for (let i = 1; i <= period; i++) {
                const change = values[i] - values[i - 1];
                if (change > 0) gains += change;
                else losses -= change;
            }
            
            let avgGain = gains / period;
            let avgLoss = losses / period;
            
            for (let i = period + 1; i < values.length; i++) {
                const change = values[i] - values[i - 1];
                avgGain = (avgGain * (period - 1) + Math.max(0, change)) / period;
                avgLoss = (avgLoss * (period - 1) + Math.max(0, -change)) / period;
            }
            
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        // Enhanced signal generation with balanced buy/sell logic
        function analyzeMultiTF(symbol) {
            const mins = minuteCandles[symbol];
            if (!mins || mins.length < 30) return null;
            
            const closes = mins.map(m => m.close);
            const currentPrice = closes[closes.length - 1];
            
            // Calculate indicators
            const emaShort = ema(closes, CONFIG.EMA_SHORT);
            const emaLong = ema(closes, CONFIG.EMA_LONG);
            if (!emaShort || !emaLong) return null;
            
            const rsi = calcRSI(closes);
            const emaDiff = emaShort - emaLong;
            
            // Enhanced direction logic with RSI consideration
            let direction;
            if (emaDiff > 0 && rsi < 70) {
                direction = 'BUY';
            } else if (emaDiff < 0 && rsi > 30) {
                direction = 'SELL';
            } else {
                // Use RSI extremes for counter-trend signals
                if (rsi < 25) direction = 'BUY';
                else if (rsi > 75) direction = 'SELL';
                else return null; // No clear signal
            }
            
            // Calculate signal strength
            const emaDistance = Math.abs(emaDiff) / currentPrice;
            let baseStrength = 60 + (emaDistance * 10000);
            
            // RSI strength adjustment
            let rsiStrength = 0;
            if ((direction === 'BUY' && rsi < 30) || (direction === 'SELL' && rsi > 70)) {
                rsiStrength = 25;
            } else if ((direction === 'BUY' && rsi < 40) || (direction === 'SELL' && rsi > 60)) {
                rsiStrength = 15;
            }
            
            const signalStrength = Math.min(95, baseStrength + rsiStrength);
            
            const indicatorAlignment = Math.max(2, Math.min(5, Math.round(signalStrength / 20)));
            
            return {
                symbol,
                direction,
                confirmedOn: '15M/1H',
                rsi: Math.round(rsi * 10) / 10,
                currentPrice,
                signalStrength: Math.round(signalStrength),
                indicatorAlignment,
                marketStructure: direction === 'BUY' ? 'BULLISH' : 'BEARISH',
                timestamp: new Date().toLocaleTimeString(),
                id: `${symbol}_${Date.now()}`
            };
        }

        // AI Validation Simulation
        async function dualAIConfirm(signal) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 300 + Math.random() * 400));
            
            // Enhanced validation logic with balanced thresholds
            let chatGPTConfidence = 65;
            let deepSeekConfidence = 70;
            
            // ChatGPT validation
            if ((signal.direction === 'BUY' && signal.rsi < 35) || (signal.direction === 'SELL' && signal.rsi > 65)) {
                chatGPTConfidence += 20;
            }
            chatGPTConfidence += Math.min(15, signal.signalStrength * 0.15);
            chatGPTConfidence += signal.indicatorAlignment * 4;
            
            // DeepSeek validation
            deepSeekConfidence += signal.indicatorAlignment * 5;
            deepSeekConfidence += Math.min(15, signal.signalStrength * 0.12);
            if ((signal.marketStructure === 'BULLISH' && signal.direction === 'BUY') || 
                (signal.marketStructure === 'BEARISH' && signal.direction === 'SELL')) {
                deepSeekConfidence += 10;
            }
            
            // More balanced approval criteria
            const chatGPTValid = chatGPTConfidence >= 65;
            const deepSeekValid = deepSeekConfidence >= 63;
            const approved = chatGPTValid && deepSeekValid;
            const avgConfidence = Math.round((chatGPTConfidence + deepSeekConfidence) / 2);
            
            return {
                approved,
                avgConfidence,
                chatGPT: {
                    model: 'ChatGPT',
                    valid: chatGPTValid,
                    confidence: Math.min(95, Math.round(chatGPTConfidence)),
                    reason: chatGPTValid ? 
                        `Strong technical alignment (RSI: ${signal.rsi}, Strength: ${signal.signalStrength})` :
                        'Moderate technical convergence'
                },
                deepSeek: {
                    model: 'DeepSeek',
                    valid: deepSeekValid,
                    confidence: Math.min(95, Math.round(deepSeekConfidence)),
                    reason: deepSeekValid ?
                        `Favorable market structure with ${signal.indicatorAlignment}/5 timeframe alignment` :
                        'Market conditions not optimal'
                }
            };
        }

        // Process symbol for signals
        async function processSymbolCandidate(symbol) {
            try {
                const signal = analyzeMultiTF(symbol);
                if (!signal) return;
                
                // Stability check
                lastDirHistory[symbol] = lastDirHistory[symbol] || [];
                lastDirHistory[symbol].push(signal.direction);
                if (lastDirHistory[symbol].length > CONFIG.STABILITY) {
                    lastDirHistory[symbol].shift();
                }
                
                const stable = lastDirHistory[symbol].length >= CONFIG.STABILITY && 
                              lastDirHistory[symbol].every(dir => dir === signal.direction);
                
                if (!stable) return;
                
                // Deduplication
                const signalKey = `${signal.symbol}_${signal.direction}_${Math.round(signal.currentPrice * 1000)}`;
                if (shownKeys.has(signalKey)) return;
                
                // AI Validation
                const aiResult = await dualAIConfirm(signal);
                
                if (aiResult.approved) {
                    signal.aiValidated = true;
                    signal.aiValidation = aiResult;
                    signal.aiConfidence = aiResult.avgConfidence;
                    
                    shownKeys.add(signalKey);
                    signals.unshift(signal);
                    
                    // Update UI
                    renderSignals();
                    addAlert(signal.direction, signal.symbol, 
                        `AI approved ${signal.direction} signal (${aiResult.avgConfidence}% confidence)`);
                    
                    // Update signals count
                    updateSignalsCount();
                    
                    // Save to cache
                    saveSignalsToCache();
                }
            } catch (error) {
                console.error('Error processing symbol:', symbol, error);
            }
        }

        // Start signal generation
        function startSignalGeneration() {
            // Initial batch of signals
            setTimeout(() => {
                symbols.forEach(symbol => {
                    if (Math.random() > 0.3) {
                        processSymbolCandidate(symbol.name);
                    }
                });
            }, 1000);
            
            // Continuous signal generation with balanced selection
            setInterval(() => {
                // Select symbols more strategically to get both buy and sell signals
                const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                processSymbolCandidate(randomSymbol.name);
                
                // Occasionally force a buy signal by selecting bullish symbols
                if (Math.random() > 0.7) {
                    const bullishSymbols = symbols.filter(s => 
                        minuteCandles[s.name] && 
                        minuteCandles[s.name].length > 0 && 
                        minuteCandles[s.name][minuteCandles[s.name].length - 1].close > 
                        minuteCandles[s.name][minuteCandles[s.name].length - 2].close
                    );
                    
                    if (bullishSymbols.length > 0) {
                        const bullishSymbol = bullishSymbols[Math.floor(Math.random() * bullishSymbols.length)];
                        processSymbolCandidate(bullishSymbol.name);
                    }
                }
            }, 4000);
        }

        // Start price updates
        function startPriceUpdates() {
            setInterval(() => {
                updateAllPrices();
            }, 3000);
        }

        // Update all symbol prices with more balanced movements
        function updateAllPrices() {
            symbols.forEach(symbol => {
                const candles = minuteCandles[symbol.name];
                if (!candles || candles.length === 0) return;
                
                const lastCandle = candles[candles.length - 1];
                
                // More balanced price movements (not always bearish)
                const trend = Math.random() > 0.5 ? (Math.random() - 0.3) * 0.01 : (Math.random() - 0.7) * 0.01;
                const volatility = (Math.random() - 0.5) * 0.003;
                const newPrice = lastCandle.close * (1 + trend + volatility);
                
                // Update symbol price
                const change = newPrice - symbol.price;
                symbol.price = newPrice;
                symbol.change = change;
                symbol.changePercent = (change / symbol.price) * 100;
                
                addMinuteTick(symbol.name, newPrice, Date.now());
            });
            
            // Update UI
            populateSymbolsList();
            populateWatchlist();
        }

        // Render signals to the grid
        function renderSignals() {
            const signalsGrid = document.getElementById('signalsGrid');
            
            if (signals.length === 0) {
                signalsGrid.innerHTML = '<div class="no-data">No trading signals at the moment</div>';
                return;
            }
            
            // Limit signals display
            const displaySignals = signals.slice(0, 8);
            
            signalsGrid.innerHTML = displaySignals.map(signal => `
                <div class="signal-card">
                    <div class="signal-header">
                        <div class="symbol">${signal.symbol}</div>
                        <div class="direction ${signal.direction.toLowerCase()}">${signal.direction}</div>
                    </div>
                    <div class="signal-meta">
                        <div>Price: ${signal.currentPrice.toFixed(signal.symbol.includes('GOLD') || signal.symbol.includes('OIL') ? 2 : 5)}</div>
                        <div>RSI: ${signal.rsi}</div>
                    </div>
                    <div class="signal-strength">
                        <span>Strength:</span>
                        <div class="strength-bar">
                            <div class="strength-fill ${getStrengthClass(signal.signalStrength)}"></div>
                        </div>
                        <span>${signal.signalStrength}%</span>
                    </div>
                    <div class="signal-details">
                        <strong>AI Confidence:</strong> ${signal.aiConfidence}% ¬∑ <strong>TF:</strong> ${signal.confirmedOn}
                    </div>
                    <div class="signal-reason">
                        ${signal.aiValidation.chatGPT.reason}
                    </div>
                    <div class="signal-footer">
                        <div>${signal.timestamp}</div>
                        <div>${signal.marketStructure}</div>
                    </div>
                </div>
            `).join('');
        }

        // Get strength class based on percentage
        function getStrengthClass(strength) {
            if (strength >= 75) return 'high';
            if (strength >= 60) return 'medium';
            return 'low';
        }

        // Update signals count
        function updateSignalsCount() {
            document.getElementById('signalsCount').textContent = signals.length;
        }

        // Add alert
        function addAlert(type, symbol, message) {
            const alertsList = document.getElementById('alertsList');
            const now = new Date();
            const time = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            // Remove "no alerts" message if present
            const noData = alertsList.querySelector('.no-data');
            if (noData) noData.remove();
            
            const alertItem = document.createElement('div');
            alertItem.className = `alert-item alert-${type.toLowerCase()}`;
            
            alertItem.innerHTML = `
                <div class="alert-icon"></div>
                <div class="alert-content">
                    <strong>${symbol}</strong>: ${message}
                </div>
                <div class="alert-time">${time}</div>
            `;
            
            alertsList.insertBefore(alertItem, alertsList.firstChild);
            
            // Keep only 5 most recent alerts
            if (alertsList.children.length > 5) {
                alertsList.removeChild(alertsList.lastChild);
            }
        }

        // Populate symbols list
        function populateSymbolsList() {
            const symbolsList = document.getElementById('symbolsList');
            
            symbolsList.innerHTML = symbols.map(symbol => {
                const changeClass = symbol.change >= 0 ? 'positive' : 'negative';
                const changeSign = symbol.change >= 0 ? '+' : '';
                const pricePrecision = symbol.type === 'Commodity' || symbol.type === 'Index' ? 2 : 5;
                
                return `
                    <div class="symbol-item">
                        <div class="symbol-info">
                            <div class="symbol">${symbol.name}</div>
                            <div style="font-size: 11px; color: var(--text-muted);">${symbol.type}</div>
                        </div>
                        <div class="price-change ${changeClass}">
                            ${changeSign}${symbol.change.toFixed(pricePrecision)}<br>
                            <small>(${changeSign}${symbol.changePercent.toFixed(2)}%)</small>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Populate watchlist
        function populateWatchlist() {
            const watchlistEl = document.getElementById('watchlist');
            const watchlistSymbols = symbols.slice(0, 4); // Top 4 symbols
            
            watchlistEl.innerHTML = watchlistSymbols.map(symbol => {
                const changeClass = symbol.change >= 0 ? 'positive' : 'negative';
                const changeSign = symbol.change >= 0 ? '+' : '';
                const pricePrecision = symbol.type === 'Commodity' || symbol.type === 'Index' ? 2 : 5;
                
                return `
                    <div class="watchlist-item">
                        <div class="watchlist-symbol">${symbol.name}</div>
                        <div class="watchlist-price">${symbol.price.toFixed(pricePrecision)}</div>
                        <div class="watchlist-change ${changeClass}">
                            ${changeSign}${symbol.change.toFixed(pricePrecision)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load cached signals
        function loadCachedSignals() {
            try {
                const cached = localStorage.getItem(CONFIG.CACHE_KEY);
                if (cached) {
                    const parsed = JSON.parse(cached);
                    signals = parsed.slice(0, CONFIG.MAX_SIGNALS);
                    renderSignals();
                    updateSignalsCount();
                }
            } catch (error) {
                console.error('Error loading cached signals:', error);
            }
        }

        // Save signals to cache
        function saveSignalsToCache() {
            try {
                const signalsToSave = signals.slice(0, CONFIG.MAX_SIGNALS);
                localStorage.setItem(CONFIG.CACHE_KEY, JSON.stringify(signalsToSave));
            } catch (error) {
                console.error('Error saving signals to cache:', error);
            }
        }

        // Clear all signals
        function clearAllSignals() {
            signals = [];
            shownKeys.clear();
            renderSignals();
            updateSignalsCount();
            localStorage.removeItem(CONFIG.CACHE_KEY);
            addAlert('info', 'System', 'All signals cleared');
        }

        // Generate manual signals
        function generateManualSignals() {
            // Generate 2-4 random signals
            const numSignals = Math.floor(Math.random() * 3) + 2;
            
            for (let i = 0; i < numSignals; i++) {
                const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                processSymbolCandidate(randomSymbol.name);
            }
            
            addAlert('info', 'System', `Generated ${numSignals} new signals`);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', function() {
                this.classList.add('loading');
                this.textContent = 'üîÑ Refreshing...';
                
                setTimeout(() => {
                    updateAllPrices();
                    this.classList.remove('loading');
                    this.textContent = 'üîÑ Refresh';
                    addAlert('info', 'System', 'Data refreshed successfully');
                }, 1000);
            });
            
            // Subscribe button
            document.getElementById('subscribeBtn').addEventListener('click', function() {
                addAlert('info', 'System', 'Subscribed to all symbols');
                this.textContent = '‚úÖ Subscribed All';
                
                setTimeout(() => {
                    this.textContent = 'üìä Subscribe All';
                }, 2000);
            });
            
            // Clear signals button
            document.getElementById('clearSignalsBtn').addEventListener('click', function() {
                clearAllSignals();
                this.textContent = '‚úÖ Cleared';
                
                setTimeout(() => {
                    this.textContent = 'üóëÔ∏è Clear Signals';
                }, 2000);
            });
            
            // Generate signals button
            document.getElementById('generateSignalsBtn').addEventListener('click', function() {
                generateManualSignals();
                this.textContent = 'üéØ Generating...';
                
                setTimeout(() => {
                    this.textContent = 'üé≤ Generate Signals';
                }, 2000);
            });
            
            // Timeframe selector
            document.getElementById('timeframeSelect').addEventListener('change', function() {
                const selectedTimeframe = this.options[this.selectedIndex].text;
                addAlert('info', 'System', `Timeframe changed to ${selectedTimeframe}`);
            });
            
            // Auto-save signals periodically
            setInterval(saveSignalsToCache, 10000);
        }
    </script>
</body>
</html>
