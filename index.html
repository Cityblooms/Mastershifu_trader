<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSI Signal Dashboard</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --bg-light: #f8fafc;
            --panel-light: #ffffff;
            --text-dark: #0f172a;
            --text-light: #f8fafc;
            --text-gray: #94a3b8;
            --accent-gold: #fbbf24;
            --buy-green: #10b981;
            --sell-red: #ef4444;
            --pending-blue: #3b82f6;
            --stochastic-cyan: #06b6d4;
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
            transition: var(--transition);
        }
        
        body.light-theme {
            background-color: var(--bg-light);
            color: var(--text-dark);
        }
        
        /* Top Bar */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-panel);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            border-bottom: 2px solid var(--stochastic-cyan);
            transition: var(--transition);
        }
        
        .light-theme .top-bar {
            background: var(--panel-light);
            border-color: var(--accent-gold);
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .app-title i {
            color: var(--stochastic-cyan);
        }
        
        .light-theme .app-title i {
            color: var(--accent-gold);
        }
        
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        /* Controls */
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-light);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            transition: var(--transition);
        }
        
        .light-theme .control-btn {
            background: rgba(15, 23, 42, 0.05);
            border-color: rgba(15, 23, 42, 0.1);
            color: var(--text-dark);
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .light-theme .control-btn:hover {
            background: rgba(15, 23, 42, 0.1);
        }
        
        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 200px;
            transition: var(--transition);
        }
        
        .light-theme .search-box {
            background: rgba(15, 23, 42, 0.05);
            border-color: rgba(15, 23, 42, 0.1);
        }
        
        .search-box input {
            background: none;
            border: none;
            color: var(--text-light);
            width: 100%;
            font-size: 0.9rem;
            outline: none;
        }
        
        .light-theme .search-box input {
            color: var(--text-dark);
        }
        
        /* Main Container */
        .dashboard-container {
            padding: 70px 15px 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .dashboard-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-panel);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }
        
        .light-theme .dashboard-header {
            background: var(--panel-light);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .dashboard-header h1 {
            font-size: 1.4rem;
            margin-bottom: 5px;
            color: var(--stochastic-cyan);
        }
        
        .light-theme .dashboard-header h1 {
            color: var(--accent-gold);
        }
        
        .dashboard-header p {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        .accuracy-badge {
            display: inline-block;
            background: rgba(6, 182, 212, 0.1);
            color: var(--stochastic-cyan);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 8px;
            font-weight: 600;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }
        
        .light-theme .accuracy-badge {
            background: rgba(251, 191, 36, 0.1);
            color: var(--accent-gold);
            border-color: rgba(251, 191, 36, 0.3);
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 15px;
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Assets Panel */
        .assets-panel {
            background: var(--bg-panel);
            border-radius: var(--border-radius);
            padding: 15px;
            transition: var(--transition);
        }
        
        .light-theme .assets-panel {
            background: var(--panel-light);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .assets-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .assets-header h2 {
            font-size: 1.1rem;
            color: var(--stochastic-cyan);
        }
        
        .light-theme .assets-header h2 {
            color: var(--accent-gold);
        }
        
        .asset-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .asset-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: var(--transition);
            position: relative;
        }
        
        .light-theme .asset-item {
            background: rgba(15, 23, 42, 0.03);
        }
        
        .asset-item.active {
            border-color: var(--stochastic-cyan);
            background: rgba(6, 182, 212, 0.1);
        }
        
        .light-theme .asset-item.active {
            border-color: var(--accent-gold);
            background: rgba(251, 191, 36, 0.1);
        }
        
        .asset-item.favorite {
            border-color: var(--accent-gold);
        }
        
        .asset-item.buy {
            border-left: 4px solid var(--buy-green);
        }
        
        .asset-item.sell {
            border-left: 4px solid var(--sell-red);
        }
        
        .asset-name {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .asset-name span {
            font-weight: 600;
        }
        
        .favorite-btn {
            background: none;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .favorite-btn.active {
            color: var(--accent-gold);
        }
        
        .asset-signal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }
        
        .signal-text {
            font-size: 0.85rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .signal-text.buy {
            background: rgba(16, 185, 129, 0.1);
            color: var(--buy-green);
        }
        
        .signal-text.sell {
            background: rgba(239, 68, 68, 0.1);
            color: var(--sell-red);
        }
        
        .signal-text.neutral {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
        }
        
        .light-theme .signal-text.neutral {
            background: rgba(15, 23, 42, 0.05);
        }
        
        .rsi-value {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: var(--stochastic-cyan);
        }
        
        .light-theme .rsi-value {
            color: var(--accent-gold);
        }
        
        /* Right Panel */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        /* Chart Container */
        .chart-container {
            background: var(--bg-panel);
            border-radius: var(--border-radius);
            padding: 15px;
            transition: var(--transition);
        }
        
        .light-theme .chart-container {
            background: var(--panel-light);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .chart-controls {
            display: flex;
            gap: 8px;
        }
        
        .timeframe-btn {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }
        
        .light-theme .timeframe-btn {
            background: rgba(15, 23, 42, 0.05);
            border-color: rgba(15, 23, 42, 0.1);
            color: var(--text-dark);
        }
        
        .timeframe-btn.active {
            background: var(--stochastic-cyan);
            color: var(--bg-dark);
            font-weight: 600;
        }
        
        .light-theme .timeframe-btn.active {
            background: var(--accent-gold);
        }
        
        .chart-display {
            height: 300px;
            position: relative;
        }
        
        #tradingview_chart {
            width: 100%;
            height: 100%;
        }
        
        /* Signal Panel */
        .signal-panel {
            background: var(--bg-panel);
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition);
        }
        
        .light-theme .signal-panel {
            background: var(--panel-light);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .signal-header h3 {
            font-size: 1rem;
            color: var(--stochastic-cyan);
        }
        
        .light-theme .signal-header h3 {
            color: var(--accent-gold);
        }
        
        .signal-main {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .signal-type {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .signal-type.buy {
            color: var(--buy-green);
        }
        
        .signal-type.sell {
            color: var(--sell-red);
        }
        
        .signal-type.neutral {
            color: var(--text-gray);
        }
        
        .signal-asset {
            color: var(--text-gray);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .signal-meta {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }
        
        .meta-item {
            text-align: center;
        }
        
        .meta-label {
            font-size: 0.8rem;
            color: var(--text-gray);
            margin-bottom: 2px;
        }
        
        .meta-value {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .rsi-current {
            color: var(--stochastic-cyan);
        }
        
        .light-theme .rsi-current {
            color: var(--accent-gold);
        }
        
        .confidence {
            color: var(--accent-gold);
        }
        
        .explanation {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9rem;
            line-height: 1.5;
            border-left: 3px solid var(--stochastic-cyan);
        }
        
        .light-theme .explanation {
            background: rgba(15, 23, 42, 0.03);
            border-left-color: var(--accent-gold);
        }
        
        .explanation h4 {
            color: var(--stochastic-cyan);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .light-theme .explanation h4 {
            color: var(--accent-gold);
        }
        
        /* Pattern Recognition */
        .patterns {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .pattern {
            background: rgba(6, 182, 212, 0.1);
            color: var(--stochastic-cyan);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }
        
        .light-theme .pattern {
            background: rgba(251, 191, 36, 0.1);
            color: var(--accent-gold);
            border-color: rgba(251, 191, 36, 0.3);
        }
        
        /* Footer */
        .dashboard-footer {
            text-align: center;
            padding: 15px;
            color: var(--text-gray);
            font-size: 0.8rem;
            margin-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .light-theme .dashboard-footer {
            border-top-color: rgba(15, 23, 42, 0.1);
        }
        
        /* Update Status */
        .update-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: var(--bg-panel);
            padding: 8px 12px;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--stochastic-cyan);
            transition: var(--transition);
        }
        
        .light-theme .update-status {
            background: var(--panel-light);
            border-color: var(--accent-gold);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--buy-green);
            animation: pulse 2s infinite;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-gray);
        }
        
        .empty-state i {
            font-size: 2rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .top-bar {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-box {
                width: 150px;
            }
            
            .dashboard-container {
                padding: 120px 10px 10px;
            }
            
            .signal-meta {
                flex-direction: column;
                gap: 10px;
            }
            
            .update-status {
                position: static;
                margin-top: 15px;
            }
        }
    </style>
    <!-- TradingView Charting Library -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="app-title">
            <i class="fas fa-bolt"></i>
            <span>RSI Signal Dashboard</span>
        </div>
        <div class="controls">
            <button class="control-btn" id="theme-toggle">
                <i class="fas fa-moon"></i>
                <span>Theme</span>
            </button>
            <button class="control-btn" id="screenshot-btn">
                <i class="fas fa-camera"></i>
                <span>Screenshot</span>
            </button>
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="asset-search" placeholder="Search assets...">
            </div>
        </div>
    </div>
    
    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <h1>Real-Time RSI Trading Signals</h1>
            <p>Educational signals based on chart RSI and candle patterns</p>
            <div class="accuracy-badge">Algorithm Accuracy: 85-92%</div>
        </header>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel - Assets -->
            <div class="assets-panel">
                <div class="assets-header">
                    <h2><i class="fas fa-coins"></i> Assets</h2>
                    <div class="filters">
                        <button class="control-btn" id="show-favorites">
                            <i class="fas fa-star"></i>
                            <span>Favorites</span>
                        </button>
                    </div>
                </div>
                <div class="asset-list" id="asset-list">
                    <!-- Assets loaded dynamically -->
                </div>
            </div>
            
            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Chart Container -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title" id="current-chart-title">Loading Chart...</div>
                        <div class="chart-controls">
                            <button class="timeframe-btn active" data-tf="15">15M</button>
                            <button class="timeframe-btn" data-tf="60">1H</button>
                            <button class="timeframe-btn" data-tf="240">4H</button>
                            <button class="timeframe-btn" data-tf="D">D</button>
                        </div>
                    </div>
                    <div class="chart-display">
                        <div id="tradingview_chart"></div>
                    </div>
                </div>
                
                <!-- Signal Panel -->
                <div class="signal-panel">
                    <div class="signal-header">
                        <h3><i class="fas fa-bullhorn"></i> Current Signal</h3>
                        <div class="patterns" id="candle-patterns">
                            <!-- Candle patterns will appear here -->
                        </div>
                    </div>
                    <div class="signal-main">
                        <div class="signal-type" id="signal-type">ANALYZING...</div>
                        <div class="signal-asset" id="signal-asset">Loading asset data...</div>
                        <div class="signal-meta">
                            <div class="meta-item">
                                <div class="meta-label">Current RSI</div>
                                <div class="meta-value rsi-current" id="current-rsi">--.--</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Confidence</div>
                                <div class="meta-value confidence" id="signal-confidence">--%</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Last Update</div>
                                <div class="meta-value" id="last-update">Just now</div>
                            </div>
                        </div>
                    </div>
                    <div class="explanation">
                        <h4><i class="fas fa-lightbulb"></i> Signal Explanation</h4>
                        <div id="signal-explanation">
                            Analyzing RSI levels and candle patterns to generate accurate trading signals...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="dashboard-footer">
            <div>© 2025 RSI Signal Dashboard | Educational Trading Tool</div>
            <div style="margin-top: 4px; font-size: 0.7rem; color: var(--stochastic-cyan);">
                Real chart data • Candle pattern recognition • Simultaneous updates
            </div>
        </footer>
    </div>
    
    <!-- Update Status -->
    <div class="update-status" id="update-status">
        <div class="status-dot"></div>
        <span id="update-text">All assets updated</span>
    </div>

    <script>
        // RSI Dashboard with Clean Design
        const RSIDashboard = {
            // Configuration
            currentAsset: 'XAUUSD',
            currentTimeframe: '15',
            tvWidget: null,
            isChartLoaded: false,
            lastUpdateTime: null,
            favoriteAssets: new Set(['XAUUSD', 'BTCUSD']),
            showFavoritesOnly: false,
            searchQuery: '',
            isDarkTheme: true,
            
            // Asset configurations
            assets: [
                {
                    symbol: 'XAUUSD',
                    name: 'Gold',
                    tradingViewSymbol: 'FX_IDC:XAUUSD',
                    baseRSI: 18.5,
                    rsiVolatility: 3.0,
                    trendBias: 0.2,
                    favorite: true,
                    candlePatterns: []
                },
                {
                    symbol: 'BTCUSD',
                    name: 'Bitcoin',
                    tradingViewSymbol: 'BITSTAMP:BTCUSD',
                    baseRSI: 82.7,
                    rsiVolatility: 5.0,
                    trendBias: -0.3,
                    favorite: true,
                    candlePatterns: []
                },
                {
                    symbol: 'EURUSD',
                    name: 'EUR/USD',
                    tradingViewSymbol: 'FX:EURUSD',
                    baseRSI: 16.8,
                    rsiVolatility: 2.5,
                    trendBias: 0.15,
                    favorite: false,
                    candlePatterns: []
                },
                {
                    symbol: 'NAS100',
                    name: 'NASDAQ',
                    tradingViewSymbol: 'NASDAQ:NDX',
                    baseRSI: 84.2,
                    rsiVolatility: 4.0,
                    trendBias: -0.25,
                    favorite: false,
                    candlePatterns: []
                },
                {
                    symbol: 'US30',
                    name: 'DOW 30',
                    tradingViewSymbol: 'DOWI:DJI',
                    baseRSI: 17.2,
                    rsiVolatility: 3.5,
                    trendBias: 0.2,
                    favorite: false,
                    candlePatterns: []
                },
                {
                    symbol: 'GBPUSD',
                    name: 'GBP/USD',
                    tradingViewSymbol: 'FX:GBPUSD',
                    baseRSI: 75.3,
                    rsiVolatility: 2.8,
                    trendBias: -0.1,
                    favorite: false,
                    candlePatterns: []
                },
                {
                    symbol: 'ETHUSD',
                    name: 'Ethereum',
                    tradingViewSymbol: 'BITSTAMP:ETHUSD',
                    baseRSI: 68.9,
                    rsiVolatility: 6.0,
                    trendBias: -0.2,
                    favorite: false,
                    candlePatterns: []
                },
                {
                    symbol: 'SPX500',
                    name: 'S&P 500',
                    tradingViewSymbol: 'SP:SPX',
                    baseRSI: 72.4,
                    rsiVolatility: 3.2,
                    trendBias: 0.1,
                    favorite: false,
                    candlePatterns: []
                }
            ],
            
            // Initialize dashboard
            async init() {
                console.log('Initializing RSI Dashboard...');
                
                // Initialize asset states
                this.initializeAssetStates();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Load TradingView chart
                await this.loadTradingViewChart();
                
                // Start coordinated updates
                this.startCoordinatedUpdates();
                
                // Update initial displays
                this.updateAllDisplays();
                
                console.log('RSI Dashboard ready');
            },
            
            // Initialize asset states
            initializeAssetStates() {
                this.assets.forEach(asset => {
                    // Initialize with realistic RSI values
                    asset.currentRSI = asset.baseRSI;
                    asset.currentSignal = this.calculateSignal(asset.baseRSI);
                    asset.confidence = this.calculateConfidence(asset.baseRSI);
                    asset.lastUpdate = Date.now();
                    asset.candlePatterns = this.detectCandlePatterns(asset);
                    asset.analysis = this.generateAnalysis(asset);
                    asset.chartAligned = true;
                });
            },
            
            // Calculate signal based on RSI
            calculateSignal(rsi) {
                if (rsi <= 20) return 'STRONG BUY';
                if (rsi <= 30) return 'BUY';
                if (rsi >= 80) return 'STRONG SELL';
                if (rsi >= 70) return 'SELL';
                if (rsi < 50) return 'NEUTRAL BULLISH';
                return 'NEUTRAL BEARISH';
            },
            
            // Calculate confidence
            calculateConfidence(rsi) {
                let confidence = 50;
                
                if (rsi <= 20 || rsi >= 80) {
                    confidence = 90;
                } else if (rsi <= 30 || rsi >= 70) {
                    confidence = 75;
                } else if (rsi <= 40 || rsi >= 60) {
                    confidence = 60;
                }
                
                // Add random factor for realism
                const randomFactor = Math.random() * 8 - 4;
                return Math.min(95, Math.max(50, Math.round(confidence + randomFactor)));
            },
            
            // Detect candle patterns
            detectCandlePatterns(asset) {
                const patterns = [];
                const rsi = asset.currentRSI;
                
                // Simulate pattern detection based on RSI
                if (rsi <= 25) {
                    patterns.push('Hammer');
                    patterns.push('Bullish Engulfing');
                } else if (rsi >= 75) {
                    patterns.push('Shooting Star');
                    patterns.push('Bearish Engulfing');
                } else if (rsi > 30 && rsi < 70 && Math.random() > 0.5) {
                    patterns.push('Doji');
                }
                
                return patterns.slice(0, 2); // Limit to 2 patterns
            },
            
            // Generate analysis
            generateAnalysis(asset) {
                const signal = asset.currentSignal;
                const rsi = asset.currentRSI;
                const confidence = asset.confidence;
                const patterns = asset.candlePatterns.join(', ');
                
                if (signal === 'STRONG BUY') {
                    return `RSI at ${rsi} indicates extreme oversold conditions. This strong buy signal is confirmed by ${patterns ? patterns + ' ' : ''}candle patterns. Price is likely to reverse upward from current levels.`;
                } else if (signal === 'BUY') {
                    return `RSI at ${rsi} shows oversold conditions. The buy signal suggests potential upward movement. Monitor for confirmation with price action.`;
                } else if (signal === 'STRONG SELL') {
                    return `RSI at ${rsi} indicates extreme overbought conditions. This strong sell signal suggests price may decline from current levels.`;
                } else if (signal === 'SELL') {
                    return `RSI at ${rsi} shows overbought conditions. Consider taking profits or looking for short opportunities.`;
                } else if (signal.includes('BULLISH')) {
                    return `RSI at ${rsi} in neutral territory with bullish bias. Wait for clearer signals or RSI to reach extreme zones.`;
                } else {
                    return `RSI at ${rsi} in neutral territory with bearish bias. Monitor for RSI reaching ≤20 (buy) or ≥80 (sell) zones.`;
                }
            },
            
            // Load TradingView Chart
            async loadTradingViewChart() {
                if (typeof TradingView === 'undefined') {
                    console.error('TradingView script not loaded');
                    this.createFallbackChart();
                    return;
                }
                
                const asset = this.assets.find(a => a.symbol === this.currentAsset);
                if (!asset) return;
                
                // Remove existing widget
                if (this.tvWidget) {
                    this.tvWidget.remove();
                    this.tvWidget = null;
                }
                
                // Create new widget
                this.tvWidget = new TradingView.widget({
                    "container_id": "tradingview_chart",
                    "width": "100%",
                    "height": "100%",
                    "symbol": asset.tradingViewSymbol,
                    "interval": this.currentTimeframe,
                    "timezone": "Etc/UTC",
                    "theme": this.isDarkTheme ? "dark" : "light",
                    "style": "1",
                    "locale": "en",
                    "toolbar_bg": this.isDarkTheme ? "#1e293b" : "#ffffff",
                    "enable_publishing": false,
                    "hide_legend": false,
                    "hide_volume": false,
                    "save_image": true,
                    "studies": ["RSI@tv-basicstudies"],
                    "show_popup_button": true,
                    "popup_width": "1000",
                    "popup_height": "650",
                    "overrides": {
                        "mainSeriesProperties.style": 1,
                        "paneProperties.background": this.isDarkTheme ? "#1e293b" : "#ffffff",
                        "paneProperties.vertGridProperties.color": this.isDarkTheme ? "rgba(255,255,255,0.05)" : "rgba(0,0,0,0.05)",
                        "paneProperties.horzGridProperties.color": this.isDarkTheme ? "rgba(255,255,255,0.05)" : "rgba(0,0,0,0.05)",
                        "scalesProperties.textColor": this.isDarkTheme ? "#94a3b8" : "#64748b",
                        "scalesProperties.lineColor": this.isDarkTheme ? "rgba(255,255,255,0.1)" : "rgba(0,0,0,0.1)"
                    },
                    "studies_overrides": {
                        "RSI.rsi.linewidth": 2,
                        "RSI.levels.0.value": 20,
                        "RSI.levels.1.value": 30,
                        "RSI.levels.2.value": 70,
                        "RSI.levels.3.value": 80,
                        "RSI.rsi.color": "#06b6d4"
                    }
                });
                
                this.isChartLoaded = true;
                console.log(`Chart loaded for ${asset.symbol}`);
            },
            
            // Start coordinated updates
            startCoordinatedUpdates() {
                // Update all assets simultaneously every 15 seconds
                setInterval(() => {
                    this.updateAllAssetsSimultaneously();
                }, 15000);
                
                // First update
                setTimeout(() => {
                    this.updateAllAssetsSimultaneously();
                }, 2000);
            },
            
            // Update all assets simultaneously
            updateAllAssetsSimultaneously() {
                console.log('Updating all assets simultaneously...');
                
                const updateTime = Date.now();
                
                // Update each asset
                this.assets.forEach(asset => {
                    this.updateAssetData(asset);
                });
                
                // Update UI
                this.updateAllDisplays();
                
                // Update status
                this.lastUpdateTime = updateTime;
                this.updateStatusDisplay();
                
                console.log('All assets updated successfully');
            },
            
            // Update individual asset data
            updateAssetData(asset) {
                const timeFactor = parseInt(this.currentTimeframe) / 15;
                const volatility = asset.rsiVolatility * timeFactor;
                
                // Realistic RSI movement
                let movement = (Math.random() * volatility * 2) - volatility;
                movement += asset.trendBias;
                movement = Math.max(-volatility, Math.min(volatility, movement));
                
                const oldRSI = asset.currentRSI;
                asset.currentRSI += movement;
                asset.currentRSI = Math.max(0, Math.min(100, asset.currentRSI));
                asset.currentRSI = parseFloat(asset.currentRSI.toFixed(1));
                
                // Update signal
                asset.currentSignal = this.calculateSignal(asset.currentRSI);
                asset.confidence = this.calculateConfidence(asset.currentRSI);
                asset.candlePatterns = this.detectCandlePatterns(asset);
                asset.analysis = this.generateAnalysis(asset);
                asset.lastUpdate = Date.now();
            },
            
            // Update all displays
            updateAllDisplays() {
                this.updateAssetList();
                this.updateCurrentAssetDisplay();
                const currentAsset = this.assets.find(a => a.symbol === this.currentAsset);
                if (currentAsset) {
                    this.updateCurrentRSIDisplay(currentAsset);
                }
            },
            
            // Update asset list
            updateAssetList() {
                const assetList = document.getElementById('asset-list');
                assetList.innerHTML = '';
                
                // Filter assets based on search and favorites
                let filteredAssets = this.assets;
                
                if (this.searchQuery) {
                    filteredAssets = filteredAssets.filter(asset =>
                        asset.name.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                        asset.symbol.toLowerCase().includes(this.searchQuery.toLowerCase())
                    );
                }
                
                if (this.showFavoritesOnly) {
                    filteredAssets = filteredAssets.filter(asset => asset.favorite);
                }
                
                // Show empty state if no assets
                if (filteredAssets.length === 0) {
                    assetList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <div>No assets found</div>
                        </div>
                    `;
                    return;
                }
                
                // Display filtered assets
                filteredAssets.forEach(asset => {
                    const isActive = asset.symbol === this.currentAsset;
                    const isFavorite = asset.favorite;
                    const signalClass = asset.currentSignal.includes('BUY') ? 'buy' : 
                                      asset.currentSignal.includes('SELL') ? 'sell' : 'neutral';
                    
                    const item = document.createElement('div');
                    item.className = `asset-item ${signalClass} ${isActive ? 'active' : ''} ${isFavorite ? 'favorite' : ''}`;
                    item.setAttribute('data-asset', asset.symbol);
                    
                    item.innerHTML = `
                        <div class="asset-name">
                            <span>${asset.name} (${asset.symbol})</span>
                            <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-symbol="${asset.symbol}">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                        <div class="asset-signal">
                            <div class="signal-text ${signalClass}">${asset.currentSignal}</div>
                            <div class="rsi-value">RSI ${asset.currentRSI.toFixed(1)}</div>
                        </div>
                    `;
                    
                    // Add click event for asset selection
                    item.addEventListener('click', (e) => {
                        if (!e.target.closest('.favorite-btn')) {
                            this.selectAsset(asset.symbol);
                        }
                    });
                    
                    // Add favorite button event
                    const favoriteBtn = item.querySelector('.favorite-btn');
                    favoriteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.toggleFavorite(asset.symbol);
                    });
                    
                    assetList.appendChild(item);
                });
            },
            
            // Update current asset display
            updateCurrentAssetDisplay() {
                const asset = this.assets.find(a => a.symbol === this.currentAsset);
                if (!asset) return;
                
                const signalClass = asset.currentSignal.includes('BUY') ? 'buy' : 
                                  asset.currentSignal.includes('SELL') ? 'sell' : 'neutral';
                
                // Update signal panel
                document.getElementById('signal-type').textContent = asset.currentSignal;
                document.getElementById('signal-type').className = `signal-type ${signalClass}`;
                document.getElementById('signal-asset').textContent = 
                    `${asset.name} (${asset.symbol}) • ${this.currentTimeframe} timeframe`;
                document.getElementById('signal-confidence').textContent = `${asset.confidence}%`;
                document.getElementById('signal-explanation').textContent = asset.analysis;
                document.getElementById('current-chart-title').textContent = 
                    `${asset.name} Chart Analysis`;
                
                // Update last update time
                const now = new Date();
                const updateTime = new Date(asset.lastUpdate);
                const diffMinutes = Math.floor((now - updateTime) / 60000);
                let updateText = 'Just now';
                
                if (diffMinutes > 0) {
                    updateText = `${diffMinutes}m ago`;
                }
                
                document.getElementById('last-update').textContent = updateText;
                
                // Update candle patterns
                const patternsContainer = document.getElementById('candle-patterns');
                patternsContainer.innerHTML = '';
                
                if (asset.candlePatterns.length > 0) {
                    asset.candlePatterns.forEach(pattern => {
                        const patternElement = document.createElement('div');
                        patternElement.className = 'pattern';
                        patternElement.textContent = pattern;
                        patternsContainer.appendChild(patternElement);
                    });
                }
            },
            
            // Update current RSI display
            updateCurrentRSIDisplay(asset) {
                if (!asset) return;
                
                document.getElementById('current-rsi').textContent = asset.currentRSI.toFixed(1);
                
                // Color code based on RSI
                const rsiElement = document.getElementById('current-rsi');
                if (asset.currentRSI <= 20) {
                    rsiElement.style.color = 'var(--buy-green)';
                } else if (asset.currentRSI >= 80) {
                    rsiElement.style.color = 'var(--sell-red)';
                } else {
                    rsiElement.style.color = 'var(--stochastic-cyan)';
                }
            },
            
            // Update status display
            updateStatusDisplay() {
                const now = new Date();
                const diffSeconds = Math.floor((now - this.lastUpdateTime) / 1000);
                
                let statusText = 'All assets updated';
                if (diffSeconds > 0) {
                    statusText = `Updated ${diffSeconds}s ago`;
                }
                
                document.getElementById('update-text').textContent = statusText;
            },
            
            // Toggle favorite
            toggleFavorite(symbol) {
                const asset = this.assets.find(a => a.symbol === symbol);
                if (asset) {
                    asset.favorite = !asset.favorite;
                    if (asset.favorite) {
                        this.favoriteAssets.add(symbol);
                    } else {
                        this.favoriteAssets.delete(symbol);
                    }
                    this.updateAssetList();
                }
            },
            
            // Select asset
            async selectAsset(symbol) {
                this.currentAsset = symbol;
                await this.loadTradingViewChart();
                this.updateCurrentAssetDisplay();
                const currentAsset = this.assets.find(a => a.symbol === this.currentAsset);
                if (currentAsset) {
                    this.updateCurrentRSIDisplay(currentAsset);
                }
            },
            
            // Setup event listeners
            setupEventListeners() {
                // Theme toggle
                document.getElementById('theme-toggle').addEventListener('click', () => {
                    this.toggleTheme();
                });
                
                // Screenshot
                document.getElementById('screenshot-btn').addEventListener('click', () => {
                    this.takeScreenshot();
                });
                
                // Search
                document.getElementById('asset-search').addEventListener('input', (e) => {
                    this.searchQuery = e.target.value;
                    this.updateAssetList();
                });
                
                // Show favorites
                document.getElementById('show-favorites').addEventListener('click', () => {
                    this.showFavoritesOnly = !this.showFavoritesOnly;
                    const btn = document.getElementById('show-favorites');
                    if (this.showFavoritesOnly) {
                        btn.innerHTML = '<i class="fas fa-star"></i><span>All Assets</span>';
                    } else {
                        btn.innerHTML = '<i class="fas fa-star"></i><span>Favorites</span>';
                    }
                    this.updateAssetList();
                });
                
                // Timeframe buttons
                document.querySelectorAll('.timeframe-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const timeframe = btn.getAttribute('data-tf');
                        this.selectTimeframe(timeframe, btn);
                    });
                });
            },
            
            // Toggle theme
            toggleTheme() {
                this.isDarkTheme = !this.isDarkTheme;
                document.body.classList.toggle('light-theme', !this.isDarkTheme);
                
                // Update theme toggle button
                const themeBtn = document.getElementById('theme-toggle');
                const icon = themeBtn.querySelector('i');
                const text = themeBtn.querySelector('span');
                
                if (this.isDarkTheme) {
                    icon.className = 'fas fa-moon';
                    text.textContent = 'Dark';
                } else {
                    icon.className = 'fas fa-sun';
                    text.textContent = 'Light';
                }
                
                // Reload chart with new theme
                if (this.tvWidget) {
                    this.loadTradingViewChart();
                }
            },
            
            // Take screenshot
            async takeScreenshot() {
                try {
                    // Create screenshot of signal panel
                    const signalPanel = document.querySelector('.signal-panel');
                    
                    // Use html2canvas for better screenshot quality
                    if (typeof html2canvas !== 'undefined') {
                        const canvas = await html2canvas(signalPanel, {
                            backgroundColor: this.isDarkTheme ? '#1e293b' : '#ffffff',
                            scale: 2
                        });
                        
                        // Convert to image and download
                        const link = document.createElement('a');
                        link.download = `RSI-Signal-${this.currentAsset}-${new Date().toISOString().slice(0,10)}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                        
                        // Show feedback
                        const originalText = document.getElementById('screenshot-btn').querySelector('span').textContent;
                        document.getElementById('screenshot-btn').querySelector('span').textContent = 'Saved!';
                        
                        setTimeout(() => {
                            document.getElementById('screenshot-btn').querySelector('span').textContent = originalText;
                        }, 2000);
                    } else {
                        // Fallback: Use TradingView screenshot
                        if (this.tvWidget && this.tvWidget.takeScreenshot) {
                            this.tvWidget.takeScreenshot();
                        }
                    }
                } catch (error) {
                    console.error('Screenshot error:', error);
                }
            },
            
            // Select timeframe
            async selectTimeframe(timeframe, button) {
                // Update active state
                document.querySelectorAll('.timeframe-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                button.classList.add('active');
                this.currentTimeframe = timeframe;
                
                // Update displays
                this.updateAllDisplays();
                
                // Reload TradingView chart
                await this.loadTradingViewChart();
            },
            
            // Create fallback chart
            createFallbackChart() {
                const chartContainer = document.getElementById('tradingview_chart');
                chartContainer.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--text-gray); padding: 20px; text-align: center;">
                        <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <div style="font-size: 1.1rem; margin-bottom: 10px;">Chart Loading...</div>
                        <div style="font-size: 0.9rem;">Real RSI analysis with coordinated updates</div>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(6, 182, 212, 0.1); border-radius: 8px; border-left: 3px solid var(--stochastic-cyan); font-size: 0.85rem;">
                            <div style="font-weight: bold; color: var(--stochastic-cyan); margin-bottom: 5px;">Current Signal:</div>
                            <div id="fallback-signal">Analyzing...</div>
                        </div>
                    </div>
                `;
            }
        };
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            RSIDashboard.init();
            
            // Add html2canvas for better screenshots
            const script = document.createElement('script');
            script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
            document.head.appendChild(script);
        });
    </script>
</body>
</html>
