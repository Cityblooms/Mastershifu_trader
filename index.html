<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeSignal Pro - Stable Market Analysis</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,sans-serif;background:#0f172a;color:#f1f5f9;padding:16px}.container{max-width:400px;margin:0 auto}.header{text-align:center;margin-bottom:20px}h1{font-size:22px;color:#3b82f6;margin-bottom:8px}.risk-warning{background:#7f1d1d20;border:1px solid #ef444440;border-radius:10px;padding:10px;margin-bottom:16px;font-size:12px;color:#fca5a5;text-align:center}.card{background:#1e293b;border-radius:14px;padding:18px;margin-bottom:16px}.form-group{margin-bottom:14px}label{display:block;margin-bottom:6px;color:#cbd5e1;font-size:14px}select{width:100%;padding:10px;background:#0f172a;border:1px solid #475569;border-radius:8px;color:white}.signal-box{padding:25px;text-align:center;border-radius:12px;font-size:32px;font-weight:700;margin:16px 0;transition:all 0.5s ease}.buy{background:linear-gradient(135deg,#052e16,#14532d);color:#22c55e;border:2px solid rgba(34,197,94,0.3)}.sell{background:linear-gradient(135deg,#450a0a,#7f1d1d);color:#ef4444;border:2px solid rgba(239,68,68,0.3)}.neutral{background:linear-gradient(135deg,#1e293b,#334155);color:#94a3b8;border:2px solid rgba(148,163,184,0.3)}.strong-buy{background:linear-gradient(135deg,#064e3b,#047857);color:#34d399;border:2px solid rgba(52,211,153,0.4);animation:pulse-green 2s infinite}.strong-sell{background:linear-gradient(135deg,#7c2d12,#c2410c);color:#fb923c;border:2px solid rgba(251,146,60,0.4);animation:pulse-red 2s infinite}@keyframes pulse-green{0%,100%{box-shadow:0 0 20px rgba(52,211,153,0.3)}50%{box-shadow:0 0 30px rgba(52,211,153,0.6)}}@keyframes pulse-red{0%,100%{box-shadow:0 0 20px rgba(251,146,60,0.3)}50%{box-shadow:0 0 30px rgba(251,146,60,0.6)}}.status{text-align:center;font-size:13px;color:#94a3b8;min-height:40px}.footer{text-align:center;margin-top:20px;font-size:12px;color:#64748b}.indicators-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:16px}.indicator{background:#0f172a;padding:8px;border-radius:8px;text-align:center}.indicator-label{font-size:10px;color:#94a3b8;margin-bottom:4px}.indicator-value{font-size:14px;font-weight:600}.signal-stability{background:#0f172a;border-radius:10px;padding:12px;margin-top:12px;font-size:11px}.stability-bar{height:6px;background:#334155;border-radius:3px;margin-top:8px;overflow:hidden}.stability-fill{height:100%;border-radius:3px;transition:width 1s ease}.stability-high{background:linear-gradient(90deg,#10b981,#34d399)}.stability-medium{background:linear-gradient(90deg,#f59e0b,#fbbf24)}.stability-low{background:linear-gradient(90deg,#ef4444,#f87171)}.confirmation-indicators{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:12px}.confirmation-indicator{padding:6px;border-radius:6px;text-align:center;font-size:10px}.confirmation-active{background:#14532d30;color:#22c55e;border:1px solid #22c55e30}.confirmation-inactive{background:#33415530;color:#94a3b8;border:1px solid #47556930}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>TradeSignal Pro</h1>
    <div style="font-size:14px;color:#94a3b8;">Stable Signal Analysis</div>
  </div>
  
  <div class="risk-warning">
    ‚ö† Educational Tool Only - Not financial advice. Use at your own risk.
  </div>
  
  <div class="card">
    <div class="form-group">
      <label>Market Pair</label>
      <select id="pair">
        <option value="EURUSD">EUR/USD</option>
        <option value="GBPUSD">GBP/USD</option>
        <option value="USDJPY">USD/JPY</option>
        <option value="XAUUSD">Gold (XAU/USD)</option>
        <option value="BTCUSD">Bitcoin (BTC/USD)</option>
        <option value="US30">US30 Index</option>
      </select>
    </div>
    
    <div class="form-group">
      <label>Timeframe</label>
      <select id="timeframe">
        <option value="15m">15 Minutes</option>
        <option value="30m">30 Minutes</option>
        <option value="1h">1 Hour</option>
        <option value="4h">4 Hours</option>
        <option value="1d">1 Day</option>
      </select>
    </div>
    
    <div id="signal" class="signal-box neutral">
      ANALYZING
    </div>
    
    <div id="status" class="status">
      Initializing stable signal analysis...
    </div>
    
    <div class="signal-stability">
      <div style="display:flex;justify-content:space-between;font-size:11px">
        <span>Signal Stability</span>
        <span id="stabilityValue">Calculating...</span>
      </div>
      <div class="stability-bar">
        <div id="stabilityFill" class="stability-fill" style="width:0%"></div>
      </div>
    </div>
    
    <div class="confirmation-indicators">
      <div id="confTrend" class="confirmation-indicator confirmation-inactive">TREND ‚úì</div>
      <div id="confRSI" class="confirmation-indicator confirmation-inactive">RSI ‚úì</div>
      <div id="confVol" class="confirmation-indicator confirmation-inactive">VOL ‚úì</div>
      <div id="confMomentum" class="confirmation-indicator confirmation-inactive">MOM ‚úì</div>
    </div>
    
    <div class="indicators-grid">
      <div class="indicator">
        <div class="indicator-label">RSI (14)</div>
        <div id="rsiValue" class="indicator-value">-</div>
      </div>
      <div class="indicator">
        <div class="indicator-label">Trend</div>
        <div id="trendValue" class="indicator-value">-</div>
      </div>
      <div class="indicator">
        <div class="indicator-label">Strength</div>
        <div id="strengthValue" class="indicator-value">-</div>
      </div>
    </div>
  </div>
  
  <div class="footer">
    TradeSignal Pro v3.0 | Stable Signal Engine<br>
    <div style="margin-top:8px;font-size:11px;color:#64748b;">
      ‚ö† Educational Tool Only | Stable algorithmic analysis
    </div>
  </div>
</div>

<script>
// ==================== STABLE SIGNAL ENGINE ====================
class StableSignalEngine {
  constructor() {
    // Signal state management
    this.currentSignal = 'NEUTRAL';
    this.signalHistory = [];
    this.confirmations = [];
    this.marketState = {};
    this.stabilityScore = 0;
    this.consecutiveSignals = 0;
    this.lastSignalChange = Date.now();
    
    // Market data initialization
    this.initializeMarketData();
    
    // Signal stabilization parameters
    this.STABILITY_THRESHOLDS = {
      HIGH: 75,      // Strong stable signal
      MEDIUM: 60,    // Moderate stability
      LOW: 40        // Low stability - stay neutral
    };
    
    this.MIN_CONFIRMATIONS = 3;     // Need 3/4 confirmations for valid signal
    this.MIN_HOLD_TIME = 10000;     // Hold signal for at least 10 seconds
    this.MAX_CONSECUTIVE = 5;       // Max consecutive same signals before reset
  }
  
  initializeMarketData() {
    this.marketData = {
      EURUSD: { price: 1.08542, trend: 'NEUTRAL', rsi: 50, volatility: 0.8 },
      GBPUSD: { price: 1.26580, trend: 'NEUTRAL', rsi: 50, volatility: 0.9 },
      USDJPY: { price: 150.325, trend: 'NEUTRAL', rsi: 50, volatility: 1.2 },
      XAUUSD: { price: 2185.42, trend: 'NEUTRAL', rsi: 50, volatility: 1.5 },
      BTCUSD: { price: 68420.50, trend: 'NEUTRAL', rsi: 50, volatility: 2.0 },
      US30: { price: 39245.75, trend: 'NEUTRAL', rsi: 50, volatility: 1.8 }
    };
    
    // Initialize history for each pair
    Object.keys(this.marketData).forEach(pair => {
      this.marketData[pair].priceHistory = Array(50).fill(this.marketData[pair].price);
      this.marketData[pair].rsiHistory = Array(50).fill(50);
      this.marketData[pair].signalHistory = [];
      this.marketData[pair].trendStrength = 0;
    });
  }
  
  // Calculate stable RSI with smoothing
  calculateStableRSI(prices) {
    if (prices.length < 30) return 50;
    
    // Use exponential smoothing for RSI calculation
    const period = 14;
    let gains = 0;
    let losses = 0;
    
    for (let i = prices.length - period; i < prices.length - 1; i++) {
      const change = prices[i + 1] - prices[i];
      if (change > 0) {
        gains += change;
      } else {
        losses -= change;
      }
    }
    
    const avgGain = gains / period;
    const avgLoss = losses / period || 1;
    const rs = avgGain / avgLoss;
    let rsi = 100 - (100 / (1 + rs));
    
    // Apply smoothing filter
    const prevRSI = prices.rsi || 50;
    rsi = (prevRSI * 0.3) + (rsi * 0.7); // 70% weight to new calculation
    
    return Math.max(0, Math.min(100, rsi));
  }
  
  // Determine stable trend with momentum
  determineStableTrend(prices) {
    if (prices.length < 20) return { direction: 'NEUTRAL', strength: 0 };
    
    // Multiple timeframe analysis
    const shortTerm = prices.slice(-10);
    const mediumTerm = prices.slice(-20);
    
    const shortAvg = shortTerm.reduce((a, b) => a + b, 0) / shortTerm.length;
    const mediumAvg = mediumTerm.reduce((a, b) => a + b, 0) / mediumTerm.length;
    
    // Calculate slopes
    const shortSlope = (shortTerm[shortTerm.length - 1] - shortTerm[0]) / shortTerm.length;
    const mediumSlope = (mediumTerm[mediumTerm.length - 1] - mediumTerm[0]) / mediumTerm.length;
    
    // Determine trend direction
    let direction = 'NEUTRAL';
    let strength = 0;
    
    if (shortSlope > 0 && mediumSlope > 0) {
      direction = 'BULLISH';
      strength = Math.abs(shortSlope + mediumSlope) * 1000;
    } else if (shortSlope < 0 && mediumSlope < 0) {
      direction = 'BEARISH';
      strength = Math.abs(shortSlope + mediumSlope) * 1000;
    }
    
    // Normalize strength (0-100)
    strength = Math.min(100, Math.max(0, strength));
    
    return { direction, strength };
  }
  
  // Check signal confirmations
  checkConfirmations(pairData, rsi, trend) {
    const confirmations = [];
    
    // 1. Trend Confirmation
    const trendConfirmation = (
      (trend.direction === 'BULLISH' && rsi > 45 && rsi < 70) ||
      (trend.direction === 'BEARISH' && rsi > 30 && rsi < 55)
    ) && trend.strength > 40;
    
    confirmations.push({
      name: 'TREND',
      active: trendConfirmation,
      weight: 30
    });
    
    // 2. RSI Confirmation
    const rsiConfirmation = (
      (rsi < 35) ||                    // Oversold
      (rsi > 65) ||                    // Overbought
      (rsi > 50 && rsi < 65 && trend.direction === 'BULLISH') ||  // Bullish zone
      (rsi > 35 && rsi < 50 && trend.direction === 'BEARISH')     // Bearish zone
    );
    
    confirmations.push({
      name: 'RSI',
      active: rsiConfirmation,
      weight: 25
    });
    
    // 3. Volatility Confirmation
    const volatility = this.calculateVolatility(pairData.priceHistory);
    const volConfirmation = volatility < 2.0; // Moderate volatility
    
    confirmations.push({
      name: 'VOL',
      active: volConfirmation,
      weight: 20
    });
    
    // 4. Momentum Confirmation
    const momentum = this.calculateMomentum(pairData.priceHistory);
    const momConfirmation = Math.abs(momentum) > 0.1;
    
    confirmations.push({
      name: 'MOMENTUM',
      active: momConfirmation,
      weight: 25
    });
    
    return confirmations;
  }
  
  calculateVolatility(prices) {
    if (prices.length < 20) return 1;
    
    const returns = [];
    for (let i = 1; i < prices.length; i++) {
      returns.push((prices[i] - prices[i-1]) / prices[i-1]);
    }
    
    const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
    const variance = returns.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / returns.length;
    
    return Math.sqrt(variance) * 100; // Return as percentage
  }
  
  calculateMomentum(prices) {
    if (prices.length < 10) return 0;
    
    const shortPeriod = 5;
    const longPeriod = 10;
    
    const shortAvg = prices.slice(-shortPeriod).reduce((a, b) => a + b, 0) / shortPeriod;
    const longAvg = prices.slice(-longPeriod).reduce((a, b) => a + b, 0) / longPeriod;
    
    return ((shortAvg - longAvg) / longAvg) * 100;
  }
  
  // Generate stable signal with filters
  generateStableSignal(pair) {
    const pairData = this.marketData[pair];
    
    // Simulate market movement
    this.simulateMarketMovement(pair);
    
    // Calculate indicators
    const rsi = this.calculateStableRSI(pairData.priceHistory);
    const trend = this.determineStableTrend(pairData.priceHistory);
    const confirmations = this.checkConfirmations(pairData, rsi, trend);
    
    // Update pair data
    pairData.rsi = rsi;
    pairData.trend = trend.direction;
    pairData.trendStrength = trend.strength;
    
    // Calculate stability score
    const activeConfirmations = confirmations.filter(c => c.active);
    const totalWeight = confirmations.reduce((sum, c) => sum + c.weight, 0);
    const activeWeight = activeConfirmations.reduce((sum, c) => sum + c.weight, 0);
    
    this.stabilityScore = Math.round((activeWeight / totalWeight) * 100);
    this.confirmations = confirmations;
    
    // Determine preliminary signal
    let preliminarySignal = 'NEUTRAL';
    let signalStrength = 'WEAK';
    
    if (this.stabilityScore >= this.STABILITY_THRESHOLDS.HIGH) {
      signalStrength = 'STRONG';
      
      // Strong signal logic
      if (trend.direction === 'BULLISH' && rsi > 50 && rsi < 70) {
        preliminarySignal = 'BUY';
      } else if (trend.direction === 'BEARISH' && rsi > 30 && rsi < 50) {
        preliminarySignal = 'SELL';
      } else if (rsi < 30) {
        preliminarySignal = 'BUY';
      } else if (rsi > 70) {
        preliminarySignal = 'SELL';
      }
    } else if (this.stabilityScore >= this.STABILITY_THRESHOLDS.MEDIUM) {
      signalStrength = 'MEDIUM';
      
      // Medium signal logic
      if (trend.direction === 'BULLISH' && rsi > 55 && rsi < 65) {
        preliminarySignal = 'BUY';
      } else if (trend.direction === 'BEARISH' && rsi > 35 && rsi < 45) {
        preliminarySignal = 'SELL';
      }
    }
    
    // Apply signal stabilization filters
    const finalSignal = this.applyStabilizationFilters(preliminarySignal, signalStrength);
    
    return {
      signal: finalSignal,
      rsi,
      trend: trend.direction,
      trendStrength: trend.strength,
      stability: this.stabilityScore,
      confirmations,
      signalStrength,
      price: pairData.price
    };
  }
  
  // Stabilization filters to prevent signal flipping
  applyStabilizationFilters(newSignal, signalStrength) {
    const now = Date.now();
    const timeSinceChange = now - this.lastSignalChange;
    
    // Filter 1: Minimum hold time
    if (timeSinceChange < this.MIN_HOLD_TIME && this.currentSignal !== 'NEUTRAL') {
      return this.currentSignal; // Keep current signal
    }
    
    // Filter 2: Stability threshold
    if (this.stabilityScore < this.STABILITY_THRESHOLDS.MEDIUM && newSignal !== 'NEUTRAL') {
      return 'NEUTRAL'; // Not stable enough for directional signal
    }
    
    // Filter 3: Consecutive signal limit
    if (newSignal === this.currentSignal && newSignal !== 'NEUTRAL') {
      this.consecutiveSignals++;
      if (this.consecutiveSignals > this.MAX_CONSECUTIVE) {
        this.consecutiveSignals = 0;
        return 'NEUTRAL'; // Reset after too many consecutive signals
      }
    } else {
      this.consecutiveSignals = 1;
    }
    
    // Filter 4: Strong signal override
    if (signalStrength === 'STRONG' && this.stabilityScore >= this.STABILITY_THRESHOLDS.HIGH) {
      // Allow strong signals to override
      this.lastSignalChange = now;
      this.currentSignal = newSignal;
      return newSignal;
    }
    
    // Filter 5: Medium signals only if current is neutral
    if (signalStrength === 'MEDIUM' && this.currentSignal === 'NEUTRAL') {
      this.lastSignalChange = now;
      this.currentSignal = newSignal;
      return newSignal;
    }
    
    // Default: maintain current signal
    return this.currentSignal;
  }
  
  simulateMarketMovement(pair) {
    const data = this.marketData[pair];
    
    // Realistic price movement with mean reversion
    const volatility = data.volatility * 0.001;
    const randomMove = (Math.random() - 0.5) * 2 * volatility;
    
    // Add slight drift based on trend
    let drift = 0;
    if (data.trend === 'BULLISH') drift = volatility * 0.1;
    if (data.trend === 'BEARISH') drift = -volatility * 0.1;
    
    // Update price
    data.price = data.price * (1 + randomMove + drift);
    data.priceHistory.push(data.price);
    if (data.priceHistory.length > 100) data.priceHistory.shift();
    
    // Update RSI history
    data.rsiHistory.push(data.rsi);
    if (data.rsiHistory.length > 100) data.rsiHistory.shift();
  }
}

// ==================== APPLICATION INITIALIZATION ====================
const signalEngine = new StableSignalEngine();

function updateUI() {
  const pair = document.getElementById('pair').value;
  const analysis = signalEngine.generateStableSignal(pair);
  
  // Update signal display
  const signalBox = document.getElementById('signal');
  signalBox.textContent = analysis.signal;
  
  // Set signal class based on strength and stability
  let signalClass = analysis.signal.toLowerCase();
  if (analysis.signalStrength === 'STRONG') {
    signalClass = analysis.signal === 'BUY' ? 'strong-buy' : 
                  analysis.signal === 'SELL' ? 'strong-sell' : 'neutral';
  }
  signalBox.className = `signal-box ${signalClass}`;
  
  // Update status with detailed information
  const priceFormat = pair.includes('XAU') ? 2 : 
                     pair.includes('BTC') ? 2 : 
                     pair.includes('US30') ? 2 :
                     pair.includes('USDJPY') ? 3 : 5;
  
  const trendText = analysis.trend === 'BULLISH' ? 'üìà Bullish' : 
                   analysis.trend === 'BEARISH' ? 'üìâ Bearish' : '‚û°Ô∏è Neutral';
  
  document.getElementById('status').innerHTML = `
    ${pair} @ ${analysis.price.toFixed(priceFormat)}<br>
    ${trendText} (${analysis.trendStrength.toFixed(0)}%) | 
    Stability: ${analysis.stability}%
  `;
  
  // Update stability indicator
  document.getElementById('stabilityValue').textContent = `${analysis.stability}%`;
  const stabilityFill = document.getElementById('stabilityFill');
  stabilityFill.style.width = `${analysis.stability}%`;
  
  // Set stability color
  stabilityFill.className = 'stability-fill ';
  if (analysis.stability >= 75) {
    stabilityFill.classList.add('stability-high');
  } else if (analysis.stability >= 60) {
    stabilityFill.classList.add('stability-medium');
  } else {
    stabilityFill.classList.add('stability-low');
  }
  
  // Update confirmation indicators
  analysis.confirmations.forEach((conf, index) => {
    const indicator = document.getElementById(`conf${conf.name}`);
    if (indicator) {
      indicator.className = `confirmation-indicator ${conf.active ? 'confirmation-active' : 'confirmation-inactive'}`;
      indicator.textContent = `${conf.name} ${conf.active ? '‚úì' : '‚úó'}`;
    }
  });
  
  // Update indicator values
  document.getElementById('rsiValue').textContent = analysis.rsi.toFixed(1);
  const rsiColor = analysis.rsi > 70 ? '#ef4444' : analysis.rsi < 30 ? '#22c55e' : '#facc15';
  document.getElementById('rsiValue').style.color = rsiColor;
  
  document.getElementById('trendValue').textContent = analysis.trend;
  const trendColor = analysis.trend === 'BULLISH' ? '#22c55e' : 
                     analysis.trend === 'BEARISH' ? '#ef4444' : '#94a3b8';
  document.getElementById('trendValue').style.color = trendColor;
  
  document.getElementById('strengthValue').textContent = analysis.signalStrength;
  const strengthColor = analysis.signalStrength === 'STRONG' ? '#22c55e' : 
                        analysis.signalStrength === 'MEDIUM' ? '#facc15' : '#ef4444';
  document.getElementById('strengthValue').style.color = strengthColor;
}

// ==================== EVENT HANDLERS ====================
document.getElementById('pair').addEventListener('change', updateUI);
document.getElementById('timeframe').addEventListener('change', updateUI);

// Initial update
setTimeout(updateUI, 500);

// Regular updates (slower for stability)
setInterval(updateUI, 3000); // Update every 3 seconds instead of faster

// Show initialization status
document.getElementById('status').textContent = "Initializing stable signal engine...";
</script>
</body>
</html>
