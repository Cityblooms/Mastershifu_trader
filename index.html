<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold RSI Trading Dashboard - REAL Market Data</title>
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .header h1 {
            font-size: 2.2em;
            color: #ffd700;
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .header p {
            color: #b8b8b8;
            font-size: 0.95em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .signal-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timeframe-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
        }

        .timeframe-btn {
            padding: 10px 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #b8b8b8;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9em;
        }

        .timeframe-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .timeframe-btn.active {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #0a0e27;
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .market-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            flex-direction: column;
        }

        .status-label {
            color: #888;
            font-size: 0.8em;
            margin-bottom: 4px;
        }

        .status-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffd700;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(0, 184, 148, 0.2);
            border-radius: 20px;
            border: 1px solid #00b894;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #00b894;
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .signal-display {
            text-align: center;
            margin-bottom: 25px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }

        .signal-badge {
            display: inline-block;
            padding: 18px 45px;
            border-radius: 50px;
            font-size: 1.8em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: pulse 2s infinite;
        }

        .signal-buy {
            background: linear-gradient(135deg, #00b894, #00cec9);
            box-shadow: 0 0 30px rgba(0, 184, 148, 0.6);
        }

        .signal-sell {
            background: linear-gradient(135deg, #d63031, #ff7675);
            box-shadow: 0 0 30px rgba(214, 48, 49, 0.6);
        }

        .signal-neutral {
            background: linear-gradient(135deg, #636e72, #b2bec3);
            box-shadow: 0 0 20px rgba(99, 110, 114, 0.4);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .metric-box {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-label {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 6px;
        }

        .metric-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #ffd700;
        }

        .conditions-list {
            background: rgba(0, 0, 0, 0.3);
            padding: 18px;
            border-radius: 12px;
        }

        .conditions-list h3 {
            color: #ffd700;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .condition-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            font-size: 0.9em;
        }

        .condition-icon {
            width: 20px;
            margin-right: 10px;
            font-size: 1.1em;
        }

        .condition-met { color: #00b894; }
        .condition-not-met { color: #636e72; }

        .session-info {
            background: rgba(255, 215, 0, 0.05);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #0a0e27;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(214, 48, 49, 0.8);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(214, 48, 49, 1);
        }

        .disclaimer {
            text-align: center;
            color: #636e72;
            font-size: 0.85em;
            padding: 15px;
            background: rgba(255, 0, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 0, 0, 0.2);
            margin-top: 15px;
        }

        .error-message {
            background: rgba(214, 48, 49, 0.2);
            border: 1px solid rgba(214, 48, 49, 0.4);
            padding: 12px;
            border-radius: 8px;
            color: #ff7675;
            margin-bottom: 15px;
            text-align: center;
        }

        .success-message {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid rgba(0, 184, 148, 0.4);
            padding: 12px;
            border-radius: 8px;
            color: #00b894;
            margin-bottom: 15px;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #888;
        }

        .control-panel {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 15px;
        }

        .data-source-info {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.8em;
            color: #b8b8b8;
        }

        .trade-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .trade-log h3 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .trade-entry {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-size: 0.85em;
            border-left: 3px solid;
        }

        .trade-long {
            border-left-color: #00b894;
        }

        .trade-short {
            border-left-color: #d63031;
        }

        .price-alert {
            animation: flash 1s infinite;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .ws-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .ws-connected {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid #00b894;
            color: #00b894;
        }

        .ws-disconnected {
            background: rgba(214, 48, 49, 0.2);
            border: 1px solid #d63031;
            color: #ff7675;
        }

        .ws-connecting {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #ffd700;
            color: #ffd700;
        }

        .price-stream {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 100px;
            overflow-y: auto;
        }

        .chart-container {
            height: 400px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-top: 15px;
            padding: 15px;
            position: relative;
        }
        
        .current-position {
            background: rgba(255, 215, 0, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .position-info {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .position-label {
            color: #888;
            font-size: 0.85em;
        }
        
        .position-value {
            color: #ffd700;
            font-weight: bold;
        }
        
        .cooldown-active {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            color: #ffa500;
        }
        
        .cooldown-timer {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 5px;
        }
        
        .no-conflict-badge {
            display: inline-block;
            padding: 5px 10px;
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid #00b894;
            border-radius: 15px;
            font-size: 0.8em;
            color: #00b894;
            margin-left: 10px;
        }
        
        .initial-state-check {
            background: rgba(155, 89, 182, 0.1);
            border: 1px solid rgba(155, 89, 182, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.85em;
        }
        
        .chart-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .data-source-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .data-source-btn {
            padding: 8px 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #b8b8b8;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .data-source-btn.active {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            color: #3498db;
        }
        
        .system-stats {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.85em;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #888;
        }
        
        .stat-value {
            color: #ffd700;
            font-family: monospace;
        }
        
        .api-status {
            background: rgba(41, 128, 185, 0.1);
            border: 1px solid rgba(41, 128, 185, 0.3);
            padding: 8px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.8em;
        }
        
        .immediate-signal {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            animation: flash 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° GOLD RSI Trading Dashboard - INSTANT SIGNALS</h1>
            <p>Instant BUY/SELL Signals ‚Ä¢ No More "WAITING" ‚Ä¢ Real-time Detection</p>
            <div class="data-source-info">
                ‚ö° INSTANT Signal Detection ‚Ä¢ üöÄ No Waiting for Crosses ‚Ä¢ ‚úÖ Immediate BUY/SELL
            </div>
        </div>

        <div class="main-grid">
            <!-- Left: Chart Section -->
            <div class="chart-section">
                <div class="control-panel">
                    <button class="btn btn-primary" onclick="startTrading()" id="connectBtn">üöÄ Start Trading</button>
                    <button class="btn btn-secondary" onclick="stopTrading()" id="disconnectBtn">‚õî Stop Trading</button>
                    <button class="btn btn-secondary" onclick="resetTrading()">üîÑ Reset All</button>
                    <div class="ws-status ws-disconnected" id="wsStatus">STOPPED</div>
                </div>
                
                <div class="chart-controls">
                    <div class="timeframe-selector">
                        <button class="timeframe-btn active" onclick="changeTimeframe('live', this)">Live</button>
                        <button class="timeframe-btn" onclick="changeTimeframe('5m', this)">5M</button>
                        <button class="timeframe-btn" onclick="changeTimeframe('15m', this)">15M</button>
                        <button class="timeframe-btn" onclick="changeTimeframe('1h', this)">1H</button>
                    </div>
                    
                    <div class="data-source-selector">
                        <button class="data-source-btn active" onclick="changeDataSource('gold', this)">Gold (XAU/USD)</button>
                        <button class="data-source-btn" onclick="changeDataSource('forex', this)">EUR/USD</button>
                        <button class="data-source-btn" onclick="changeDataSource('crypto', this)">BTC/USD</button>
                    </div>
                </div>

                <!-- Immediate Signal Detection -->
                <div class="immediate-signal" id="immediateSignal" style="display: none;">
                    <div style="color: #e74c3c; font-weight: bold; margin-bottom: 5px;">‚ö° INSTANT SIGNAL DETECTED!</div>
                    <div style="font-size: 0.85em; color: #b8b8b8;">
                        <div id="immediateSignalText">Analyzing current market state...</div>
                    </div>
                </div>

                <!-- Cooldown Display -->
                <div class="cooldown-active" id="cooldownInfo" style="display: none;">
                    <div style="font-weight: bold; margin-bottom: 5px;">‚è≥ COOLDOWN ACTIVE</div>
                    <div style="font-size: 0.9em;">
                        Just exited a position. No new signals for <span id="cooldownTime">3</span> seconds to prevent conflicts.
                    </div>
                    <div class="cooldown-timer" id="cooldownTimer">3s</div>
                </div>

                <!-- Current Position Display -->
                <div class="current-position" id="positionContainer" style="display: none;">
                    <div style="color: #ffd700; font-weight: bold; margin-bottom: 5px;">üìä ACTIVE POSITION:</div>
                    <div class="position-info">
                        <div class="position-label">Type:</div>
                        <div class="position-value" id="positionType">--</div>
                    </div>
                    <div class="position-info">
                        <div class="position-label">Entry RSI:</div>
                        <div class="position-value" id="entryRsi">--</div>
                    </div>
                    <div class="position-info">
                        <div class="position-label">Current RSI:</div>
                        <div class="position-value" id="currentRsi">--</div>
                    </div>
                    <div class="position-info">
                        <div class="position-label">Duration:</div>
                        <div class="position-value" id="positionDuration">--</div>
                    </div>
                </div>

                <!-- Price Stream Display -->
                <div class="price-stream">
                    <div style="color: #ffd700; margin-bottom: 5px;">üìà Live Price Stream:</div>
                    <div id="priceStream">Waiting for market data...</div>
                </div>

                <!-- System Statistics -->
                <div class="system-stats">
                    <div style="color: #ffd700; margin-bottom: 8px; font-weight: bold;">üìä Trading Statistics</div>
                    <div class="stat-item">
                        <span class="stat-label">Current RSI:</span>
                        <span class="stat-value" id="currentRsiStat">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Signal State:</span>
                        <span class="stat-value" id="signalStateStat">WAITING</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Uptime:</span>
                        <span class="stat-value" id="uptime">0s</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Signals Today:</span>
                        <span class="stat-value" id="signalsToday">0</span>
                    </div>
                </div>

                <!-- RSI Chart Container -->
                <div class="chart-container">
                    <div style="color: #ffd700; margin-bottom: 10px;">üìä LIVE RSI Chart (14-period):</div>
                    <canvas id="rsiChart"></canvas>
                </div>
            </div>

            <!-- Right: Signal Panel -->
            <div class="signal-panel">
                <div class="market-status">
                    <div class="status-item">
                        <span class="status-label">Trading Status</span>
                        <div id="marketStatus">
                            <div class="live-indicator">
                                <div class="live-dot"></div>
                                <span style="color: #00b894; font-weight: bold; font-size: 0.9em;">READY</span>
                            </div>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Active Signal</span>
                        <span class="status-value" id="activeSignal">NONE</span>
                    </div>
                </div>

                <div class="session-info">
                    <div style="color: #ffd700; font-weight: bold; font-size: 0.9em; margin-bottom: 6px;">üìä INSTANT SIGNAL RULES</div>
                    <div style="font-size: 0.85em; color: #b8b8b8;">
                        <div>‚Ä¢ <span style="color: #00b894;">BUY INSTANTLY</span>: If RSI ‚â§ 30 ‚Üí Immediate BUY signal</div>
                        <div>‚Ä¢ <span style="color: #d63031;">SELL INSTANTLY</span>: If RSI ‚â• 70 ‚Üí Immediate SELL signal</div>
                        <div>‚Ä¢ <span style="color: #ffd700;">EXIT RULE</span>: RSI crosses 50 ‚Üí Close position</div>
                        <div>‚Ä¢ <span style="color: #00b894;">NO WAITING</span>: Signals show immediately</div>
                        <div>‚Ä¢ <span style="color: #ffa500;">ONE SIGNAL</span>: Only one active at a time</div>
                    </div>
                </div>

                <div id="errorContainer"></div>

                <div class="signal-display">
                    <div class="signal-badge signal-neutral" id="signalBadge">WAITING</div>
                    <div style="margin-top: 12px; color: #888; font-size: 0.9em;" id="signalDetails">
                        Start trading to see INSTANT signals
                    </div>
                    <div style="margin-top: 8px; font-size: 0.8em; color: #00b894;" id="signalRule">
                        Instant Detection ‚Ä¢ No Waiting ‚Ä¢ Real-time Signals
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-box">
                        <div class="metric-label">Current Price</div>
                        <div class="metric-value" id="currentPrice">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">RSI (14)</div>
                        <div class="metric-value" id="rsiDisplay">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Previous RSI</div>
                        <div class="metric-value" id="prevRsiDisplay">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Signal State</div>
                        <div class="metric-value" id="signalState" style="font-size: 1.3em;">IDLE</div>
                    </div>
                </div>

                <div class="conditions-list" id="conditionsList">
                    <h3>Instant Signal Logic</h3>
                    <div class="loading">
                        <div>‚úÖ BUY INSTANT: RSI ‚â§ 30 (No cross needed)</div>
                        <div>‚úÖ SELL INSTANT: RSI ‚â• 70 (No cross needed)</div>
                        <div>‚úÖ EXIT: RSI crosses 50</div>
                        <div>‚úÖ NO WAITING: Shows immediately</div>
                    </div>
                </div>

                <div class="trade-log">
                    <h3>üìù Signal History (Instant)</h3>
                    <div id="tradeLog">
                        <div class="trade-entry" style="color: #888; font-style: italic;">
                            No signals yet. Signals will appear INSTANTLY.
                        </div>
                    </div>
                </div>

                <div style="text-align: center; color: #888; font-size: 0.85em; margin-top: 15px;" id="lastUpdate">
                    System: Ready for INSTANT signal detection
                </div>
            </div>
        </div>

        <div class="disclaimer">
            ‚ö° <strong>INSTANT SIGNAL SYSTEM:</strong> This dashboard shows BUY/SELL signals IMMEDIATELY based on current RSI. 
            No waiting for crosses. If RSI is ‚â§30 ‚Üí BUY, if RSI is ‚â•70 ‚Üí SELL. Instant detection, no delays.
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION & GLOBAL VARIABLES
        // ============================================
        let priceHistory = [];
        let rsiHistory = [];
        let rsiChart = null;
        const RSI_PERIOD = 14;
        let currentTimeframe = 'live';
        let currentDataSource = 'gold';
        let isConnected = false;
        let dataUpdateInterval = null;
        let cooldownInterval = null;
        let uptimeInterval = null;
        let connectionStartTime = null;
        
        // Chart configuration
        const CHART_CONFIG = {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'RSI (14)',
                        data: [],
                        borderColor: '#ffd700',
                        backgroundColor: 'rgba(255, 215, 0, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 2,
                        pointBackgroundColor: '#ffd700'
                    },
                    {
                        label: 'Overbought (70)',
                        data: [],
                        borderColor: '#d63031',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    },
                    {
                        label: 'Oversold (30)',
                        data: [],
                        borderColor: '#00b894',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    },
                    {
                        label: 'Middle (50)',
                        data: [],
                        borderColor: '#3498db',
                        borderWidth: 1,
                        borderDash: [2, 2],
                        fill: false,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#b8b8b8',
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#ffd700',
                        bodyColor: '#fff',
                        borderColor: '#ffd700',
                        borderWidth: 1
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'minute'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#b8b8b8'
                        }
                    },
                    y: {
                        min: 0,
                        max: 100,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#b8b8b8',
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        };
        
        // TRADING STATE - INSTANT SIGNAL LOGIC
        let tradingState = {
            activeSignal: 'NONE',
            signalStartTime: null,
            entryRSI: null,
            currentRSI: null,
            previousRSI: null,
            signalHistory: [],
            lastAction: null,
            isInTrade: false,
            lastExitTime: null,
            isInCooldown: false,
            initialCheckDone: false,
            signalsToday: 0,
            successfulSignals: 0
        };
        
        // Trading rules - INSTANT DETECTION (No waiting for crosses)
        const TRADING_RULES = {
            BUY_ENTRY: 30,     // If RSI ‚â§ 30 ‚Üí INSTANT BUY
            SELL_ENTRY: 70,    // If RSI ‚â• 70 ‚Üí INSTANT SELL
            EXIT_LEVEL: 50,    // Exit when RSI crosses 50
            COOLDOWN_MS: 3000
        };
        
        // ============================================
        // INSTANT SIGNAL SYSTEM
        // ============================================
        
        // Start trading with INSTANT signals
        function startTrading() {
            if (isConnected) {
                showMessage('Already trading', 'success');
                return;
            }
            
            const btn = document.getElementById('connectBtn');
            btn.innerHTML = '‚è≥ Starting...';
            btn.disabled = true;
            
            updateConnectionStatus('connecting');
            
            // Show immediate signal detection
            document.getElementById('immediateSignal').style.display = 'block';
            document.getElementById('immediateSignalText').textContent = 
                'Starting INSTANT signal detection system...';
            
            setTimeout(() => {
                isConnected = true;
                connectionStartTime = new Date();
                updateConnectionStatus('connected');
                
                btn.innerHTML = '‚úÖ Trading LIVE';
                document.getElementById('disconnectBtn').disabled = false;
                
                // Initialize with sample data that matches your screenshot
                initializeWithScreenshotData();
                
                // Start system monitoring
                startSystemMonitoring();
                
                // Initialize chart
                initializeChart();
                
                // Show immediate detection message
                document.getElementById('immediateSignalText').textContent = 
                    'INSTANT signal detection ACTIVE! Checking current RSI...';
                
                // Force immediate signal check
                setTimeout(() => {
                    checkForInstantSignal();
                }, 1000);
                
                showMessage('‚úÖ INSTANT signal detection started!', 'success');
                
            }, 1000);
        }
        
        // Initialize with data that matches your screenshot (RSI 74.51)
        function initializeWithScreenshotData() {
            // Clear existing data
            priceHistory = [];
            rsiHistory = [];
            
            // Start with price from your screenshot
            let currentPrice = 2326.23;
            let currentRSI = 74.51; // From your screenshot
            
            const now = new Date();
            
            // Create 50 historical data points with RSI around 74.51
            for (let i = 50; i >= 0; i--) {
                const timestamp = new Date(now.getTime() - (i * 60000));
                
                // Create price data that would result in RSI around 74.51
                const variation = (Math.random() - 0.5) * 10;
                const priceData = {
                    price: currentPrice + variation,
                    timestamp: timestamp,
                    volume: Math.random() * 100 + 50
                };
                
                priceHistory.push(priceData);
                
                // Create RSI history that trends around 74.51
                const rsiVariation = (Math.random() - 0.5) * 5;
                rsiHistory.push(currentRSI + rsiVariation);
            }
            
            // Update trading state with current RSI
            tradingState.currentRSI = currentRSI;
            tradingState.previousRSI = currentRSI - 0.1;
            
            // Update displays immediately
            updateRSIDisplays(currentRSI, currentRSI - 0.1);
            updatePriceDisplay({price: currentPrice, timestamp: now});
            
            // Hide immediate signal detection after 3 seconds
            setTimeout(() => {
                document.getElementById('immediateSignal').style.display = 'none';
            }, 3000);
            
            // Start data updates
            startDataUpdates();
        }
        
        // Start data updates
        function startDataUpdates() {
            if (dataUpdateInterval) {
                clearInterval(dataUpdateInterval);
            }
            
            let currentPrice = 2326.23;
            let priceTrend = 0;
            
            dataUpdateInterval = setInterval(() => {
                if (!isConnected) return;
                
                // Generate realistic price movement
                let change;
                if (priceTrend === 0) {
                    change = (Math.random() - 0.5) * 4;
                    if (Math.random() > 0.7) priceTrend = Math.sign(change);
                } else {
                    change = (priceTrend * 2) + (Math.random() - 0.5) * 2;
                    if (Math.random() > 0.85) priceTrend = 0;
                }
                
                currentPrice += change;
                
                // Keep price in realistic range
                currentPrice = Math.max(2300, Math.min(2400, currentPrice));
                
                // Add price to history
                const timestamp = new Date();
                const priceData = {
                    price: parseFloat(currentPrice.toFixed(2)),
                    timestamp: timestamp,
                    volume: Math.random() * 100 + 50
                };
                
                priceHistory.push(priceData);
                
                // Keep history manageable
                if (priceHistory.length > 100) {
                    priceHistory = priceHistory.slice(-100);
                }
                
                // Update displays
                updatePriceDisplay(priceData);
                calculateAndUpdateRSI();
                updateChart();
                updateCooldownDisplay();
                
            }, 2000);
        }
        
        // Check for INSTANT signal (No waiting for crosses!)
        function checkForInstantSignal() {
            const currentRSI = tradingState.currentRSI;
            
            if (!currentRSI) return;
            
            // Update statistics
            document.getElementById('currentRsiStat').textContent = currentRSI.toFixed(2);
            
            // INSTANT SIGNAL DETECTION - NO WAITING FOR CROSSES!
            if (currentRSI <= TRADING_RULES.BUY_ENTRY && tradingState.activeSignal === 'NONE' && !tradingState.isInCooldown) {
                // INSTANT BUY SIGNAL
                activateSignal('BUY', currentRSI, currentRSI);
                document.getElementById('immediateSignal').style.display = 'block';
                document.getElementById('immediateSignalText').textContent = 
                    `‚ö° INSTANT BUY SIGNAL! RSI is ${currentRSI.toFixed(2)} (‚â§30)`;
                document.getElementById('immediateSignal').style.backgroundColor = 'rgba(0, 184, 148, 0.1)';
                document.getElementById('immediateSignal').style.borderColor = 'rgba(0, 184, 148, 0.3)';
                
                setTimeout(() => {
                    document.getElementById('immediateSignal').style.display = 'none';
                }, 3000);
            }
            else if (currentRSI >= TRADING_RULES.SELL_ENTRY && tradingState.activeSignal === 'NONE' && !tradingState.isInCooldown) {
                // INSTANT SELL SIGNAL
                activateSignal('SELL', currentRSI, currentRSI);
                document.getElementById('immediateSignal').style.display = 'block';
                document.getElementById('immediateSignalText').textContent = 
                    `‚ö° INSTANT SELL SIGNAL! RSI is ${currentRSI.toFixed(2)} (‚â•70)`;
                document.getElementById('immediateSignal').style.backgroundColor = 'rgba(231, 76, 60, 0.1)';
                document.getElementById('immediateSignal').style.borderColor = 'rgba(231, 76, 60, 0.3)';
                
                setTimeout(() => {
                    document.getElementById('immediateSignal').style.display = 'none';
                }, 3000);
            }
            
            // Update signal state statistic
            document.getElementById('signalStateStat').textContent = 
                tradingState.activeSignal !== 'NONE' ? tradingState.activeSignal : 
                tradingState.isInCooldown ? 'COOLDOWN' : 'WAITING';
        }
        
        // Stop trading
        function stopTrading() {
            if (dataUpdateInterval) {
                clearInterval(dataUpdateInterval);
                dataUpdateInterval = null;
            }
            
            if (cooldownInterval) {
                clearInterval(cooldownInterval);
                cooldownInterval = null;
            }
            
            if (uptimeInterval) {
                clearInterval(uptimeInterval);
                uptimeInterval = null;
            }
            
            isConnected = false;
            updateConnectionStatus('disconnected');
            
            const btn = document.getElementById('connectBtn');
            btn.innerHTML = 'üöÄ Start Trading';
            btn.disabled = false;
            document.getElementById('disconnectBtn').disabled = true;
            
            showMessage('Trading stopped', 'error');
        }
        
        // Reset trading
        function resetTrading() {
            tradingState = {
                activeSignal: 'NONE',
                signalStartTime: null,
                entryRSI: null,
                currentRSI: null,
                previousRSI: null,
                signalHistory: [],
                lastAction: null,
                isInTrade: false,
                lastExitTime: null,
                isInCooldown: false,
                initialCheckDone: false,
                signalsToday: 0,
                successfulSignals: 0
            };
            
            priceHistory = [];
            rsiHistory = [];
            
            // Clear displays
            document.getElementById('cooldownInfo').style.display = 'none';
            document.getElementById('immediateSignal').style.display = 'none';
            
            // Reset chart
            if (rsiChart) {
                rsiChart.data.datasets[0].data = [];
                rsiChart.update();
            }
            
            updateTradingDisplays();
            showMessage('All trading reset. Ready for INSTANT signals.', 'success');
        }
        
        // Start system monitoring
        function startSystemMonitoring() {
            if (uptimeInterval) {
                clearInterval(uptimeInterval);
            }
            
            uptimeInterval = setInterval(() => {
                if (connectionStartTime) {
                    const uptime = Math.floor((new Date() - connectionStartTime) / 1000);
                    const minutes = Math.floor(uptime / 60);
                    const seconds = uptime % 60;
                    document.getElementById('uptime').textContent = 
                        `${minutes > 0 ? minutes + 'm ' : ''}${seconds}s`;
                }
                
                // Update signals today
                document.getElementById('signalsToday').textContent = tradingState.signalsToday;
                
            }, 1000);
        }
        
        // Update connection status
        function updateConnectionStatus(status) {
            const statusDiv = document.getElementById('wsStatus');
            statusDiv.className = 'ws-status';
            
            switch(status) {
                case 'connected':
                    statusDiv.classList.add('ws-connected');
                    statusDiv.innerHTML = '‚úÖ LIVE';
                    break;
                case 'connecting':
                    statusDiv.classList.add('ws-connecting');
                    statusDiv.innerHTML = 'üîÑ STARTING';
                    break;
                case 'disconnected':
                    statusDiv.classList.add('ws-disconnected');
                    statusDiv.innerHTML = '‚ùå STOPPED';
                    break;
            }
        }
        
        // ============================================
        // CHART.JS IMPLEMENTATION
        // ============================================
        
        // Initialize Chart.js
        function initializeChart() {
            const ctx = document.getElementById('rsiChart').getContext('2d');
            
            // Destroy existing chart
            if (rsiChart) {
                rsiChart.destroy();
            }
            
            // Create new chart
            rsiChart = new Chart(ctx, CHART_CONFIG);
            
            // Add initial reference lines
            updateChartReferenceLines();
        }
        
        // Update chart with new data
        function updateChart() {
            if (!rsiChart || rsiHistory.length < 2) return;
            
            // Get the last 50 RSI values
            const recentRSI = rsiHistory.slice(-50);
            const recentTimes = priceHistory.slice(-50).map(p => p.timestamp);
            
            // Update RSI line
            const rsiData = recentTimes.map((time, index) => ({
                x: time,
                y: recentRSI[index] || 50
            }));
            
            rsiChart.data.datasets[0].data = rsiData;
            
            // Update reference lines
            updateChartReferenceLines();
            
            // Update chart
            rsiChart.update('none');
        }
        
        // Update chart reference lines
        function updateChartReferenceLines() {
            if (!rsiChart || priceHistory.length < 2) return;
            
            const times = priceHistory.slice(-50).map(p => p.timestamp);
            
            // Overbought line (70)
            rsiChart.data.datasets[1].data = times.map(time => ({
                x: time,
                y: 70
            }));
            
            // Oversold line (30)
            rsiChart.data.datasets[2].data = times.map(time => ({
                x: time,
                y: 30
            }));
            
            // Middle line (50)
            rsiChart.data.datasets[3].data = times.map(time => ({
                x: time,
                y: 50
            }));
        }
        
        // ============================================
        // INSTANT RSI CALCULATION
        // ============================================
        
        // Calculate RSI from price history
        function calculateRSI(prices, period = RSI_PERIOD) {
            if (prices.length < period + 1) {
                return tradingState.currentRSI || 50;
            }
            
            const priceValues = prices.map(p => p.price);
            let gains = [];
            let losses = [];
            
            for (let i = 1; i < priceValues.length; i++) {
                const change = priceValues[i] - priceValues[i - 1];
                gains.push(change > 0 ? change : 0);
                losses.push(change < 0 ? Math.abs(change) : 0);
            }
            
            let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
            let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
            
            for (let i = period; i < gains.length; i++) {
                avgGain = ((avgGain * (period - 1)) + gains[i]) / period;
                avgLoss = ((avgLoss * (period - 1)) + losses[i]) / period;
            }
            
            if (avgLoss === 0) return 100;
            
            const rs = avgGain / avgLoss;
            const rsi = 100 - (100 / (1 + rs));
            
            return parseFloat(rsi.toFixed(2));
        }
        
        // Calculate and update RSI with INSTANT signal detection
        function calculateAndUpdateRSI() {
            if (priceHistory.length < RSI_PERIOD + 1) {
                // Use the RSI from screenshot if we don't have enough data
                const currentRSI = tradingState.currentRSI || 74.51;
                document.getElementById('rsiDisplay').textContent = currentRSI.toFixed(2);
                document.getElementById('prevRsiDisplay').textContent = (currentRSI - 0.1).toFixed(2);
                return;
            }
            
            // Get RSI values
            const currentRSI = calculateRSI(priceHistory);
            const previousRSI = tradingState.currentRSI || currentRSI;
            
            // Update trading state
            tradingState.previousRSI = tradingState.currentRSI;
            tradingState.currentRSI = currentRSI;
            
            // Update RSI history for chart
            rsiHistory.push(currentRSI);
            if (rsiHistory.length > 100) {
                rsiHistory = rsiHistory.slice(-100);
            }
            
            // Update displays
            updateRSIDisplays(currentRSI, previousRSI);
            
            // CHECK FOR INSTANT SIGNAL (No waiting for initial state check!)
            checkForInstantSignal();
            
            // If we have an active signal, check for exit
            if (tradingState.activeSignal !== 'NONE') {
                checkForExit(currentRSI, previousRSI);
            }
            
            // Update position duration if active
            if (tradingState.activeSignal !== 'NONE' && tradingState.signalStartTime) {
                updatePositionDuration();
            }
        }
        
        // Check for exit
        function checkForExit(currentRSI, previousRSI) {
            // EXIT CONDITION: RSI crosses through 50
            const shouldExitBuy = tradingState.activeSignal === 'BUY' && 
                                  previousRSI < 50 && 
                                  currentRSI >= 50;
            
            const shouldExitSell = tradingState.activeSignal === 'SELL' && 
                                   previousRSI > 50 && 
                                   currentRSI <= 50;
            
            if (shouldExitBuy || shouldExitSell) {
                deactivateSignal(currentRSI);
            }
        }
        
        // Activate a signal - INSTANT VERSION
        function activateSignal(type, currentRSI, previousRSI) {
            // Safety check
            if (tradingState.activeSignal !== 'NONE') {
                return;
            }
            
            tradingState.activeSignal = type;
            tradingState.signalStartTime = new Date();
            tradingState.entryRSI = currentRSI;
            tradingState.isInTrade = true;
            tradingState.lastAction = 'ENTRY';
            tradingState.isInCooldown = false;
            tradingState.signalsToday++;
            
            // Add to history
            const signalEntry = {
                type: type,
                action: 'ENTRY',
                rsi: currentRSI,
                previousRsi: previousRSI,
                price: priceHistory[priceHistory.length - 1].price,
                timestamp: new Date(),
                rule: `INSTANT ${type} (RSI ${type === 'BUY' ? '‚â§30' : '‚â•70'})`
            };
            
            tradingState.signalHistory.unshift(signalEntry);
            if (tradingState.signalHistory.length > 10) {
                tradingState.signalHistory = tradingState.signalHistory.slice(0, 10);
            }
            
            // Update displays
            updateSignalDisplay();
            updateTradeLog();
            updateConditionsDisplay();
            showMessage(`‚ö° INSTANT ${type} SIGNAL ACTIVATED!`, 'success');
        }
        
        // Deactivate current signal
        function deactivateSignal(currentRSI) {
            const oldSignal = tradingState.activeSignal;
            
            // Safety check
            if (oldSignal === 'NONE') {
                return;
            }
            
            const duration = Math.floor((new Date() - tradingState.signalStartTime) / 1000);
            const isSuccessful = (oldSignal === 'BUY' && currentRSI > tradingState.entryRSI) ||
                                (oldSignal === 'SELL' && currentRSI < tradingState.entryRSI);
            
            if (isSuccessful) {
                tradingState.successfulSignals++;
            }
            
            // Add exit to history
            const exitEntry = {
                type: oldSignal,
                action: 'EXIT',
                rsi: currentRSI,
                entryRsi: tradingState.entryRSI,
                price: priceHistory[priceHistory.length - 1].price,
                timestamp: new Date(),
                duration: duration,
                successful: isSuccessful,
                rule: 'RSI crossed 50'
            };
            
            tradingState.signalHistory.unshift(exitEntry);
            if (tradingState.signalHistory.length > 10) {
                tradingState.signalHistory = tradingState.signalHistory.slice(0, 10);
            }
            
            // Reset trading state
            tradingState.activeSignal = 'NONE';
            tradingState.signalStartTime = null;
            tradingState.entryRSI = null;
            tradingState.isInTrade = false;
            tradingState.lastAction = 'EXIT';
            tradingState.lastExitTime = new Date();
            tradingState.isInCooldown = true;
            
            // Start cooldown timer
            startCooldownTimer();
            
            // Update displays
            updateSignalDisplay();
            updateTradeLog();
            updateConditionsDisplay();
            
            const successText = isSuccessful ? 'SUCCESSFUL' : 'UNSUCCESSFUL';
            showMessage(`${oldSignal} exited after ${duration}s (${successText})`, 'success');
        }
        
        // Start cooldown timer
        function startCooldownTimer() {
            const cooldownEnd = new Date().getTime() + TRADING_RULES.COOLDOWN_MS;
            
            if (cooldownInterval) {
                clearInterval(cooldownInterval);
            }
            
            document.getElementById('cooldownInfo').style.display = 'block';
            
            cooldownInterval = setInterval(() => {
                const now = new Date().getTime();
                const remaining = Math.max(0, cooldownEnd - now);
                const seconds = Math.ceil(remaining / 1000);
                
                document.getElementById('cooldownTime').textContent = seconds;
                document.getElementById('cooldownTimer').textContent = `${seconds}s`;
                
                if (remaining <= 0) {
                    clearInterval(cooldownInterval);
                    tradingState.isInCooldown = false;
                    document.getElementById('cooldownInfo').style.display = 'none';
                    showMessage('‚úÖ Cooldown ended. Ready for next INSTANT signal.', 'success');
                }
            }, 100);
        }
        
        // ============================================
        // DISPLAY UPDATES
        // ============================================
        
        // Update all trading displays
        function updateTradingDisplays() {
            updateSignalDisplay();
            updateTradeLog();
            updatePositionDisplay();
            updateConditionsDisplay();
            updateLastUpdate();
            updateCooldownDisplay();
        }
        
        // Update signal display
        function updateSignalDisplay() {
            const badge = document.getElementById('signalBadge');
            const activeSignalEl = document.getElementById('activeSignal');
            const signalStateEl = document.getElementById('signalState');
            const signalDetails = document.getElementById('signalDetails');
            const signalRule = document.getElementById('signalRule');
            
            badge.classList.remove('signal-buy', 'signal-sell', 'signal-neutral', 'price-alert');
            
            if (tradingState.activeSignal === 'BUY') {
                badge.textContent = 'BUY ACTIVE';
                badge.classList.add('signal-buy', 'price-alert');
                activeSignalEl.textContent = 'BUY';
                activeSignalEl.style.color = '#00b894';
                signalStateEl.textContent = 'ACTIVE';
                signalStateEl.style.color = '#00b894';
                signalDetails.innerHTML = `INSTANT BUY signal active<br>RSI was ‚â§30 when detected`;
                signalRule.innerHTML = '‚ö° Instant Detection ‚Ä¢ Active Trade ‚Ä¢ Exit at RSI ‚â•50';
            }
            else if (tradingState.activeSignal === 'SELL') {
                badge.textContent = 'SELL ACTIVE';
                badge.classList.add('signal-sell', 'price-alert');
                activeSignalEl.textContent = 'SELL';
                activeSignalEl.style.color = '#d63031';
                signalStateEl.textContent = 'ACTIVE';
                signalStateEl.style.color = '#d63031';
                signalDetails.innerHTML = `INSTANT SELL signal active<br>RSI was ‚â•70 when detected`;
                signalRule.innerHTML = '‚ö° Instant Detection ‚Ä¢ Active Trade ‚Ä¢ Exit at RSI ‚â§50';
            }
            else {
                badge.textContent = 'WAITING';
                badge.classList.add('signal-neutral');
                activeSignalEl.textContent = 'NONE';
                activeSignalEl.style.color = '#888';
                signalStateEl.textContent = tradingState.isInCooldown ? 'COOLDOWN' : 'WAITING';
                signalStateEl.style.color = tradingState.isInCooldown ? '#ffa500' : '#888';
                if (tradingState.isInCooldown) {
                    signalDetails.innerHTML = 'Cooldown active after exit<br>No new signals for 3 seconds';
                    signalRule.innerHTML = '‚è≥ Cooldown active ‚Ä¢ Instant detection ready';
                } else {
                    // Check current RSI and show what signal would trigger
                    const currentRSI = tradingState.currentRSI;
                    if (currentRSI) {
                        if (currentRSI <= 30) {
                            signalDetails.innerHTML = `RSI is ${currentRSI.toFixed(2)} (‚â§30)<br>BUY signal would trigger INSTANTLY`;
                            signalRule.innerHTML = '‚úÖ Ready for INSTANT BUY signal';
                        } else if (currentRSI >= 70) {
                            signalDetails.innerHTML = `RSI is ${currentRSI.toFixed(2)} (‚â•70)<br>SELL signal would trigger INSTANTLY`;
                            signalRule.innerHTML = '‚úÖ Ready for INSTANT SELL signal';
                        } else {
                            signalDetails.innerHTML = `RSI is ${currentRSI.toFixed(2)}<br>Waiting for RSI ‚â§30 (BUY) or ‚â•70 (SELL)`;
                            signalRule.innerHTML = '‚úÖ Instant detection ready ‚Ä¢ Monitoring RSI';
                        }
                    } else {
                        signalDetails.innerHTML = 'Waiting for market data<br>Instant detection ready';
                        signalRule.innerHTML = '‚úÖ System ready ‚Ä¢ Start trading to see signals';
                    }
                }
            }
        }
        
        // Update RSI displays
        function updateRSIDisplays(currentRSI, previousRSI) {
            document.getElementById('rsiDisplay').textContent = currentRSI.toFixed(2);
            document.getElementById('prevRsiDisplay').textContent = previousRSI.toFixed(2);
            
            // Color code RSI
            const rsiDisplay = document.getElementById('rsiDisplay');
            if (currentRSI <= 30) {
                rsiDisplay.style.color = '#00b894';
            } else if (currentRSI >= 70) {
                rsiDisplay.style.color = '#d63031';
            } else if (currentRSI >= 50) {
                rsiDisplay.style.color = '#ffa500';
            } else {
                rsiDisplay.style.color = '#ffd700';
            }
            
            // Update position display if active
            if (tradingState.activeSignal !== 'NONE') {
                document.getElementById('currentRsi').textContent = currentRSI.toFixed(2);
            }
        }
        
        // Update price display
        function updatePriceDisplay(priceData) {
            document.getElementById('currentPrice').textContent = `$${priceData.price.toFixed(2)}`;
            
            const streamDiv = document.getElementById('priceStream');
            const timestamp = priceData.timestamp.toLocaleTimeString();
            const streamEntry = `[${timestamp}] $${priceData.price.toFixed(2)}`;
            
            let currentStream = streamDiv.innerHTML;
            let entries = currentStream.split('<br>').filter(e => e);
            entries.unshift(streamEntry);
            if (entries.length > 5) entries = entries.slice(0, 5);
            streamDiv.innerHTML = entries.join('<br>');
        }
        
        // Update trade log
        function updateTradeLog() {
            const tradeLog = document.getElementById('tradeLog');
            
            if (tradingState.signalHistory.length === 0) {
                tradeLog.innerHTML = `
                    <div class="trade-entry" style="color: #888; font-style: italic;">
                        No INSTANT signals yet. Start trading to see immediate signals.
                    </div>
                `;
                return;
            }
            
            tradeLog.innerHTML = tradingState.signalHistory.map(signal => `
                <div class="trade-entry ${signal.type === 'BUY' ? 'trade-long' : 'trade-short'}">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: ${signal.type === 'BUY' ? '#00b894' : '#d63031'}; font-weight: bold;">
                            ${signal.type} ${signal.action} ${signal.successful !== undefined ? (signal.successful ? '‚úÖ' : '‚ùå') : ''}
                        </span>
                        <span style="color: #888; font-size: 0.8em;">
                            ${signal.timestamp.toLocaleTimeString()}
                        </span>
                    </div>
                    <div style="font-size: 0.85em; margin-top: 3px;">
                        RSI: ${signal.rsi.toFixed(2)} | Price: $${signal.price.toFixed(2)}
                    </div>
                    <div style="font-size: 0.8em; color: #888;">
                        ${signal.rule}${signal.duration ? ` | Duration: ${signal.duration}s` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        // Update position display
        function updatePositionDisplay() {
            const positionContainer = document.getElementById('positionContainer');
            
            if (tradingState.activeSignal !== 'NONE') {
                positionContainer.style.display = 'block';
                document.getElementById('positionType').textContent = tradingState.activeSignal;
                document.getElementById('positionType').style.color = tradingState.activeSignal === 'BUY' ? '#00b894' : '#d63031';
                document.getElementById('entryRsi').textContent = tradingState.entryRSI ? tradingState.entryRSI.toFixed(2) : '--';
                document.getElementById('currentRsi').textContent = tradingState.currentRSI ? tradingState.currentRSI.toFixed(2) : '--';
            } else {
                positionContainer.style.display = 'none';
            }
        }
        
        // Update position duration
        function updatePositionDuration() {
            if (!tradingState.signalStartTime) return;
            
            const duration = Math.floor((new Date() - tradingState.signalStartTime) / 1000);
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            document.getElementById('positionDuration').textContent = 
                `${minutes > 0 ? minutes + 'm ' : ''}${seconds}s`;
        }
        
        // Update conditions display
        function updateConditionsDisplay() {
            const conditionsList = document.getElementById('conditionsList');
            
            let conditions = [];
            if (tradingState.activeSignal === 'BUY') {
                conditions = [
                    '‚úÖ INSTANT BUY SIGNAL ACTIVE',
                    `üìä Entry RSI: ${tradingState.entryRSI ? tradingState.entryRSI.toFixed(2) : '--'}`,
                    `üìä Current RSI: ${tradingState.currentRSI ? tradingState.currentRSI.toFixed(2) : '--'}`,
                    `‚è≥ Waiting for RSI to cross ABOVE 50`,
                    `üõë NO conflicting signals allowed`,
                    `‚ö° Instant detection system active`
                ];
            } else if (tradingState.activeSignal === 'SELL') {
                conditions = [
                    '‚úÖ INSTANT SELL SIGNAL ACTIVE',
                    `üìä Entry RSI: ${tradingState.entryRSI ? tradingState.entryRSI.toFixed(2) : '--'}`,
                    `üìä Current RSI: ${tradingState.currentRSI ? tradingState.currentRSI.toFixed(2) : '--'}`,
                    `‚è≥ Waiting for RSI to cross BELOW 50`,
                    `üõë NO conflicting signals allowed`,
                    `‚ö° Instant detection system active`
                ];
            } else if (tradingState.isInCooldown) {
                conditions = [
                    '‚è≥ INSTANT SYSTEM COOLDOWN',
                    'üõë No new signals allowed',
                    `‚è∞ 3-second cooldown after exit`,
                    '‚úÖ Prevents conflicting signals',
                    '‚ö° Instant detection ready after cooldown'
                ];
            } else {
                const currentRSI = tradingState.currentRSI;
                if (currentRSI) {
                    if (currentRSI <= 30) {
                        conditions = [
                            '‚ö° READY FOR INSTANT BUY',
                            `üìä Current RSI: ${currentRSI.toFixed(2)} (‚â§30)`,
                            `‚úÖ BUY signal would trigger INSTANTLY`,
                            `üëÄ Monitoring for RSI changes`,
                            `üîÑ System will auto-detect instantly`,
                            `‚ö° No waiting for crosses needed`
                        ];
                    } else if (currentRSI >= 70) {
                        conditions = [
                            '‚ö° READY FOR INSTANT SELL',
                            `üìä Current RSI: ${currentRSI.toFixed(2)} (‚â•70)`,
                            `‚úÖ SELL signal would trigger INSTANTLY`,
                            `üëÄ Monitoring for RSI changes`,
                            `üîÑ System will auto-detect instantly`,
                            `‚ö° No waiting for crosses needed`
                        ];
                    } else {
                        conditions = [
                            'üìä INSTANT DETECTION READY',
                            `üìä Current RSI: ${currentRSI.toFixed(2)}`,
                            `‚úÖ NO active position`,
                            `üëÄ Instant monitoring active:`,
                            `   ‚Ä¢ RSI ‚â§30 ‚Üí INSTANT BUY`,
                            `   ‚Ä¢ RSI ‚â•70 ‚Üí INSTANT SELL`,
                            `‚ö° Signals show immediately`
                        ];
                    }
                } else {
                    conditions = [
                        'üìä INSTANT SIGNAL SYSTEM',
                        `‚èπÔ∏è No active position`,
                        `‚úÖ Instant detection ready`,
                        `üëÄ Will show signals immediately:`,
                        `   ‚Ä¢ RSI ‚â§30 ‚Üí INSTANT BUY`,
                        `   ‚Ä¢ RSI ‚â•70 ‚Üí INSTANT SELL`,
                        `‚ö° No waiting for crosses`
                    ];
                }
            }
            
            conditionsList.innerHTML = `
                <h3>Instant Signal Logic</h3>
                ${conditions.map(cond => `
                    <div class="condition-item">
                        <span class="condition-icon">${cond.includes('‚úÖ') ? '‚úÖ' : cond.includes('üìä') ? 'üìä' : cond.includes('‚è≥') ? '‚è≥' : cond.includes('üõë') ? 'üõë' : cond.includes('‚ö°') ? '‚ö°' : cond.includes('üëÄ') ? 'üëÄ' : 'üîÑ'}</span>
                        <span class="${cond.includes('‚úÖ') ? 'condition-met' : cond.includes('üõë') ? 'condition-not-met' : cond.includes('‚è≥') ? 'condition-not-met' : cond.includes('‚ö°') ? 'condition-met' : 'condition-not-met'}">${cond}</span>
                    </div>
                `).join('')}
            `;
        }
        
        // Update last update timestamp
        function updateLastUpdate() {
            const now = new Date();
            let statusText = 'Instant Detection: Ready';
            
            if (tradingState.activeSignal !== 'NONE') {
                const duration = tradingState.signalStartTime ? 
                    Math.floor((new Date() - tradingState.signalStartTime) / 1000) : 0;
                statusText = `INSTANT ${tradingState.activeSignal} active for ${duration}s`;
            } else if (tradingState.isInCooldown) {
                statusText = `Instant system cooldown`;
            } else {
                const currentRSI = tradingState.currentRSI;
                if (currentRSI) {
                    if (currentRSI <= 30) {
                        statusText = `RSI ${currentRSI.toFixed(2)} ‚Üí READY for INSTANT BUY`;
                    } else if (currentRSI >= 70) {
                        statusText = `RSI ${currentRSI.toFixed(2)} ‚Üí READY for INSTANT SELL`;
                    } else {
                        statusText = `RSI ${currentRSI.toFixed(2)} ‚Üí Monitoring for instant signals`;
                    }
                }
            }
            
            document.getElementById('lastUpdate').innerHTML = 
                `<span style="color: ${tradingState.isInCooldown ? '#ffa500' : 
                                  tradingState.currentRSI <= 30 ? '#00b894' : 
                                  tradingState.currentRSI >= 70 ? '#d63031' : '#00b894'};">${statusText}</span>`;
        }
        
        // Update cooldown display
        function updateCooldownDisplay() {
            const cooldownInfo = document.getElementById('cooldownInfo');
            const now = new Date();
            const lastExitTime = tradingState.lastExitTime;
            
            if (lastExitTime && tradingState.isInCooldown) {
                const elapsed = now - lastExitTime;
                const remaining = Math.max(0, TRADING_RULES.COOLDOWN_MS - elapsed);
                
                if (remaining > 0) {
                    cooldownInfo.style.display = 'block';
                } else {
                    cooldownInfo.style.display = 'none';
                    tradingState.isInCooldown = false;
                }
            } else {
                cooldownInfo.style.display = 'none';
            }
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        // Change timeframe
        function changeTimeframe(timeframe, btn) {
            currentTimeframe = timeframe;
            
            document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            showMessage(`Timeframe: ${timeframe}`, 'success');
        }
        
        // Change data source
        function changeDataSource(source, btn) {
            currentDataSource = source;
            
            document.querySelectorAll('.data-source-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            showMessage(`Data source: ${source}`, 'success');
        }
        
        // Show message
        function showMessage(message, type = 'success') {
            const errorContainer = document.getElementById('errorContainer');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            messageDiv.style.animation = 'fadeIn 0.3s';
            
            errorContainer.innerHTML = '';
            errorContainer.appendChild(messageDiv);
            
            setTimeout(() => {
                if (errorContainer.contains(messageDiv)) {
                    messageDiv.style.animation = 'fadeOut 0.3s';
                    setTimeout(() => {
                        if (errorContainer.contains(messageDiv)) {
                            errorContainer.removeChild(messageDiv);
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ INSTANT Signal Dashboard Initializing...');
            
            // Set initial displays
            document.getElementById('currentPrice').textContent = '--';
            document.getElementById('rsiDisplay').textContent = '--';
            document.getElementById('prevRsiDisplay').textContent = '--';
            document.getElementById('signalState').textContent = 'IDLE';
            document.getElementById('activeSignal').textContent = 'NONE';
            
            // Initialize with your screenshot RSI value
            tradingState.currentRSI = 74.51;
            tradingState.previousRSI = 74.41;
            
            // Update RSI display with screenshot value
            updateRSIDisplays(74.51, 74.41);
            
            // Initialize chart
            setTimeout(() => {
                initializeChart();
            }, 1000);
            
            // Show welcome message
            showMessage('Click "Start Trading" for INSTANT BUY/SELL signals!', 'success');
            
            console.log('‚úÖ INSTANT Signal Dashboard ready');
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            stopTrading();
        });
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            @keyframes fadeOut {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(-10px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
