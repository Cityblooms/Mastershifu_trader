<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Sniper - Professional Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        :root {
            --bg: #0a0f1c;
            --card: #131a2a;
            --accent: #3a86ff;
            --accent-hover: #2a76ef;
            --buy: #00d4aa;
            --sell: #ff4d7d;
            --warning: #ffb74d;
            --text: #e6eef8;
            --text-muted: #8a9bb8;
            --border: #1e293b;
            --success: #00d4aa;
            --danger: #ff4d7d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            min-height: 100vh;
        }

        /* Header Styles */
        .header {
            grid-column: 1 / -1;
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-bar {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .status-dot.warning { background: var(--warning); }
        .status-dot.danger { background: var(--danger); }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .chart-section {
            grid-column: 1 / -1;
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .signals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        /* Card Styles */
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        /* Signal Cards */
        .signal-card {
            background: linear-gradient(135deg, rgba(58, 134, 255, 0.1), rgba(0, 212, 170, 0.05));
            border: 1px solid rgba(58, 134, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .signal-card.buy {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.15), rgba(0, 212, 170, 0.05));
            border-color: rgba(0, 212, 170, 0.3);
        }

        .signal-card.sell {
            background: linear-gradient(135deg, rgba(255, 77, 125, 0.15), rgba(255, 77, 125, 0.05));
            border-color: rgba(255, 77, 125, 0.3);
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .signal-pair {
            font-weight: 700;
            font-size: 16px;
        }

        .signal-direction {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .signal-direction.buy {
            background: var(--buy);
            color: white;
        }

        .signal-direction.sell {
            background: var(--sell);
            color: white;
        }

        .signal-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .meta-item {
            font-size: 12px;
            color: var(--text-muted);
        }

        .meta-value {
            font-weight: 600;
            color: var(--text);
        }

        .confidence-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .confidence-high { background: var(--success); }
        .confidence-medium { background: var(--warning); }
        .confidence-low { background: var(--danger); }

        /* Analysis Panel */
        .analysis-panel {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .timeframe-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .timeframe-tab {
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .timeframe-tab.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .indicator-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .indicator-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .indicator-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .indicator-value {
            font-size: 14px;
            font-weight: 600;
        }

        .indicator-value.bullish { color: var(--success); }
        .indicator-value.bearish { color: var(--danger); }
        .indicator-value.neutral { color: var(--warning); }

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: var(--accent);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        /* Log Panel */
        .log-panel {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 12px;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .log-time {
            color: var(--text-muted);
            margin-right: 10px;
        }

        .log-buy { color: var(--success); }
        .log-sell { color: var(--danger); }
        .log-info { color: var(--accent); }

        /* Chart Container */
        .chart-container {
            height: 400px;
            position: relative;
        }

        /* Settings Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card);
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .setting-group {
            margin-bottom: 15px;
        }

        .setting-label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--text);
        }

        .setting-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* Badges */
        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-success { background: var(--success); color: white; }
        .badge-warning { background: var(--warning); color: white; }
        .badge-danger { background: var(--danger); color: white; }
    </style>
</head>
<body>
    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="card-header">
                <div class="card-title">‚öôÔ∏è Trading Settings</div>
                <button class="btn btn-outline" onclick="closeSettings()">‚úï</button>
            </div>
            
            <div class="settings-grid">
                <div class="setting-group">
                    <label class="setting-label">Minimum Confidence %</label>
                    <input type="number" id="minConfidence" class="setting-input" min="50" max="95" value="75">
                </div>
                <div class="setting-group">
                    <label class="setting-label">Risk-Reward Ratio</label>
                    <input type="number" id="riskReward" class="setting-input" min="1" max="5" step="0.1" value="2.0">
                </div>
                <div class="setting-group">
                    <label class="setting-label">Max Signals Display</label>
                    <input type="number" id="maxSignals" class="setting-input" min="1" max="20" value="10">
                </div>
                <div class="setting-group">
                    <label class="setting-label">Refresh Interval (seconds)</label>
                    <input type="number" id="refreshInterval" class="setting-input" min="10" max="300" value="30">
                </div>
                <div class="setting-group">
                    <label class="setting-label">EMA Fast Period</label>
                    <input type="number" id="emaFast" class="setting-input" min="5" max="50" value="12">
                </div>
                <div class="setting-group">
                    <label class="setting-label">EMA Slow Period</label>
                    <input type="number" id="emaSlow" class="setting-input" min="20" max="100" value="26">
                </div>
                <div class="setting-group">
                    <label class="setting-label">RSI Period</label>
                    <input type="number" id="rsiPeriod" class="setting-input" min="5" max="30" value="14">
                </div>
                <div class="setting-group">
                    <label class="setting-label">RSI Buy Level</label>
                    <input type="number" id="rsiBuy" class="setting-input" min="10" max="40" value="30">
                </div>
                <div class="setting-group">
                    <label class="setting-label">RSI Sell Level</label>
                    <input type="number" id="rsiSell" class="setting-input" min="60" max="90" value="70">
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="saveSettings()">üíæ Save Settings</button>
                <button class="btn btn-outline" onclick="resetSettings()">üîÑ Reset Defaults</button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo">
                    <h1>QUANTUM SNIPER</h1>
                    <span class="badge badge-success">LIVE</span>
                </div>
                <div class="status-bar">
                    <div class="status-item">
                        <div class="status-dot"></div>
                        <span>Data Feed</span>
                    </div>
                    <div class="status-item">
                        <div class="status-dot"></div>
                        <span>Signal Engine</span>
                    </div>
                    <div class="status-item">
                        <div class="status-dot"></div>
                        <span>Multi-TF Analysis</span>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn" id="refreshBtn">üîÑ Refresh Signals</button>
                <button class="btn btn-outline" id="settingsBtn">‚öôÔ∏è Settings</button>
                <button class="btn btn-outline" id="exportBtn">üìä Export Data</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-grid">
            <!-- Chart Section -->
            <div class="chart-section">
                <div class="card-header">
                    <div class="card-title">Multi-Timeframe Analysis</div>
                    <div class="timeframe-tabs">
                        <div class="timeframe-tab active" data-tf="1h">1H Analysis</div>
                        <div class="timeframe-tab" data-tf="15m">15M Entry</div>
                        <div class="timeframe-tab" data-tf="5m">5M Sniper</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <!-- Signals Grid -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üéØ Active Sniper Signals</div>
                    <div class="badge badge-success" id="signalsCount">0 Signals</div>
                </div>
                <div class="signals-grid" id="signalsContainer">
                    <!-- Signals will be populated here -->
                </div>
            </div>

            <!-- Analysis Panel -->
            <div class="analysis-panel">
                <div class="card-header">
                    <div class="card-title">üìä Market Analysis</div>
                </div>
                <div class="indicator-grid">
                    <div class="indicator-item">
                        <div class="indicator-label">Trend Direction</div>
                        <div class="indicator-value bullish" id="trendDirection">BULLISH</div>
                    </div>
                    <div class="indicator-item">
                        <div class="indicator-label">Market Regime</div>
                        <div class="indicator-value" id="marketRegime">TRENDING</div>
                    </div>
                    <div class="indicator-item">
                        <div class="indicator-label">RSI Momentum</div>
                        <div class="indicator-value bullish" id="rsiMomentum">62.4</div>
                    </div>
                    <div class="indicator-item">
                        <div class="indicator-label">Volume Trend</div>
                        <div class="indicator-value bullish" id="volumeTrend">INCREASING</div>
                    </div>
                    <div class="indicator-item">
                        <div class="indicator-label">Volatility</div>
                        <div class="indicator-value" id="volatility">HIGH</div>
                    </div>
                    <div class="indicator-item">
                        <div class="indicator-label">Signal Quality</div>
                        <div class="indicator-value bullish" id="signalQuality">92%</div>
                    </div>
                </div>
                
                <div class="card-header" style="margin-top: 20px;">
                    <div class="card-title">‚ö° Quick Actions</div>
                </div>
                <div class="controls">
                    <button class="btn" id="scanMarketsBtn">üîç Scan All Markets</button>
                    <button class="btn btn-outline" id="validateSignalsBtn">‚úÖ Validate Signals</button>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Pairs Monitor -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìà Market Watch</div>
                </div>
                <div id="pairsMonitor">
                    <!-- Pairs will be populated here -->
                </div>
            </div>

            <!-- Log Panel -->
            <div class="log-panel">
                <div class="card-header">
                    <div class="card-title">üìù Activity Log</div>
                </div>
                <div id="activityLog">
                    <div class="log-entry">
                        <span class="log-time">12:00:00</span>
                        <span class="log-info">System initialized</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================================================
        // CONFIGURATION SETTINGS
        // =============================================================================
        const DEFAULT_SETTINGS = {
            // Signal Generation
            minConfidence: 75,
            riskReward: 2.0,
            maxSignals: 10,
            refreshInterval: 30,
            
            // Technical Indicators
            emaFast: 12,
            emaSlow: 26,
            rsiPeriod: 14,
            rsiBuy: 30,
            rsiSell: 70,
            
            // Trading Pairs
            pairs: ['EUR/USD', 'GBP/USD', 'USD/JPY', 'XAU/USD', 'BTC/USD', 'ETH/USD'],
            
            // Risk Management
            maxDrawdown: 2.0,
            positionSize: 1.0,
            trailingStop: true,
            
            // Alert Settings
            audioAlerts: true,
            desktopNotifications: true,
            emailAlerts: false
        };

        // =============================================================================
        // QUANTUM SNIPER DASHBOARD CLASS
        // =============================================================================
        class QuantumSniperDashboard {
            constructor() {
                this.settings = this.loadSettings();
                this.pairs = this.settings.pairs;
                this.timeframes = ['1h', '15m', '5m'];
                this.signals = [];
                this.chart = null;
                this.isRunning = true;
                this.currentTimeframe = '1h';
                
                this.initializeDashboard();
                this.startEngine();
            }

            // =============================================================================
            // SETTINGS MANAGEMENT
            // =============================================================================
            loadSettings() {
                try {
                    const saved = localStorage.getItem('quantumSniperSettings');
                    if (saved) {
                        return { ...DEFAULT_SETTINGS, ...JSON.parse(saved) };
                    }
                } catch (error) {
                    console.error('Error loading settings:', error);
                }
                return DEFAULT_SETTINGS;
            }

            saveSettings() {
                try {
                    localStorage.setItem('quantumSniperSettings', JSON.stringify(this.settings));
                    this.log('Settings saved successfully', 'info');
                    return true;
                } catch (error) {
                    this.log('Error saving settings: ' + error.message, 'info');
                    return false;
                }
            }

            updateSettings(newSettings) {
                this.settings = { ...this.settings, ...newSettings };
                this.pairs = this.settings.pairs;
                this.applySettings();
            }

            applySettings() {
                // Update UI elements with current settings
                document.getElementById('minConfidence').value = this.settings.minConfidence;
                document.getElementById('riskReward').value = this.settings.riskReward;
                document.getElementById('maxSignals').value = this.settings.maxSignals;
                document.getElementById('refreshInterval').value = this.settings.refreshInterval;
                document.getElementById('emaFast').value = this.settings.emaFast;
                document.getElementById('emaSlow').value = this.settings.emaSlow;
                document.getElementById('rsiPeriod').value = this.settings.rsiPeriod;
                document.getElementById('rsiBuy').value = this.settings.rsiBuy;
                document.getElementById('rsiSell').value = this.settings.rsiSell;
            }

            resetSettings() {
                this.settings = { ...DEFAULT_SETTINGS };
                this.saveSettings();
                this.applySettings();
                this.log('Settings reset to defaults', 'info');
            }

            // =============================================================================
            // INITIALIZATION
            // =============================================================================
            initializeDashboard() {
                this.initializeChart();
                this.setupEventListeners();
                this.renderPairsMonitor();
                this.applySettings();
                this.log('Quantum Sniper Dashboard initialized', 'info');
            }

            initializeChart() {
                const ctx = document.getElementById('mainChart').getContext('2d');
                
                // Generate sample data for demonstration
                const data = this.generateSampleData();
                
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Price',
                            data: data.prices,
                            borderColor: '#3a86ff',
                            backgroundColor: 'rgba(58, 134, 255, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'EMA Fast',
                            data: data.emaFast,
                            borderColor: '#00d4aa',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            fill: false
                        }, {
                            label: 'EMA Slow',
                            data: data.emaSlow,
                            borderColor: '#ff4d7d',
                            borderWidth: 1,
                            borderDash: [5, 5],
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: { color: var(--text) }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'hour'
                                },
                                grid: { color: 'rgba(255,255,255,0.1)' },
                                ticks: { color: var(--text-muted) }
                            },
                            y: {
                                position: 'right',
                                grid: { color: 'rgba(255,255,255,0.1)' },
                                ticks: { color: var(--text-muted) }
                            }
                        }
                    }
                });
            }

            // =============================================================================
            // DATA GENERATION & ANALYSIS
            // =============================================================================
            generateSampleData() {
                const labels = [];
                const prices = [];
                const emaFast = [];
                const emaSlow = [];
                
                let price = 1.0800;
                const baseTime = new Date();
                baseTime.setHours(baseTime.getHours() - 24);

                for (let i = 0; i < 100; i++) {
                    const time = new Date(baseTime.getTime() + i * 15 * 60000);
                    labels.push(time);
                    
                    const change = (Math.random() - 0.5) * 0.002;
                    price = price * (1 + change);
                    prices.push(price);
                    
                    // Calculate EMAs for demonstration
                    if (i >= this.settings.emaFast - 1) {
                        const fastPeriod = prices.slice(i - this.settings.emaFast + 1, i + 1);
                        emaFast.push(fastPeriod.reduce((a, b) => a + b) / this.settings.emaFast);
                    } else {
                        emaFast.push(null);
                    }
                    
                    if (i >= this.settings.emaSlow - 1) {
                        const slowPeriod = prices.slice(i - this.settings.emaSlow + 1, i + 1);
                        emaSlow.push(slowPeriod.reduce((a, b) => a + b) / this.settings.emaSlow);
                    } else {
                        emaSlow.push(null);
                    }
                }

                return { labels, prices, emaFast, emaSlow };
            }

            // =============================================================================
            // SIGNAL GENERATION ENGINE
            // =============================================================================
            async analyzeMarkets() {
                this.log('Starting multi-timeframe market analysis...', 'info');
                
                const newSignals = [];
                
                for (const pair of this.pairs) {
                    try {
                        // Simulate multi-timeframe analysis
                        const analysis = await this.analyzePair(pair);
                        
                        if (analysis && analysis.confidence >= this.settings.minConfidence) {
                            newSignals.push(analysis);
                            this.log(`SNIPER SIGNAL: ${pair} ${analysis.direction} | Confidence: ${analysis.confidence}%`, analysis.direction.toLowerCase());
                        }
                    } catch (error) {
                        this.log(`Analysis error for ${pair}: ${error.message}`, 'info');
                    }
                }

                // Update signals
                this.signals = newSignals.slice(0, this.settings.maxSignals);
                this.updateUI();
            }

            async analyzePair(pair) {
                // Simulate API delay and analysis
                await this.delay(100 + Math.random() * 200);
                
                // Generate realistic signal based on settings
                const direction = Math.random() > 0.5 ? 'BUY' : 'SELL';
                const basePrice = this.getBasePrice(pair);
                const volatility = this.getVolatilityForPair(pair);
                
                const price = basePrice * (1 + (Math.random() - 0.5) * volatility);
                const confidence = 70 + Math.random() * 25; // 70-95% confidence
                
                if (confidence < this.settings.minConfidence) {
                    return null;
                }

                return {
                    id: `${pair}-${Date.now()}`,
                    pair,
                    direction,
                    entry: this.calculateEntryPrice(price, direction),
                    stopLoss: this.calculateStopLoss(price, direction, volatility),
                    takeProfit: this.calculateTakeProfit(price, direction, this.settings.riskReward),
                    confidence: Math.round(confidence),
                    timeframe: '15m',
                    timestamp: new Date(),
                    reasons: this.generateSignalReasons(direction),
                    riskReward: this.settings.riskReward
                };
            }

            calculateEntryPrice(price, direction) {
                const spread = price * 0.0002; // 0.02% spread
                return direction === 'BUY' ? price + spread : price - spread;
            }

            calculateStopLoss(price, direction, volatility) {
                const stopDistance = price * volatility * 2; // 2x volatility
                return direction === 'BUY' ? price - stopDistance : price + stopDistance;
            }

            calculateTakeProfit(price, direction, riskReward) {
                const stopDistance = Math.abs(price - this.calculateStopLoss(price, direction, 0.01));
                const tpDistance = stopDistance * riskReward;
                return direction === 'BUY' ? price + tpDistance : price - tpDistance;
            }

            generateSignalReasons(direction) {
                const reasons = {
                    BUY: [
                        'EMA Bullish Crossover',
                        'RSI Oversold Bounce',
                        'Support Level Hold',
                        'Volume Confirmation',
                        'Trend Alignment'
                    ],
                    SELL: [
                        'EMA Bearish Crossover',
                        'RSI Overbought Rejection',
                        'Resistance Test Fail',
                        'Volume Divergence',
                        'Trend Breakdown'
                    ]
                };
                
                const selectedReasons = [];
                const availableReasons = reasons[direction];
                
                // Select 2-3 random reasons
                const numReasons = 2 + Math.floor(Math.random() * 2);
                for (let i = 0; i < numReasons; i++) {
                    const randomIndex = Math.floor(Math.random() * availableReasons.length);
                    selectedReasons.push(availableReasons[randomIndex]);
                    availableReasons.splice(randomIndex, 1);
                }
                
                return selectedReasons;
            }

            // =============================================================================
            // UTILITY METHODS
            // =============================================================================
            getBasePrice(pair) {
                const basePrices = {
                    'EUR/USD': 1.0800, 'GBP/USD': 1.2650, 'USD/JPY': 151.50,
                    'XAU/USD': 1980.00, 'BTC/USD': 45000.00, 'ETH/USD': 2500.00
                };
                return basePrices[pair] || 1.0000;
            }

            getVolatilityForPair(pair) {
                const volatilities = {
                    'EUR/USD': 0.0005, 'GBP/USD': 0.0008, 'USD/JPY': 0.0010,
                    'XAU/USD': 0.0020, 'BTC/USD': 0.0150, 'ETH/USD': 0.0200
                };
                return volatilities[pair] || 0.0010;
            }

            // =============================================================================
            // UI MANAGEMENT
            // =============================================================================
            setupEventListeners() {
                document.getElementById('refreshBtn').addEventListener('click', () => this.refreshSignals());
                document.getElementById('settingsBtn').addEventListener('click', () => this.openSettings());
                document.getElementById('scanMarketsBtn').addEventListener('click', () => this.scanAllMarkets());
                document.getElementById('validateSignalsBtn').addEventListener('click', () => this.validateAllSignals());
                
                // Timeframe tabs
                document.querySelectorAll('.timeframe-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.timeframe-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        this.switchTimeframe(e.target.dataset.tf);
                    });
                });
            }

            updateUI() {
                this.renderSignals();
                this.renderPairsMonitor();
                this.updateSignalsCount();
                this.updateMarketAnalysis();
            }

            renderSignals() {
                const container = document.getElementById('signalsContainer');
                
                if (this.signals.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-muted);">
                            <div style="font-size: 48px; margin-bottom: 10px;">üéØ</div>
                            <div>No high-confidence signals found</div>
                            <div style="font-size: 12px; margin-top: 5px;">Waiting for optimal trading conditions...</div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '';

                this.signals.forEach(signal => {
                    const signalElement = document.createElement('div');
                    signalElement.className = `signal-card ${signal.direction.toLowerCase()}`;
                    
                    signalElement.innerHTML = `
                        <div class="signal-header">
                            <div class="signal-pair">${signal.pair}</div>
                            <div class="signal-direction ${signal.direction.toLowerCase()}">${signal.direction}</div>
                        </div>
                        <div class="signal-meta">
                            <div class="meta-item">
                                <div>Entry</div>
                                <div class="meta-value">${signal.entry.toFixed(5)}</div>
                            </div>
                            <div class="meta-item">
                                <div>Stop Loss</div>
                                <div class="meta-value">${signal.stopLoss.toFixed(5)}</div>
                            </div>
                            <div class="meta-item">
                                <div>Take Profit</div>
                                <div class="meta-value">${signal.takeProfit.toFixed(5)}</div>
                            </div>
                            <div class="meta-item">
                                <div>R:R</div>
                                <div class="meta-value">1:${signal.riskReward.toFixed(1)}</div>
                            </div>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill ${this.getConfidenceClass(signal.confidence)}" 
                                 style="width: ${signal.confidence}%"></div>
                        </div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">
                            ${signal.reasons.join(' ‚Ä¢ ')}
                        </div>
                        <div style="font-size: 10px; color: var(--text-muted); margin-top: 5px;">
                            ${signal.timestamp.toLocaleTimeString()}
                        </div>
                    `;
                    
                    container.appendChild(signalElement);
                });
            }

            renderPairsMonitor() {
                const container = document.getElementById('pairsMonitor');
                container.innerHTML = '';

                this.pairs.forEach(pair => {
                    const pairElement = document.createElement('div');
                    pairElement.className = 'pair-row';
                    pairElement.style.cssText = `
                        display: flex; justify-content: space-between; align-items: center;
                        padding: 10px; border-bottom: 1px solid var(--border);
                    `;
                    
                    const signal = this.signals.find(s => s.pair === pair);
                    const status = signal ? signal.direction : 'NEUTRAL';
                    const statusColor = status === 'BUY' ? 'var(--success)' : 
                                      status === 'SELL' ? 'var(--danger)' : 'var(--text-muted)';
                    
                    pairElement.innerHTML = `
                        <div style="font-weight: 600;">${pair}</div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="font-size: 12px; color: ${statusColor}">${status}</div>
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: ${statusColor}"></div>
                        </div>
                    `;
                    
                    container.appendChild(pairElement);
                });
            }

            updateSignalsCount() {
                const count = this.signals.length;
                const badge = document.getElementById('signalsCount');
                badge.textContent = `${count} Signal${count !== 1 ? 's' : ''}`;
                badge.className = `badge ${count > 0 ? 'badge-success' : 'badge-warning'}`;
            }

            updateMarketAnalysis() {
                // Update analysis indicators based on current signals
                if (this.signals.length > 0) {
                    const buySignals = this.signals.filter(s => s.direction === 'BUY').length;
                    const sellSignals = this.signals.filter(s => s.direction === 'SELL').length;
                    
                    document.getElementById('trendDirection').textContent = 
                        buySignals > sellSignals ? 'BULLISH' : buySignals < sellSignals ? 'BEARISH' : 'NEUTRAL';
                    document.getElementById('trendDirection').className = 
                        `indicator-value ${buySignals > sellSignals ? 'bullish' : buySignals < sellSignals ? 'bearish' : 'neutral'}`;
                    
                    const avgConfidence = this.signals.reduce((sum, signal) => sum + signal.confidence, 0) / this.signals.length;
                    document.getElementById('signalQuality').textContent = `${Math.round(avgConfidence)}%`;
                }
            }

            getConfidenceClass(confidence) {
                if (confidence >= 85) return 'confidence-high';
                if (confidence >= 70) return 'confidence-medium';
                return 'confidence-low';
            }

            log(message, type = 'info') {
                const logContainer = document.getElementById('activityLog');
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                
                const timestamp = new Date().toLocaleTimeString();
                logEntry.innerHTML = `
                    <span class="log-time">${timestamp}</span>
                    <span class="log-${type}">${message}</span>
                `;
                
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            // =============================================================================
            // MAIN ENGINE
            // =============================================================================
            async startEngine() {
                this.log('Quantum Sniper Engine started', 'info');
                
                while (this.isRunning) {
                    try {
                        await this.analyzeMarkets();
                        await this.delay(this.settings.refreshInterval * 1000);
                    } catch (error) {
                        this.log(`Engine error: ${error.message}`, 'info');
                        await this.delay(5000);
                    }
                }
            }

            // =============================================================================
            // ACTION METHODS
            // =============================================================================
            refreshSignals() {
                this.log('Manual signal refresh initiated', 'info');
                this.analyzeMarkets();
            }

            scanAllMarkets() {
                this.log('Comprehensive market scan started', 'info');
                this.analyzeMarkets();
            }

            validateAllSignals() {
                this.log('Signal validation process started', 'info');
                // In a real implementation, this would re-validate all signals
                this.log('All signals validated - ' + this.signals.length + ' high-quality signals active', 'info');
            }

            switchTimeframe(timeframe) {
                this.currentTimeframe = timeframe;
                this.log(`Switched to ${timeframe} timeframe analysis`, 'info');
            }

            openSettings() {
                document.getElementById('settingsModal').style.display = 'block';
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // =============================================================================
        // GLOBAL FUNCTIONS FOR SETTINGS MODAL
        // =============================================================================
        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function saveSettings() {
            const newSettings = {
                minConfidence: parseInt(document.getElementById('minConfidence').value),
                riskReward: parseFloat(document.getElementById('riskReward').value),
                maxSignals: parseInt(document.getElementById('maxSignals').value),
                refreshInterval: parseInt(document.getElementById('refreshInterval').value),
                emaFast: parseInt(document.getElementById('emaFast').value),
                emaSlow: parseInt(document.getElementById('emaSlow').value),
                rsiPeriod: parseInt(document.getElementById('rsiPeriod').value),
                rsiBuy: parseInt(document.getElementById('rsiBuy').value),
                rsiSell: parseInt(document.getElementById('rsiSell').value)
            };
            
            window.quantumSniper.updateSettings(newSettings);
            window.quantumSniper.saveSettings();
            closeSettings();
        }

        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to defaults?')) {
                window.quantumSniper.resetSettings();
            }
        }

        // =============================================================================
        // INITIALIZATION
        // =============================================================================
        document.addEventListener('DOMContentLoaded', () => {
            window.quantumSniper = new QuantumSniperDashboard();
        });
    </script>
</body>
</html>
