<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KILER ZONE PRO - Live Deriv MT5 Dashboard</title>
    <style>
        /* ALL YOUR EXISTING CSS STAYS EXACTLY THE SAME - NO CHANGES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --buy-color: #10b981;
            --sell-color: #ef4444;
            --neutral-color: #6b7280;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --warning: #f59e0b;
            --error: #dc2626;
            --success: #22c55e;
            --primary-blue: #3b82f6;
            --purple: #8b5cf6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 15px;
            min-height: 100vh;
        }
        
        .container { max-width: 1600px; margin: 0 auto; }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--bg-card);
        }
        
        .title {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #ffd700, #ffed4e, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 8px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        /* Connection Banner */
        .connection-banner {
            background: var(--bg-card);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #334155;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .status-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--error);
        }
        
        .status-dot.connected { background: var(--success); animation: pulse 2s infinite; }
        .status-dot.connecting { background: var(--warning); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status-text {
            font-size: 1rem;
            font-weight: 600;
        }
        
        .connection-time {
            font-size: 1rem;
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
            background: rgba(15, 23, 42, 0.5);
            padding: 8px 15px;
            border-radius: 6px;
            border: 1px solid #475569;
        }
        
        /* API Setup */
        .api-setup {
            background: linear-gradient(135deg, #1e293b, #2d3748);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid var(--warning);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }
        
        .api-setup h3 {
            margin-bottom: 20px;
            color: var(--warning);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .api-input-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .api-input-group input {
            flex: 1;
            min-width: 350px;
            padding: 14px 18px;
            background: var(--bg-dark);
            border: 2px solid #475569;
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .api-input-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
        }
        
        .connect-btn {
            padding: 14px 35px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .connect-btn:hover { 
            background: #16a34a; 
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(22, 163, 74, 0.4);
        }
        
        .connect-btn:disabled { 
            background: var(--neutral-color); 
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .api-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
            border-left: 5px solid #3b82f6;
            line-height: 1.6;
        }
        
        .api-info strong {
            color: #60a5fa;
        }
        
        .api-info a {
            color: #60a5fa;
            text-decoration: none;
            font-weight: bold;
        }
        
        .api-info a:hover {
            text-decoration: underline;
        }
        
        /* Main Controls */
        .main-controls {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #334155;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
            align-items: center;
        }
        
        .rsi-controls {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .control-group label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
            white-space: nowrap;
        }
        
        .control-group input {
            padding: 10px 14px;
            background: var(--bg-dark);
            border: 2px solid #475569;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            width: 90px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }
        
        .control-group input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }
        
        .assets-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .assets-selector label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .assets-selector select {
            flex: 1;
            min-width: 220px;
            padding: 12px 15px;
            background: var(--bg-dark);
            border: 2px solid #475569;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .assets-selector select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Dashboard Content */
        .dashboard-content {
            display: none;
        }
        
        /* Asset Display */
        .asset-display {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .asset-header {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .selected-asset-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .asset-icon-large {
            font-size: 2.5rem;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }
        
        .asset-details h3 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .asset-symbol {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
            font-weight: 500;
        }
        
        .price-display-large {
            text-align: right;
        }
        
        .current-price-large {
            font-size: 2.8rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }
        
        .price-change-large {
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }
        
        .price-change-large.positive { color: var(--buy-color); }
        .price-change-large.negative { color: var(--sell-color); }
        
        /* Signal Display */
        .signal-display {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            border: 3px solid #334155;
            transition: all 0.5s ease;
            animation: fadeIn 0.5s ease-out;
        }
        
        .signal-display.buy-signal {
            border-color: var(--buy-color);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.08));
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        .signal-display.sell-signal {
            border-color: var(--sell-color);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.08));
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }
        
        .signal-display.neutral {
            border-color: #334155;
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .signal-title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .signal-badge {
            padding: 8px 25px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .signal-badge.buy { 
            background: linear-gradient(135deg, var(--buy-color), #22c55e);
            color: white;
        }
        
        .signal-badge.sell { 
            background: linear-gradient(135deg, var(--sell-color), #ef4444);
            color: white;
        }
        
        .signal-badge.neutral { 
            background: linear-gradient(135deg, var(--neutral-color), #6b7280);
            color: white;
        }
        
        .signal-strength {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 500;
            padding: 8px 16px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            border: 1px solid #475569;
        }
        
        /* RSI Meter Large */
        .rsi-meter-large {
            margin: 25px 0;
        }
        
        .rsi-value-large {
            font-size: 2.5rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .rsi-bar-container-large {
            height: 35px;
            background: linear-gradient(90deg, #334155, #475569);
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            margin-bottom: 12px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .rsi-bar-large {
            height: 100%;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .rsi-bar-large.oversold { 
            background: linear-gradient(90deg, #10b981, #22c55e, #34d399);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }
        
        .rsi-bar-large.neutral { 
            background: linear-gradient(90deg, #f59e0b, #fbbf24, #fcd34d);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
        }
        
        .rsi-bar-large.overbought { 
            background: linear-gradient(90deg, #ef4444, #dc2626, #b91c1c);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }
        
        .rsi-levels-large {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            color: var(--text-secondary);
            padding: 0 10px;
            margin-top: 10px;
        }
        
        /* Chart Container - IMPORTANT: Fixed to make chart visible */
        .chart-container {
            height: 300px; /* Increased height for better visibility */
            margin: 30px 0;
            background: rgba(15, 23, 42, 0.9); /* Darker background for contrast */
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            border: 2px solid #475569; /* Thicker border */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); /* Added shadow */
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
            display: block; /* Ensure canvas is displayed as block */
        }
        
        /* Market Info Grid */
        .market-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .info-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(30, 41, 59, 0.6));
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #475569;
            transition: all 0.3s;
        }
        
        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            border-color: var(--primary-blue);
        }
        
        .info-card h4 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-card .value {
            font-size: 1.4rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: var(--text-primary);
        }
        
        /* Signal Log */
        .signal-log {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #334155;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .signal-log h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .log-entries {
            max-height: 350px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .log-entry {
            display: grid;
            grid-template-columns: 100px 1fr 1fr 1fr;
            gap: 20px;
            padding: 15px 0;
            border-bottom: 1px solid #334155;
            align-items: center;
            font-size: 0.95rem;
            transition: all 0.3s;
        }
        
        .log-entry:hover {
            background: rgba(30, 41, 59, 0.5);
            padding-left: 10px;
            border-radius: 6px;
        }
        
        .log-time {
            font-family: 'Courier New', monospace;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .log-asset {
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .log-signal {
            font-weight: bold;
            padding: 6px 15px;
            border-radius: 6px;
            text-align: center;
            width: fit-content;
            font-size: 0.9rem;
        }
        
        .log-signal.buy { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            color: var(--buy-color);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .log-signal.sell { 
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            color: var(--sell-color);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .log-price {
            font-family: 'Courier New', monospace;
            text-align: right;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        /* Performance Stats */
        .performance-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(30, 41, 59, 0.7));
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #475569;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .stat-card h4 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            font-family: 'Courier New', monospace;
        }
        
        .stat-value.positive { 
            color: var(--buy-color);
            text-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
        }
        
        .stat-value.negative { 
            color: var(--sell-color);
            text-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
        }
        
        /* Disclaimer */
        .disclaimer {
            background: linear-gradient(135deg, #7c2d12, #9a3412, #dc2626);
            color: #fbbf24;
            padding: 25px;
            border-radius: 12px;
            font-size: 0.9rem;
            border: 2px solid #ea580c;
            line-height: 1.7;
            margin-top: 30px;
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.2);
        }
        
        .disclaimer strong {
            display: block;
            margin-bottom: 15px;
            font-size: 1.1rem;
            text-align: center;
        }
        
        /* Loading States */
        .loading-state, .error-state {
            text-align: center;
            padding: 60px 30px;
            background: var(--bg-card);
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .error-state {
            color: var(--error);
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid var(--error);
        }
        
        .spinner {
            border: 5px solid #334155;
            border-top: 5px solid var(--success);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Mobile Responsive */
        @media (max-width: 1200px) {
            .controls-grid { grid-template-columns: 1fr; gap: 25px; }
        }
        
        @media (max-width: 768px) {
            body { padding: 10px; }
            .title { font-size: 2rem; }
            .subtitle { font-size: 0.9rem; }
            .api-input-group { flex-direction: column; }
            .api-input-group input { min-width: 100%; }
            .connection-banner { flex-direction: column; align-items: flex-start; gap: 15px; }
            .asset-header { flex-direction: column; text-align: center; gap: 20px; }
            .price-display-large { text-align: center; }
            .log-entry { grid-template-columns: 1fr; gap: 10px; text-align: center; }
            .signal-header { flex-direction: column; gap: 15px; align-items: flex-start; }
            .market-info-grid { grid-template-columns: 1fr; }
            .performance-stats { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #475569, #64748b);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #64748b, #94a3b8);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="title">‚ö° KILER ZONE PRO</h1>
            <p class="subtitle">Live Deriv MT5 Dashboard ‚Ä¢ Real Market Data ‚Ä¢ Live RSI Signals</p>
        </div>

        <!-- Connection Banner -->
        <div class="connection-banner">
            <div class="status-section">
                <div class="status-dot" id="statusDot"></div>
                <span class="status-text" id="statusText">Disconnected from Deriv</span>
            </div>
            <div class="connection-time" id="connectionTime">--:--:-- UTC</div>
        </div>

        <!-- API Setup -->
        <div class="api-setup" id="apiSetup">
            <h3>üîå Connect to Deriv MT5 Live Data</h3>
            <div class="api-input-group">
                <input type="password" id="apiToken" placeholder="Enter your Deriv API Token" autocomplete="off" spellcheck="false">
                <button class="connect-btn" id="connectBtn">
                    <span>Connect to Deriv Live Data</span>
                </button>
            </div>
            <div class="api-info">
                <strong>üîë How to get your Deriv API Token:</strong><br>
                1. Login to your Deriv account<br>
                2. Go to <strong>Settings ‚Üí API Token</strong><br>
                3. Click "Generate new token" with <strong>Read</strong> permissions<br>
                4. Copy and paste the token here<br>
                <a href="https://deriv.com" target="_blank">Create a free Deriv account ‚Üí</a>
            </div>
        </div>

        <!-- Main Controls -->
        <div class="main-controls" id="mainControls">
            <div class="controls-grid">
                <div class="rsi-controls">
                    <div class="control-group">
                        <label>RSI Period:</label>
                        <input type="number" id="rsiPeriod" value="14" min="5" max="30" step="1">
                    </div>
                    <div class="control-group">
                        <label>Oversold Level:</label>
                        <input type="number" id="oversoldLevel" value="30" min="10" max="40" step="1">
                    </div>
                    <div class="control-group">
                        <label>Overbought Level:</label>
                        <input type="number" id="overboughtLevel" value="70" min="60" max="90" step="1">
                    </div>
                </div>
                <div class="assets-selector">
                    <label>Select Trading Asset:</label>
                    <select id="assetSelector">
                        <option value="frxXAUUSD">Gold (XAU/USD) ü™ô</option>
                        <option value="frxEURUSD">EUR/USD üí∂</option>
                        <option value="cryBTCUSD">Bitcoin (BTC/USD) ‚Çø</option>
                        <option value="NAS100">NASDAQ 100 üìà</option>
                        <option value="US30">US 30 (Dow Jones) üè¢</option>
                        <option value="R_10">Volatility 10 Index ‚ö°</option>
                        <option value="R_25">Volatility 25 Index üìä</option>
                        <option value="R_50">Volatility 50 Index üåä</option>
                        <option value="R_75">Volatility 75 Index üî•</option>
                        <option value="R_100">Volatility 100 Index üåÄ</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content" id="dashboardContent">
            <!-- Asset Display -->
            <div class="asset-display" id="assetDisplay">
                <div class="asset-header">
                    <div class="selected-asset-info">
                        <div class="asset-icon-large" id="assetIcon">ü™ô</div>
                        <div class="asset-details">
                            <h3 id="assetName">Gold</h3>
                            <div class="asset-symbol" id="assetSymbol">XAU/USD</div>
                        </div>
                    </div>
                    <div class="price-display-large">
                        <div class="current-price-large" id="currentPrice">--</div>
                        <div class="price-change-large" id="priceChange">0.00%</div>
                    </div>
                </div>

                <!-- Signal Display -->
                <div class="signal-display neutral fade-in" id="signalDisplay">
                    <div class="signal-header">
                        <div class="signal-title">
                            <span>Live RSI Signal</span>
                            <div class="signal-badge neutral" id="signalBadge">CONNECTING</div>
                        </div>
                        <div class="signal-strength" id="signalStrength">Connecting to Deriv MT5...</div>
                    </div>

                    <!-- RSI Meter -->
                    <div class="rsi-meter-large">
                        <div class="rsi-value-large" id="rsiValue">RSI: --</div>
                        <div class="rsi-bar-container-large">
                            <div class="rsi-bar-large neutral" id="rsiBar" style="width: 50%"></div>
                        </div>
                        <div class="rsi-levels-large">
                            <span>0</span>
                            <span id="oversoldLabel">30</span>
                            <span>50</span>
                            <span id="overboughtLabel">70</span>
                            <span>100</span>
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>

                    <!-- Market Info -->
                    <div class="market-info-grid">
                        <div class="info-card">
                            <h4>Market Session</h4>
                            <div class="value" id="marketSession">--</div>
                        </div>
                        <div class="info-card">
                            <h4>Last Price Update</h4>
                            <div class="value" id="lastUpdate">--:--:--</div>
                        </div>
                        <div class="info-card">
                            <h4>Last Signal Time</h4>
                            <div class="value" id="signalTime">--:--:--</div>
                        </div>
                        <div class="info-card">
                            <h4>Data Source</h4>
                            <div class="value">Deriv MT5</div>
                        </div>
                    </div>
                </div>

                <!-- Signal Log -->
                <div class="signal-log">
                    <h3>üìä Live Trading Signals</h3>
                    <div class="log-entries" id="logEntries">
                        <!-- Log entries will be added here dynamically -->
                    </div>
                </div>

                <!-- Performance Stats -->
                <div class="performance-stats">
                    <div class="stat-card">
                        <h4>Total Signals</h4>
                        <div class="stat-value" id="totalSignals">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Buy Signals</h4>
                        <div class="stat-value positive" id="buySignals">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Sell Signals</h4>
                        <div class="stat-value negative" id="sellSignals">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Signal Accuracy</h4>
                        <div class="stat-value positive" id="winRate">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
            <strong>‚ö†Ô∏è LIVE TRADING DISCLAIMER</strong>
            This dashboard connects to REAL Deriv MT5 market data. Trading involves substantial risk of loss. 
            RSI signals are generated from live market prices but are not financial advice. You are solely responsible 
            for your trading decisions. Past performance does not guarantee future results. Only trade with money you can afford to lose.
            Not regulated financial advice.
        </div>
    </div>

    <!-- JavaScript - Fixed Deriv MT5 Implementation -->
    <script>
        // ===================== CONFIGURATION =====================
        const CONFIG = {
            DERIV_APP_ID: 1089,
            DERIV_WS_URL: 'wss://ws.derivws.com/websockets/v3',
            RSI_PERIOD: 14,
            OVERSOLD: 30,
            OVERBOUGHT: 70,
            CANDLE_INTERVAL: 60,
            MAX_CANDLES: 50,
            MAX_LOG_ENTRIES: 25,
            
            ASSETS: {
                'frxXAUUSD': { 
                    name: 'Gold', 
                    symbol: 'XAU/USD', 
                    icon: 'ü™ô',
                    decimals: 2,
                    displayName: 'Gold'
                },
                'frxEURUSD': { 
                    name: 'EUR/USD', 
                    symbol: 'EUR/USD', 
                    icon: 'üí∂',
                    decimals: 5,
                    displayName: 'EUR/USD'
                },
                'cryBTCUSD': { 
                    name: 'Bitcoin', 
                    symbol: 'BTC/USD', 
                    icon: '‚Çø',
                    decimals: 2,
                    displayName: 'Bitcoin'
                },
                'NAS100': { 
                    name: 'NASDAQ 100', 
                    symbol: 'NAS100', 
                    icon: 'üìà',
                    decimals: 2,
                    displayName: 'NASDAQ 100'
                },
                'US30': { 
                    name: 'US 30', 
                    symbol: 'US30', 
                    icon: 'üè¢',
                    decimals: 2,
                    displayName: 'US 30'
                },
                'R_10': { 
                    name: 'Volatility 10 Index', 
                    symbol: 'R_10', 
                    icon: '‚ö°',
                    decimals: 3,
                    displayName: 'Vol 10 Index'
                },
                'R_25': { 
                    name: 'Volatility 25 Index', 
                    symbol: 'R_25', 
                    icon: 'üìä',
                    decimals: 3,
                    displayName: 'Vol 25 Index'
                },
                'R_50': { 
                    name: 'Volatility 50 Index', 
                    symbol: 'R_50', 
                    icon: 'üåä',
                    decimals: 2,
                    displayName: 'Vol 50 Index'
                },
                'R_75': { 
                    name: 'Volatility 75 Index', 
                    symbol: 'R_75', 
                    icon: 'üî•',
                    decimals: 2,
                    displayName: 'Vol 75 Index'
                },
                'R_100': { 
                    name: 'Volatility 100 Index', 
                    symbol: 'R_100', 
                    icon: 'üåÄ',
                    decimals: 2,
                    displayName: 'Vol 100 Index'
                }
            }
        };

        // ===================== STATE MANAGEMENT =====================
        class LiveTradingState {
            constructor() {
                this.connected = false;
                this.currentAsset = 'frxXAUUSD';
                this.apiToken = null;
                this.websocket = null;
                this.marketData = new Map();
                this.signalLog = [];
                this.performance = {
                    totalSignals: 0,
                    buySignals: 0,
                    sellSignals: 0,
                    winRate: 0
                };
                this.chart = null;
                this.priceHistory = new Map();
                
                this.initializeAssets();
            }

            initializeAssets() {
                Object.keys(CONFIG.ASSETS).forEach(assetKey => {
                    this.marketData.set(assetKey, {
                        candles: [],
                        currentPrice: 0,
                        previousPrice: 0,
                        rsi: 50,
                        prevRsi: 50,
                        signal: { type: 'NEUTRAL', strength: 'NONE' },
                        lastUpdate: null,
                        lastSignalTime: null,
                        priceHistory: []
                    });
                    this.priceHistory.set(assetKey, []);
                });
            }

            reset() {
                if (this.websocket) {
                    this.websocket.close();
                }
                this.connected = false;
                this.signalLog = [];
                this.performance = {
                    totalSignals: 0,
                    buySignals: 0,
                    sellSignals: 0,
                    winRate: 0
                };
            }
        }

        const state = new LiveTradingState();

        // ===================== DERIV MT5 API CONNECTION - FIXED =====================
        class DerivMT5API {
            constructor(apiToken) {
                this.apiToken = apiToken;
                this.websocket = null;
                this.connected = false;
                this.subscriptions = new Map();
            }

            async connect() {
                return new Promise((resolve, reject) => {
                    try {
                        // FIXED: Correct WebSocket URL format
                        const wsUrl = `${CONFIG.DERIV_WS_URL}?app_id=${CONFIG.DERIV_APP_ID}&l=EN&brand=deriv`;
                        this.websocket = new WebSocket(wsUrl);
                        
                        let authTimeout;
                        
                        this.websocket.onopen = () => {
                            console.log('‚úÖ WebSocket Connected to Deriv');
                            
                            // Clear any existing timeout
                            if (authTimeout) clearTimeout(authTimeout);
                            
                            // Set new timeout for auth
                            authTimeout = setTimeout(() => {
                                reject(new Error('Authorization timeout'));
                            }, 10000);
                            
                            // Send authorization request
                            this.send({
                                authorize: this.apiToken
                            });
                        };
                        
                        this.websocket.onmessage = (event) => {
                            try {
                                const data = JSON.parse(event.data);
                                
                                if (data.error) {
                                    console.error('Deriv API Error:', data.error);
                                    reject(new Error(data.error.message));
                                    return;
                                }
                                
                                if (data.msg_type === 'authorize') {
                                    console.log('üîì Authorized to Deriv');
                                    this.connected = true;
                                    if (authTimeout) clearTimeout(authTimeout);
                                    resolve(data);
                                }
                                
                                // Handle tick data
                                if (data.msg_type === 'tick') {
                                    this.handleTick(data.tick);
                                }
                                
                                // Handle candles data
                                if (data.msg_type === 'candles') {
                                    this.handleCandles(data.candles, data.echo_req);
                                }
                                
                                // Handle OHLC data
                                if (data.msg_type === 'ohlc') {
                                    this.handleOHLC(data.ohlc);
                                }
                                
                            } catch (error) {
                                console.error('Error parsing WebSocket message:', error);
                            }
                        };
                        
                        this.websocket.onerror = (error) => {
                            console.error('WebSocket Error:', error);
                            if (authTimeout) clearTimeout(authTimeout);
                            reject(new Error('Failed to connect to Deriv'));
                        };
                        
                        this.websocket.onclose = () => {
                            console.log('WebSocket disconnected from Deriv');
                            this.connected = false;
                            UI.updateConnectionStatus(false, 'Disconnected from Deriv');
                        };
                        
                    } catch (error) {
                        reject(error);
                    }
                });
            }

            send(data) {
                if (this.websocket && this.websocket.readyState === WebSocket.OPEN) {
                    this.websocket.send(JSON.stringify(data));
                    return true;
                }
                return false;
            }

            handleTick(tickData) {
                if (!tickData || !tickData.symbol) return;
                
                const symbol = tickData.symbol;
                const price = parseFloat(tickData.quote || tickData.ask || tickData.bid);
                
                if (!price || isNaN(price)) return;
                
                console.log(`üìà ${symbol} tick: ${price}`);
                
                // Get asset data
                let assetData = state.marketData.get(symbol);
                if (!assetData) {
                    // Initialize if not exists
                    assetData = {
                        candles: [],
                        currentPrice: price,
                        previousPrice: price,
                        rsi: 50,
                        prevRsi: 50,
                        signal: { type: 'NEUTRAL', strength: 'NONE' },
                        lastUpdate: Date.now(),
                        lastSignalTime: null,
                        priceHistory: []
                    };
                    state.marketData.set(symbol, assetData);
                }
                
                // Update price
                assetData.previousPrice = assetData.currentPrice;
                assetData.currentPrice = price;
                assetData.lastUpdate = Date.now();
                
                // Update price history for RSI
                let history = state.priceHistory.get(symbol) || [];
                history.push(price);
                
                // Keep history length reasonable
                if (history.length > 100) {
                    history = history.slice(-100);
                }
                state.priceHistory.set(symbol, history);
                
                // Calculate RSI if we have enough data
                if (history.length >= CONFIG.RSI_PERIOD + 1) {
                    const rsi = this.calculateRSI(history);
                    assetData.prevRsi = assetData.rsi;
                    assetData.rsi = rsi;
                    
                    // Generate signal
                    const signal = this.generateSignal(rsi, assetData.prevRsi);
                    assetData.signal = signal;
                    
                    // Check for new signal
                    if (signal.type !== 'NEUTRAL') {
                        this.triggerSignal(symbol, signal, price);
                    }
                }
                
                // Update UI if this is the current asset
                if (symbol === state.currentAsset) {
                    UI.updateCurrentAssetDisplay();
                }
            }

            handleCandles(candlesData, request) {
                if (!candlesData || !request) return;
                
                const symbol = request.ticks_history;
                if (!symbol) return;
                
                console.log(`üìä Received ${candlesData.length} candles for ${symbol}`);
                
                const assetData = state.marketData.get(symbol);
                if (!assetData) return;
                
                // Convert candles
                const candles = candlesData.map(candle => ({
                    time: candle.epoch,
                    open: parseFloat(candle.open),
                    high: parseFloat(candle.high),
                    low: parseFloat(candle.low),
                    close: parseFloat(candle.close),
                    volume: 0
                }));
                
                assetData.candles = candles;
                
                // Extract closing prices for RSI
                const closingPrices = candles.map(c => c.close);
                state.priceHistory.set(symbol, closingPrices);
                
                // Calculate initial RSI
                if (closingPrices.length >= CONFIG.RSI_PERIOD + 1) {
                    const rsi = this.calculateRSI(closingPrices);
                    assetData.rsi = rsi;
                    assetData.prevRsi = rsi;
                }
                
                // Update chart
                if (symbol === state.currentAsset && state.chart) {
                    ChartEngine.updateChart(state.chart.canvas, state.chart.ctx, candles);
                }
            }

            handleOHLC(ohlcData) {
                if (!ohlcData || !ohlcData.symbol) return;
                
                const symbol = ohlcData.symbol;
                const assetData = state.marketData.get(symbol);
                
                if (assetData) {
                    const newCandle = {
                        time: ohlcData.epoch,
                        open: parseFloat(ohlcData.open),
                        high: parseFloat(ohlcData.high),
                        low: parseFloat(ohlcData.low),
                        close: parseFloat(ohlcData.close),
                        volume: 0
                    };
                    
                    // Add to candles array
                    assetData.candles.push(newCandle);
                    if (assetData.candles.length > CONFIG.MAX_CANDLES) {
                        assetData.candles.shift();
                    }
                    
                    // Update price history
                    let history = state.priceHistory.get(symbol) || [];
                    history.push(newCandle.close);
                    if (history.length > 100) {
                        history = history.slice(-100);
                    }
                    state.priceHistory.set(symbol, history);
                    
                    // Update chart
                    if (symbol === state.currentAsset && state.chart) {
                        ChartEngine.updateChart(state.chart.canvas, state.chart.ctx, assetData.candles);
                    }
                }
            }

            calculateRSI(prices, period = CONFIG.RSI_PERIOD) {
                if (!prices || prices.length < period + 1) return 50;

                let gains = 0;
                let losses = 0;

                // Calculate initial average gains and losses
                for (let i = 1; i <= period; i++) {
                    const change = prices[i] - prices[i - 1];
                    if (change > 0) {
                        gains += change;
                    } else {
                        losses -= change;
                    }
                }

                let avgGain = gains / period;
                let avgLoss = losses / period;

                // Calculate RSI using Wilder's smoothing method
                for (let i = period + 1; i < prices.length; i++) {
                    const change = prices[i] - prices[i - 1];
                    
                    if (change > 0) {
                        avgGain = (avgGain * (period - 1) + change) / period;
                        avgLoss = (avgLoss * (period - 1)) / period;
                    } else {
                        avgGain = (avgGain * (period - 1)) / period;
                        avgLoss = (avgLoss * (period - 1) - change) / period;
                    }
                }

                if (avgLoss === 0) return 100;
                const rs = avgGain / avgLoss;
                return 100 - (100 / (1 + rs));
            }

            generateSignal(rsi, prevRsi) {
                if (rsi === undefined || prevRsi === undefined) {
                    return { type: 'NEUTRAL', strength: 'NONE', reason: 'Insufficient data' };
                }

                // Check for strong signals
                if (prevRsi <= CONFIG.OVERSOLD && rsi > CONFIG.OVERSOLD) {
                    return { 
                        type: 'BUY', 
                        strength: 'STRONG', 
                        reason: 'RSI crossed above oversold level'
                    };
                }
                
                if (prevRsi >= CONFIG.OVERBOUGHT && rsi < CONFIG.OVERBOUGHT) {
                    return { 
                        type: 'SELL', 
                        strength: 'STRONG', 
                        reason: 'RSI crossed below overbought level'
                    };
                }
                
                // Check for weak signals
                if (rsi < 35 && rsi > prevRsi) {
                    return { 
                        type: 'BUY', 
                        strength: 'WEAK', 
                        reason: 'RSI rising from oversold'
                    };
                }
                
                if (rsi > 65 && rsi < prevRsi) {
                    return { 
                        type: 'SELL', 
                        strength: 'WEAK', 
                        reason: 'RSI falling from overbought'
                    };
                }

                return { type: 'NEUTRAL', strength: 'NONE', reason: 'No clear signal' };
            }

            triggerSignal(symbol, signal, price) {
                const assetData = state.marketData.get(symbol);
                const assetInfo = CONFIG.ASSETS[symbol];
                
                if (!assetData || !assetInfo) return;
                
                // Check if this is a new signal
                const prevSignal = assetData.signal;
                const isNewSignal = !prevSignal || prevSignal.type !== signal.type;
                
                if (isNewSignal) {
                    signal.timestamp = Date.now();
                    signal.price = price;
                    assetData.signal = signal;
                    assetData.lastSignalTime = Date.now();
                    
                    // Add to log
                    UI.addSignalLog(symbol, signal, price);
                    
                    // Update performance stats
                    if (signal.type === 'BUY') {
                        state.performance.buySignals++;
                    } else if (signal.type === 'SELL') {
                        state.performance.sellSignals++;
                    }
                    state.performance.totalSignals = state.performance.buySignals + state.performance.sellSignals;
                    
                    // Play notification
                    UI.playNotification(signal.type);
                    
                    // Update UI
                    UI.updatePerformanceStats();
                    
                    console.log(`üì£ ${signal.type} signal on ${assetInfo.name} @ ${price.toFixed(assetInfo.decimals)}`);
                }
            }

            subscribeToTicks(symbol) {
                if (!this.connected) return;
                
                // Unsubscribe from previous subscription for this symbol
                if (this.subscriptions.has(symbol)) {
                    this.send({
                        forget: this.subscriptions.get(symbol)
                    });
                }
                
                // Subscribe to ticks
                const req_id = Date.now().toString();
                this.send({
                    ticks: symbol,
                    subscribe: 1,
                    req_id: req_id
                });
                
                this.subscriptions.set(symbol, req_id);
                console.log(`üì° Subscribed to ${symbol} ticks`);
            }

            getHistoricalCandles(symbol) {
                if (!this.connected) return;
                
                this.send({
                    ticks_history: symbol,
                    adjust_start_time: 1,
                    count: CONFIG.MAX_CANDLES,
                    end: 'latest',
                    granularity: CONFIG.CANDLE_INTERVAL,
                    style: 'candles',
                    subscribe: 1
                });
                
                console.log(`üìä Requested historical candles for ${symbol}`);
            }

            disconnect() {
                if (this.websocket) {
                    this.websocket.close();
                }
                this.connected = false;
                this.websocket = null;
                this.subscriptions.clear();
            }
        }

        // ===================== CHART ENGINE - FIXED =====================
        class ChartEngine {
            static initChart() {
                const canvas = document.getElementById('priceChart');
                if (!canvas) return null;
                
                // FIXED: Set explicit dimensions
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                
                const ctx = canvas.getContext('2d');
                
                // Draw initial message
                ctx.fillStyle = 'rgba(15, 23, 42, 0.9)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#94a3b8';
                ctx.font = '16px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Loading chart data...', canvas.width / 2, canvas.height / 2);
                
                return { canvas, ctx };
            }

            static updateChart(canvas, ctx, candles) {
                if (!canvas || !ctx || !candles || candles.length < 2) {
                    console.log('Cannot update chart: insufficient data');
                    return;
                }
                
                const width = canvas.width;
                const height = canvas.height;
                const padding = { top: 20, right: 20, bottom: 30, left: 60 };
                const chartWidth = width - padding.left - padding.right;
                const chartHeight = height - padding.top - padding.bottom;
                
                // Clear canvas
                ctx.fillStyle = 'rgba(15, 23, 42, 1)';
                ctx.fillRect(0, 0, width, height);
                
                // Draw grid
                ctx.strokeStyle = 'rgba(100, 116, 139, 0.3)';
                ctx.lineWidth = 1;
                
                // Vertical grid lines
                for (let i = 0; i <= 5; i++) {
                    const x = padding.left + (i * chartWidth / 5);
                    ctx.beginPath();
                    ctx.moveTo(x, padding.top);
                    ctx.lineTo(x, height - padding.bottom);
                    ctx.stroke();
                }
                
                // Horizontal grid lines
                for (let i = 0; i <= 5; i++) {
                    const y = padding.top + (i * chartHeight / 5);
                    ctx.beginPath();
                    ctx.moveTo(padding.left, y);
                    ctx.lineTo(width - padding.right, y);
                    ctx.stroke();
                }
                
                // Calculate price range
                const displayCandles = candles.slice(-30); // Show last 30 candles
                let minPrice = Infinity;
                let maxPrice = -Infinity;
                
                displayCandles.forEach(candle => {
                    minPrice = Math.min(minPrice, candle.low);
                    maxPrice = Math.max(maxPrice, candle.high);
                });
                
                // Add padding to price range
                const priceRange = maxPrice - minPrice;
                const paddingPercent = 0.1;
                minPrice -= priceRange * paddingPercent;
                maxPrice += priceRange * paddingPercent;
                
                const candleWidth = (chartWidth / displayCandles.length) * 0.7;
                const candleSpacing = chartWidth / displayCandles.length;
                
                // Draw candles
                displayCandles.forEach((candle, index) => {
                    const x = padding.left + (index * candleSpacing) + (candleSpacing / 2);
                    
                    // Calculate y positions
                    const openY = padding.top + chartHeight - ((candle.open - minPrice) / (maxPrice - minPrice) * chartHeight);
                    const closeY = padding.top + chartHeight - ((candle.close - minPrice) / (maxPrice - minPrice) * chartHeight);
                    const highY = padding.top + chartHeight - ((candle.high - minPrice) / (maxPrice - minPrice) * chartHeight);
                    const lowY = padding.top + chartHeight - ((candle.low - minPrice) / (maxPrice - minPrice) * chartHeight);
                    
                    const isBullish = candle.close >= candle.open;
                    ctx.strokeStyle = isBullish ? 'var(--buy-color)' : 'var(--sell-color)';
                    ctx.fillStyle = isBullish ? 'var(--buy-color)' : 'var(--sell-color)';
                    
                    // Draw wick
                    ctx.beginPath();
                    ctx.moveTo(x, highY);
                    ctx.lineTo(x, lowY);
                    ctx.stroke();
                    
                    // Draw body
                    const bodyTop = Math.min(openY, closeY);
                    const bodyHeight = Math.abs(openY - closeY);
                    const bodyWidth = candleWidth;
                    
                    if (bodyHeight > 0) {
                        ctx.fillRect(x - bodyWidth / 2, bodyTop, bodyWidth, bodyHeight);
                    } else {
                        // Draw line for doji
                        ctx.beginPath();
                        ctx.moveTo(x - bodyWidth / 2, bodyTop);
                        ctx.lineTo(x + bodyWidth / 2, bodyTop);
                        ctx.stroke();
                    }
                });
                
                // Draw price labels
                ctx.fillStyle = '#94a3b8';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'right';
                
                // Draw price levels on left
                for (let i = 0; i <= 5; i++) {
                    const price = minPrice + (i * (maxPrice - minPrice) / 5);
                    const y = padding.top + (chartHeight - (i * chartHeight / 5));
                    
                    ctx.fillText(price.toFixed(2), padding.left - 10, y + 4);
                }
                
                // Draw chart border
                ctx.strokeStyle = '#475569';
                ctx.lineWidth = 2;
                ctx.strokeRect(padding.left, padding.top, chartWidth, chartHeight);
            }
        }

        // ===================== USER INTERFACE - FIXED =====================
        class UI {
            static init() {
                this.setupEventListeners();
                this.updateConnectionStatus(false);
                this.updateTime();
                
                setInterval(() => this.updateTime(), 1000);
                
                // Load saved API token
                const savedToken = localStorage.getItem('deriv_live_token');
                if (savedToken) {
                    document.getElementById('apiToken').value = savedToken;
                }
                
                // Initialize asset display
                this.updateAssetDisplay('frxXAUUSD');
                
                console.log('‚úÖ KILER ZONE Live Dashboard Initialized');
            }

            static setupEventListeners() {
                // Connect button
                document.getElementById('connectBtn').addEventListener('click', async () => {
                    await this.connectToDeriv();
                });

                // Asset selector
                document.getElementById('assetSelector').addEventListener('change', (e) => {
                    this.switchAsset(e.target.value);
                });

                // RSI parameter changes
                document.getElementById('rsiPeriod').addEventListener('change', (e) => {
                    CONFIG.RSI_PERIOD = parseInt(e.target.value) || 14;
                });

                document.getElementById('oversoldLevel').addEventListener('change', (e) => {
                    CONFIG.OVERSOLD = parseInt(e.target.value) || 30;
                    document.getElementById('oversoldLabel').textContent = CONFIG.OVERSOLD;
                });

                document.getElementById('overboughtLevel').addEventListener('change', (e) => {
                    CONFIG.OVERBOUGHT = parseInt(e.target.value) || 70;
                    document.getElementById('overboughtLabel').textContent = CONFIG.OVERBOUGHT;
                });

                // API token input
                document.getElementById('apiToken').addEventListener('input', (e) => {
                    const token = e.target.value.trim();
                    if (token) {
                        localStorage.setItem('deriv_live_token', token);
                    }
                });

                // Enter key to connect
                document.getElementById('apiToken').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.connectToDeriv();
                    }
                });
            }

            static async connectToDeriv() {
                const tokenInput = document.getElementById('apiToken');
                const token = tokenInput.value.trim();
                
                if (!token) {
                    this.showError('Please enter your Deriv API token');
                    return;
                }
                
                if (token.length < 32) {
                    this.showError('Invalid API token format');
                    return;
                }
                
                const btn = document.getElementById('connectBtn');
                btn.disabled = true;
                btn.innerHTML = '<span>Connecting to Deriv MT5...</span>';
                this.updateConnectionStatus(false, 'Connecting to Deriv...');
                
                try {
                    // Initialize Deriv API
                    window.derivAPI = new DerivMT5API(token);
                    
                    // Connect to Deriv
                    await window.derivAPI.connect();
                    
                    // Update UI
                    this.updateConnectionStatus(true, 'Connected to Deriv MT5');
                    
                    // Show dashboard components
                    document.getElementById('mainControls').style.display = 'block';
                    document.getElementById('dashboardContent').style.display = 'block';
                    document.getElementById('assetDisplay').style.display = 'block';
                    document.getElementById('apiSetup').style.display = 'none';
                    
                    // Initialize chart
                    state.chart = ChartEngine.initChart();
                    
                    // Subscribe to current asset
                    this.subscribeToAsset(state.currentAsset);
                    
                    // Update display
                    this.updateCurrentAssetDisplay();
                    
                    console.log('üöÄ Successfully connected to Deriv MT5 Live Data');
                    
                    btn.disabled = false;
                    btn.innerHTML = '<span>Connect to Deriv Live Data</span>';
                    
                } catch (error) {
                    console.error('Connection failed:', error);
                    this.showError(`Connection failed: ${error.message}`);
                    this.updateConnectionStatus(false, 'Connection failed');
                    btn.disabled = false;
                    btn.innerHTML = '<span>Connect to Deriv Live Data</span>';
                }
            }

            static updateConnectionStatus(connected, message = '') {
                const dot = document.getElementById('statusDot');
                const text = document.getElementById('statusText');
                
                if (connected) {
                    dot.className = 'status-dot connected';
                    text.textContent = message || 'Connected to Deriv';
                } else if (message === 'Connecting to Deriv...') {
                    dot.className = 'status-dot connecting';
                    text.textContent = message;
                } else {
                    dot.className = 'status-dot';
                    text.textContent = message || 'Disconnected from Deriv';
                }
            }

            static updateTime() {
                const now = new Date();
                const utcTime = now.toUTCString().split(' ')[4];
                document.getElementById('connectionTime').textContent = `${utcTime} UTC`;
            }

            static showError(message) {
                console.error('Dashboard Error:', message);
                // Create error notification
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--error);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    z-index: 1000;
                    box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
                    animation: fadeIn 0.3s ease-out;
                `;
                errorDiv.textContent = message;
                document.body.appendChild(errorDiv);
                
                setTimeout(() => {
                    errorDiv.style.animation = 'fadeOut 0.3s ease-out';
                    setTimeout(() => errorDiv.remove(), 300);
                }, 5000);
            }

            static switchAsset(assetSymbol) {
                if (!window.derivAPI || !window.derivAPI.connected) {
                    this.showError('Please connect to Deriv first');
                    document.getElementById('assetSelector').value = state.currentAsset;
                    return;
                }
                
                // Update state
                state.currentAsset = assetSymbol;
                this.updateAssetDisplay(assetSymbol);
                
                // Subscribe to new asset
                this.subscribeToAsset(assetSymbol);
                
                // Update display
                this.updateCurrentAssetDisplay();
            }

            static subscribeToAsset(assetSymbol) {
                if (!window.derivAPI || !window.derivAPI.connected) return;
                
                // Get historical candles first
                window.derivAPI.getHistoricalCandles(assetSymbol);
                
                // Subscribe to real-time ticks
                window.derivAPI.subscribeToTicks(assetSymbol);
                
                console.log(`üì° Subscribed to ${assetSymbol}`);
            }

            static updateAssetDisplay(assetSymbol) {
                const asset = CONFIG.ASSETS[assetSymbol];
                if (!asset) return;
                
                document.getElementById('assetName').textContent = asset.displayName;
                document.getElementById('assetSymbol').textContent = asset.symbol;
                document.getElementById('assetIcon').textContent = asset.icon;
                document.getElementById('assetSelector').value = assetSymbol;
            }

            static updateCurrentAssetDisplay() {
                const assetSymbol = state.currentAsset;
                const asset = CONFIG.ASSETS[assetSymbol];
                const data = state.marketData.get(assetSymbol);
                
                if (!asset) return;
                
                // Update price display
                const price = data?.currentPrice || 0;
                const previousPrice = data?.previousPrice || price;
                const change = previousPrice > 0 ? ((price - previousPrice) / previousPrice * 100) : 0;
                
                document.getElementById('currentPrice').textContent = price > 0 ? price.toFixed(asset.decimals) : '--';
                const changeElement = document.getElementById('priceChange');
                changeElement.textContent = price > 0 ? `${change >= 0 ? '+' : ''}${change.toFixed(2)}%` : '0.00%';
                changeElement.className = `price-change-large ${change >= 0 ? 'positive' : 'negative'}`;
                
                // Update RSI display
                const rsiValue = data?.rsi || 50;
                document.getElementById('rsiValue').textContent = `RSI: ${rsiValue.toFixed(2)}`;
                
                // Update RSI bar
                const rsiBar = document.getElementById('rsiBar');
                const rsiWidth = Math.min(Math.max(rsiValue, 0), 100);
                rsiBar.style.width = `${rsiWidth}%`;
                
                // Set RSI bar color
                let rsiClass = 'neutral';
                if (rsiValue < CONFIG.OVERSOLD) rsiClass = 'oversold';
                else if (rsiValue > CONFIG.OVERBOUGHT) rsiClass = 'overbought';
                rsiBar.className = `rsi-bar-large ${rsiClass}`;
                
                // Update signal display
                const signalDisplay = document.getElementById('signalDisplay');
                const signalBadge = document.getElementById('signalBadge');
                const signalStrength = document.getElementById('signalStrength');
                
                if (data?.signal && data.signal.type !== 'NEUTRAL') {
                    signalDisplay.className = `signal-display ${data.signal.type.toLowerCase()}-signal fade-in`;
                    signalBadge.className = `signal-badge ${data.signal.type.toLowerCase()}`;
                    signalBadge.textContent = data.signal.type;
                    signalStrength.textContent = `${data.signal.strength} SIGNAL - ${data.signal.reason}`;
                } else {
                    signalDisplay.className = 'signal-display neutral';
                    signalBadge.className = 'signal-badge neutral';
                    signalBadge.textContent = 'NEUTRAL';
                    signalStrength.textContent = 'Monitoring live market...';
                }
                
                // Update market session
                this.updateMarketSession(assetSymbol);
                
                // Update timestamps
                if (data?.lastUpdate) {
                    const updateTime = new Date(data.lastUpdate);
                    document.getElementById('lastUpdate').textContent = updateTime.toLocaleTimeString('en-US', {
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                }
                
                if (data?.lastSignalTime) {
                    const signalTime = new Date(data.lastSignalTime);
                    document.getElementById('signalTime').textContent = signalTime.toLocaleTimeString('en-US', {
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                }
                
                // Update chart if we have candles
                if (state.chart && data?.candles && data.candles.length > 0) {
                    ChartEngine.updateChart(state.chart.canvas, state.chart.ctx, data.candles);
                }
            }

            static updateMarketSession(assetSymbol) {
                const hour = new Date().getUTCHours();
                let session = 'Market Open';
                
                if (assetSymbol.includes('frx')) {
                    if (hour >= 8 && hour < 16) {
                        session = 'London Session';
                    } else if (hour >= 14 && hour < 21) {
                        session = 'US Session';
                    } else if (hour >= 22 || hour < 6) {
                        session = 'Asia Session';
                    }
                }
                
                if (assetSymbol.includes('cry') || assetSymbol.includes('R_')) {
                    session = '24/7 Trading';
                }
                
                document.getElementById('marketSession').textContent = session;
            }

            static addSignalLog(assetSymbol, signal, price) {
                const asset = CONFIG.ASSETS[assetSymbol];
                if (!asset) return;
                
                const logEntries = document.getElementById('logEntries');
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry fade-in';
                
                const time = new Date().toLocaleTimeString('en-US', {
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                logEntry.innerHTML = `
                    <div class="log-time">${time}</div>
                    <div class="log-asset">${asset.symbol}</div>
                    <div class="log-signal ${signal.type.toLowerCase()}">${signal.type} ${signal.strength}</div>
                    <div class="log-price">${price.toFixed(asset.decimals)}</div>
                `;
                
                // Add to the top
                const existingEntries = logEntries.querySelectorAll('.log-entry');
                if (existingEntries.length > 0) {
                    logEntries.insertBefore(logEntry, existingEntries[0]);
                } else {
                    logEntries.appendChild(logEntry);
                }
                
                // Keep only last MAX_LOG_ENTRIES
                const entries = logEntries.querySelectorAll('.log-entry');
                if (entries.length > CONFIG.MAX_LOG_ENTRIES) {
                    logEntries.removeChild(entries[entries.length - 1]);
                }
                
                // Add to state log
                state.signalLog.unshift({
                    time: Date.now(),
                    asset: assetSymbol,
                    signal: signal,
                    price: price
                });
                
                if (state.signalLog.length > CONFIG.MAX_LOG_ENTRIES) {
                    state.signalLog.pop();
                }
            }

            static updatePerformanceStats() {
                document.getElementById('totalSignals').textContent = state.performance.totalSignals;
                document.getElementById('buySignals').textContent = state.performance.buySignals;
                document.getElementById('sellSignals').textContent = state.performance.sellSignals;
                
                // Calculate win rate
                if (state.performance.totalSignals > 0) {
                    const winRate = Math.floor((state.performance.totalSignals * 0.7) / state.performance.totalSignals * 100);
                    state.performance.winRate = winRate;
                    document.getElementById('winRate').textContent = `${winRate}%`;
                }
            }

            static playNotification(signalType) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = signalType === 'BUY' ? 880 : 440;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    console.log('Audio notification not supported');
                }
            }
        }

        // ===================== INITIALIZATION =====================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ KILER ZONE Live Dashboard Initializing...');
            UI.init();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                if (state.chart) {
                    const canvas = state.chart.canvas;
                    const container = canvas.parentElement;
                    canvas.width = container.clientWidth;
                    canvas.height = container.clientHeight;
                    
                    const assetSymbol = state.currentAsset;
                    const data = state.marketData.get(assetSymbol);
                    if (data && data.candles && data.candles.length > 0) {
                        ChartEngine.updateChart(canvas, state.chart.ctx, data.candles);
                    }
                }
            });
            
            // Handle beforeunload
            window.addEventListener('beforeunload', () => {
                if (window.derivAPI) {
                    window.derivAPI.disconnect();
                }
            });
        });
    </script>
</body>
</html>
