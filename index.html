<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Gold RSI Trading Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .header h1 {
            font-size: 2.2em;
            color: #ffd700;
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .header p {
            color: #b8b8b8;
            font-size: 0.95em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .signal-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timeframe-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
        }

        .timeframe-btn {
            padding: 10px 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #b8b8b8;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9em;
        }

        .timeframe-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .timeframe-btn.active {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #0a0e27;
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .market-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            flex-direction: column;
        }

        .status-label {
            color: #888;
            font-size: 0.8em;
            margin-bottom: 4px;
        }

        .status-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffd700;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(0, 184, 148, 0.2);
            border-radius: 20px;
            border: 1px solid #00b894;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #00b894;
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .signal-display {
            text-align: center;
            margin-bottom: 25px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }

        .signal-badge {
            display: inline-block;
            padding: 18px 45px;
            border-radius: 50px;
            font-size: 1.8em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            animation: pulse 2s infinite;
        }

        .signal-buy {
            background: linear-gradient(135deg, #00b894, #00cec9);
            box-shadow: 0 0 30px rgba(0, 184, 148, 0.6);
        }

        .signal-sell {
            background: linear-gradient(135deg, #d63031, #ff7675);
            box-shadow: 0 0 30px rgba(214, 48, 49, 0.6);
        }

        .signal-neutral {
            background: linear-gradient(135deg, #636e72, #b2bec3);
            box-shadow: 0 0 20px rgba(99, 110, 114, 0.4);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .metric-box {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-label {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 6px;
        }

        .metric-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #ffd700;
        }

        .conditions-list {
            background: rgba(0, 0, 0, 0.3);
            padding: 18px;
            border-radius: 12px;
        }

        .conditions-list h3 {
            color: #ffd700;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .condition-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            font-size: 0.9em;
        }

        .condition-icon {
            width: 20px;
            margin-right: 10px;
            font-size: 1.1em;
        }

        .condition-met { color: #00b894; }
        .condition-not-met { color: #636e72; }

        .session-info {
            background: rgba(255, 215, 0, 0.05);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .session-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .session-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .session-active {
            background: rgba(0, 184, 148, 0.3);
            border: 1px solid #00b894;
            color: #00b894;
        }

        .session-inactive {
            background: rgba(99, 110, 114, 0.2);
            border: 1px solid #636e72;
            color: #888;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #0a0e27;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(214, 48, 49, 0.8);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(214, 48, 49, 1);
        }

        .tradingview-widget-container {
            height: 600px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .disclaimer {
            text-align: center;
            color: #636e72;
            font-size: 0.85em;
            padding: 15px;
            background: rgba(255, 0, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 0, 0, 0.2);
            margin-top: 15px;
        }

        .error-message {
            background: rgba(214, 48, 49, 0.2);
            border: 1px solid rgba(214, 48, 49, 0.4);
            padding: 12px;
            border-radius: 8px;
            color: #ff7675;
            margin-bottom: 15px;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #888;
        }

        .control-panel {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 15px;
        }

        .data-source-info {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.8em;
            color: #b8b8b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Professional Gold RSI Trading Dashboard</h1>
            <p>Real-time XAU/USD Analysis with TradingView Integration ‚Ä¢ Multi-Timeframe RSI Signals</p>
            <div class="data-source-info">
                üî¥ Live TradingView Chart | üü° Simulated RSI Signals | üü¢ Real Market Sessions
            </div>
        </div>

        <div class="main-grid">
            <!-- Left: Chart Section -->
            <div class="chart-section">
                <div class="control-panel">
                    <button class="btn btn-primary" onclick="refreshData()" id="refreshBtn">üîÑ Refresh Data</button>
                    <button class="btn btn-secondary" onclick="resetData()">üîÑ Reset</button>
                    <button class="btn" onclick="toggleDataMode()" id="dataModeBtn" style="background: rgba(0, 184, 148, 0.8); color: white;">üåê Live Mode</button>
                </div>
                
                <div class="timeframe-selector">
                    <button class="timeframe-btn" onclick="changeTimeframe('1', this)">1M</button>
                    <button class="timeframe-btn" onclick="changeTimeframe('5', this)">5M</button>
                    <button class="timeframe-btn" onclick="changeTimeframe('15', this)">15M</button>
                    <button class="timeframe-btn active" onclick="changeTimeframe('60', this)">1H</button>
                    <button class="timeframe-btn" onclick="changeTimeframe('240', this)">4H</button>
                    <button class="timeframe-btn" onclick="changeTimeframe('D', this)">1D</button>
                </div>

                <!-- TradingView Chart Widget -->
                <div class="tradingview-widget-container">
                    <div id="tradingview_chart"></div>
                    <div id="chartLoading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #888; font-size: 1.2em;">
                        Loading TradingView Chart...
                    </div>
                </div>
            </div>

            <!-- Right: Signal Panel -->
            <div class="signal-panel">
                <div class="market-status">
                    <div class="status-item">
                        <span class="status-label">Market Status</span>
                        <div id="marketStatus">
                            <div class="live-indicator">
                                <div class="live-dot"></div>
                                <span style="color: #00b894; font-weight: bold; font-size: 0.9em;">CONNECTING...</span>
                            </div>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Current Session</span>
                        <span class="status-value" id="currentSession" style="font-size: 1em;">--</span>
                    </div>
                </div>

                <div class="session-info">
                    <div style="color: #ffd700; font-weight: bold; font-size: 0.9em; margin-bottom: 6px;">üìä Trading Sessions (GMT)</div>
                    <div class="session-badges" id="sessionBadges">
                        <div class="session-badge session-inactive">Asian 00-09</div>
                        <div class="session-badge session-inactive">London 07-16</div>
                        <div class="session-badge session-inactive">NY 13-22</div>
                    </div>
                </div>

                <div id="errorContainer"></div>

                <div class="signal-display">
                    <div class="signal-badge signal-neutral" id="signalBadge">ANALYZING...</div>
                    <div style="margin-top: 12px; color: #888; font-size: 0.9em;" id="timeframeDisplay">Timeframe: 1H</div>
                    <div style="margin-top: 8px; font-size: 0.8em; color: #00b894;" id="dataSourceInfo">
                        üî¥ Live Chart | üü° Simulated Signals
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-box">
                        <div class="metric-label">RSI (14)</div>
                        <div class="metric-value" id="rsiDisplay">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Signal Strength</div>
                        <div class="metric-value" id="strengthDisplay" style="font-size: 1.3em;">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Trend Status</div>
                        <div class="metric-value" id="trendDisplay" style="font-size: 1.3em;">--</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Price Action</div>
                        <div class="metric-value" id="priceDisplay" style="font-size: 1.2em;">--</div>
                    </div>
                </div>

                <div class="conditions-list" id="conditionsList">
                    <h3>Signal Analysis</h3>
                    <div class="loading">Connecting to live market data...</div>
                </div>

                <div style="text-align: center; color: #888; font-size: 0.85em; margin-top: 15px;" id="lastUpdate">
                    Last updated: --
                </div>

                <div class="data-source-info">
                    <strong>Data Sources:</strong><br>
                    ‚Ä¢ Chart: TradingView Live Feed (OANDA:XAUUSD)<br>
                    ‚Ä¢ RSI Signals: Algorithmic Simulation<br>
                    ‚Ä¢ Sessions: Real-time GMT calculation<br>
                    ‚Ä¢ Market Status: Real-time checking
                </div>
            </div>
        </div>

        <div class="disclaimer">
            ‚ö†Ô∏è <strong>Risk Disclaimer:</strong> This dashboard displays a LIVE TradingView chart with real gold prices. RSI signals are simulated for educational purposes. Trading involves risk. Never risk more than you can afford to lose. Gold trades 24/5 with highest volatility during London-NY overlap (13:00-16:00 GMT).
        </div>
    </div>

    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        // ============================================
        // CONFIGURATION & GLOBAL VARIABLES
        // ============================================
        let currentTimeframe = '60'; // Default 1 hour
        let tvWidget = null;
        let priceHistory = [];
        const RSI_PERIOD = 14;
        let isLiveMode = true;
        let lastRSI = 50; // For realistic RSI simulation
        
        // Trading sessions (GMT)
        const SESSIONS = {
            asian: { start: 0, end: 9, name: 'Asian' },
            london: { start: 7, end: 16, name: 'London' },
            newyork: { start: 13, end: 22, name: 'NY' }
        };
        
        // ============================================
        // TRADINGVIEW CHART FUNCTIONS
        // ============================================
        
        // Initialize TradingView Chart
        function initTradingViewChart() {
            try {
                // Hide loading message
                document.getElementById('chartLoading').style.display = 'none';
                
                tvWidget = new TradingView.widget({
                    autosize: true,
                    symbol: "OANDA:XAUUSD",
                    interval: currentTimeframe,
                    timezone: "Etc/UTC",
                    theme: "dark",
                    style: "1",
                    locale: "en",
                    toolbar_bg: "#0a0e27",
                    enable_publishing: false,
                    hide_side_toolbar: false,
                    allow_symbol_change: false,
                    container_id: "tradingview_chart",
                    studies: [
                        {
                            id: "RSI@tv-basicstudies",
                            inputs: {
                                length: 14
                            }
                        }
                    ],
                    disabled_features: [
                        "use_localstorage_for_settings",
                        "header_symbol_search",
                        "symbol_search_hot_key"
                    ],
                    enabled_features: [
                        "study_templates"
                    ],
                    overrides: {
                        "mainSeriesProperties.candleStyle.upColor": "#00b894",
                        "mainSeriesProperties.candleStyle.downColor": "#d63031",
                        "mainSeriesProperties.candleStyle.borderUpColor": "#00b894",
                        "mainSeriesProperties.candleStyle.borderDownColor": "#d63031",
                        "mainSeriesProperties.candleStyle.wickUpColor": "#00b894",
                        "mainSeriesProperties.candleStyle.wickDownColor": "#d63031"
                    }
                });

                tvWidget.onChartReady(() => {
                    console.log('‚úÖ TradingView chart loaded successfully');
                    document.getElementById('errorContainer').innerHTML = `
                        <div class="error-message" style="background: rgba(0, 184, 148, 0.2); border-color: rgba(0, 184, 148, 0.4); color: #00b894;">
                            ‚úÖ Connected to TradingView Live Chart
                        </div>
                    `;
                    startDataCollection();
                    
                    // Hide error message after 5 seconds
                    setTimeout(() => {
                        const errorContainer = document.getElementById('errorContainer');
                        if (errorContainer.innerHTML.includes('‚úÖ Connected')) {
                            errorContainer.innerHTML = '';
                        }
                    }, 5000);
                });
                
            } catch (error) {
                console.error('Error loading TradingView:', error);
                document.getElementById('chartLoading').innerHTML = `
                    <div style="color: #ff7675;">
                        ‚ùå Failed to load TradingView chart<br>
                        <small>Check internet connection and refresh</small>
                    </div>
                `;
            }
        }

        // Change timeframe
        function changeTimeframe(interval, btn) {
            currentTimeframe = interval;
            
            // Update button states
            document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Update timeframe display
            const labels = {'1': '1M', '5': '5M', '15': '15M', '60': '1H', '240': '4H', 'D': '1D'};
            document.getElementById('timeframeDisplay').textContent = `Timeframe: ${labels[interval]}`;
            
            // Reinitialize chart with new timeframe
            if (tvWidget) {
                tvWidget.remove();
                document.getElementById('chartLoading').style.display = 'block';
                document.getElementById('chartLoading').innerHTML = 'Loading TradingView Chart...';
            }
            priceHistory = [];
            
            // Small delay to show loading state
            setTimeout(() => {
                initTradingViewChart();
            }, 500);
        }
        
        // ============================================
        // MARKET DATA FUNCTIONS
        // ============================================
        
        // Market hours check
        function isMarketOpen() {
            const now = new Date();
            const day = now.getUTCDay();
            const hour = now.getUTCHours();
            
            // Gold market closes Friday 21:00 GMT to Sunday 21:00 GMT
            if (day === 5 && hour >= 21) return false;
            if (day === 6) return false;
            if (day === 0 && hour < 21) return false;
            return true;
        }

        // Get active sessions
        function getActiveSessions() {
            const hour = new Date().getUTCHours();
            const active = [];
            
            Object.entries(SESSIONS).forEach(([key, session]) => {
                if (hour >= session.start && hour < session.end) {
                    active.push({ key, ...session });
                }
            });
            
            return active;
        }

        // Check overlap period
        function isOverlapPeriod() {
            const hour = new Date().getUTCHours();
            if (hour >= 13 && hour < 16) return 'London-NY (Peak)';
            if (hour >= 7 && hour < 9) return 'Asian-London';
            return null;
        }

        // Update session display
        function updateSessionDisplay() {
            const activeSessions = getActiveSessions();
            const overlap = isOverlapPeriod();
            
            // Update badges
            const badges = ['Asian 00-09', 'London 07-16', 'NY 13-22'];
            const badgesContainer = document.getElementById('sessionBadges');
            badgesContainer.innerHTML = badges.map((text, i) => {
                const isActive = activeSessions.some(s => 
                    (i === 0 && s.key === 'asian') ||
                    (i === 1 && s.key === 'london') ||
                    (i === 2 && s.key === 'newyork')
                );
                return `<div class="session-badge ${isActive ? 'session-active' : 'session-inactive'}">${text}</div>`;
            }).join('');
            
            // Update current session
            if (activeSessions.length > 0) {
                document.getElementById('currentSession').textContent = activeSessions[0].name;
                if (overlap) {
                    document.getElementById('currentSession').textContent += ` (${overlap})`;
                }
            } else {
                document.getElementById('currentSession').textContent = 'Transition';
            }
        }

        // Update market status
        function updateMarketStatus() {
            const isOpen = isMarketOpen();
            const statusDiv = document.getElementById('marketStatus');
            
            if (isOpen) {
                statusDiv.innerHTML = `
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span style="color: #00b894; font-weight: bold; font-size: 0.9em;">LIVE MARKET</span>
                    </div>
                `;
            } else {
                statusDiv.innerHTML = `
                    <div style="color: #ff7675; font-weight: bold; font-size: 0.9em;">
                        üîí MARKET CLOSED
                    </div>
                `;
            }
        }
        
        // ============================================
        // RSI & SIGNAL GENERATION FUNCTIONS
        // ============================================
        
        // Generate realistic RSI simulation
        function generateRealisticRSI() {
            const hour = new Date().getUTCHours();
            let volatility = 8;
            
            // Market session adjustments (realistic volatility patterns)
            if (hour >= 13 && hour < 16) volatility = 15; // London-NY overlap (peak volatility)
            else if (hour >= 7 && hour < 9) volatility = 12; // Asian-London overlap
            else if (hour >= 0 && hour < 5) volatility = 5; // Asian session (low volatility)
            else if (hour >= 16 && hour < 21) volatility = 10; // NY session
            else volatility = 6; // Other hours
            
            // Random walk with mean reversion (more realistic RSI movement)
            const randomWalk = (Math.random() - 0.5) * volatility;
            const meanReversion = (50 - lastRSI) * 0.08; // Tends to revert to 50
            
            lastRSI += randomWalk + meanReversion;
            
            // Keep within realistic bounds (RSI rarely goes below 10 or above 90)
            lastRSI = Math.max(12, Math.min(88, lastRSI));
            
            // Add session-based bias
            if (hour >= 13 && hour < 16) {
                // Slight bullish bias during peak hours (more buying activity)
                lastRSI += 2;
            } else if (hour >= 0 && hour < 5) {
                // Slight bearish bias during Asian hours
                lastRSI -= 1;
            }
            
            return Number(lastRSI.toFixed(2));
        }

        // Generate signal based on RSI
        function generateSignal(rsiValue) {
            const signal = {
                type: 'NEUTRAL',
                strength: 'Medium',
                confidence: 50,
                conditions: [],
                rsi: rsiValue,
                trend: '',
                price: ''
            };
            
            // Extreme overbought
            if (rsiValue >= 80) {
                signal.type = 'STRONG SELL';
                signal.strength = 'Very Strong';
                signal.confidence = 85;
                signal.conditions = [
                    '‚úì RSI above 80 (Extreme Overbought)',
                    '‚úì High probability of reversal',
                    '‚úì Consider short positions',
                    '‚úì Set tight stop losses'
                ];
                signal.trend = 'Bearish Reversal';
            }
            // Overbought
            else if (rsiValue >= 70) {
                signal.type = 'SELL';
                signal.strength = 'Strong';
                signal.confidence = 70;
                signal.conditions = [
                    '‚úì RSI above 70 (Overbought)',
                    '‚úì Caution for long positions',
                    '‚úì Look for bearish patterns',
                    '‚úì Wait for confirmation'
                ];
                signal.trend = 'Bearish';
            }
            // Oversold
            else if (rsiValue <= 30) {
                signal.type = 'BUY';
                signal.strength = 'Strong';
                signal.confidence = 70;
                signal.conditions = [
                    '‚úì RSI below 30 (Oversold)',
                    '‚úì Price likely to bounce',
                    '‚úì Consider long positions',
                    '‚úì Good risk/reward ratio'
                ];
                signal.trend = 'Bullish';
            }
            // Extreme oversold
            else if (rsiValue <= 20) {
                signal.type = 'STRONG BUY';
                signal.strength = 'Very Strong';
                signal.confidence = 85;
                signal.conditions = [
                    '‚úì RSI below 20 (Extreme Oversold)',
                    '‚úì Strong bounce expected',
                    '‚úì Excellent long entry',
                    '‚úì Wider stop loss possible'
                ];
                signal.trend = 'Bullish Reversal';
            }
            // Neutral with bullish bias
            else if (rsiValue > 55) {
                signal.type = 'NEUTRAL-BULLISH';
                signal.strength = 'Medium';
                signal.confidence = 60;
                signal.conditions = [
                    '‚úì RSI above 55 (Bullish bias)',
                    '‚úì Wait for better entry',
                    '‚úì Monitor for breakout',
                    '‚úì Consider small positions'
                ];
                signal.trend = 'Slightly Bullish';
            }
            // Neutral with bearish bias
            else if (rsiValue < 45) {
                signal.type = 'NEUTRAL-BEARISH';
                signal.strength = 'Medium';
                signal.confidence = 60;
                signal.conditions = [
                    '‚úì RSI below 45 (Bearish bias)',
                    '‚úì Wait for confirmation',
                    '‚úì Monitor support levels',
                    '‚úì Consider hedging'
                ];
                signal.trend = 'Slightly Bearish';
            }
            // Neutral
            else {
                signal.type = 'NEUTRAL';
                signal.strength = 'Weak';
                signal.confidence = 50;
                signal.conditions = [
                    '‚úì RSI between 45-55 (Neutral)',
                    '‚úì Market in balance',
                    '‚úì Wait for clearer signal',
                    '‚úì Monitor volume and momentum'
                ];
                signal.trend = 'Ranging';
            }
            
            // Add session context
            const overlap = isOverlapPeriod();
            if (overlap) {
                signal.conditions.push(`‚úì ${overlap} - High volatility expected`);
                signal.confidence += 5;
            }
            
            // Generate realistic price
            const basePrice = 2350;
            const sessionFactor = overlap ? 0.3 : 0.15;
            const priceChange = (Math.random() - 0.5) * 50 * sessionFactor;
            const currentPrice = basePrice + priceChange;
            signal.price = `$${currentPrice.toFixed(2)}`;
            
            return signal;
        }

        // Update signal display
        function updateSignalDisplay(signal) {
            const badge = document.getElementById('signalBadge');
            badge.textContent = signal.type;
            
            // Remove all signal classes
            badge.classList.remove('signal-buy', 'signal-sell', 'signal-neutral');
            
            // Add appropriate class
            if (signal.type.includes('BUY')) {
                badge.classList.add('signal-buy');
            } else if (signal.type.includes('SELL')) {
                badge.classList.add('signal-sell');
            } else {
                badge.classList.add('signal-neutral');
            }
            
            // Update metrics
            document.getElementById('rsiDisplay').textContent = signal.rsi.toFixed(2);
            document.getElementById('strengthDisplay').textContent = signal.strength;
            document.getElementById('trendDisplay').textContent = signal.trend;
            document.getElementById('priceDisplay').textContent = signal.price;
            
            // Update conditions list
            const conditionsList = document.getElementById('conditionsList');
            if (signal.conditions && signal.conditions.length > 0) {
                conditionsList.innerHTML = `
                    <h3>Signal Analysis</h3>
                    ${signal.conditions.map(cond => `
                        <div class="condition-item">
                            <span class="condition-icon">${cond.startsWith('‚úì') ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                            <span class="${cond.startsWith('‚úì') ? 'condition-met' : 'condition-not-met'}">${cond}</span>
                        </div>
                    `).join('')}
                `;
            }
        }
        
        // ============================================
        // DASHBOARD UPDATE FUNCTIONS
        // ============================================
        
        // Update all displays
        function updateDashboard() {
            try {
                // Update market info (REAL DATA)
                updateMarketStatus();
                updateSessionDisplay();
                
                // Generate realistic RSI and signal (SIMULATED)
                const rsiValue = generateRealisticRSI();
                const signal = generateSignal(rsiValue);
                updateSignalDisplay(signal);
                
                // Update timestamp
                const now = new Date();
                const timeStr = now.toUTCString().replace('GMT', 'GMT');
                document.getElementById('lastUpdate').innerHTML = 
                    `<span style="color: #00b894;">üîÑ Last updated: ${timeStr}</span>`;
                
                // Clear errors if everything is working
                const errorContainer = document.getElementById('errorContainer');
                if (errorContainer.innerHTML.includes('Error')) {
                    errorContainer.innerHTML = '';
                }
                
            } catch (error) {
                console.error('Error updating dashboard:', error);
                document.getElementById('errorContainer').innerHTML = `
                    <div class="error-message">
                        ‚ö†Ô∏è Error updating data: ${error.message}<br>
                        <small>Retrying in 10 seconds...</small>
                    </div>
                `;
            }
        }

        // Start data collection
        function startDataCollection() {
            console.log('üöÄ Starting data collection...');
            
            // Initial update
            updateDashboard();
            
            // Update every 10 seconds
            setInterval(updateDashboard, 10000);
            
            // Faster updates during peak hours
            const hour = new Date().getUTCHours();
            if (hour >= 13 && hour < 16) {
                setInterval(updateDashboard, 5000); // 5 seconds during peak
            }
            
            // Remove loading message
            const loading = document.querySelector('.conditions-list .loading');
            if (loading) {
                loading.style.display = 'none';
            }
        }
        
        // ============================================
        // CONTROL FUNCTIONS
        // ============================================
        
        // Refresh data manually
        function refreshData() {
            const btn = document.getElementById('refreshBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '‚è≥ Updating...';
            btn.disabled = true;
            
            updateDashboard();
            
            // Show refresh notification
            document.getElementById('errorContainer').innerHTML = `
                <div class="error-message" style="background: rgba(0, 184, 148, 0.2); border-color: rgba(0, 184, 148, 0.4); color: #00b894;">
                    üîÑ Refreshing data...
                </div>
            `;
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
                document.getElementById('errorContainer').innerHTML = '';
            }, 1000);
        }

        // Reset data
        function resetData() {
            priceHistory = [];
            lastRSI = 50;
            updateDashboard();
            
            // Show reset notification
            document.getElementById('errorContainer').innerHTML = `
                <div class="error-message" style="background: rgba(255, 215, 0, 0.1); border-color: rgba(255, 215, 0, 0.3); color: #ffd700;">
                    üîÑ Data reset complete. Starting fresh analysis...
                </div>
            `;
            
            setTimeout(() => {
                document.getElementById('errorContainer').innerHTML = '';
            }, 3000);
        }

        // Toggle between live and demo mode
        function toggleDataMode() {
            isLiveMode = !isLiveMode;
            const btn = document.getElementById('dataModeBtn');
            const info = document.getElementById('dataSourceInfo');
            
            if (isLiveMode) {
                btn.innerHTML = 'üåê Live Mode';
                btn.style.background = 'rgba(0, 184, 148, 0.8)';
                info.innerHTML = 'üî¥ Live Chart | üü° Simulated Signals';
                info.style.color = '#00b894';
            } else {
                btn.innerHTML = 'üß™ Demo Mode';
                btn.style.background = 'rgba(155, 89, 182, 0.8)';
                info.innerHTML = 'üß™ Demo Mode - All data simulated';
                info.style.color = '#9b59b6';
            }
            
            updateDashboard();
        }
        
        // ============================================
        // INITIALIZATION & EVENT HANDLERS
        // ============================================
        
        // Initialize everything when page loads
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üìä Gold RSI Dashboard Initializing...');
            
            // Initialize TradingView chart
            initTradingViewChart();
            
            // Set up periodic session updates
            setInterval(updateSessionDisplay, 60000); // Update every minute
            
            // Initial display setup
            document.getElementById('timeframeDisplay').textContent = 'Timeframe: 1H';
            
            // Set up error handling
            window.addEventListener('error', function(e) {
                console.error('Global error:', e);
                document.getElementById('errorContainer').innerHTML = `
                    <div class="error-message">
                        ‚ö†Ô∏è Script error detected: ${e.message}<br>
                        <small>Please refresh the page</small>
                    </div>
                `;
            });
            
            // Handle page visibility changes
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    // Page became visible, refresh data
                    updateDashboard();
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Refresh with F5
                if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                    e.preventDefault();
                    refreshData();
                }
                // Reset with Ctrl+Shift+R
                if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                    e.preventDefault();
                    resetData();
                }
                // Toggle mode with Ctrl+M
                if (e.ctrlKey && e.key === 'm') {
                    e.preventDefault();
                    toggleDataMode();
                }
            });
            
            // Simulate initial loading delay
            setTimeout(() => {
                const loading = document.querySelector('.conditions-list .loading');
                if (loading) {
                    loading.style.display = 'none';
                }
            }, 2000);
            
            console.log('‚úÖ Dashboard initialized successfully');
        });
    </script>
</body>
</html>
