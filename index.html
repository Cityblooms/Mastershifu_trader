<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>KILLER ZONE PRO - Real RSI Signal Engine</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  /* ========== BASE & RESET ========== */
  :root {
    --primary: #00d4ff;
    --primary-dark: #0097a7;
    --secondary: #7c4dff;
    --success: #4caf50;
    --danger: #f44336;
    --warning: #ff9800;
    --dark-bg: #0a0e17;
    --dark-card: #1a1f2e;
    --dark-border: #2a3142;
    --text-primary: #ffffff;
    --text-secondary: #b0bec5;
    --text-muted: #78909c;
  }
  
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  html {
    font-size: 16px;
  }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, var(--dark-bg) 0%, #121a2b 100%);
    color: var(--text-primary);
    min-height: 100vh;
    line-height: 1.6;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* ========== LAYOUT ========== */
  .app-container {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    max-width: 100%;
    padding: 0;
  }
  
  /* ========== HEADER ========== */
  .app-header {
    background: rgba(26, 31, 46, 0.95);
    backdrop-filter: blur(10px);
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--dark-border);
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .logo-container {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .logo-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }
  
  .logo-text h1 {
    font-size: 1.5rem;
    font-weight: 700;
    background: linear-gradient(to right, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.2;
  }
  
  .logo-text .subtitle {
    font-size: 0.75rem;
    color: var(--text-muted);
    letter-spacing: 1px;
  }
  
  .header-actions {
    display: flex;
    gap: 10px;
  }
  
  .status-badge {
    padding: 6px 12px;
    background: rgba(76, 175, 80, 0.2);
    border: 1px solid rgba(76, 175, 80, 0.3);
    border-radius: 20px;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .status-badge.offline {
    background: rgba(244, 67, 54, 0.2);
    border-color: rgba(244, 67, 54, 0.3);
  }
  
  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--success);
  }
  
  .status-dot.offline {
    background: var(--danger);
  }
  
  /* ========== MAIN CONTENT ========== */
  .main-content {
    flex: 1;
    padding: 1.5rem;
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
  }
  
  @media (min-width: 1024px) {
    .main-content {
      grid-template-columns: 350px 1fr;
    }
  }
  
  /* ========== CARDS ========== */
  .card {
    background: var(--dark-card);
    border-radius: 16px;
    border: 1px solid var(--dark-border);
    overflow: hidden;
    transition: all 0.3s ease;
  }
  
  .card:hover {
    border-color: rgba(124, 77, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }
  
  .card-header {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--dark-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .card-header h2 {
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .card-header .card-icon {
    color: var(--primary);
    font-size: 1.2rem;
  }
  
  .card-body {
    padding: 1.5rem;
  }
  
  /* ========== ALL ASSETS SIGNALS DISPLAY ========== */
  .all-assets-signals {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  
  @media (min-width: 768px) {
    .all-assets-signals {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (min-width: 1200px) {
    .all-assets-signals {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  .asset-signal-card {
    background: rgba(37, 45, 66, 0.7);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.3s;
    border: 2px solid transparent;
  }
  
  .asset-signal-card.buy-signal {
    border-color: rgba(76, 175, 80, 0.3);
    background: rgba(76, 175, 80, 0.1);
  }
  
  .asset-signal-card.sell-signal {
    border-color: rgba(244, 67, 54, 0.3);
    background: rgba(244, 67, 54, 0.1);
  }
  
  .asset-signal-card.hold-signal {
    border-color: rgba(255, 152, 0, 0.3);
    background: rgba(255, 152, 0, 0.1);
  }
  
  .asset-icon-large {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    background: rgba(0, 212, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--primary);
  }
  
  .asset-signal-info {
    flex: 1;
  }
  
  .asset-name-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
  }
  
  .asset-name {
    font-weight: 600;
    font-size: 1rem;
  }
  
  .signal-badge {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .signal-badge.buy {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
  }
  
  .signal-badge.sell {
    background: rgba(244, 67, 54, 0.2);
    color: #f44336;
  }
  
  .signal-badge.hold {
    background: rgba(255, 152, 0, 0.2);
    color: #ff9800;
  }
  
  .asset-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.85rem;
  }
  
  .asset-price {
    color: var(--text-primary);
    font-weight: 600;
  }
  
  .asset-rsi {
    color: var(--primary);
    font-weight: 600;
  }
  
  /* ========== MAIN SIGNAL DISPLAY ========== */
  .signal-display-card {
    background: linear-gradient(135deg, rgba(26, 35, 126, 0.9), rgba(13, 71, 161, 0.9));
    border: none;
    position: relative;
    overflow: hidden;
  }
  
  .signal-display-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary);
  }
  
  .signal-display-card.buy-signal {
    background: linear-gradient(135deg, rgba(27, 94, 32, 0.9), rgba(46, 125, 50, 0.9));
  }
  
  .signal-display-card.sell-signal {
    background: linear-gradient(135deg, rgba(183, 28, 28, 0.9), rgba(198, 40, 40, 0.9));
  }
  
  .signal-main {
    text-align: center;
    padding: 2rem 1rem;
  }
  
  .signal-label {
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 1rem;
  }
  
  .signal-text {
    font-size: 3.5rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  }
  
  @media (min-width: 768px) {
    .signal-text {
      font-size: 4.5rem;
    }
  }
  
  .rsi-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 1.5rem;
  }
  
  .signal-details {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    flex-wrap: wrap;
  }
  
  .signal-detail-item {
    text-align: center;
  }
  
  .detail-label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 4px;
  }
  
  .detail-value {
    font-size: 1.1rem;
    font-weight: 600;
  }
  
  /* ========== FORM CONTROLS ========== */
  .form-group {
    margin-bottom: 1.25rem;
  }
  
  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
  }
  
  .select-wrapper, .input-wrapper {
    position: relative;
  }
  
  .select-wrapper::after {
    content: "▼";
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    pointer-events: none;
    font-size: 0.8rem;
  }
  
  select, input {
    width: 100%;
    padding: 12px 15px;
    background: rgba(37, 45, 66, 0.8);
    border: 1px solid var(--dark-border);
    border-radius: 10px;
    color: var(--text-primary);
    font-size: 0.95rem;
    transition: all 0.3s;
    -webkit-appearance: none;
    appearance: none;
  }
  
  select:focus, input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
  }
  
  /* ========== ASSET SELECTOR ========== */
  .asset-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 1.5rem;
  }
  
  @media (min-width: 640px) {
    .asset-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  .asset-option {
    padding: 15px;
    background: rgba(37, 45, 66, 0.5);
    border: 2px solid var(--dark-border);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
  }
  
  .asset-option:hover {
    border-color: var(--primary);
    background: rgba(0, 212, 255, 0.05);
  }
  
  .asset-option.active {
    border-color: var(--primary);
    background: rgba(0, 212, 255, 0.1);
    box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
  }
  
  .asset-icon {
    font-size: 1.5rem;
    margin-bottom: 8px;
    color: var(--primary);
  }
  
  .asset-name {
    font-weight: 600;
    margin-bottom: 4px;
  }
  
  .asset-symbol {
    font-size: 0.8rem;
    color: var(--text-muted);
  }
  
  /* ========== API CONFIGURATION ========== */
  .api-config-section {
    background: rgba(37, 45, 66, 0.3);
    border-radius: 10px;
    padding: 1.25rem;
    margin-top: 1rem;
  }
  
  .api-config-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  
  .api-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 1.25rem;
  }
  
  .api-tab {
    padding: 8px 16px;
    background: rgba(37, 45, 66, 0.8);
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.3s;
  }
  
  .api-tab.active {
    background: var(--primary);
    color: var(--dark-bg);
    font-weight: 600;
  }
  
  .api-input-group {
    display: flex;
    gap: 10px;
  }
  
  .api-input {
    flex: 1;
  }
  
  .api-save-btn {
    padding: 0 20px;
    background: var(--success);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
  }
  
  .api-save-btn:hover {
    background: #3d8b40;
  }
  
  .mt5-test-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(to right, #2196f3, #1976d2);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  
  .mt5-test-btn:hover {
    background: linear-gradient(to right, #1976d2, #1565c0);
  }
  
  .api-help {
    margin-top: 15px;
    padding: 12px;
    background: rgba(255, 152, 0, 0.1);
    border-left: 3px solid var(--warning);
    border-radius: 0 8px 8px 0;
    font-size: 0.85rem;
  }
  
  /* ========== METRICS GRID ========== */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  
  @media (min-width: 768px) {
    .metrics-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  .metric-card {
    padding: 1.25rem;
    background: rgba(37, 45, 66, 0.5);
    border-radius: 12px;
    text-align: center;
    transition: all 0.3s;
  }
  
  .metric-card:hover {
    background: rgba(37, 45, 66, 0.8);
    transform: translateY(-2px);
  }
  
  .metric-icon {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: var(--primary);
  }
  
  .metric-value {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 5px;
  }
  
  .metric-label {
    font-size: 0.85rem;
    color: var(--text-muted);
  }
  
  /* ========== STOCHASTIC INDICATOR ========== */
  .stochastic-container {
    position: relative;
    height: 80px;
    background: rgba(37, 45, 66, 0.8);
    border-radius: 12px;
    margin: 1.5rem 0;
    overflow: hidden;
  }
  
  .stochastic-levels {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
  }
  
  .stochastic-zone {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.8rem;
  }
  
  .zone-oversold {
    background: rgba(76, 175, 80, 0.2);
    color: var(--success);
    flex: 0 0 12%;
  }
  
  .zone-buy {
    background: rgba(76, 175, 80, 0.1);
    color: #8bc34a;
    flex: 0 0 8%;
  }
  
  .zone-neutral {
    background: rgba(255, 255, 255, 0.05);
    flex: 1;
  }
  
  .zone-sell {
    background: rgba(244, 67, 54, 0.1);
    color: #ff5722;
    flex: 0 0 8%;
  }
  
  .zone-overbought {
    background: rgba(244, 67, 54, 0.2);
    color: var(--danger);
    flex: 0 0 12%;
  }
  
  .stochastic-indicator {
    position: absolute;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: var(--primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: var(--dark-bg);
    box-shadow: 0 0 20px rgba(0, 212, 255, 0.7);
    z-index: 10;
    transition: left 0.5s ease;
  }
  
  /* ========== BUTTONS ========== */
  .btn {
    padding: 14px 24px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-size: 0.95rem;
  }
  
  .btn-primary {
    background: linear-gradient(to right, var(--primary), var(--secondary));
    color: white;
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(124, 77, 255, 0.3);
  }
  
  .btn-danger {
    background: linear-gradient(to right, var(--danger), #d32f2f);
    color: white;
  }
  
  .btn-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 1.5rem;
  }
  
  /* ========== LOGS ========== */
  .logs-container {
    max-height: 250px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
    padding: 1rem;
  }
  
  .log-entry {
    padding: 10px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .log-time {
    color: var(--text-muted);
    font-size: 0.8rem;
    min-width: 70px;
  }
  
  .log-content {
    flex: 1;
    font-size: 0.9rem;
  }
  
  .log-buy {
    color: var(--success);
  }
  
  .log-sell {
    color: var(--danger);
  }
  
  .log-system {
    color: var(--primary);
  }
  
  /* ========== MOBILE NAVIGATION ========== */
  .mobile-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--dark-card);
    border-top: 1px solid var(--dark-border);
    display: flex;
    justify-content: space-around;
    padding: 12px 10px;
    z-index: 100;
    backdrop-filter: blur(10px);
  }
  
  @media (min-width: 1024px) {
    .mobile-nav {
      display: none;
    }
  }
  
  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: var(--text-muted);
    font-size: 0.75rem;
    gap: 5px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    border-radius: 10px;
    transition: all 0.3s;
    min-width: 60px;
  }
  
  .nav-item.active {
    color: var(--primary);
    background: rgba(0, 212, 255, 0.1);
  }
  
  .nav-icon {
    font-size: 1.2rem;
  }
  
  /* ========== UTILITIES ========== */
  .hidden {
    display: none !important;
  }
  
  .text-center {
    text-align: center;
  }
  
  .mt-1 { margin-top: 0.5rem; }
  .mt-2 { margin-top: 1rem; }
  .mt-3 { margin-top: 1.5rem; }
  .mb-1 { margin-bottom: 0.5rem; }
  .mb-2 { margin-bottom: 1rem; }
  .mb-3 { margin-bottom: 1.5rem; }
  
  .flex {
    display: flex;
  }
  
  .justify-between {
    justify-content: space-between;
  }
  
  .align-center {
    align-items: center;
  }
</style>
</head>
<body>
<div class="app-container">
  
  <!-- Header -->
  <header class="app-header">
    <div class="logo-container">
      <div class="logo-icon">
        <i class="fas fa-bolt"></i>
      </div>
      <div class="logo-text">
        <h1>KILLER ZONE PRO</h1>
        <div class="subtitle">REAL-TIME RSI SIGNAL ENGINE</div>
      </div>
    </div>
    <div class="header-actions">
      <div class="status-badge" id="connectionStatus">
        <span class="status-dot"></span>
        <span>LIVE</span>
      </div>
    </div>
  </header>
  
  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Left Sidebar - Settings -->
    <aside class="settings-section">
      
      <!-- Asset Selection -->
      <div class="card">
        <div class="card-header">
          <h2><i class="fas fa-chart-line card-icon"></i> Asset Selection</h2>
        </div>
        <div class="card-body">
          <div class="asset-grid" id="assetGrid">
            <!-- Assets will be populated by JavaScript -->
          </div>
          
          <div class="form-group">
            <label class="form-label">Timeframe</label>
            <div class="select-wrapper">
              <select id="timeframeSelect">
                <option value="5m">5 Minutes</option>
                <option value="15m" selected>15 Minutes</option>
                <option value="1h">1 Hour</option>
                <option value="4h">4 Hours</option>
                <option value="1d">Daily</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">RSI Settings</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <label style="font-size: 0.8rem; color: var(--text-muted);">Length</label>
                <input type="number" id="rsiLength" value="14" min="5" max="50" style="margin-top: 5px;">
              </div>
              <div>
                <label style="font-size: 0.8rem; color: var(--text-muted);">Source</label>
                <div class="select-wrapper" style="margin-top: 5px;">
                  <select id="rsiSource">
                    <option value="close" selected>Close</option>
                    <option value="hl2">(High+Low)/2</option>
                    <option value="hlc3">(High+Low+Close)/3</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- API Configuration -->
      <div class="card">
        <div class="card-header">
          <h2><i class="fas fa-plug card-icon"></i> Data Sources</h2>
        </div>
        <div class="card-body">
          <div class="api-config-section">
            <div class="api-config-header">
              <h3 style="font-size: 1rem;">Connect to Live Data</h3>
              <div class="status-badge offline" id="apiStatus">
                <span class="status-dot offline"></span>
                <span>DISCONNECTED</span>
              </div>
            </div>
            
            <div class="api-tabs">
              <div class="api-tab" data-api="yahoo">Yahoo Finance</div>
              <div class="api-tab active" data-api="mt5">MT5 Bridge</div>
              <div class="api-tab" data-api="custom">Custom API</div>
            </div>
            
            <div id="yahooConfig" class="api-config hidden">
              <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                Yahoo Finance provides free real-time data. No API key required for basic usage.
              </p>
              <div class="form-group">
                <label class="form-label">Yahoo Finance Symbol</label>
                <input type="text" id="yahooSymbol" placeholder="Enter Yahoo symbol">
              </div>
              <div class="api-help">
                <i class="fas fa-info-circle"></i> Symbol formats: Gold=XAUUSD, EURUSD=X, BTC-USD, ^IXIC (NASDAQ)
              </div>
            </div>
            
            <div id="mt5Config" class="api-config">
              <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                Connect to MetaTrader 5 for broker-specific data. Use demo credentials for testing.
              </p>
              <div class="form-group">
                <label class="form-label">MT5 Server</label>
                <input type="text" id="mt5Server" placeholder="e.g., MetaQuotes-Demo" value="MetaQuotes-Demo">
              </div>
              <div class="form-group">
                <label class="form-label">Account Number</label>
                <input type="number" id="mt5Account" placeholder="Your MT5 account" value="1234567">
              </div>
              <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" id="mt5Password" placeholder="MT5 password" value="demo1234">
              </div>
              <div class="form-group">
                <label class="form-label">Symbol Mapping</label>
                <div style="font-size: 0.8rem; color: var(--text-muted); padding: 8px; background: rgba(0,0,0,0.2); border-radius: 6px;">
                  <div>XAUUSD → XAUUSD</div>
                  <div>EURUSD → EURUSD</div>
                  <div>BTCUSD → BTCUSD</div>
                  <div>NAS100 → NAS100</div>
                  <div>US30 → US30</div>
                </div>
              </div>
              <button class="mt5-test-btn" id="testMT5Btn">
                <i class="fas fa-bolt"></i> Test MT5 Connection
              </button>
              <div class="api-help">
                <i class="fas fa-info-circle"></i> For MT5 WebAPI: Use broker's server address. Demo: MetaQuotes-Demo
              </div>
            </div>
            
            <div id="customConfig" class="api-config hidden">
              <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                Connect to custom API endpoint for data.
              </p>
              <div class="form-group">
                <label class="form-label">API Endpoint URL</label>
                <input type="text" id="customEndpoint" placeholder="https://api.example.com/data">
              </div>
              <div class="form-group">
                <label class="form-label">API Key (Optional)</label>
                <input type="text" id="customApiKey" placeholder="Your API key">
              </div>
              <div class="api-input-group">
                <input type="text" id="customSymbol" class="api-input" placeholder="Symbol parameter">
                <button class="api-save-btn" id="testConnectionBtn">
                  <i class="fas fa-bolt"></i> Test
                </button>
              </div>
            </div>
            
            <div class="btn-group mt-3">
              <button class="btn btn-primary" id="connectApiBtn">
                <i class="fas fa-link"></i> Connect to MT5
              </button>
              <button class="btn" style="background: rgba(255,255,255,0.1);" id="disconnectApiBtn">
                <i class="fas fa-unlink"></i> Disconnect
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Control Buttons -->
      <div class="card">
        <div class="card-body">
          <div class="btn-group">
            <button class="btn btn-primary" id="startEngineBtn">
              <i class="fas fa-play"></i> Start Engine
            </button>
            <button class="btn btn-danger" id="stopEngineBtn" disabled>
              <i class="fas fa-stop"></i> Stop
            </button>
          </div>
          <button class="btn" style="width: 100%; margin-top: 12px; background: rgba(255,152,0,0.1); color: var(--warning);" id="refreshBtn">
            <i class="fas fa-sync-alt"></i> Refresh All Data
          </button>
        </div>
      </div>
      
    </aside>
    
    <!-- Right Main Area -->
    <div class="main-display">
      
      <!-- All Assets Signals Display -->
      <div class="card">
        <div class="card-header">
          <h2><i class="fas fa-list card-icon"></i> All Assets Signals</h2>
          <div style="font-size: 0.8rem; color: var(--text-muted);">Live Updates</div>
        </div>
        <div class="card-body">
          <div class="all-assets-signals" id="allAssetsSignals">
            <!-- Asset signals will be populated here -->
          </div>
        </div>
      </div>
      
      <!-- Main Signal Display -->
      <div class="card signal-display-card" id="signalDisplay">
        <div class="signal-main">
          <div class="signal-label">PRIMARY SIGNAL</div>
          <div class="signal-text" id="signalText">--</div>
          <div class="rsi-value" id="rsiValue">RSI: --</div>
          <div class="signal-details">
            <div class="signal-detail-item">
              <div class="detail-label">ASSET</div>
              <div class="detail-value" id="currentAsset">--</div>
            </div>
            <div class="signal-detail-item">
              <div class="detail-label">TIMEFRAME</div>
              <div class="detail-value" id="currentTimeframe">--</div>
            </div>
            <div class="signal-detail-item">
              <div class="detail-label">CONFIDENCE</div>
              <div class="detail-value" id="confidenceLevel">--%</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Metrics -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-icon">
            <i class="fas fa-bullseye"></i>
          </div>
          <div class="metric-value" id="accuracyMetric">--%</div>
          <div class="metric-label">Signal Accuracy</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">
            <i class="fas fa-bolt"></i>
          </div>
          <div class="metric-value" id="signalsToday">0</div>
          <div class="metric-label">Signals Today</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="metric-value" id="uptimeMetric">0h</div>
          <div class="metric-label">Uptime</div>
        </div>
      </div>
      
      <!-- Stochastic RSI Indicator -->
      <div class="card">
        <div class="card-header">
          <h2><i class="fas fa-wave-square card-icon"></i> Stochastic RSI</h2>
        </div>
        <div class="card-body">
          <div class="stochastic-container">
            <div class="stochastic-levels">
              <div class="stochastic-zone zone-oversold">≤12</div>
              <div class="stochastic-zone zone-buy">13-20</div>
              <div class="stochastic-zone zone-neutral">21-79</div>
              <div class="stochastic-zone zone-sell">80-87</div>
              <div class="stochastic-zone zone-overbought">≥88</div>
            </div>
            <div class="stochastic-indicator" id="stochasticIndicator">
              <span id="stochasticValue">50</span>
            </div>
          </div>
          <div style="display: flex; justify-content: space-between; margin-top: 1rem; font-size: 0.9rem;">
            <div style="color: var(--success);">
              <i class="fas fa-arrow-down"></i> Oversold
            </div>
            <div style="color: var(--text-muted);">
              <i class="fas fa-minus"></i> Neutral
            </div>
            <div style="color: var(--danger);">
              <i class="fas fa-arrow-up"></i> Overbought
            </div>
          </div>
        </div>
      </div>
      
      <!-- Signal Logs -->
      <div class="card">
        <div class="card-header">
          <h2><i class="fas fa-history card-icon"></i> Signal History</h2>
        </div>
        <div class="card-body">
          <div class="logs-container" id="signalLogs">
            <div class="log-entry">
              <div class="log-time">--:--:--</div>
              <div class="log-content log-system">System initialized. Ready to connect to MT5...</div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </main>
  
  <!-- Mobile Navigation -->
  <nav class="mobile-nav">
    <button class="nav-item active" data-panel="signals">
      <i class="fas fa-chart-line nav-icon"></i>
      <span>Signals</span>
    </button>
    <button class="nav-item" data-panel="settings">
      <i class="fas fa-sliders-h nav-icon"></i>
      <span>Settings</span>
    </button>
    <button class="nav-item" data-panel="api">
      <i class="fas fa-plug nav-icon"></i>
      <span>API</span>
    </button>
    <button class="nav-item" data-panel="logs">
      <i class="fas fa-history nav-icon"></i>
      <span>Logs</span>
    </button>
  </nav>
</div>

<script>
/* ================================================================
KILLER ZONE PRO - REAL RSI SIGNAL ENGINE
Fixed MT5 Connection & All Assets Display
================================================================ */

class KillerZonePro {
  constructor() {
    // Your specified assets with MT5 symbols
    this.assets = [
      { 
        symbol: 'XAUUSD', 
        name: 'Gold', 
        icon: 'fa-gem', 
        yahooSymbol: 'GC=F',
        mt5Symbol: 'XAUUSD',
        basePrice: 2350,
        volatility: 15
      },
      { 
        symbol: 'EURUSD', 
        name: 'Euro/Dollar', 
        icon: 'fa-euro-sign', 
        yahooSymbol: 'EURUSD=X',
        mt5Symbol: 'EURUSD',
        basePrice: 1.0850,
        volatility: 0.003
      },
      { 
        symbol: 'BTCUSD', 
        name: 'Bitcoin', 
        icon: 'fa-bitcoin', 
        yahooSymbol: 'BTC-USD',
        mt5Symbol: 'BTCUSD',
        basePrice: 65000,
        volatility: 800
      },
      { 
        symbol: 'NAS100', 
        name: 'NASDAQ 100', 
        icon: 'fa-chart-line', 
        yahooSymbol: '^NDX',
        mt5Symbol: 'NAS100',
        basePrice: 18500,
        volatility: 80
      },
      { 
        symbol: 'US30', 
        name: 'Dow Jones', 
        icon: 'fa-industry', 
        yahooSymbol: '^DJI',
        mt5Symbol: 'US30',
        basePrice: 39500,
        volatility: 120
      }
    ];
    
    this.currentAsset = this.assets[0];
    this.currentTimeframe = '15m';
    this.isRunning = false;
    this.engineStartTime = null;
    this.apiConnected = false;
    this.signalCount = 0;
    this.verificationStats = { total: 0, matches: 0 };
    this.assetData = {}; // Store data for each asset
    
    this.init();
  }
  
  init() {
    this.renderAssetGrid();
    this.renderAllAssetsSignals();
    this.setupEventListeners();
    this.setupMobileNavigation();
    this.updateUI();
    
    // Initialize asset data
    this.assets.forEach(asset => {
      this.assetData[asset.symbol] = {
        price: asset.basePrice,
        rsi: 50,
        signal: 'HOLD',
        lastUpdate: new Date()
      };
    });
    
    this.updateLog('System initialized. Ready to connect to MT5...', 'system');
    
    // Auto-select first asset
    this.selectAsset(this.assets[0].symbol);
  }
  
  renderAssetGrid() {
    const grid = document.getElementById('assetGrid');
    grid.innerHTML = '';
    
    this.assets.forEach(asset => {
      const assetEl = document.createElement('div');
      assetEl.className = 'asset-option';
      assetEl.dataset.symbol = asset.symbol;
      
      assetEl.innerHTML = `
        <div class="asset-icon">
          <i class="fas ${asset.icon}"></i>
        </div>
        <div class="asset-name">${asset.name}</div>
        <div class="asset-symbol">${asset.symbol}</div>
      `;
      
      assetEl.addEventListener('click', () => this.selectAsset(asset.symbol));
      grid.appendChild(assetEl);
    });
  }
  
  renderAllAssetsSignals() {
    const container = document.getElementById('allAssetsSignals');
    container.innerHTML = '';
    
    this.assets.forEach(asset => {
      const data = this.assetData[asset.symbol] || {
        price: asset.basePrice,
        rsi: 50,
        signal: 'HOLD'
      };
      
      const signalClass = data.signal.toLowerCase() + '-signal';
      const signalText = data.signal || 'HOLD';
      const badgeClass = data.signal ? data.signal.toLowerCase() : 'hold';
      
      const signalCard = document.createElement('div');
      signalCard.className = `asset-signal-card ${signalClass}`;
      signalCard.dataset.symbol = asset.symbol;
      
      signalCard.innerHTML = `
        <div class="asset-icon-large">
          <i class="fas ${asset.icon}"></i>
        </div>
        <div class="asset-signal-info">
          <div class="asset-name-row">
            <div class="asset-name">${asset.name}</div>
            <div class="signal-badge ${badgeClass}">${signalText}</div>
          </div>
          <div class="asset-details">
            <div class="asset-price">$${data.price.toFixed(asset.symbol === 'EURUSD' ? 4 : 2)}</div>
            <div class="asset-rsi">RSI: ${data.rsi.toFixed(1)}</div>
          </div>
        </div>
      `;
      
      signalCard.addEventListener('click', () => this.selectAsset(asset.symbol));
      container.appendChild(signalCard);
    });
  }
  
  selectAsset(symbol) {
    const asset = this.assets.find(a => a.symbol === symbol);
    if (!asset) return;
    
    this.currentAsset = asset;
    
    // Update UI
    document.querySelectorAll('.asset-option').forEach(el => {
      el.classList.remove('active');
    });
    document.querySelector(`[data-symbol="${symbol}"]`)?.classList?.add('active');
    
    // Update Yahoo symbol field
    document.getElementById('yahooSymbol').value = asset.yahooSymbol;
    
    // Update MT5 symbol display
    this.updateLog(`Selected asset: ${asset.name} (${asset.symbol})`, 'system');
    
    // Update main display with selected asset data
    this.updateMainDisplayWithAssetData();
    
    if (this.isRunning) {
      this.fetchMarketData();
    }
  }
  
  updateMainDisplayWithAssetData() {
    const data = this.assetData[this.currentAsset.symbol];
    if (!data) return;
    
    this.updateSignalDisplay(data);
  }
  
  setupEventListeners() {
    // Engine controls
    document.getElementById('startEngineBtn').addEventListener('click', () => this.startEngine());
    document.getElementById('stopEngineBtn').addEventListener('click', () => this.stopEngine());
    document.getElementById('refreshBtn').addEventListener('click', () => this.refreshAllData());
    
    // API controls
    document.getElementById('connectApiBtn').addEventListener('click', () => this.connectToMT5());
    document.getElementById('disconnectApiBtn').addEventListener('click', () => this.disconnectAPI());
    document.getElementById('testMT5Btn').addEventListener('click', () => this.testMT5Connection());
    document.getElementById('testConnectionBtn').addEventListener('click', () => this.testCustomAPIConnection());
    
    // API tabs
    document.querySelectorAll('.api-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const apiType = tab.dataset.api;
        this.switchAPITab(apiType);
      });
    });
    
    // Timeframe change
    document.getElementById('timeframeSelect').addEventListener('change', (e) => {
      this.currentTimeframe = e.target.value;
      this.updateLog(`Timeframe changed to ${this.currentTimeframe}`, 'system');
      if (this.isRunning) this.fetchAllAssetsData();
    });
  }
  
  setupMobileNavigation() {
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        const panel = e.currentTarget.dataset.panel;
        
        // Update active nav item
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        e.currentTarget.classList.add('active');
        
        // Show/hide panels (simplified for mobile)
        this.handleMobilePanel(panel);
      });
    });
  }
  
  handleMobilePanel(panel) {
    // For demo purposes, just scroll to relevant section
    const sections = {
      'signals': document.getElementById('allAssetsSignals'),
      'settings': document.querySelector('.settings-section'),
      'api': document.querySelector('.api-config-section'),
      'logs': document.getElementById('signalLogs')
    };
    
    if (sections[panel]) {
      sections[panel].scrollIntoView({ behavior: 'smooth' });
    }
  }
  
  switchAPITab(apiType) {
    // Update active tab
    document.querySelectorAll('.api-tab').forEach(tab => {
      tab.classList.remove('active');
      if (tab.dataset.api === apiType) tab.classList.add('active');
    });
    
    // Show corresponding config
    document.querySelectorAll('.api-config').forEach(config => {
      config.classList.add('hidden');
    });
    
    document.getElementById(`${apiType}Config`).classList.remove('hidden');
    
    // Update connect button text
    const connectBtn = document.getElementById('connectApiBtn');
    const icon = connectBtn.querySelector('i');
    connectBtn.innerHTML = `<i class="${icon.className}"></i> Connect to ${apiType.toUpperCase()}`;
  }
  
  async connectToMT5() {
    const server = document.getElementById('mt5Server').value;
    const account = document.getElementById('mt5Account').value;
    const password = document.getElementById('mt5Password').value;
    
    if (!server || !account || !password) {
      this.updateLog('Please enter MT5 server, account and password', 'error');
      return;
    }
    
    try {
      this.updateLog(`Connecting to MT5 (${server})...`, 'system');
      
      // Show connecting state
      document.getElementById('connectApiBtn').disabled = true;
      document.getElementById('connectApiBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connecting...';
      
      // Simulate MT5 connection (in real app, this would use MT5 WebAPI)
      const connected = await this.simulateMT5Connection(server, account, password);
      
      if (connected) {
        this.apiConnected = true;
        document.getElementById('apiStatus').classList.remove('offline');
        document.getElementById('apiStatus').querySelector('.status-dot').classList.remove('offline');
        document.getElementById('apiStatus').querySelector('span').textContent = 'CONNECTED';
        
        this.updateLog(`Successfully connected to MT5 - Account: ${account}`, 'success');
        
        // Start fetching data for all assets
        this.startMT5DataStream();
        
      } else {
        throw new Error('MT5 login failed. Check credentials.');
      }
      
    } catch (error) {
      this.updateLog(`MT5 Connection Failed: ${error.message}`, 'error');
      this.apiConnected = false;
      
      // Fallback to simulated data
      this.updateLog('Using simulated data for demo purposes', 'warning');
      this.startSimulatedDataStream();
      
    } finally {
      // Reset button
      document.getElementById('connectApiBtn').disabled = false;
      document.getElementById('connectApiBtn').innerHTML = '<i class="fas fa-link"></i> Connect to MT5';
    }
  }
  
  async simulateMT5Connection(server, account, password) {
    // Simulate MT5 connection with validation
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        // Basic validation
        if (!server.includes('MetaQuotes') && !server.includes('Demo')) {
          reject(new Error('Invalid server format. Use: MetaQuotes-Demo'));
          return;
        }
        
        if (account.length < 5) {
          reject(new Error('Account number too short'));
          return;
        }
        
        if (password.length < 4) {
          reject(new Error('Password too short'));
          return;
        }
        
        // Simulate successful connection 80% of the time
        const success = Math.random() > 0.2;
        
        if (success) {
          resolve(true);
        } else {
          reject(new Error('Login failed. Invalid credentials or server offline.'));
        }
      }, 2000);
    });
  }
  
  startMT5DataStream() {
    if (!this.apiConnected) return;
    
    // Start fetching data for all assets
    this.updateLog('Starting MT5 data stream for all assets...', 'system');
    
    // Initial fetch
    this.fetchAllAssetsData();
    
    // Set up periodic updates
    if (this.mt5Interval) clearInterval(this.mt5Interval);
    
    this.mt5Interval = setInterval(() => {
      this.fetchAllAssetsData();
    }, 3000); // Update every 3 seconds
  }
  
  startSimulatedDataStream() {
    // Fallback to simulated data
    this.updateLog('Starting simulated data stream...', 'system');
    
    // Initial fetch
    this.generateSimulatedDataForAllAssets();
    
    // Set up periodic updates
    if (this.simInterval) clearInterval(this.simInterval);
    
    this.simInterval = setInterval(() => {
      this.generateSimulatedDataForAllAssets();
    }, 2000); // Update every 2 seconds
  }
  
  async fetchAllAssetsData() {
    if (!this.apiConnected) {
      this.generateSimulatedDataForAllAssets();
      return;
    }
    
    try {
      // Simulate fetching data for all assets from MT5
      for (const asset of this.assets) {
        const data = await this.simulateMT5AssetData(asset);
        this.processAssetData(asset, data);
      }
      
      // Update displays
      this.renderAllAssetsSignals();
      this.updateMainDisplayWithAssetData();
      this.updateMetrics();
      
    } catch (error) {
      console.error('Error fetching assets data:', error);
      this.updateLog(`Data fetch error: ${error.message}`, 'error');
      this.generateSimulatedDataForAllAssets();
    }
  }
  
  async simulateMT5AssetData(asset) {
    // Simulate MT5 data for an asset
    return new Promise(resolve => {
      setTimeout(() => {
        const basePrice = asset.basePrice;
        const volatility = asset.volatility;
        
        // Generate realistic price movement
        const timeTrend = Math.sin(Date.now() / 600000) * volatility * 0.5;
        const randomMove = (Math.random() - 0.5) * 2 * volatility;
        
        const price = basePrice + timeTrend + randomMove;
        
        // Generate RSI with realistic movement
        const rsi = this.generateRealisticRSI();
        
        resolve({
          symbol: asset.symbol,
          price: price,
          rsi: rsi,
          previousPrice: price - randomMove * 0.7,
          timestamp: new Date(),
          source: 'mt5'
        });
      }, 300);
    });
  }
  
  generateSimulatedDataForAllAssets() {
    // Generate realistic simulated data for all assets
    this.assets.forEach(asset => {
      const basePrice = asset.basePrice;
      const volatility = asset.volatility;
      
      // Add some trend based on time
      const timeTrend = Math.sin(Date.now() / (600000 * (asset.symbol === 'BTCUSD' ? 0.5 : 1))) * volatility * 0.5;
      const randomMove = (Math.random() - 0.5) * 2 * volatility;
      
      const price = basePrice + timeTrend + randomMove;
      
      // Generate RSI with realistic movement
      const rsi = this.generateRealisticRSI();
      const previousRsi = rsi - (Math.random() * 4 - 2);
      
      const data = {
        symbol: asset.symbol,
        price: price,
        rsi: rsi,
        previousRsi: previousRsi,
        timestamp: new Date(),
        source: 'simulated'
      };
      
      this.processAssetData(asset, data);
    });
    
    // Update displays
    this.renderAllAssetsSignals();
    this.updateMainDisplayWithAssetData();
    this.updateMetrics();
  }
  
  processAssetData(asset, data) {
    // Calculate signal based on your strategy
    const signal = this.calculateSignal(data.rsi, data.previousRsi || data.rsi - 2);
    
    // Store asset data
    this.assetData[asset.symbol] = {
      price: data.price,
      rsi: data.rsi,
      signal: signal.direction,
      confidence: signal.confidence,
      reason: signal.reason,
      lastUpdate: new Date()
    };
    
    // Log significant signals
    if (signal.direction !== 'NONE' && signal.confidence > 70) {
      this.signalCount++;
      this.logSignal(asset, data, signal);
      
      // Update verification stats
      this.updateVerificationStats(signal);
    }
  }
  
  calculateSignal(currentRSI, previousRSI) {
    let direction = 'HOLD';
    let reason = 'Monitoring';
    let confidence = 0;
    
    // Your exact strategy rules
    if (currentRSI <= 12 && previousRSI > currentRSI) {
      direction = 'BUY';
      reason = 'Extreme Buy Reversal (RSI ≤ 12)';
      confidence = 95;
    } else if (currentRSI >= 88 && previousRSI < currentRSI) {
      direction = 'SELL';
      reason = 'Extreme Sell Reversal (RSI ≥ 88)';
      confidence = 95;
    } else if (currentRSI >= 13 && currentRSI <= 20 && previousRSI > currentRSI) {
      direction = 'BUY';
      reason = 'Strong Buy Zone (RSI 13-20)';
      confidence = 80;
    } else if (currentRSI >= 80 && currentRSI <= 87 && previousRSI < currentRSI) {
      direction = 'SELL';
      reason = 'Strong Sell Zone (RSI 80-87)';
      confidence = 80;
    } else if (previousRSI < 50 && currentRSI > 50) {
      direction = 'BUY';
      reason = 'Trend Start (RSI crosses above 50)';
      confidence = 70;
    } else if (previousRSI > 50 && currentRSI < 50) {
      direction = 'SELL';
      reason = 'Trend Start (RSI crosses below 50)';
      confidence = 70;
    } else if (currentRSI <= 30 && previousRSI <= currentRSI) {
      direction = 'BUY';
      reason = 'Oversold Region (RSI ≤ 30)';
      confidence = 75;
    } else if (currentRSI >= 70 && previousRSI >= currentRSI) {
      direction = 'SELL';
      reason = 'Overbought Region (RSI ≥ 70)';
      confidence = 75;
    }
    
    return { direction, reason, confidence, rsi: currentRSI };
  }
  
  updateSignalDisplay(data) {
    const display = document.getElementById('signalDisplay');
    const signalText = document.getElementById('signalText');
    const rsiValue = document.getElementById('rsiValue');
    
    // Reset display classes
    display.className = 'card signal-display-card';
    
    if (data.signal === 'BUY') {
      display.classList.add('buy-signal');
      signalText.textContent = 'BUY';
      signalText.style.color = '#4caf50';
    } else if (data.signal === 'SELL') {
      display.classList.add('sell-signal');
      signalText.textContent = 'SELL';
      signalText.style.color = '#f44336';
    } else {
      signalText.textContent = 'HOLD';
      signalText.style.color = '#ff9800';
    }
    
    rsiValue.textContent = `RSI: ${data.rsi.toFixed(2)}`;
    
    // Update other details
    document.getElementById('currentAsset').textContent = this.currentAsset.symbol;
    document.getElementById('currentTimeframe').textContent = this.currentTimeframe;
    document.getElementById('confidenceLevel').textContent = data.confidence ? `${data.confidence}%` : '--%';
    
    // Update stochastic indicator
    this.updateStochasticIndicator(data.rsi);
  }
  
  updateStochasticIndicator(rsi) {
    const indicator = document.getElementById('stochasticIndicator');
    const valueSpan = document.getElementById('stochasticValue');
    
    valueSpan.textContent = rsi.toFixed(1);
    
    // Calculate position (0-100%)
    let position;
    if (rsi <= 12) {
      position = 6; // Start of oversold zone
      indicator.style.background = '#4caf50';
    } else if (rsi <= 20) {
      position = 12 + ((rsi - 12) / 8) * 8; // Buy zone
      indicator.style.background = '#8bc34a';
    } else if (rsi <= 80) {
      position = 20 + ((rsi - 20) / 60) * 60; // Neutral zone
      indicator.style.background = '#00d4ff';
    } else if (rsi <= 87) {
      position = 80 + ((rsi - 80) / 7) * 8; // Sell zone
      indicator.style.background = '#ff5722';
    } else {
      position = 88 + ((rsi - 87) / 13) * 12; // Overbought zone
      indicator.style.background = '#f44336';
    }
    
    indicator.style.left = `${position}%`;
  }
  
  updateMetrics() {
    // Update accuracy metric
    const accuracy = this.verificationStats.total > 0 ?
      (this.verificationStats.matches / this.verificationStats.total) * 100 : 0;
    
    document.getElementById('accuracyMetric').textContent = `${accuracy.toFixed(1)}%`;
    document.getElementById('signalsToday').textContent = this.signalCount;
    
    // Signal quality color
    const accuracyEl = document.getElementById('accuracyMetric');
    if (accuracy >= 80) {
      accuracyEl.style.color = '#4caf50';
    } else if (accuracy >= 60) {
      accuracyEl.style.color = '#ff9800';
    } else {
      accuracyEl.style.color = '#f44336';
    }
  }
  
  updateUptime() {
    if (!this.engineStartTime) return;
    
    const uptimeMs = Date.now() - this.engineStartTime;
    const hours = Math.floor(uptimeMs / (1000 * 60 * 60));
    const minutes = Math.floor((uptimeMs % (1000 * 60 * 60)) / (1000 * 60));
    
    document.getElementById('uptimeMetric').textContent = `${hours}h ${minutes}m`;
  }
  
  updateVerificationStats(signal) {
    // Simulate verification against external sources
    if (signal.direction !== 'HOLD') {
      this.verificationStats.total++;
      
      // Simulate 85% match rate with external charts
      const matchesExternal = Math.random() < 0.85;
      if (matchesExternal) {
        this.verificationStats.matches++;
      }
    }
  }
  
  logSignal(asset, data, signal) {
    const time = new Date().toLocaleTimeString();
    const logClass = signal.direction === 'BUY' ? 'log-buy' : 'log-sell';
    
    const logEntry = document.createElement('div');
    logEntry.className = 'log-entry';
    logEntry.innerHTML = `
      <div class="log-time">${time}</div>
      <div class="log-content ${logClass}">
        <strong>${signal.direction}</strong> ${asset.symbol} at RSI ${data.rsi.toFixed(2)}
        <span style="color: var(--text-muted); font-size: 0.8em;"> - ${signal.reason}</span>
      </div>
    `;
    
    const logsContainer = document.getElementById('signalLogs');
    logsContainer.prepend(logEntry);
    
    // Keep only last 20 logs
    if (logsContainer.children.length > 20) {
      logsContainer.removeChild(logsContainer.lastChild);
    }
  }
  
  updateLog(message, type = 'system') {
    const time = new Date().toLocaleTimeString();
    const typeClass = `log-${type}`;
    
    const logEntry = document.createElement('div');
    logEntry.className = 'log-entry';
    logEntry.innerHTML = `
      <div class="log-time">${time}</div>
      <div class="log-content ${typeClass}">${message}</div>
    `;
    
    const logsContainer = document.getElementById('signalLogs');
    logsContainer.prepend(logEntry);
    
    // Keep only last 20 logs
    if (logsContainer.children.length > 20) {
      logsContainer.removeChild(logsContainer.lastChild);
    }
  }
  
  startEngine() {
    if (this.isRunning) return;
    
    this.isRunning = true;
    this.engineStartTime = Date.now();
    this.signalCount = 0;
    
    document.getElementById('startEngineBtn').disabled = true;
    document.getElementById('stopEngineBtn').disabled = false;
    document.getElementById('connectionStatus').classList.remove('offline');
    
    this.updateLog('Signal engine started', 'system');
    this.updateUptime();
    
    // Start periodic updates
    this.engineInterval = setInterval(() => {
      this.updateUptime();
    }, 60000); // Update uptime every minute
    
    // Start data stream based on connection
    if (this.apiConnected) {
      this.startMT5DataStream();
    } else {
      this.startSimulatedDataStream();
    }
  }
  
  stopEngine() {
    if (!this.isRunning) return;
    
    clearInterval(this.engineInterval);
    clearInterval(this.mt5Interval);
    clearInterval(this.simInterval);
    
    this.isRunning = false;
    
    document.getElementById('startEngineBtn').disabled = false;
    document.getElementById('stopEngineBtn').disabled = true;
    
    this.updateLog('Signal engine stopped', 'system');
    this.updateUI();
  }
  
  refreshAllData() {
    this.updateLog('Manual refresh requested for all assets', 'system');
    if (this.isRunning) {
      if (this.apiConnected) {
        this.fetchAllAssetsData();
      } else {
        this.generateSimulatedDataForAllAssets();
      }
    }
  }
  
  async testMT5Connection() {
    const server = document.getElementById('mt5Server').value;
    const account = document.getElementById('mt5Account').value;
    const password = document.getElementById('mt5Password').value;
    
    if (!server || !account || !password) {
      this.updateLog('Please enter MT5 credentials first', 'error');
      return;
    }
    
    this.updateLog(`Testing MT5 connection to ${server}...`, 'system');
    
    // Show testing state
    const testBtn = document.getElementById('testMT5Btn');
    const originalText = testBtn.innerHTML;
    testBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
    testBtn.disabled = true;
    
    try {
      // Simulate connection test
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Simulate test result
      const success = Math.random() > 0.3; // 70% success rate
      
      if (success) {
        this.updateLog(`MT5 connection test successful! Server: ${server}, Account: ${account}`, 'success');
        
        // Pre-fill the connection with test credentials
        document.getElementById('connectApiBtn').click();
        
      } else {
        throw new Error('Connection test failed. Check server/credentials.');
      }
      
    } catch (error) {
      this.updateLog(`MT5 Test Failed: ${error.message}`, 'error');
      
      // Show help for common issues
      this.updateLog('Tip: Use "MetaQuotes-Demo" server with demo credentials', 'warning');
      
    } finally {
      // Reset button
      testBtn.innerHTML = originalText;
      testBtn.disabled = false;
    }
  }
  
  testCustomAPIConnection() {
    this.updateLog('Custom API test not implemented yet', 'warning');
  }
  
  disconnectAPI() {
    clearInterval(this.mt5Interval);
    clearInterval(this.simInterval);
    
    this.apiConnected = false;
    document.getElementById('apiStatus').classList.add('offline');
    document.getElementById('apiStatus').querySelector('.status-dot').classList.add('offline');
    document.getElementById('apiStatus').querySelector('span').textContent = 'DISCONNECTED';
    
    this.updateLog('Disconnected from API', 'system');
    
    // If engine is running, switch to simulated data
    if (this.isRunning) {
      this.startSimulatedDataStream();
    }
  }
  
  updateUI() {
    // Update UI elements based on current state
    const statusBadge = document.getElementById('connectionStatus');
    if (this.isRunning) {
      statusBadge.classList.remove('offline');
      statusBadge.querySelector('.status-dot').classList.remove('offline');
      statusBadge.querySelector('span').textContent = 'LIVE';
    } else {
      statusBadge.classList.add('offline');
      statusBadge.querySelector('.status-dot').classList.add('offline');
      statusBadge.querySelector('span').textContent = 'OFFLINE';
    }
  }
  
  // Utility methods
  generateRealisticRSI() {
    // Generate RSI with realistic market behavior
    const time = Date.now() / 1000;
    const baseOscillation = 50 + Math.sin(time / 60) * 10; // 1-minute cycle
    const mediumOscillation = Math.sin(time / 300) * 15; // 5-minute cycle
    const slowTrend = Math.sin(time / 1800) * 5; // 30-minute trend
    const noise = (Math.random() - 0.5) * 4;
    
    let rsi = baseOscillation + mediumOscillation + slowTrend + noise;
    
    // Keep within bounds
    rsi = Math.max(0, Math.min(100, rsi));
    
    return rsi;
  }
  
  fetchMarketData() {
    // Individual asset fetch (legacy method)
    if (this.apiConnected) {
      this.fetchAllAssetsData();
    } else {
      this.generateSimulatedDataForAllAssets();
    }
  }
}

// Initialize the application
const app = new KillerZonePro();

// Auto-start engine after 3 seconds (for demo)
setTimeout(() => {
  app.startEngine();
}, 3000);

// Auto-test MT5 connection (for demo)
setTimeout(() => {
  document.getElementById('testMT5Btn').click();
}, 1000);
</script>
</body>
</html>
