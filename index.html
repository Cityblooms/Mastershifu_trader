        // Update market status
        function updateMarketStatus() {
            const isOpen = isMarketOpen();
            const statusDiv = document.getElementById('marketStatus');
            
            if (isOpen) {
                statusDiv.innerHTML = `
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span style="color: #00b894; font-weight: bold; font-size: 0.9em;">LIVE MARKET</span>
                    </div>
                `;
            } else {
                statusDiv.innerHTML = `
                    <div style="color: #ff7675; font-weight: bold; font-size: 0.9em;">
                        MARKET CLOSED
                    </div>
                `;
            }
        }

        // Simulate RSI calculation (in real app, this would come from TradingView API)
        function calculateRSI(prices, period = RSI_PERIOD) {
            if (prices.length < period + 1) return 50;
            
            let gains = 0;
            let losses = 0;
            
            for (let i = 1; i <= period; i++) {
                const diff = prices[i] - prices[i - 1];
                if (diff >= 0) {
                    gains += diff;
                } else {
                    losses -= diff;
                }
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            
            if (avgLoss === 0) return 100;
            
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        // Generate signal based on RSI
        function generateSignal(rsiValue) {
            const signal = {
                type: 'NEUTRAL',
                strength: 'Medium',
                confidence: 50,
                conditions: []
            };
            
            // Extreme overbought
            if (rsiValue >= 80) {
                signal.type = 'STRONG SELL';
                signal.strength = 'Very Strong';
                signal.confidence = 85;
                signal.conditions = [
                    '‚úì RSI above 80 (Extreme Overbought)',
                    '‚úì Price likely to reverse down',
                    '‚úì Consider short positions'
                ];
            }
            // Overbought
            else if (rsiValue >= 70) {
                signal.type = 'SELL';
                signal.strength = 'Strong';
                signal.confidence = 70;
                signal.conditions = [
                    '‚úì RSI above 70 (Overbought)',
                    '‚úì Caution for longs',
                    '‚úì Look for bearish patterns'
                ];
            }
            // Oversold
            else if (rsiValue <= 30) {
                signal.type = 'BUY';
                signal.strength = 'Strong';
                signal.confidence = 70;
                signal.conditions = [
                    '‚úì RSI below 30 (Oversold)',
                    '‚úì Price likely to bounce',
                    '‚úì Consider long positions'
                ];
            }
            // Extreme oversold
            else if (rsiValue <= 20) {
                signal.type = 'STRONG BUY';
                signal.strength = 'Very Strong';
                signal.confidence = 85;
                signal.conditions = [
                    '‚úì RSI below 20 (Extreme Oversold)',
                    '‚úì Strong bounce expected',
                    '‚úì Good long entry zone'
                ];
            }
            // Neutral with bullish bias
            else if (rsiValue > 50) {
                signal.type = 'NEUTRAL-BULLISH';
                signal.strength = 'Medium';
                signal.confidence = 60;
                signal.conditions = [
                    '‚úì RSI above 50 (Bullish bias)',
                    '‚úì Wait for better entry',
                    '‚úì Monitor for breakout'
                ];
            }
            // Neutral with bearish bias
            else if (rsiValue < 50) {
                signal.type = 'NEUTRAL-BEARISH';
                signal.strength = 'Medium';
                signal.confidence = 60;
                signal.conditions = [
                    '‚úì RSI below 50 (Bearish bias)',
                    '‚úì Wait for confirmation',
                    '‚úì Monitor support levels'
                ];
            }
            
            return signal;
        }

        // Update signal display
        function updateSignalDisplay(signal) {
            const badge = document.getElementById('signalBadge');
            badge.textContent = signal.type;
            
            // Remove all signal classes
            badge.classList.remove('signal-buy', 'signal-sell', 'signal-neutral');
            
            // Add appropriate class
            if (signal.type.includes('BUY')) {
                badge.classList.add('signal-buy');
            } else if (signal.type.includes('SELL')) {
                badge.classList.add('signal-sell');
            } else {
                badge.classList.add('signal-neutral');
            }
            
            // Update metrics
            document.getElementById('rsiDisplay').textContent = signal.rsi?.toFixed(2) || '--';
            document.getElementById('strengthDisplay').textContent = signal.strength;
            document.getElementById('trendDisplay').textContent = signal.trend || '--';
            document.getElementById('priceDisplay').textContent = signal.price || '--';
            
            // Update conditions list
            const conditionsList = document.getElementById('conditionsList');
            if (signal.conditions && signal.conditions.length > 0) {
                conditionsList.innerHTML = `
                    <h3>Signal Analysis</h3>
                    ${signal.conditions.map(cond => `
                        <div class="condition-item">
                            <span class="condition-icon">${cond.startsWith('‚úì') ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                            <span class="${cond.startsWith('‚úì') ? 'condition-met' : 'condition-not-met'}">${cond}</span>
                        </div>
                    `).join('')}
                `;
            }
        }

        // Generate realistic mock data
        function generateMockData() {
            const now = new Date();
            const hour = now.getUTCHours();
            const isPeak = hour >= 13 && hour < 16;
            
            // Base RSI with market session influence
            let baseRSI = 50;
            if (isPeak) {
                baseRSI += (Math.random() - 0.5) * 40; // More volatility during peak
            } else {
                baseRSI += (Math.random() - 0.5) * 20;
            }
            
            // Ensure RSI stays within 0-100 bounds
            baseRSI = Math.max(0, Math.min(100, baseRSI));
            
            // Price simulation
            const price = 2350 + (Math.random() - 0.5) * 50;
            
            const signal = generateSignal(baseRSI);
            signal.rsi = baseRSI;
            signal.price = `$${price.toFixed(2)}`;
            signal.trend = baseRSI > 50 ? 'Bullish' : 'Bearish';
            
            return signal;
        }

        // Update all displays
        function updateDashboard() {
            try {
                // Update market info
                updateMarketStatus();
                updateSessionDisplay();
                
                // Generate and update signal
                const signal = generateMockData();
                updateSignalDisplay(signal);
                
                // Update timestamp
                const now = new Date();
                document.getElementById('lastUpdate').innerHTML = 
                    `Last updated: ${now.toUTCString().replace('GMT', 'GMT')}`;
                
                // Update error container (clear if no errors)
                document.getElementById('errorContainer').innerHTML = '';
                
            } catch (error) {
                console.error('Error updating dashboard:', error);
                document.getElementById('errorContainer').innerHTML = `
                    <div class="error-message">
                        ‚ö†Ô∏è Error updating data: ${error.message}
                    </div>
                `;
            }
        }

        // Start data collection
        function startDataCollection() {
            // Initial update
            updateDashboard();
            
            // Update every 10 seconds
            setInterval(updateDashboard, 10000);
            
            // Also update on price changes (simulated)
            setInterval(() => {
                if (Math.random() > 0.7) { // 30% chance to trigger update
                    updateDashboard();
                }
            }, 3000);
        }

        // Refresh data manually
        function refreshData() {
            const btn = document.getElementById('refreshBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '‚è≥ Updating...';
            btn.disabled = true;
            
            updateDashboard();
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 1000);
        }

        // Reset data
        function resetData() {
            priceHistory = [];
            updateDashboard();
            
            // Show reset notification
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `
                <div class="error-message" style="background: rgba(255, 215, 0, 0.1); border-color: rgba(255, 215, 0, 0.3); color: #ffd700;">
                    üîÑ Data reset complete. Starting fresh collection...
                </div>
            `;
            
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 3000);
        }

        // Initialize everything when page loads
        window.addEventListener('DOMContentLoaded', () => {
            // Initialize TradingView chart
            initTradingViewChart();
            
            // Set up periodic session updates
            setInterval(updateSessionDisplay, 60000); // Update every minute
            
            // Initial display setup
            document.getElementById('timeframeDisplay').textContent = 'Timeframe: 1H';
            
            // Set up error handling for TradingView
            window.addEventListener('error', function(e) {
                console.error('Global error:', e);
                document.getElementById('errorContainer').innerHTML = `
                    <div class="error-message">
                        ‚ö†Ô∏è Script error detected. Please refresh the page.
                    </div>
                `;
            });
            
            // Simulate initial loading delay
            setTimeout(() => {
                const loading = document.querySelector('.conditions-list .loading');
                if (loading) {
                    loading.style.display = 'none';
                }
            }, 2000);
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // Page became visible, refresh data
                updateDashboard();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Refresh with F5
            if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                e.preventDefault();
                refreshData();
            }
            // Reset with Ctrl+Shift+R
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                e.preventDefault();
                resetData();
            }
        });
    </script>
</body>
</html>
